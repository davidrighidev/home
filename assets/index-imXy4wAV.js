(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();var wh={exports:{}},Sl={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var By;function kA(){if(By)return Sl;By=1;var l=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(i,s,r){var o=null;if(r!==void 0&&(o=""+r),s.key!==void 0&&(o=""+s.key),"key"in s){r={};for(var c in s)c!=="key"&&(r[c]=s[c])}else r=s;return s=r.ref,{$$typeof:l,type:i,key:o,ref:s!==void 0?s:null,props:r}}return Sl.Fragment=t,Sl.jsx=e,Sl.jsxs=e,Sl}var Fy;function MA(){return Fy||(Fy=1,wh.exports=kA()),wh.exports}var rt=MA(),kh={exports:{}},At={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $y;function PA(){if($y)return At;$y=1;var l=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),o=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.iterator;function y(k){return k===null||typeof k!="object"?null:(k=m&&k[m]||k["@@iterator"],typeof k=="function"?k:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,S={};function x(k,$,j){this.props=k,this.context=$,this.refs=S,this.updater=j||v}x.prototype.isReactComponent={},x.prototype.setState=function(k,$){if(typeof k!="object"&&typeof k!="function"&&k!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,k,$,"setState")},x.prototype.forceUpdate=function(k){this.updater.enqueueForceUpdate(this,k,"forceUpdate")};function _(){}_.prototype=x.prototype;function L(k,$,j){this.props=k,this.context=$,this.refs=S,this.updater=j||v}var R=L.prototype=new _;R.constructor=L,T(R,x.prototype),R.isPureReactComponent=!0;var C=Array.isArray,I={H:null,A:null,T:null,S:null,V:null},U=Object.prototype.hasOwnProperty;function O(k,$,j,st,ut,ft){return j=ft.ref,{$$typeof:l,type:k,key:$,ref:j!==void 0?j:null,props:ft}}function M(k,$){return O(k.type,$,void 0,void 0,void 0,k.props)}function w(k){return typeof k=="object"&&k!==null&&k.$$typeof===l}function N(k){var $={"=":"=0",":":"=2"};return"$"+k.replace(/[=:]/g,function(j){return $[j]})}var z=/\/+/g;function J(k,$){return typeof k=="object"&&k!==null&&k.key!=null?N(""+k.key):$.toString(36)}function lt(){}function ct(k){switch(k.status){case"fulfilled":return k.value;case"rejected":throw k.reason;default:switch(typeof k.status=="string"?k.then(lt,lt):(k.status="pending",k.then(function($){k.status==="pending"&&(k.status="fulfilled",k.value=$)},function($){k.status==="pending"&&(k.status="rejected",k.reason=$)})),k.status){case"fulfilled":return k.value;case"rejected":throw k.reason}}throw k}function at(k,$,j,st,ut){var ft=typeof k;(ft==="undefined"||ft==="boolean")&&(k=null);var ht=!1;if(k===null)ht=!0;else switch(ft){case"bigint":case"string":case"number":ht=!0;break;case"object":switch(k.$$typeof){case l:case t:ht=!0;break;case g:return ht=k._init,at(ht(k._payload),$,j,st,ut)}}if(ht)return ut=ut(k),ht=st===""?"."+J(k,0):st,C(ut)?(j="",ht!=null&&(j=ht.replace(z,"$&/")+"/"),at(ut,$,j,"",function(ce){return ce})):ut!=null&&(w(ut)&&(ut=M(ut,j+(ut.key==null||k&&k.key===ut.key?"":(""+ut.key).replace(z,"$&/")+"/")+ht)),$.push(ut)),1;ht=0;var Nt=st===""?".":st+":";if(C(k))for(var _t=0;_t<k.length;_t++)st=k[_t],ft=Nt+J(st,_t),ht+=at(st,$,j,ft,ut);else if(_t=y(k),typeof _t=="function")for(k=_t.call(k),_t=0;!(st=k.next()).done;)st=st.value,ft=Nt+J(st,_t++),ht+=at(st,$,j,ft,ut);else if(ft==="object"){if(typeof k.then=="function")return at(ct(k),$,j,st,ut);throw $=String(k),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(k).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return ht}function B(k,$,j){if(k==null)return k;var st=[],ut=0;return at(k,st,"","",function(ft){return $.call(j,ft,ut++)}),st}function q(k){if(k._status===-1){var $=k._result;$=$(),$.then(function(j){(k._status===0||k._status===-1)&&(k._status=1,k._result=j)},function(j){(k._status===0||k._status===-1)&&(k._status=2,k._result=j)}),k._status===-1&&(k._status=0,k._result=$)}if(k._status===1)return k._result.default;throw k._result}var W=typeof reportError=="function"?reportError:function(k){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof k=="object"&&k!==null&&typeof k.message=="string"?String(k.message):String(k),error:k});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",k);return}console.error(k)};function ot(){}return At.Children={map:B,forEach:function(k,$,j){B(k,function(){$.apply(this,arguments)},j)},count:function(k){var $=0;return B(k,function(){$++}),$},toArray:function(k){return B(k,function($){return $})||[]},only:function(k){if(!w(k))throw Error("React.Children.only expected to receive a single React element child.");return k}},At.Component=x,At.Fragment=e,At.Profiler=s,At.PureComponent=L,At.StrictMode=i,At.Suspense=h,At.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,At.__COMPILER_RUNTIME={__proto__:null,c:function(k){return I.H.useMemoCache(k)}},At.cache=function(k){return function(){return k.apply(null,arguments)}},At.cloneElement=function(k,$,j){if(k==null)throw Error("The argument must be a React element, but you passed "+k+".");var st=T({},k.props),ut=k.key,ft=void 0;if($!=null)for(ht in $.ref!==void 0&&(ft=void 0),$.key!==void 0&&(ut=""+$.key),$)!U.call($,ht)||ht==="key"||ht==="__self"||ht==="__source"||ht==="ref"&&$.ref===void 0||(st[ht]=$[ht]);var ht=arguments.length-2;if(ht===1)st.children=j;else if(1<ht){for(var Nt=Array(ht),_t=0;_t<ht;_t++)Nt[_t]=arguments[_t+2];st.children=Nt}return O(k.type,ut,void 0,void 0,ft,st)},At.createContext=function(k){return k={$$typeof:o,_currentValue:k,_currentValue2:k,_threadCount:0,Provider:null,Consumer:null},k.Provider=k,k.Consumer={$$typeof:r,_context:k},k},At.createElement=function(k,$,j){var st,ut={},ft=null;if($!=null)for(st in $.key!==void 0&&(ft=""+$.key),$)U.call($,st)&&st!=="key"&&st!=="__self"&&st!=="__source"&&(ut[st]=$[st]);var ht=arguments.length-2;if(ht===1)ut.children=j;else if(1<ht){for(var Nt=Array(ht),_t=0;_t<ht;_t++)Nt[_t]=arguments[_t+2];ut.children=Nt}if(k&&k.defaultProps)for(st in ht=k.defaultProps,ht)ut[st]===void 0&&(ut[st]=ht[st]);return O(k,ft,void 0,void 0,null,ut)},At.createRef=function(){return{current:null}},At.forwardRef=function(k){return{$$typeof:c,render:k}},At.isValidElement=w,At.lazy=function(k){return{$$typeof:g,_payload:{_status:-1,_result:k},_init:q}},At.memo=function(k,$){return{$$typeof:f,type:k,compare:$===void 0?null:$}},At.startTransition=function(k){var $=I.T,j={};I.T=j;try{var st=k(),ut=I.S;ut!==null&&ut(j,st),typeof st=="object"&&st!==null&&typeof st.then=="function"&&st.then(ot,W)}catch(ft){W(ft)}finally{I.T=$}},At.unstable_useCacheRefresh=function(){return I.H.useCacheRefresh()},At.use=function(k){return I.H.use(k)},At.useActionState=function(k,$,j){return I.H.useActionState(k,$,j)},At.useCallback=function(k,$){return I.H.useCallback(k,$)},At.useContext=function(k){return I.H.useContext(k)},At.useDebugValue=function(){},At.useDeferredValue=function(k,$){return I.H.useDeferredValue(k,$)},At.useEffect=function(k,$,j){var st=I.H;if(typeof j=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return st.useEffect(k,$)},At.useId=function(){return I.H.useId()},At.useImperativeHandle=function(k,$,j){return I.H.useImperativeHandle(k,$,j)},At.useInsertionEffect=function(k,$){return I.H.useInsertionEffect(k,$)},At.useLayoutEffect=function(k,$){return I.H.useLayoutEffect(k,$)},At.useMemo=function(k,$){return I.H.useMemo(k,$)},At.useOptimistic=function(k,$){return I.H.useOptimistic(k,$)},At.useReducer=function(k,$,j){return I.H.useReducer(k,$,j)},At.useRef=function(k){return I.H.useRef(k)},At.useState=function(k){return I.H.useState(k)},At.useSyncExternalStore=function(k,$,j){return I.H.useSyncExternalStore(k,$,j)},At.useTransition=function(){return I.H.useTransition()},At.version="19.1.1",At}var Gy;function tg(){return Gy||(Gy=1,kh.exports=PA()),kh.exports}var Z=tg(),Mh={exports:{}},xl={},Ph={exports:{}},Nh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hy;function NA(){return Hy||(Hy=1,function(l){function t(B,q){var W=B.length;B.push(q);t:for(;0<W;){var ot=W-1>>>1,k=B[ot];if(0<s(k,q))B[ot]=q,B[W]=k,W=ot;else break t}}function e(B){return B.length===0?null:B[0]}function i(B){if(B.length===0)return null;var q=B[0],W=B.pop();if(W!==q){B[0]=W;t:for(var ot=0,k=B.length,$=k>>>1;ot<$;){var j=2*(ot+1)-1,st=B[j],ut=j+1,ft=B[ut];if(0>s(st,W))ut<k&&0>s(ft,st)?(B[ot]=ft,B[ut]=W,ot=ut):(B[ot]=st,B[j]=W,ot=j);else if(ut<k&&0>s(ft,W))B[ot]=ft,B[ut]=W,ot=ut;else break t}}return q}function s(B,q){var W=B.sortIndex-q.sortIndex;return W!==0?W:B.id-q.id}if(l.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;l.unstable_now=function(){return r.now()}}else{var o=Date,c=o.now();l.unstable_now=function(){return o.now()-c}}var h=[],f=[],g=1,m=null,y=3,v=!1,T=!1,S=!1,x=!1,_=typeof setTimeout=="function"?setTimeout:null,L=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function C(B){for(var q=e(f);q!==null;){if(q.callback===null)i(f);else if(q.startTime<=B)i(f),q.sortIndex=q.expirationTime,t(h,q);else break;q=e(f)}}function I(B){if(S=!1,C(B),!T)if(e(h)!==null)T=!0,U||(U=!0,J());else{var q=e(f);q!==null&&at(I,q.startTime-B)}}var U=!1,O=-1,M=5,w=-1;function N(){return x?!0:!(l.unstable_now()-w<M)}function z(){if(x=!1,U){var B=l.unstable_now();w=B;var q=!0;try{t:{T=!1,S&&(S=!1,L(O),O=-1),v=!0;var W=y;try{e:{for(C(B),m=e(h);m!==null&&!(m.expirationTime>B&&N());){var ot=m.callback;if(typeof ot=="function"){m.callback=null,y=m.priorityLevel;var k=ot(m.expirationTime<=B);if(B=l.unstable_now(),typeof k=="function"){m.callback=k,C(B),q=!0;break e}m===e(h)&&i(h),C(B)}else i(h);m=e(h)}if(m!==null)q=!0;else{var $=e(f);$!==null&&at(I,$.startTime-B),q=!1}}break t}finally{m=null,y=W,v=!1}q=void 0}}finally{q?J():U=!1}}}var J;if(typeof R=="function")J=function(){R(z)};else if(typeof MessageChannel<"u"){var lt=new MessageChannel,ct=lt.port2;lt.port1.onmessage=z,J=function(){ct.postMessage(null)}}else J=function(){_(z,0)};function at(B,q){O=_(function(){B(l.unstable_now())},q)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(B){B.callback=null},l.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<B?Math.floor(1e3/B):5},l.unstable_getCurrentPriorityLevel=function(){return y},l.unstable_next=function(B){switch(y){case 1:case 2:case 3:var q=3;break;default:q=y}var W=y;y=q;try{return B()}finally{y=W}},l.unstable_requestPaint=function(){x=!0},l.unstable_runWithPriority=function(B,q){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var W=y;y=B;try{return q()}finally{y=W}},l.unstable_scheduleCallback=function(B,q,W){var ot=l.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?ot+W:ot):W=ot,B){case 1:var k=-1;break;case 2:k=250;break;case 5:k=1073741823;break;case 4:k=1e4;break;default:k=5e3}return k=W+k,B={id:g++,callback:q,priorityLevel:B,startTime:W,expirationTime:k,sortIndex:-1},W>ot?(B.sortIndex=W,t(f,B),e(h)===null&&B===e(f)&&(S?(L(O),O=-1):S=!0,at(I,W-ot))):(B.sortIndex=k,t(h,B),T||v||(T=!0,U||(U=!0,J()))),B},l.unstable_shouldYield=N,l.unstable_wrapCallback=function(B){var q=y;return function(){var W=y;y=q;try{return B.apply(this,arguments)}finally{y=W}}}}(Nh)),Nh}var Vy;function UA(){return Vy||(Vy=1,Ph.exports=NA()),Ph.exports}var Uh={exports:{}},Ue={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ky;function BA(){if(Ky)return Ue;Ky=1;var l=tg();function t(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)f+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var i={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},s=Symbol.for("react.portal");function r(h,f,g){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:m==null?null:""+m,children:h,containerInfo:f,implementation:g}}var o=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Ue.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Ue.createPortal=function(h,f){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(t(299));return r(h,f,null,g)},Ue.flushSync=function(h){var f=o.T,g=i.p;try{if(o.T=null,i.p=2,h)return h()}finally{o.T=f,i.p=g,i.d.f()}},Ue.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,i.d.C(h,f))},Ue.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},Ue.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var g=f.as,m=c(g,f.crossOrigin),y=typeof f.integrity=="string"?f.integrity:void 0,v=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;g==="style"?i.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:m,integrity:y,fetchPriority:v}):g==="script"&&i.d.X(h,{crossOrigin:m,integrity:y,fetchPriority:v,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Ue.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var g=c(f.as,f.crossOrigin);i.d.M(h,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&i.d.M(h)},Ue.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var g=f.as,m=c(g,f.crossOrigin);i.d.L(h,g,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Ue.preloadModule=function(h,f){if(typeof h=="string")if(f){var g=c(f.as,f.crossOrigin);i.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else i.d.m(h)},Ue.requestFormReset=function(h){i.d.r(h)},Ue.unstable_batchedUpdates=function(h,f){return h(f)},Ue.useFormState=function(h,f,g){return o.H.useFormState(h,f,g)},Ue.useFormStatus=function(){return o.H.useHostTransitionStatus()},Ue.version="19.1.1",Ue}var zy;function FA(){if(zy)return Uh.exports;zy=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(t){console.error(t)}}return l(),Uh.exports=BA(),Uh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yy;function $A(){if(Yy)return xl;Yy=1;var l=UA(),t=tg(),e=FA();function i(n){var a="https://react.dev/errors/"+n;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)a+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+n+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function r(n){var a=n,u=n;if(n.alternate)for(;a.return;)a=a.return;else{n=a;do a=n,(a.flags&4098)!==0&&(u=a.return),n=a.return;while(n)}return a.tag===3?u:null}function o(n){if(n.tag===13){var a=n.memoizedState;if(a===null&&(n=n.alternate,n!==null&&(a=n.memoizedState)),a!==null)return a.dehydrated}return null}function c(n){if(r(n)!==n)throw Error(i(188))}function h(n){var a=n.alternate;if(!a){if(a=r(n),a===null)throw Error(i(188));return a!==n?null:n}for(var u=n,d=a;;){var p=u.return;if(p===null)break;var E=p.alternate;if(E===null){if(d=p.return,d!==null){u=d;continue}break}if(p.child===E.child){for(E=p.child;E;){if(E===u)return c(p),n;if(E===d)return c(p),a;E=E.sibling}throw Error(i(188))}if(u.return!==d.return)u=p,d=E;else{for(var b=!1,D=p.child;D;){if(D===u){b=!0,u=p,d=E;break}if(D===d){b=!0,d=p,u=E;break}D=D.sibling}if(!b){for(D=E.child;D;){if(D===u){b=!0,u=E,d=p;break}if(D===d){b=!0,d=E,u=p;break}D=D.sibling}if(!b)throw Error(i(189))}}if(u.alternate!==d)throw Error(i(190))}if(u.tag!==3)throw Error(i(188));return u.stateNode.current===u?n:a}function f(n){var a=n.tag;if(a===5||a===26||a===27||a===6)return n;for(n=n.child;n!==null;){if(a=f(n),a!==null)return a;n=n.sibling}return null}var g=Object.assign,m=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),L=Symbol.for("react.consumer"),R=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),w=Symbol.for("react.activity"),N=Symbol.for("react.memo_cache_sentinel"),z=Symbol.iterator;function J(n){return n===null||typeof n!="object"?null:(n=z&&n[z]||n["@@iterator"],typeof n=="function"?n:null)}var lt=Symbol.for("react.client.reference");function ct(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===lt?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case T:return"Fragment";case x:return"Profiler";case S:return"StrictMode";case I:return"Suspense";case U:return"SuspenseList";case w:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case v:return"Portal";case R:return(n.displayName||"Context")+".Provider";case L:return(n._context.displayName||"Context")+".Consumer";case C:var a=n.render;return n=n.displayName,n||(n=a.displayName||a.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case O:return a=n.displayName||null,a!==null?a:ct(n.type)||"Memo";case M:a=n._payload,n=n._init;try{return ct(n(a))}catch{}}return null}var at=Array.isArray,B=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W={pending:!1,data:null,method:null,action:null},ot=[],k=-1;function $(n){return{current:n}}function j(n){0>k||(n.current=ot[k],ot[k]=null,k--)}function st(n,a){k++,ot[k]=n.current,n.current=a}var ut=$(null),ft=$(null),ht=$(null),Nt=$(null);function _t(n,a){switch(st(ht,a),st(ft,n),st(ut,null),a.nodeType){case 9:case 11:n=(n=a.documentElement)&&(n=n.namespaceURI)?hy(n):0;break;default:if(n=a.tagName,a=a.namespaceURI)a=hy(a),n=dy(a,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}j(ut),st(ut,n)}function ce(){j(ut),j(ft),j(ht)}function Ve(n){n.memoizedState!==null&&st(Nt,n);var a=ut.current,u=dy(a,n.type);a!==u&&(st(ft,n),st(ut,u))}function Ti(n){ft.current===n&&(j(ut),j(ft)),Nt.current===n&&(j(Nt),pl._currentValue=W)}var _a=Object.prototype.hasOwnProperty,Dn=l.unstable_scheduleCallback,In=l.unstable_cancelCallback,qg=l.unstable_shouldYield,wt=l.unstable_requestPaint,zt=l.unstable_now,Ke=l.unstable_getCurrentPriorityLevel,Yi=l.unstable_ImmediatePriority,ze=l.unstable_UserBlockingPriority,Bi=l.unstable_NormalPriority,ds=l.unstable_LowPriority,Aa=l.unstable_IdlePriority,hr=l.log,to=l.unstable_setDisableYieldValue,Fi=null,ke=null;function ji(n){if(typeof hr=="function"&&to(n),ke&&typeof ke.setStrictMode=="function")try{ke.setStrictMode(Fi,n)}catch{}}var Me=Math.clz32?Math.clz32:Ex,eo=Math.log,Cn=Math.LN2;function Ex(n){return n>>>=0,n===0?32:31-(eo(n)/Cn|0)|0}var io=256,so=4194304;function On(n){var a=n&42;if(a!==0)return a;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function no(n,a,u){var d=n.pendingLanes;if(d===0)return 0;var p=0,E=n.suspendedLanes,b=n.pingedLanes;n=n.warmLanes;var D=d&134217727;return D!==0?(d=D&~E,d!==0?p=On(d):(b&=D,b!==0?p=On(b):u||(u=D&~n,u!==0&&(p=On(u))))):(D=d&~E,D!==0?p=On(D):b!==0?p=On(b):u||(u=d&~n,u!==0&&(p=On(u)))),p===0?0:a!==0&&a!==p&&(a&E)===0&&(E=p&-p,u=a&-a,E>=u||E===32&&(u&4194048)!==0)?a:p}function ba(n,a){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&a)===0}function Tx(n,a){switch(n){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Xg(){var n=io;return io<<=1,(io&4194048)===0&&(io=256),n}function Qg(){var n=so;return so<<=1,(so&62914560)===0&&(so=4194304),n}function Tc(n){for(var a=[],u=0;31>u;u++)a.push(n);return a}function Ra(n,a){n.pendingLanes|=a,a!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function Sx(n,a,u,d,p,E){var b=n.pendingLanes;n.pendingLanes=u,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=u,n.entangledLanes&=u,n.errorRecoveryDisabledLanes&=u,n.shellSuspendCounter=0;var D=n.entanglements,P=n.expirationTimes,Y=n.hiddenUpdates;for(u=b&~u;0<u;){var tt=31-Me(u),nt=1<<tt;D[tt]=0,P[tt]=-1;var X=Y[tt];if(X!==null)for(Y[tt]=null,tt=0;tt<X.length;tt++){var Q=X[tt];Q!==null&&(Q.lane&=-536870913)}u&=~nt}d!==0&&Wg(n,d,0),E!==0&&p===0&&n.tag!==0&&(n.suspendedLanes|=E&~(b&~a))}function Wg(n,a,u){n.pendingLanes|=a,n.suspendedLanes&=~a;var d=31-Me(a);n.entangledLanes|=a,n.entanglements[d]=n.entanglements[d]|1073741824|u&4194090}function Zg(n,a){var u=n.entangledLanes|=a;for(n=n.entanglements;u;){var d=31-Me(u),p=1<<d;p&a|n[d]&a&&(n[d]|=a),u&=~p}}function Sc(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function xc(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function Jg(){var n=q.p;return n!==0?n:(n=window.event,n===void 0?32:wy(n.type))}function xx(n,a){var u=q.p;try{return q.p=n,a()}finally{q.p=u}}var Vs=Math.random().toString(36).slice(2),Pe="__reactFiber$"+Vs,Ye="__reactProps$"+Vs,dr="__reactContainer$"+Vs,_c="__reactEvents$"+Vs,_x="__reactListeners$"+Vs,Ax="__reactHandles$"+Vs,tm="__reactResources$"+Vs,La="__reactMarker$"+Vs;function Ac(n){delete n[Pe],delete n[Ye],delete n[_c],delete n[_x],delete n[Ax]}function gr(n){var a=n[Pe];if(a)return a;for(var u=n.parentNode;u;){if(a=u[dr]||u[Pe]){if(u=a.alternate,a.child!==null||u!==null&&u.child!==null)for(n=yy(n);n!==null;){if(u=n[Pe])return u;n=yy(n)}return a}n=u,u=n.parentNode}return null}function mr(n){if(n=n[Pe]||n[dr]){var a=n.tag;if(a===5||a===6||a===13||a===26||a===27||a===3)return n}return null}function Da(n){var a=n.tag;if(a===5||a===26||a===27||a===6)return n.stateNode;throw Error(i(33))}function pr(n){var a=n[tm];return a||(a=n[tm]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function _e(n){n[La]=!0}var em=new Set,im={};function wn(n,a){yr(n,a),yr(n+"Capture",a)}function yr(n,a){for(im[n]=a,n=0;n<a.length;n++)em.add(a[n])}var bx=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),sm={},nm={};function Rx(n){return _a.call(nm,n)?!0:_a.call(sm,n)?!1:bx.test(n)?nm[n]=!0:(sm[n]=!0,!1)}function ro(n,a,u){if(Rx(a))if(u===null)n.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":n.removeAttribute(a);return;case"boolean":var d=a.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){n.removeAttribute(a);return}}n.setAttribute(a,""+u)}}function ao(n,a,u){if(u===null)n.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(a);return}n.setAttribute(a,""+u)}}function gs(n,a,u,d){if(d===null)n.removeAttribute(u);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(u);return}n.setAttributeNS(a,u,""+d)}}var bc,rm;function vr(n){if(bc===void 0)try{throw Error()}catch(u){var a=u.stack.trim().match(/\n( *(at )?)/);bc=a&&a[1]||"",rm=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+bc+n+rm}var Rc=!1;function Lc(n,a){if(!n||Rc)return"";Rc=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(a){var nt=function(){throw Error()};if(Object.defineProperty(nt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(nt,[])}catch(Q){var X=Q}Reflect.construct(n,[],nt)}else{try{nt.call()}catch(Q){X=Q}n.call(nt.prototype)}}else{try{throw Error()}catch(Q){X=Q}(nt=n())&&typeof nt.catch=="function"&&nt.catch(function(){})}}catch(Q){if(Q&&X&&typeof Q.stack=="string")return[Q.stack,X.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var E=d.DetermineComponentFrameRoot(),b=E[0],D=E[1];if(b&&D){var P=b.split(`
`),Y=D.split(`
`);for(p=d=0;d<P.length&&!P[d].includes("DetermineComponentFrameRoot");)d++;for(;p<Y.length&&!Y[p].includes("DetermineComponentFrameRoot");)p++;if(d===P.length||p===Y.length)for(d=P.length-1,p=Y.length-1;1<=d&&0<=p&&P[d]!==Y[p];)p--;for(;1<=d&&0<=p;d--,p--)if(P[d]!==Y[p]){if(d!==1||p!==1)do if(d--,p--,0>p||P[d]!==Y[p]){var tt=`
`+P[d].replace(" at new "," at ");return n.displayName&&tt.includes("<anonymous>")&&(tt=tt.replace("<anonymous>",n.displayName)),tt}while(1<=d&&0<=p);break}}}finally{Rc=!1,Error.prepareStackTrace=u}return(u=n?n.displayName||n.name:"")?vr(u):""}function Lx(n){switch(n.tag){case 26:case 27:case 5:return vr(n.type);case 16:return vr("Lazy");case 13:return vr("Suspense");case 19:return vr("SuspenseList");case 0:case 15:return Lc(n.type,!1);case 11:return Lc(n.type.render,!1);case 1:return Lc(n.type,!0);case 31:return vr("Activity");default:return""}}function am(n){try{var a="";do a+=Lx(n),n=n.return;while(n);return a}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function Si(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function lm(n){var a=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Dx(n){var a=lm(n)?"checked":"value",u=Object.getOwnPropertyDescriptor(n.constructor.prototype,a),d=""+n[a];if(!n.hasOwnProperty(a)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var p=u.get,E=u.set;return Object.defineProperty(n,a,{configurable:!0,get:function(){return p.call(this)},set:function(b){d=""+b,E.call(this,b)}}),Object.defineProperty(n,a,{enumerable:u.enumerable}),{getValue:function(){return d},setValue:function(b){d=""+b},stopTracking:function(){n._valueTracker=null,delete n[a]}}}}function lo(n){n._valueTracker||(n._valueTracker=Dx(n))}function om(n){if(!n)return!1;var a=n._valueTracker;if(!a)return!0;var u=a.getValue(),d="";return n&&(d=lm(n)?n.checked?"true":"false":n.value),n=d,n!==u?(a.setValue(n),!0):!1}function oo(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var Ix=/[\n"\\]/g;function xi(n){return n.replace(Ix,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Dc(n,a,u,d,p,E,b,D){n.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?n.type=b:n.removeAttribute("type"),a!=null?b==="number"?(a===0&&n.value===""||n.value!=a)&&(n.value=""+Si(a)):n.value!==""+Si(a)&&(n.value=""+Si(a)):b!=="submit"&&b!=="reset"||n.removeAttribute("value"),a!=null?Ic(n,b,Si(a)):u!=null?Ic(n,b,Si(u)):d!=null&&n.removeAttribute("value"),p==null&&E!=null&&(n.defaultChecked=!!E),p!=null&&(n.checked=p&&typeof p!="function"&&typeof p!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?n.name=""+Si(D):n.removeAttribute("name")}function um(n,a,u,d,p,E,b,D){if(E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(n.type=E),a!=null||u!=null){if(!(E!=="submit"&&E!=="reset"||a!=null))return;u=u!=null?""+Si(u):"",a=a!=null?""+Si(a):u,D||a===n.value||(n.value=a),n.defaultValue=a}d=d??p,d=typeof d!="function"&&typeof d!="symbol"&&!!d,n.checked=D?n.checked:!!d,n.defaultChecked=!!d,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(n.name=b)}function Ic(n,a,u){a==="number"&&oo(n.ownerDocument)===n||n.defaultValue===""+u||(n.defaultValue=""+u)}function Er(n,a,u,d){if(n=n.options,a){a={};for(var p=0;p<u.length;p++)a["$"+u[p]]=!0;for(u=0;u<n.length;u++)p=a.hasOwnProperty("$"+n[u].value),n[u].selected!==p&&(n[u].selected=p),p&&d&&(n[u].defaultSelected=!0)}else{for(u=""+Si(u),a=null,p=0;p<n.length;p++){if(n[p].value===u){n[p].selected=!0,d&&(n[p].defaultSelected=!0);return}a!==null||n[p].disabled||(a=n[p])}a!==null&&(a.selected=!0)}}function cm(n,a,u){if(a!=null&&(a=""+Si(a),a!==n.value&&(n.value=a),u==null)){n.defaultValue!==a&&(n.defaultValue=a);return}n.defaultValue=u!=null?""+Si(u):""}function fm(n,a,u,d){if(a==null){if(d!=null){if(u!=null)throw Error(i(92));if(at(d)){if(1<d.length)throw Error(i(93));d=d[0]}u=d}u==null&&(u=""),a=u}u=Si(a),n.defaultValue=u,d=n.textContent,d===u&&d!==""&&d!==null&&(n.value=d)}function Tr(n,a){if(a){var u=n.firstChild;if(u&&u===n.lastChild&&u.nodeType===3){u.nodeValue=a;return}}n.textContent=a}var Cx=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function hm(n,a,u){var d=a.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?d?n.setProperty(a,""):a==="float"?n.cssFloat="":n[a]="":d?n.setProperty(a,u):typeof u!="number"||u===0||Cx.has(a)?a==="float"?n.cssFloat=u:n[a]=(""+u).trim():n[a]=u+"px"}function dm(n,a,u){if(a!=null&&typeof a!="object")throw Error(i(62));if(n=n.style,u!=null){for(var d in u)!u.hasOwnProperty(d)||a!=null&&a.hasOwnProperty(d)||(d.indexOf("--")===0?n.setProperty(d,""):d==="float"?n.cssFloat="":n[d]="");for(var p in a)d=a[p],a.hasOwnProperty(p)&&u[p]!==d&&hm(n,p,d)}else for(var E in a)a.hasOwnProperty(E)&&hm(n,E,a[E])}function Cc(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ox=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),wx=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function uo(n){return wx.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}var Oc=null;function wc(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Sr=null,xr=null;function gm(n){var a=mr(n);if(a&&(n=a.stateNode)){var u=n[Ye]||null;t:switch(n=a.stateNode,a.type){case"input":if(Dc(n,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),a=u.name,u.type==="radio"&&a!=null){for(u=n;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+xi(""+a)+'"][type="radio"]'),a=0;a<u.length;a++){var d=u[a];if(d!==n&&d.form===n.form){var p=d[Ye]||null;if(!p)throw Error(i(90));Dc(d,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(a=0;a<u.length;a++)d=u[a],d.form===n.form&&om(d)}break t;case"textarea":cm(n,u.value,u.defaultValue);break t;case"select":a=u.value,a!=null&&Er(n,!!u.multiple,a,!1)}}}var kc=!1;function mm(n,a,u){if(kc)return n(a,u);kc=!0;try{var d=n(a);return d}finally{if(kc=!1,(Sr!==null||xr!==null)&&(Xo(),Sr&&(a=Sr,n=xr,xr=Sr=null,gm(a),n)))for(a=0;a<n.length;a++)gm(n[a])}}function Ia(n,a){var u=n.stateNode;if(u===null)return null;var d=u[Ye]||null;if(d===null)return null;u=d[a];t:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(n=n.type,d=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!d;break t;default:n=!1}if(n)return null;if(u&&typeof u!="function")throw Error(i(231,a,typeof u));return u}var ms=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Mc=!1;if(ms)try{var Ca={};Object.defineProperty(Ca,"passive",{get:function(){Mc=!0}}),window.addEventListener("test",Ca,Ca),window.removeEventListener("test",Ca,Ca)}catch{Mc=!1}var Ks=null,Pc=null,co=null;function pm(){if(co)return co;var n,a=Pc,u=a.length,d,p="value"in Ks?Ks.value:Ks.textContent,E=p.length;for(n=0;n<u&&a[n]===p[n];n++);var b=u-n;for(d=1;d<=b&&a[u-d]===p[E-d];d++);return co=p.slice(n,1<d?1-d:void 0)}function fo(n){var a=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&a===13&&(n=13)):n=a,n===10&&(n=13),32<=n||n===13?n:0}function ho(){return!0}function ym(){return!1}function je(n){function a(u,d,p,E,b){this._reactName=u,this._targetInst=p,this.type=d,this.nativeEvent=E,this.target=b,this.currentTarget=null;for(var D in n)n.hasOwnProperty(D)&&(u=n[D],this[D]=u?u(E):E[D]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?ho:ym,this.isPropagationStopped=ym,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=ho)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=ho)},persist:function(){},isPersistent:ho}),a}var kn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},go=je(kn),Oa=g({},kn,{view:0,detail:0}),kx=je(Oa),Nc,Uc,wa,mo=g({},Oa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fc,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==wa&&(wa&&n.type==="mousemove"?(Nc=n.screenX-wa.screenX,Uc=n.screenY-wa.screenY):Uc=Nc=0,wa=n),Nc)},movementY:function(n){return"movementY"in n?n.movementY:Uc}}),vm=je(mo),Mx=g({},mo,{dataTransfer:0}),Px=je(Mx),Nx=g({},Oa,{relatedTarget:0}),Bc=je(Nx),Ux=g({},kn,{animationName:0,elapsedTime:0,pseudoElement:0}),Bx=je(Ux),Fx=g({},kn,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),$x=je(Fx),Gx=g({},kn,{data:0}),Em=je(Gx),Hx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Vx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Kx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zx(n){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(n):(n=Kx[n])?!!a[n]:!1}function Fc(){return zx}var Yx=g({},Oa,{key:function(n){if(n.key){var a=Hx[n.key]||n.key;if(a!=="Unidentified")return a}return n.type==="keypress"?(n=fo(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Vx[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fc,charCode:function(n){return n.type==="keypress"?fo(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?fo(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),jx=je(Yx),qx=g({},mo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Tm=je(qx),Xx=g({},Oa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fc}),Qx=je(Xx),Wx=g({},kn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Zx=je(Wx),Jx=g({},mo,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),t_=je(Jx),e_=g({},kn,{newState:0,oldState:0}),i_=je(e_),s_=[9,13,27,32],$c=ms&&"CompositionEvent"in window,ka=null;ms&&"documentMode"in document&&(ka=document.documentMode);var n_=ms&&"TextEvent"in window&&!ka,Sm=ms&&(!$c||ka&&8<ka&&11>=ka),xm=" ",_m=!1;function Am(n,a){switch(n){case"keyup":return s_.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function bm(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var _r=!1;function r_(n,a){switch(n){case"compositionend":return bm(a);case"keypress":return a.which!==32?null:(_m=!0,xm);case"textInput":return n=a.data,n===xm&&_m?null:n;default:return null}}function a_(n,a){if(_r)return n==="compositionend"||!$c&&Am(n,a)?(n=pm(),co=Pc=Ks=null,_r=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Sm&&a.locale!=="ko"?null:a.data;default:return null}}var l_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Rm(n){var a=n&&n.nodeName&&n.nodeName.toLowerCase();return a==="input"?!!l_[n.type]:a==="textarea"}function Lm(n,a,u,d){Sr?xr?xr.push(d):xr=[d]:Sr=d,a=eu(a,"onChange"),0<a.length&&(u=new go("onChange","change",null,u,d),n.push({event:u,listeners:a}))}var Ma=null,Pa=null;function o_(n){ly(n,0)}function po(n){var a=Da(n);if(om(a))return n}function Dm(n,a){if(n==="change")return a}var Im=!1;if(ms){var Gc;if(ms){var Hc="oninput"in document;if(!Hc){var Cm=document.createElement("div");Cm.setAttribute("oninput","return;"),Hc=typeof Cm.oninput=="function"}Gc=Hc}else Gc=!1;Im=Gc&&(!document.documentMode||9<document.documentMode)}function Om(){Ma&&(Ma.detachEvent("onpropertychange",wm),Pa=Ma=null)}function wm(n){if(n.propertyName==="value"&&po(Pa)){var a=[];Lm(a,Pa,n,wc(n)),mm(o_,a)}}function u_(n,a,u){n==="focusin"?(Om(),Ma=a,Pa=u,Ma.attachEvent("onpropertychange",wm)):n==="focusout"&&Om()}function c_(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return po(Pa)}function f_(n,a){if(n==="click")return po(a)}function h_(n,a){if(n==="input"||n==="change")return po(a)}function d_(n,a){return n===a&&(n!==0||1/n===1/a)||n!==n&&a!==a}var ni=typeof Object.is=="function"?Object.is:d_;function Na(n,a){if(ni(n,a))return!0;if(typeof n!="object"||n===null||typeof a!="object"||a===null)return!1;var u=Object.keys(n),d=Object.keys(a);if(u.length!==d.length)return!1;for(d=0;d<u.length;d++){var p=u[d];if(!_a.call(a,p)||!ni(n[p],a[p]))return!1}return!0}function km(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Mm(n,a){var u=km(n);n=0;for(var d;u;){if(u.nodeType===3){if(d=n+u.textContent.length,n<=a&&d>=a)return{node:u,offset:a-n};n=d}t:{for(;u;){if(u.nextSibling){u=u.nextSibling;break t}u=u.parentNode}u=void 0}u=km(u)}}function Pm(n,a){return n&&a?n===a?!0:n&&n.nodeType===3?!1:a&&a.nodeType===3?Pm(n,a.parentNode):"contains"in n?n.contains(a):n.compareDocumentPosition?!!(n.compareDocumentPosition(a)&16):!1:!1}function Nm(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var a=oo(n.document);a instanceof n.HTMLIFrameElement;){try{var u=typeof a.contentWindow.location.href=="string"}catch{u=!1}if(u)n=a.contentWindow;else break;a=oo(n.document)}return a}function Vc(n){var a=n&&n.nodeName&&n.nodeName.toLowerCase();return a&&(a==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||a==="textarea"||n.contentEditable==="true")}var g_=ms&&"documentMode"in document&&11>=document.documentMode,Ar=null,Kc=null,Ua=null,zc=!1;function Um(n,a,u){var d=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;zc||Ar==null||Ar!==oo(d)||(d=Ar,"selectionStart"in d&&Vc(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Ua&&Na(Ua,d)||(Ua=d,d=eu(Kc,"onSelect"),0<d.length&&(a=new go("onSelect","select",null,a,u),n.push({event:a,listeners:d}),a.target=Ar)))}function Mn(n,a){var u={};return u[n.toLowerCase()]=a.toLowerCase(),u["Webkit"+n]="webkit"+a,u["Moz"+n]="moz"+a,u}var br={animationend:Mn("Animation","AnimationEnd"),animationiteration:Mn("Animation","AnimationIteration"),animationstart:Mn("Animation","AnimationStart"),transitionrun:Mn("Transition","TransitionRun"),transitionstart:Mn("Transition","TransitionStart"),transitioncancel:Mn("Transition","TransitionCancel"),transitionend:Mn("Transition","TransitionEnd")},Yc={},Bm={};ms&&(Bm=document.createElement("div").style,"AnimationEvent"in window||(delete br.animationend.animation,delete br.animationiteration.animation,delete br.animationstart.animation),"TransitionEvent"in window||delete br.transitionend.transition);function Pn(n){if(Yc[n])return Yc[n];if(!br[n])return n;var a=br[n],u;for(u in a)if(a.hasOwnProperty(u)&&u in Bm)return Yc[n]=a[u];return n}var Fm=Pn("animationend"),$m=Pn("animationiteration"),Gm=Pn("animationstart"),m_=Pn("transitionrun"),p_=Pn("transitionstart"),y_=Pn("transitioncancel"),Hm=Pn("transitionend"),Vm=new Map,jc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");jc.push("scrollEnd");function $i(n,a){Vm.set(n,a),wn(a,[n])}var Km=new WeakMap;function _i(n,a){if(typeof n=="object"&&n!==null){var u=Km.get(n);return u!==void 0?u:(a={value:n,source:a,stack:am(a)},Km.set(n,a),a)}return{value:n,source:a,stack:am(a)}}var Ai=[],Rr=0,qc=0;function yo(){for(var n=Rr,a=qc=Rr=0;a<n;){var u=Ai[a];Ai[a++]=null;var d=Ai[a];Ai[a++]=null;var p=Ai[a];Ai[a++]=null;var E=Ai[a];if(Ai[a++]=null,d!==null&&p!==null){var b=d.pending;b===null?p.next=p:(p.next=b.next,b.next=p),d.pending=p}E!==0&&zm(u,p,E)}}function vo(n,a,u,d){Ai[Rr++]=n,Ai[Rr++]=a,Ai[Rr++]=u,Ai[Rr++]=d,qc|=d,n.lanes|=d,n=n.alternate,n!==null&&(n.lanes|=d)}function Xc(n,a,u,d){return vo(n,a,u,d),Eo(n)}function Lr(n,a){return vo(n,null,null,a),Eo(n)}function zm(n,a,u){n.lanes|=u;var d=n.alternate;d!==null&&(d.lanes|=u);for(var p=!1,E=n.return;E!==null;)E.childLanes|=u,d=E.alternate,d!==null&&(d.childLanes|=u),E.tag===22&&(n=E.stateNode,n===null||n._visibility&1||(p=!0)),n=E,E=E.return;return n.tag===3?(E=n.stateNode,p&&a!==null&&(p=31-Me(u),n=E.hiddenUpdates,d=n[p],d===null?n[p]=[a]:d.push(a),a.lane=u|536870912),E):null}function Eo(n){if(50<ol)throw ol=0,ih=null,Error(i(185));for(var a=n.return;a!==null;)n=a,a=n.return;return n.tag===3?n.stateNode:null}var Dr={};function v_(n,a,u,d){this.tag=n,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ri(n,a,u,d){return new v_(n,a,u,d)}function Qc(n){return n=n.prototype,!(!n||!n.isReactComponent)}function ps(n,a){var u=n.alternate;return u===null?(u=ri(n.tag,a,n.key,n.mode),u.elementType=n.elementType,u.type=n.type,u.stateNode=n.stateNode,u.alternate=n,n.alternate=u):(u.pendingProps=a,u.type=n.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=n.flags&65011712,u.childLanes=n.childLanes,u.lanes=n.lanes,u.child=n.child,u.memoizedProps=n.memoizedProps,u.memoizedState=n.memoizedState,u.updateQueue=n.updateQueue,a=n.dependencies,u.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},u.sibling=n.sibling,u.index=n.index,u.ref=n.ref,u.refCleanup=n.refCleanup,u}function Ym(n,a){n.flags&=65011714;var u=n.alternate;return u===null?(n.childLanes=0,n.lanes=a,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=u.childLanes,n.lanes=u.lanes,n.child=u.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=u.memoizedProps,n.memoizedState=u.memoizedState,n.updateQueue=u.updateQueue,n.type=u.type,a=u.dependencies,n.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),n}function To(n,a,u,d,p,E){var b=0;if(d=n,typeof n=="function")Qc(n)&&(b=1);else if(typeof n=="string")b=TA(n,u,ut.current)?26:n==="html"||n==="head"||n==="body"?27:5;else t:switch(n){case w:return n=ri(31,u,a,p),n.elementType=w,n.lanes=E,n;case T:return Nn(u.children,p,E,a);case S:b=8,p|=24;break;case x:return n=ri(12,u,a,p|2),n.elementType=x,n.lanes=E,n;case I:return n=ri(13,u,a,p),n.elementType=I,n.lanes=E,n;case U:return n=ri(19,u,a,p),n.elementType=U,n.lanes=E,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case _:case R:b=10;break t;case L:b=9;break t;case C:b=11;break t;case O:b=14;break t;case M:b=16,d=null;break t}b=29,u=Error(i(130,n===null?"null":typeof n,"")),d=null}return a=ri(b,u,a,p),a.elementType=n,a.type=d,a.lanes=E,a}function Nn(n,a,u,d){return n=ri(7,n,d,a),n.lanes=u,n}function Wc(n,a,u){return n=ri(6,n,null,a),n.lanes=u,n}function Zc(n,a,u){return a=ri(4,n.children!==null?n.children:[],n.key,a),a.lanes=u,a.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},a}var Ir=[],Cr=0,So=null,xo=0,bi=[],Ri=0,Un=null,ys=1,vs="";function Bn(n,a){Ir[Cr++]=xo,Ir[Cr++]=So,So=n,xo=a}function jm(n,a,u){bi[Ri++]=ys,bi[Ri++]=vs,bi[Ri++]=Un,Un=n;var d=ys;n=vs;var p=32-Me(d)-1;d&=~(1<<p),u+=1;var E=32-Me(a)+p;if(30<E){var b=p-p%5;E=(d&(1<<b)-1).toString(32),d>>=b,p-=b,ys=1<<32-Me(a)+p|u<<p|d,vs=E+n}else ys=1<<E|u<<p|d,vs=n}function Jc(n){n.return!==null&&(Bn(n,1),jm(n,1,0))}function tf(n){for(;n===So;)So=Ir[--Cr],Ir[Cr]=null,xo=Ir[--Cr],Ir[Cr]=null;for(;n===Un;)Un=bi[--Ri],bi[Ri]=null,vs=bi[--Ri],bi[Ri]=null,ys=bi[--Ri],bi[Ri]=null}var Ge=null,re=null,Pt=!1,Fn=null,qi=!1,ef=Error(i(519));function $n(n){var a=Error(i(418,""));throw $a(_i(a,n)),ef}function qm(n){var a=n.stateNode,u=n.type,d=n.memoizedProps;switch(a[Pe]=n,a[Ye]=d,u){case"dialog":Ct("cancel",a),Ct("close",a);break;case"iframe":case"object":case"embed":Ct("load",a);break;case"video":case"audio":for(u=0;u<cl.length;u++)Ct(cl[u],a);break;case"source":Ct("error",a);break;case"img":case"image":case"link":Ct("error",a),Ct("load",a);break;case"details":Ct("toggle",a);break;case"input":Ct("invalid",a),um(a,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),lo(a);break;case"select":Ct("invalid",a);break;case"textarea":Ct("invalid",a),fm(a,d.value,d.defaultValue,d.children),lo(a)}u=d.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||a.textContent===""+u||d.suppressHydrationWarning===!0||fy(a.textContent,u)?(d.popover!=null&&(Ct("beforetoggle",a),Ct("toggle",a)),d.onScroll!=null&&Ct("scroll",a),d.onScrollEnd!=null&&Ct("scrollend",a),d.onClick!=null&&(a.onclick=iu),a=!0):a=!1,a||$n(n)}function Xm(n){for(Ge=n.return;Ge;)switch(Ge.tag){case 5:case 13:qi=!1;return;case 27:case 3:qi=!0;return;default:Ge=Ge.return}}function Ba(n){if(n!==Ge)return!1;if(!Pt)return Xm(n),Pt=!0,!1;var a=n.tag,u;if((u=a!==3&&a!==27)&&((u=a===5)&&(u=n.type,u=!(u!=="form"&&u!=="button")||vh(n.type,n.memoizedProps)),u=!u),u&&re&&$n(n),Xm(n),a===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));t:{for(n=n.nextSibling,a=0;n;){if(n.nodeType===8)if(u=n.data,u==="/$"){if(a===0){re=Hi(n.nextSibling);break t}a--}else u!=="$"&&u!=="$!"&&u!=="$?"||a++;n=n.nextSibling}re=null}}else a===27?(a=re,ln(n.type)?(n=xh,xh=null,re=n):re=a):re=Ge?Hi(n.stateNode.nextSibling):null;return!0}function Fa(){re=Ge=null,Pt=!1}function Qm(){var n=Fn;return n!==null&&(Qe===null?Qe=n:Qe.push.apply(Qe,n),Fn=null),n}function $a(n){Fn===null?Fn=[n]:Fn.push(n)}var sf=$(null),Gn=null,Es=null;function zs(n,a,u){st(sf,a._currentValue),a._currentValue=u}function Ts(n){n._currentValue=sf.current,j(sf)}function nf(n,a,u){for(;n!==null;){var d=n.alternate;if((n.childLanes&a)!==a?(n.childLanes|=a,d!==null&&(d.childLanes|=a)):d!==null&&(d.childLanes&a)!==a&&(d.childLanes|=a),n===u)break;n=n.return}}function rf(n,a,u,d){var p=n.child;for(p!==null&&(p.return=n);p!==null;){var E=p.dependencies;if(E!==null){var b=p.child;E=E.firstContext;t:for(;E!==null;){var D=E;E=p;for(var P=0;P<a.length;P++)if(D.context===a[P]){E.lanes|=u,D=E.alternate,D!==null&&(D.lanes|=u),nf(E.return,u,n),d||(b=null);break t}E=D.next}}else if(p.tag===18){if(b=p.return,b===null)throw Error(i(341));b.lanes|=u,E=b.alternate,E!==null&&(E.lanes|=u),nf(b,u,n),b=null}else b=p.child;if(b!==null)b.return=p;else for(b=p;b!==null;){if(b===n){b=null;break}if(p=b.sibling,p!==null){p.return=b.return,b=p;break}b=b.return}p=b}}function Ga(n,a,u,d){n=null;for(var p=a,E=!1;p!==null;){if(!E){if((p.flags&524288)!==0)E=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var b=p.alternate;if(b===null)throw Error(i(387));if(b=b.memoizedProps,b!==null){var D=p.type;ni(p.pendingProps.value,b.value)||(n!==null?n.push(D):n=[D])}}else if(p===Nt.current){if(b=p.alternate,b===null)throw Error(i(387));b.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(n!==null?n.push(pl):n=[pl])}p=p.return}n!==null&&rf(a,n,u,d),a.flags|=262144}function _o(n){for(n=n.firstContext;n!==null;){if(!ni(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function Hn(n){Gn=n,Es=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function Ne(n){return Wm(Gn,n)}function Ao(n,a){return Gn===null&&Hn(n),Wm(n,a)}function Wm(n,a){var u=a._currentValue;if(a={context:a,memoizedValue:u,next:null},Es===null){if(n===null)throw Error(i(308));Es=a,n.dependencies={lanes:0,firstContext:a},n.flags|=524288}else Es=Es.next=a;return u}var E_=typeof AbortController<"u"?AbortController:function(){var n=[],a=this.signal={aborted:!1,addEventListener:function(u,d){n.push(d)}};this.abort=function(){a.aborted=!0,n.forEach(function(u){return u()})}},T_=l.unstable_scheduleCallback,S_=l.unstable_NormalPriority,Ee={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function af(){return{controller:new E_,data:new Map,refCount:0}}function Ha(n){n.refCount--,n.refCount===0&&T_(S_,function(){n.controller.abort()})}var Va=null,lf=0,Or=0,wr=null;function x_(n,a){if(Va===null){var u=Va=[];lf=0,Or=uh(),wr={status:"pending",value:void 0,then:function(d){u.push(d)}}}return lf++,a.then(Zm,Zm),a}function Zm(){if(--lf===0&&Va!==null){wr!==null&&(wr.status="fulfilled");var n=Va;Va=null,Or=0,wr=null;for(var a=0;a<n.length;a++)(0,n[a])()}}function __(n,a){var u=[],d={status:"pending",value:null,reason:null,then:function(p){u.push(p)}};return n.then(function(){d.status="fulfilled",d.value=a;for(var p=0;p<u.length;p++)(0,u[p])(a)},function(p){for(d.status="rejected",d.reason=p,p=0;p<u.length;p++)(0,u[p])(void 0)}),d}var Jm=B.S;B.S=function(n,a){typeof a=="object"&&a!==null&&typeof a.then=="function"&&x_(n,a),Jm!==null&&Jm(n,a)};var Vn=$(null);function of(){var n=Vn.current;return n!==null?n:Qt.pooledCache}function bo(n,a){a===null?st(Vn,Vn.current):st(Vn,a.pool)}function t0(){var n=of();return n===null?null:{parent:Ee._currentValue,pool:n}}var Ka=Error(i(460)),e0=Error(i(474)),Ro=Error(i(542)),uf={then:function(){}};function i0(n){return n=n.status,n==="fulfilled"||n==="rejected"}function Lo(){}function s0(n,a,u){switch(u=n[u],u===void 0?n.push(a):u!==a&&(a.then(Lo,Lo),a=u),a.status){case"fulfilled":return a.value;case"rejected":throw n=a.reason,r0(n),n;default:if(typeof a.status=="string")a.then(Lo,Lo);else{if(n=Qt,n!==null&&100<n.shellSuspendCounter)throw Error(i(482));n=a,n.status="pending",n.then(function(d){if(a.status==="pending"){var p=a;p.status="fulfilled",p.value=d}},function(d){if(a.status==="pending"){var p=a;p.status="rejected",p.reason=d}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw n=a.reason,r0(n),n}throw za=a,Ka}}var za=null;function n0(){if(za===null)throw Error(i(459));var n=za;return za=null,n}function r0(n){if(n===Ka||n===Ro)throw Error(i(483))}var Ys=!1;function cf(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ff(n,a){n=n.updateQueue,a.updateQueue===n&&(a.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function js(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function qs(n,a,u){var d=n.updateQueue;if(d===null)return null;if(d=d.shared,(Ut&2)!==0){var p=d.pending;return p===null?a.next=a:(a.next=p.next,p.next=a),d.pending=a,a=Eo(n),zm(n,null,u),a}return vo(n,d,a,u),Eo(n)}function Ya(n,a,u){if(a=a.updateQueue,a!==null&&(a=a.shared,(u&4194048)!==0)){var d=a.lanes;d&=n.pendingLanes,u|=d,a.lanes=u,Zg(n,u)}}function hf(n,a){var u=n.updateQueue,d=n.alternate;if(d!==null&&(d=d.updateQueue,u===d)){var p=null,E=null;if(u=u.firstBaseUpdate,u!==null){do{var b={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};E===null?p=E=b:E=E.next=b,u=u.next}while(u!==null);E===null?p=E=a:E=E.next=a}else p=E=a;u={baseState:d.baseState,firstBaseUpdate:p,lastBaseUpdate:E,shared:d.shared,callbacks:d.callbacks},n.updateQueue=u;return}n=u.lastBaseUpdate,n===null?u.firstBaseUpdate=a:n.next=a,u.lastBaseUpdate=a}var df=!1;function ja(){if(df){var n=wr;if(n!==null)throw n}}function qa(n,a,u,d){df=!1;var p=n.updateQueue;Ys=!1;var E=p.firstBaseUpdate,b=p.lastBaseUpdate,D=p.shared.pending;if(D!==null){p.shared.pending=null;var P=D,Y=P.next;P.next=null,b===null?E=Y:b.next=Y,b=P;var tt=n.alternate;tt!==null&&(tt=tt.updateQueue,D=tt.lastBaseUpdate,D!==b&&(D===null?tt.firstBaseUpdate=Y:D.next=Y,tt.lastBaseUpdate=P))}if(E!==null){var nt=p.baseState;b=0,tt=Y=P=null,D=E;do{var X=D.lane&-536870913,Q=X!==D.lane;if(Q?(kt&X)===X:(d&X)===X){X!==0&&X===Or&&(df=!0),tt!==null&&(tt=tt.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});t:{var Tt=n,vt=D;X=a;var Ht=u;switch(vt.tag){case 1:if(Tt=vt.payload,typeof Tt=="function"){nt=Tt.call(Ht,nt,X);break t}nt=Tt;break t;case 3:Tt.flags=Tt.flags&-65537|128;case 0:if(Tt=vt.payload,X=typeof Tt=="function"?Tt.call(Ht,nt,X):Tt,X==null)break t;nt=g({},nt,X);break t;case 2:Ys=!0}}X=D.callback,X!==null&&(n.flags|=64,Q&&(n.flags|=8192),Q=p.callbacks,Q===null?p.callbacks=[X]:Q.push(X))}else Q={lane:X,tag:D.tag,payload:D.payload,callback:D.callback,next:null},tt===null?(Y=tt=Q,P=nt):tt=tt.next=Q,b|=X;if(D=D.next,D===null){if(D=p.shared.pending,D===null)break;Q=D,D=Q.next,Q.next=null,p.lastBaseUpdate=Q,p.shared.pending=null}}while(!0);tt===null&&(P=nt),p.baseState=P,p.firstBaseUpdate=Y,p.lastBaseUpdate=tt,E===null&&(p.shared.lanes=0),sn|=b,n.lanes=b,n.memoizedState=nt}}function a0(n,a){if(typeof n!="function")throw Error(i(191,n));n.call(a)}function l0(n,a){var u=n.callbacks;if(u!==null)for(n.callbacks=null,n=0;n<u.length;n++)a0(u[n],a)}var kr=$(null),Do=$(0);function o0(n,a){n=Ls,st(Do,n),st(kr,a),Ls=n|a.baseLanes}function gf(){st(Do,Ls),st(kr,kr.current)}function mf(){Ls=Do.current,j(kr),j(Do)}var Xs=0,bt=null,$t=null,ge=null,Io=!1,Mr=!1,Kn=!1,Co=0,Xa=0,Pr=null,A_=0;function fe(){throw Error(i(321))}function pf(n,a){if(a===null)return!1;for(var u=0;u<a.length&&u<n.length;u++)if(!ni(n[u],a[u]))return!1;return!0}function yf(n,a,u,d,p,E){return Xs=E,bt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,B.H=n===null||n.memoizedState===null?z0:Y0,Kn=!1,E=u(d,p),Kn=!1,Mr&&(E=c0(a,u,d,p)),u0(n),E}function u0(n){B.H=No;var a=$t!==null&&$t.next!==null;if(Xs=0,ge=$t=bt=null,Io=!1,Xa=0,Pr=null,a)throw Error(i(300));n===null||Ae||(n=n.dependencies,n!==null&&_o(n)&&(Ae=!0))}function c0(n,a,u,d){bt=n;var p=0;do{if(Mr&&(Pr=null),Xa=0,Mr=!1,25<=p)throw Error(i(301));if(p+=1,ge=$t=null,n.updateQueue!=null){var E=n.updateQueue;E.lastEffect=null,E.events=null,E.stores=null,E.memoCache!=null&&(E.memoCache.index=0)}B.H=O_,E=a(u,d)}while(Mr);return E}function b_(){var n=B.H,a=n.useState()[0];return a=typeof a.then=="function"?Qa(a):a,n=n.useState()[0],($t!==null?$t.memoizedState:null)!==n&&(bt.flags|=1024),a}function vf(){var n=Co!==0;return Co=0,n}function Ef(n,a,u){a.updateQueue=n.updateQueue,a.flags&=-2053,n.lanes&=~u}function Tf(n){if(Io){for(n=n.memoizedState;n!==null;){var a=n.queue;a!==null&&(a.pending=null),n=n.next}Io=!1}Xs=0,ge=$t=bt=null,Mr=!1,Xa=Co=0,Pr=null}function qe(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ge===null?bt.memoizedState=ge=n:ge=ge.next=n,ge}function me(){if($t===null){var n=bt.alternate;n=n!==null?n.memoizedState:null}else n=$t.next;var a=ge===null?bt.memoizedState:ge.next;if(a!==null)ge=a,$t=n;else{if(n===null)throw bt.alternate===null?Error(i(467)):Error(i(310));$t=n,n={memoizedState:$t.memoizedState,baseState:$t.baseState,baseQueue:$t.baseQueue,queue:$t.queue,next:null},ge===null?bt.memoizedState=ge=n:ge=ge.next=n}return ge}function Sf(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Qa(n){var a=Xa;return Xa+=1,Pr===null&&(Pr=[]),n=s0(Pr,n,a),a=bt,(ge===null?a.memoizedState:ge.next)===null&&(a=a.alternate,B.H=a===null||a.memoizedState===null?z0:Y0),n}function Oo(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return Qa(n);if(n.$$typeof===R)return Ne(n)}throw Error(i(438,String(n)))}function xf(n){var a=null,u=bt.updateQueue;if(u!==null&&(a=u.memoCache),a==null){var d=bt.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(a={data:d.data.map(function(p){return p.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),u===null&&(u=Sf(),bt.updateQueue=u),u.memoCache=a,u=a.data[a.index],u===void 0)for(u=a.data[a.index]=Array(n),d=0;d<n;d++)u[d]=N;return a.index++,u}function Ss(n,a){return typeof a=="function"?a(n):a}function wo(n){var a=me();return _f(a,$t,n)}function _f(n,a,u){var d=n.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=u;var p=n.baseQueue,E=d.pending;if(E!==null){if(p!==null){var b=p.next;p.next=E.next,E.next=b}a.baseQueue=p=E,d.pending=null}if(E=n.baseState,p===null)n.memoizedState=E;else{a=p.next;var D=b=null,P=null,Y=a,tt=!1;do{var nt=Y.lane&-536870913;if(nt!==Y.lane?(kt&nt)===nt:(Xs&nt)===nt){var X=Y.revertLane;if(X===0)P!==null&&(P=P.next={lane:0,revertLane:0,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null}),nt===Or&&(tt=!0);else if((Xs&X)===X){Y=Y.next,X===Or&&(tt=!0);continue}else nt={lane:0,revertLane:Y.revertLane,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null},P===null?(D=P=nt,b=E):P=P.next=nt,bt.lanes|=X,sn|=X;nt=Y.action,Kn&&u(E,nt),E=Y.hasEagerState?Y.eagerState:u(E,nt)}else X={lane:nt,revertLane:Y.revertLane,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null},P===null?(D=P=X,b=E):P=P.next=X,bt.lanes|=nt,sn|=nt;Y=Y.next}while(Y!==null&&Y!==a);if(P===null?b=E:P.next=D,!ni(E,n.memoizedState)&&(Ae=!0,tt&&(u=wr,u!==null)))throw u;n.memoizedState=E,n.baseState=b,n.baseQueue=P,d.lastRenderedState=E}return p===null&&(d.lanes=0),[n.memoizedState,d.dispatch]}function Af(n){var a=me(),u=a.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=n;var d=u.dispatch,p=u.pending,E=a.memoizedState;if(p!==null){u.pending=null;var b=p=p.next;do E=n(E,b.action),b=b.next;while(b!==p);ni(E,a.memoizedState)||(Ae=!0),a.memoizedState=E,a.baseQueue===null&&(a.baseState=E),u.lastRenderedState=E}return[E,d]}function f0(n,a,u){var d=bt,p=me(),E=Pt;if(E){if(u===void 0)throw Error(i(407));u=u()}else u=a();var b=!ni(($t||p).memoizedState,u);b&&(p.memoizedState=u,Ae=!0),p=p.queue;var D=g0.bind(null,d,p,n);if(Wa(2048,8,D,[n]),p.getSnapshot!==a||b||ge!==null&&ge.memoizedState.tag&1){if(d.flags|=2048,Nr(9,ko(),d0.bind(null,d,p,u,a),null),Qt===null)throw Error(i(349));E||(Xs&124)!==0||h0(d,a,u)}return u}function h0(n,a,u){n.flags|=16384,n={getSnapshot:a,value:u},a=bt.updateQueue,a===null?(a=Sf(),bt.updateQueue=a,a.stores=[n]):(u=a.stores,u===null?a.stores=[n]:u.push(n))}function d0(n,a,u,d){a.value=u,a.getSnapshot=d,m0(a)&&p0(n)}function g0(n,a,u){return u(function(){m0(a)&&p0(n)})}function m0(n){var a=n.getSnapshot;n=n.value;try{var u=a();return!ni(n,u)}catch{return!0}}function p0(n){var a=Lr(n,2);a!==null&&ci(a,n,2)}function bf(n){var a=qe();if(typeof n=="function"){var u=n;if(n=u(),Kn){ji(!0);try{u()}finally{ji(!1)}}}return a.memoizedState=a.baseState=n,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ss,lastRenderedState:n},a}function y0(n,a,u,d){return n.baseState=u,_f(n,$t,typeof d=="function"?d:Ss)}function R_(n,a,u,d,p){if(Po(n))throw Error(i(485));if(n=a.action,n!==null){var E={payload:p,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){E.listeners.push(b)}};B.T!==null?u(!0):E.isTransition=!1,d(E),u=a.pending,u===null?(E.next=a.pending=E,v0(a,E)):(E.next=u.next,a.pending=u.next=E)}}function v0(n,a){var u=a.action,d=a.payload,p=n.state;if(a.isTransition){var E=B.T,b={};B.T=b;try{var D=u(p,d),P=B.S;P!==null&&P(b,D),E0(n,a,D)}catch(Y){Rf(n,a,Y)}finally{B.T=E}}else try{E=u(p,d),E0(n,a,E)}catch(Y){Rf(n,a,Y)}}function E0(n,a,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(d){T0(n,a,d)},function(d){return Rf(n,a,d)}):T0(n,a,u)}function T0(n,a,u){a.status="fulfilled",a.value=u,S0(a),n.state=u,a=n.pending,a!==null&&(u=a.next,u===a?n.pending=null:(u=u.next,a.next=u,v0(n,u)))}function Rf(n,a,u){var d=n.pending;if(n.pending=null,d!==null){d=d.next;do a.status="rejected",a.reason=u,S0(a),a=a.next;while(a!==d)}n.action=null}function S0(n){n=n.listeners;for(var a=0;a<n.length;a++)(0,n[a])()}function x0(n,a){return a}function _0(n,a){if(Pt){var u=Qt.formState;if(u!==null){t:{var d=bt;if(Pt){if(re){e:{for(var p=re,E=qi;p.nodeType!==8;){if(!E){p=null;break e}if(p=Hi(p.nextSibling),p===null){p=null;break e}}E=p.data,p=E==="F!"||E==="F"?p:null}if(p){re=Hi(p.nextSibling),d=p.data==="F!";break t}}$n(d)}d=!1}d&&(a=u[0])}}return u=qe(),u.memoizedState=u.baseState=a,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:x0,lastRenderedState:a},u.queue=d,u=H0.bind(null,bt,d),d.dispatch=u,d=bf(!1),E=Of.bind(null,bt,!1,d.queue),d=qe(),p={state:a,dispatch:null,action:n,pending:null},d.queue=p,u=R_.bind(null,bt,p,E,u),p.dispatch=u,d.memoizedState=n,[a,u,!1]}function A0(n){var a=me();return b0(a,$t,n)}function b0(n,a,u){if(a=_f(n,a,x0)[0],n=wo(Ss)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var d=Qa(a)}catch(b){throw b===Ka?Ro:b}else d=a;a=me();var p=a.queue,E=p.dispatch;return u!==a.memoizedState&&(bt.flags|=2048,Nr(9,ko(),L_.bind(null,p,u),null)),[d,E,n]}function L_(n,a){n.action=a}function R0(n){var a=me(),u=$t;if(u!==null)return b0(a,u,n);me(),a=a.memoizedState,u=me();var d=u.queue.dispatch;return u.memoizedState=n,[a,d,!1]}function Nr(n,a,u,d){return n={tag:n,create:u,deps:d,inst:a,next:null},a=bt.updateQueue,a===null&&(a=Sf(),bt.updateQueue=a),u=a.lastEffect,u===null?a.lastEffect=n.next=n:(d=u.next,u.next=n,n.next=d,a.lastEffect=n),n}function ko(){return{destroy:void 0,resource:void 0}}function L0(){return me().memoizedState}function Mo(n,a,u,d){var p=qe();d=d===void 0?null:d,bt.flags|=n,p.memoizedState=Nr(1|a,ko(),u,d)}function Wa(n,a,u,d){var p=me();d=d===void 0?null:d;var E=p.memoizedState.inst;$t!==null&&d!==null&&pf(d,$t.memoizedState.deps)?p.memoizedState=Nr(a,E,u,d):(bt.flags|=n,p.memoizedState=Nr(1|a,E,u,d))}function D0(n,a){Mo(8390656,8,n,a)}function I0(n,a){Wa(2048,8,n,a)}function C0(n,a){return Wa(4,2,n,a)}function O0(n,a){return Wa(4,4,n,a)}function w0(n,a){if(typeof a=="function"){n=n();var u=a(n);return function(){typeof u=="function"?u():a(null)}}if(a!=null)return n=n(),a.current=n,function(){a.current=null}}function k0(n,a,u){u=u!=null?u.concat([n]):null,Wa(4,4,w0.bind(null,a,n),u)}function Lf(){}function M0(n,a){var u=me();a=a===void 0?null:a;var d=u.memoizedState;return a!==null&&pf(a,d[1])?d[0]:(u.memoizedState=[n,a],n)}function P0(n,a){var u=me();a=a===void 0?null:a;var d=u.memoizedState;if(a!==null&&pf(a,d[1]))return d[0];if(d=n(),Kn){ji(!0);try{n()}finally{ji(!1)}}return u.memoizedState=[d,a],d}function Df(n,a,u){return u===void 0||(Xs&1073741824)!==0?n.memoizedState=a:(n.memoizedState=u,n=Bp(),bt.lanes|=n,sn|=n,u)}function N0(n,a,u,d){return ni(u,a)?u:kr.current!==null?(n=Df(n,u,d),ni(n,a)||(Ae=!0),n):(Xs&42)===0?(Ae=!0,n.memoizedState=u):(n=Bp(),bt.lanes|=n,sn|=n,a)}function U0(n,a,u,d,p){var E=q.p;q.p=E!==0&&8>E?E:8;var b=B.T,D={};B.T=D,Of(n,!1,a,u);try{var P=p(),Y=B.S;if(Y!==null&&Y(D,P),P!==null&&typeof P=="object"&&typeof P.then=="function"){var tt=__(P,d);Za(n,a,tt,ui(n))}else Za(n,a,d,ui(n))}catch(nt){Za(n,a,{then:function(){},status:"rejected",reason:nt},ui())}finally{q.p=E,B.T=b}}function D_(){}function If(n,a,u,d){if(n.tag!==5)throw Error(i(476));var p=B0(n).queue;U0(n,p,a,W,u===null?D_:function(){return F0(n),u(d)})}function B0(n){var a=n.memoizedState;if(a!==null)return a;a={memoizedState:W,baseState:W,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ss,lastRenderedState:W},next:null};var u={};return a.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ss,lastRenderedState:u},next:null},n.memoizedState=a,n=n.alternate,n!==null&&(n.memoizedState=a),a}function F0(n){var a=B0(n).next.queue;Za(n,a,{},ui())}function Cf(){return Ne(pl)}function $0(){return me().memoizedState}function G0(){return me().memoizedState}function I_(n){for(var a=n.return;a!==null;){switch(a.tag){case 24:case 3:var u=ui();n=js(u);var d=qs(a,n,u);d!==null&&(ci(d,a,u),Ya(d,a,u)),a={cache:af()},n.payload=a;return}a=a.return}}function C_(n,a,u){var d=ui();u={lane:d,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},Po(n)?V0(a,u):(u=Xc(n,a,u,d),u!==null&&(ci(u,n,d),K0(u,a,d)))}function H0(n,a,u){var d=ui();Za(n,a,u,d)}function Za(n,a,u,d){var p={lane:d,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(Po(n))V0(a,p);else{var E=n.alternate;if(n.lanes===0&&(E===null||E.lanes===0)&&(E=a.lastRenderedReducer,E!==null))try{var b=a.lastRenderedState,D=E(b,u);if(p.hasEagerState=!0,p.eagerState=D,ni(D,b))return vo(n,a,p,0),Qt===null&&yo(),!1}catch{}finally{}if(u=Xc(n,a,p,d),u!==null)return ci(u,n,d),K0(u,a,d),!0}return!1}function Of(n,a,u,d){if(d={lane:2,revertLane:uh(),action:d,hasEagerState:!1,eagerState:null,next:null},Po(n)){if(a)throw Error(i(479))}else a=Xc(n,u,d,2),a!==null&&ci(a,n,2)}function Po(n){var a=n.alternate;return n===bt||a!==null&&a===bt}function V0(n,a){Mr=Io=!0;var u=n.pending;u===null?a.next=a:(a.next=u.next,u.next=a),n.pending=a}function K0(n,a,u){if((u&4194048)!==0){var d=a.lanes;d&=n.pendingLanes,u|=d,a.lanes=u,Zg(n,u)}}var No={readContext:Ne,use:Oo,useCallback:fe,useContext:fe,useEffect:fe,useImperativeHandle:fe,useLayoutEffect:fe,useInsertionEffect:fe,useMemo:fe,useReducer:fe,useRef:fe,useState:fe,useDebugValue:fe,useDeferredValue:fe,useTransition:fe,useSyncExternalStore:fe,useId:fe,useHostTransitionStatus:fe,useFormState:fe,useActionState:fe,useOptimistic:fe,useMemoCache:fe,useCacheRefresh:fe},z0={readContext:Ne,use:Oo,useCallback:function(n,a){return qe().memoizedState=[n,a===void 0?null:a],n},useContext:Ne,useEffect:D0,useImperativeHandle:function(n,a,u){u=u!=null?u.concat([n]):null,Mo(4194308,4,w0.bind(null,a,n),u)},useLayoutEffect:function(n,a){return Mo(4194308,4,n,a)},useInsertionEffect:function(n,a){Mo(4,2,n,a)},useMemo:function(n,a){var u=qe();a=a===void 0?null:a;var d=n();if(Kn){ji(!0);try{n()}finally{ji(!1)}}return u.memoizedState=[d,a],d},useReducer:function(n,a,u){var d=qe();if(u!==void 0){var p=u(a);if(Kn){ji(!0);try{u(a)}finally{ji(!1)}}}else p=a;return d.memoizedState=d.baseState=p,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:p},d.queue=n,n=n.dispatch=C_.bind(null,bt,n),[d.memoizedState,n]},useRef:function(n){var a=qe();return n={current:n},a.memoizedState=n},useState:function(n){n=bf(n);var a=n.queue,u=H0.bind(null,bt,a);return a.dispatch=u,[n.memoizedState,u]},useDebugValue:Lf,useDeferredValue:function(n,a){var u=qe();return Df(u,n,a)},useTransition:function(){var n=bf(!1);return n=U0.bind(null,bt,n.queue,!0,!1),qe().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,a,u){var d=bt,p=qe();if(Pt){if(u===void 0)throw Error(i(407));u=u()}else{if(u=a(),Qt===null)throw Error(i(349));(kt&124)!==0||h0(d,a,u)}p.memoizedState=u;var E={value:u,getSnapshot:a};return p.queue=E,D0(g0.bind(null,d,E,n),[n]),d.flags|=2048,Nr(9,ko(),d0.bind(null,d,E,u,a),null),u},useId:function(){var n=qe(),a=Qt.identifierPrefix;if(Pt){var u=vs,d=ys;u=(d&~(1<<32-Me(d)-1)).toString(32)+u,a=""+a+"R"+u,u=Co++,0<u&&(a+="H"+u.toString(32)),a+=""}else u=A_++,a=""+a+"r"+u.toString(32)+"";return n.memoizedState=a},useHostTransitionStatus:Cf,useFormState:_0,useActionState:_0,useOptimistic:function(n){var a=qe();a.memoizedState=a.baseState=n;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=u,a=Of.bind(null,bt,!0,u),u.dispatch=a,[n,a]},useMemoCache:xf,useCacheRefresh:function(){return qe().memoizedState=I_.bind(null,bt)}},Y0={readContext:Ne,use:Oo,useCallback:M0,useContext:Ne,useEffect:I0,useImperativeHandle:k0,useInsertionEffect:C0,useLayoutEffect:O0,useMemo:P0,useReducer:wo,useRef:L0,useState:function(){return wo(Ss)},useDebugValue:Lf,useDeferredValue:function(n,a){var u=me();return N0(u,$t.memoizedState,n,a)},useTransition:function(){var n=wo(Ss)[0],a=me().memoizedState;return[typeof n=="boolean"?n:Qa(n),a]},useSyncExternalStore:f0,useId:$0,useHostTransitionStatus:Cf,useFormState:A0,useActionState:A0,useOptimistic:function(n,a){var u=me();return y0(u,$t,n,a)},useMemoCache:xf,useCacheRefresh:G0},O_={readContext:Ne,use:Oo,useCallback:M0,useContext:Ne,useEffect:I0,useImperativeHandle:k0,useInsertionEffect:C0,useLayoutEffect:O0,useMemo:P0,useReducer:Af,useRef:L0,useState:function(){return Af(Ss)},useDebugValue:Lf,useDeferredValue:function(n,a){var u=me();return $t===null?Df(u,n,a):N0(u,$t.memoizedState,n,a)},useTransition:function(){var n=Af(Ss)[0],a=me().memoizedState;return[typeof n=="boolean"?n:Qa(n),a]},useSyncExternalStore:f0,useId:$0,useHostTransitionStatus:Cf,useFormState:R0,useActionState:R0,useOptimistic:function(n,a){var u=me();return $t!==null?y0(u,$t,n,a):(u.baseState=n,[n,u.queue.dispatch])},useMemoCache:xf,useCacheRefresh:G0},Ur=null,Ja=0;function Uo(n){var a=Ja;return Ja+=1,Ur===null&&(Ur=[]),s0(Ur,n,a)}function tl(n,a){a=a.props.ref,n.ref=a!==void 0?a:null}function Bo(n,a){throw a.$$typeof===m?Error(i(525)):(n=Object.prototype.toString.call(a),Error(i(31,n==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":n)))}function j0(n){var a=n._init;return a(n._payload)}function q0(n){function a(G,F){if(n){var V=G.deletions;V===null?(G.deletions=[F],G.flags|=16):V.push(F)}}function u(G,F){if(!n)return null;for(;F!==null;)a(G,F),F=F.sibling;return null}function d(G){for(var F=new Map;G!==null;)G.key!==null?F.set(G.key,G):F.set(G.index,G),G=G.sibling;return F}function p(G,F){return G=ps(G,F),G.index=0,G.sibling=null,G}function E(G,F,V){return G.index=V,n?(V=G.alternate,V!==null?(V=V.index,V<F?(G.flags|=67108866,F):V):(G.flags|=67108866,F)):(G.flags|=1048576,F)}function b(G){return n&&G.alternate===null&&(G.flags|=67108866),G}function D(G,F,V,it){return F===null||F.tag!==6?(F=Wc(V,G.mode,it),F.return=G,F):(F=p(F,V),F.return=G,F)}function P(G,F,V,it){var gt=V.type;return gt===T?tt(G,F,V.props.children,it,V.key):F!==null&&(F.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===M&&j0(gt)===F.type)?(F=p(F,V.props),tl(F,V),F.return=G,F):(F=To(V.type,V.key,V.props,null,G.mode,it),tl(F,V),F.return=G,F)}function Y(G,F,V,it){return F===null||F.tag!==4||F.stateNode.containerInfo!==V.containerInfo||F.stateNode.implementation!==V.implementation?(F=Zc(V,G.mode,it),F.return=G,F):(F=p(F,V.children||[]),F.return=G,F)}function tt(G,F,V,it,gt){return F===null||F.tag!==7?(F=Nn(V,G.mode,it,gt),F.return=G,F):(F=p(F,V),F.return=G,F)}function nt(G,F,V){if(typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint")return F=Wc(""+F,G.mode,V),F.return=G,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case y:return V=To(F.type,F.key,F.props,null,G.mode,V),tl(V,F),V.return=G,V;case v:return F=Zc(F,G.mode,V),F.return=G,F;case M:var it=F._init;return F=it(F._payload),nt(G,F,V)}if(at(F)||J(F))return F=Nn(F,G.mode,V,null),F.return=G,F;if(typeof F.then=="function")return nt(G,Uo(F),V);if(F.$$typeof===R)return nt(G,Ao(G,F),V);Bo(G,F)}return null}function X(G,F,V,it){var gt=F!==null?F.key:null;if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return gt!==null?null:D(G,F,""+V,it);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case y:return V.key===gt?P(G,F,V,it):null;case v:return V.key===gt?Y(G,F,V,it):null;case M:return gt=V._init,V=gt(V._payload),X(G,F,V,it)}if(at(V)||J(V))return gt!==null?null:tt(G,F,V,it,null);if(typeof V.then=="function")return X(G,F,Uo(V),it);if(V.$$typeof===R)return X(G,F,Ao(G,V),it);Bo(G,V)}return null}function Q(G,F,V,it,gt){if(typeof it=="string"&&it!==""||typeof it=="number"||typeof it=="bigint")return G=G.get(V)||null,D(F,G,""+it,gt);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case y:return G=G.get(it.key===null?V:it.key)||null,P(F,G,it,gt);case v:return G=G.get(it.key===null?V:it.key)||null,Y(F,G,it,gt);case M:var Lt=it._init;return it=Lt(it._payload),Q(G,F,V,it,gt)}if(at(it)||J(it))return G=G.get(V)||null,tt(F,G,it,gt,null);if(typeof it.then=="function")return Q(G,F,V,Uo(it),gt);if(it.$$typeof===R)return Q(G,F,V,Ao(F,it),gt);Bo(F,it)}return null}function Tt(G,F,V,it){for(var gt=null,Lt=null,yt=F,Et=F=0,Re=null;yt!==null&&Et<V.length;Et++){yt.index>Et?(Re=yt,yt=null):Re=yt.sibling;var Mt=X(G,yt,V[Et],it);if(Mt===null){yt===null&&(yt=Re);break}n&&yt&&Mt.alternate===null&&a(G,yt),F=E(Mt,F,Et),Lt===null?gt=Mt:Lt.sibling=Mt,Lt=Mt,yt=Re}if(Et===V.length)return u(G,yt),Pt&&Bn(G,Et),gt;if(yt===null){for(;Et<V.length;Et++)yt=nt(G,V[Et],it),yt!==null&&(F=E(yt,F,Et),Lt===null?gt=yt:Lt.sibling=yt,Lt=yt);return Pt&&Bn(G,Et),gt}for(yt=d(yt);Et<V.length;Et++)Re=Q(yt,G,Et,V[Et],it),Re!==null&&(n&&Re.alternate!==null&&yt.delete(Re.key===null?Et:Re.key),F=E(Re,F,Et),Lt===null?gt=Re:Lt.sibling=Re,Lt=Re);return n&&yt.forEach(function(hn){return a(G,hn)}),Pt&&Bn(G,Et),gt}function vt(G,F,V,it){if(V==null)throw Error(i(151));for(var gt=null,Lt=null,yt=F,Et=F=0,Re=null,Mt=V.next();yt!==null&&!Mt.done;Et++,Mt=V.next()){yt.index>Et?(Re=yt,yt=null):Re=yt.sibling;var hn=X(G,yt,Mt.value,it);if(hn===null){yt===null&&(yt=Re);break}n&&yt&&hn.alternate===null&&a(G,yt),F=E(hn,F,Et),Lt===null?gt=hn:Lt.sibling=hn,Lt=hn,yt=Re}if(Mt.done)return u(G,yt),Pt&&Bn(G,Et),gt;if(yt===null){for(;!Mt.done;Et++,Mt=V.next())Mt=nt(G,Mt.value,it),Mt!==null&&(F=E(Mt,F,Et),Lt===null?gt=Mt:Lt.sibling=Mt,Lt=Mt);return Pt&&Bn(G,Et),gt}for(yt=d(yt);!Mt.done;Et++,Mt=V.next())Mt=Q(yt,G,Et,Mt.value,it),Mt!==null&&(n&&Mt.alternate!==null&&yt.delete(Mt.key===null?Et:Mt.key),F=E(Mt,F,Et),Lt===null?gt=Mt:Lt.sibling=Mt,Lt=Mt);return n&&yt.forEach(function(wA){return a(G,wA)}),Pt&&Bn(G,Et),gt}function Ht(G,F,V,it){if(typeof V=="object"&&V!==null&&V.type===T&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case y:t:{for(var gt=V.key;F!==null;){if(F.key===gt){if(gt=V.type,gt===T){if(F.tag===7){u(G,F.sibling),it=p(F,V.props.children),it.return=G,G=it;break t}}else if(F.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===M&&j0(gt)===F.type){u(G,F.sibling),it=p(F,V.props),tl(it,V),it.return=G,G=it;break t}u(G,F);break}else a(G,F);F=F.sibling}V.type===T?(it=Nn(V.props.children,G.mode,it,V.key),it.return=G,G=it):(it=To(V.type,V.key,V.props,null,G.mode,it),tl(it,V),it.return=G,G=it)}return b(G);case v:t:{for(gt=V.key;F!==null;){if(F.key===gt)if(F.tag===4&&F.stateNode.containerInfo===V.containerInfo&&F.stateNode.implementation===V.implementation){u(G,F.sibling),it=p(F,V.children||[]),it.return=G,G=it;break t}else{u(G,F);break}else a(G,F);F=F.sibling}it=Zc(V,G.mode,it),it.return=G,G=it}return b(G);case M:return gt=V._init,V=gt(V._payload),Ht(G,F,V,it)}if(at(V))return Tt(G,F,V,it);if(J(V)){if(gt=J(V),typeof gt!="function")throw Error(i(150));return V=gt.call(V),vt(G,F,V,it)}if(typeof V.then=="function")return Ht(G,F,Uo(V),it);if(V.$$typeof===R)return Ht(G,F,Ao(G,V),it);Bo(G,V)}return typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint"?(V=""+V,F!==null&&F.tag===6?(u(G,F.sibling),it=p(F,V),it.return=G,G=it):(u(G,F),it=Wc(V,G.mode,it),it.return=G,G=it),b(G)):u(G,F)}return function(G,F,V,it){try{Ja=0;var gt=Ht(G,F,V,it);return Ur=null,gt}catch(yt){if(yt===Ka||yt===Ro)throw yt;var Lt=ri(29,yt,null,G.mode);return Lt.lanes=it,Lt.return=G,Lt}finally{}}}var Br=q0(!0),X0=q0(!1),Li=$(null),Xi=null;function Qs(n){var a=n.alternate;st(Te,Te.current&1),st(Li,n),Xi===null&&(a===null||kr.current!==null||a.memoizedState!==null)&&(Xi=n)}function Q0(n){if(n.tag===22){if(st(Te,Te.current),st(Li,n),Xi===null){var a=n.alternate;a!==null&&a.memoizedState!==null&&(Xi=n)}}else Ws()}function Ws(){st(Te,Te.current),st(Li,Li.current)}function xs(n){j(Li),Xi===n&&(Xi=null),j(Te)}var Te=$(0);function Fo(n){for(var a=n;a!==null;){if(a.tag===13){var u=a.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||Sh(u)))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===n)break;for(;a.sibling===null;){if(a.return===null||a.return===n)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}function wf(n,a,u,d){a=n.memoizedState,u=u(d,a),u=u==null?a:g({},a,u),n.memoizedState=u,n.lanes===0&&(n.updateQueue.baseState=u)}var kf={enqueueSetState:function(n,a,u){n=n._reactInternals;var d=ui(),p=js(d);p.payload=a,u!=null&&(p.callback=u),a=qs(n,p,d),a!==null&&(ci(a,n,d),Ya(a,n,d))},enqueueReplaceState:function(n,a,u){n=n._reactInternals;var d=ui(),p=js(d);p.tag=1,p.payload=a,u!=null&&(p.callback=u),a=qs(n,p,d),a!==null&&(ci(a,n,d),Ya(a,n,d))},enqueueForceUpdate:function(n,a){n=n._reactInternals;var u=ui(),d=js(u);d.tag=2,a!=null&&(d.callback=a),a=qs(n,d,u),a!==null&&(ci(a,n,u),Ya(a,n,u))}};function W0(n,a,u,d,p,E,b){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(d,E,b):a.prototype&&a.prototype.isPureReactComponent?!Na(u,d)||!Na(p,E):!0}function Z0(n,a,u,d){n=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(u,d),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(u,d),a.state!==n&&kf.enqueueReplaceState(a,a.state,null)}function zn(n,a){var u=a;if("ref"in a){u={};for(var d in a)d!=="ref"&&(u[d]=a[d])}if(n=n.defaultProps){u===a&&(u=g({},u));for(var p in n)u[p]===void 0&&(u[p]=n[p])}return u}var $o=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)};function J0(n){$o(n)}function tp(n){console.error(n)}function ep(n){$o(n)}function Go(n,a){try{var u=n.onUncaughtError;u(a.value,{componentStack:a.stack})}catch(d){setTimeout(function(){throw d})}}function ip(n,a,u){try{var d=n.onCaughtError;d(u.value,{componentStack:u.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function Mf(n,a,u){return u=js(u),u.tag=3,u.payload={element:null},u.callback=function(){Go(n,a)},u}function sp(n){return n=js(n),n.tag=3,n}function np(n,a,u,d){var p=u.type.getDerivedStateFromError;if(typeof p=="function"){var E=d.value;n.payload=function(){return p(E)},n.callback=function(){ip(a,u,d)}}var b=u.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(n.callback=function(){ip(a,u,d),typeof p!="function"&&(nn===null?nn=new Set([this]):nn.add(this));var D=d.stack;this.componentDidCatch(d.value,{componentStack:D!==null?D:""})})}function w_(n,a,u,d,p){if(u.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(a=u.alternate,a!==null&&Ga(a,u,p,!0),u=Li.current,u!==null){switch(u.tag){case 13:return Xi===null?nh():u.alternate===null&&ae===0&&(ae=3),u.flags&=-257,u.flags|=65536,u.lanes=p,d===uf?u.flags|=16384:(a=u.updateQueue,a===null?u.updateQueue=new Set([d]):a.add(d),ah(n,d,p)),!1;case 22:return u.flags|=65536,d===uf?u.flags|=16384:(a=u.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([d])},u.updateQueue=a):(u=a.retryQueue,u===null?a.retryQueue=new Set([d]):u.add(d)),ah(n,d,p)),!1}throw Error(i(435,u.tag))}return ah(n,d,p),nh(),!1}if(Pt)return a=Li.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=p,d!==ef&&(n=Error(i(422),{cause:d}),$a(_i(n,u)))):(d!==ef&&(a=Error(i(423),{cause:d}),$a(_i(a,u))),n=n.current.alternate,n.flags|=65536,p&=-p,n.lanes|=p,d=_i(d,u),p=Mf(n.stateNode,d,p),hf(n,p),ae!==4&&(ae=2)),!1;var E=Error(i(520),{cause:d});if(E=_i(E,u),ll===null?ll=[E]:ll.push(E),ae!==4&&(ae=2),a===null)return!0;d=_i(d,u),u=a;do{switch(u.tag){case 3:return u.flags|=65536,n=p&-p,u.lanes|=n,n=Mf(u.stateNode,d,n),hf(u,n),!1;case 1:if(a=u.type,E=u.stateNode,(u.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(nn===null||!nn.has(E))))return u.flags|=65536,p&=-p,u.lanes|=p,p=sp(p),np(p,n,u,d),hf(u,p),!1}u=u.return}while(u!==null);return!1}var rp=Error(i(461)),Ae=!1;function Ie(n,a,u,d){a.child=n===null?X0(a,null,u,d):Br(a,n.child,u,d)}function ap(n,a,u,d,p){u=u.render;var E=a.ref;if("ref"in d){var b={};for(var D in d)D!=="ref"&&(b[D]=d[D])}else b=d;return Hn(a),d=yf(n,a,u,b,E,p),D=vf(),n!==null&&!Ae?(Ef(n,a,p),_s(n,a,p)):(Pt&&D&&Jc(a),a.flags|=1,Ie(n,a,d,p),a.child)}function lp(n,a,u,d,p){if(n===null){var E=u.type;return typeof E=="function"&&!Qc(E)&&E.defaultProps===void 0&&u.compare===null?(a.tag=15,a.type=E,op(n,a,E,d,p)):(n=To(u.type,null,d,a,a.mode,p),n.ref=a.ref,n.return=a,a.child=n)}if(E=n.child,!Hf(n,p)){var b=E.memoizedProps;if(u=u.compare,u=u!==null?u:Na,u(b,d)&&n.ref===a.ref)return _s(n,a,p)}return a.flags|=1,n=ps(E,d),n.ref=a.ref,n.return=a,a.child=n}function op(n,a,u,d,p){if(n!==null){var E=n.memoizedProps;if(Na(E,d)&&n.ref===a.ref)if(Ae=!1,a.pendingProps=d=E,Hf(n,p))(n.flags&131072)!==0&&(Ae=!0);else return a.lanes=n.lanes,_s(n,a,p)}return Pf(n,a,u,d,p)}function up(n,a,u){var d=a.pendingProps,p=d.children,E=n!==null?n.memoizedState:null;if(d.mode==="hidden"){if((a.flags&128)!==0){if(d=E!==null?E.baseLanes|u:u,n!==null){for(p=a.child=n.child,E=0;p!==null;)E=E|p.lanes|p.childLanes,p=p.sibling;a.childLanes=E&~d}else a.childLanes=0,a.child=null;return cp(n,a,d,u)}if((u&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},n!==null&&bo(a,E!==null?E.cachePool:null),E!==null?o0(a,E):gf(),Q0(a);else return a.lanes=a.childLanes=536870912,cp(n,a,E!==null?E.baseLanes|u:u,u)}else E!==null?(bo(a,E.cachePool),o0(a,E),Ws(),a.memoizedState=null):(n!==null&&bo(a,null),gf(),Ws());return Ie(n,a,p,u),a.child}function cp(n,a,u,d){var p=of();return p=p===null?null:{parent:Ee._currentValue,pool:p},a.memoizedState={baseLanes:u,cachePool:p},n!==null&&bo(a,null),gf(),Q0(a),n!==null&&Ga(n,a,d,!0),null}function Ho(n,a){var u=a.ref;if(u===null)n!==null&&n.ref!==null&&(a.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(i(284));(n===null||n.ref!==u)&&(a.flags|=4194816)}}function Pf(n,a,u,d,p){return Hn(a),u=yf(n,a,u,d,void 0,p),d=vf(),n!==null&&!Ae?(Ef(n,a,p),_s(n,a,p)):(Pt&&d&&Jc(a),a.flags|=1,Ie(n,a,u,p),a.child)}function fp(n,a,u,d,p,E){return Hn(a),a.updateQueue=null,u=c0(a,d,u,p),u0(n),d=vf(),n!==null&&!Ae?(Ef(n,a,E),_s(n,a,E)):(Pt&&d&&Jc(a),a.flags|=1,Ie(n,a,u,E),a.child)}function hp(n,a,u,d,p){if(Hn(a),a.stateNode===null){var E=Dr,b=u.contextType;typeof b=="object"&&b!==null&&(E=Ne(b)),E=new u(d,E),a.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,E.updater=kf,a.stateNode=E,E._reactInternals=a,E=a.stateNode,E.props=d,E.state=a.memoizedState,E.refs={},cf(a),b=u.contextType,E.context=typeof b=="object"&&b!==null?Ne(b):Dr,E.state=a.memoizedState,b=u.getDerivedStateFromProps,typeof b=="function"&&(wf(a,u,b,d),E.state=a.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(b=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),b!==E.state&&kf.enqueueReplaceState(E,E.state,null),qa(a,d,E,p),ja(),E.state=a.memoizedState),typeof E.componentDidMount=="function"&&(a.flags|=4194308),d=!0}else if(n===null){E=a.stateNode;var D=a.memoizedProps,P=zn(u,D);E.props=P;var Y=E.context,tt=u.contextType;b=Dr,typeof tt=="object"&&tt!==null&&(b=Ne(tt));var nt=u.getDerivedStateFromProps;tt=typeof nt=="function"||typeof E.getSnapshotBeforeUpdate=="function",D=a.pendingProps!==D,tt||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(D||Y!==b)&&Z0(a,E,d,b),Ys=!1;var X=a.memoizedState;E.state=X,qa(a,d,E,p),ja(),Y=a.memoizedState,D||X!==Y||Ys?(typeof nt=="function"&&(wf(a,u,nt,d),Y=a.memoizedState),(P=Ys||W0(a,u,P,d,X,Y,b))?(tt||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(a.flags|=4194308)):(typeof E.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=d,a.memoizedState=Y),E.props=d,E.state=Y,E.context=b,d=P):(typeof E.componentDidMount=="function"&&(a.flags|=4194308),d=!1)}else{E=a.stateNode,ff(n,a),b=a.memoizedProps,tt=zn(u,b),E.props=tt,nt=a.pendingProps,X=E.context,Y=u.contextType,P=Dr,typeof Y=="object"&&Y!==null&&(P=Ne(Y)),D=u.getDerivedStateFromProps,(Y=typeof D=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(b!==nt||X!==P)&&Z0(a,E,d,P),Ys=!1,X=a.memoizedState,E.state=X,qa(a,d,E,p),ja();var Q=a.memoizedState;b!==nt||X!==Q||Ys||n!==null&&n.dependencies!==null&&_o(n.dependencies)?(typeof D=="function"&&(wf(a,u,D,d),Q=a.memoizedState),(tt=Ys||W0(a,u,tt,d,X,Q,P)||n!==null&&n.dependencies!==null&&_o(n.dependencies))?(Y||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(d,Q,P),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(d,Q,P)),typeof E.componentDidUpdate=="function"&&(a.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof E.componentDidUpdate!="function"||b===n.memoizedProps&&X===n.memoizedState||(a.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||b===n.memoizedProps&&X===n.memoizedState||(a.flags|=1024),a.memoizedProps=d,a.memoizedState=Q),E.props=d,E.state=Q,E.context=P,d=tt):(typeof E.componentDidUpdate!="function"||b===n.memoizedProps&&X===n.memoizedState||(a.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||b===n.memoizedProps&&X===n.memoizedState||(a.flags|=1024),d=!1)}return E=d,Ho(n,a),d=(a.flags&128)!==0,E||d?(E=a.stateNode,u=d&&typeof u.getDerivedStateFromError!="function"?null:E.render(),a.flags|=1,n!==null&&d?(a.child=Br(a,n.child,null,p),a.child=Br(a,null,u,p)):Ie(n,a,u,p),a.memoizedState=E.state,n=a.child):n=_s(n,a,p),n}function dp(n,a,u,d){return Fa(),a.flags|=256,Ie(n,a,u,d),a.child}var Nf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Uf(n){return{baseLanes:n,cachePool:t0()}}function Bf(n,a,u){return n=n!==null?n.childLanes&~u:0,a&&(n|=Di),n}function gp(n,a,u){var d=a.pendingProps,p=!1,E=(a.flags&128)!==0,b;if((b=E)||(b=n!==null&&n.memoizedState===null?!1:(Te.current&2)!==0),b&&(p=!0,a.flags&=-129),b=(a.flags&32)!==0,a.flags&=-33,n===null){if(Pt){if(p?Qs(a):Ws(),Pt){var D=re,P;if(P=D){t:{for(P=D,D=qi;P.nodeType!==8;){if(!D){D=null;break t}if(P=Hi(P.nextSibling),P===null){D=null;break t}}D=P}D!==null?(a.memoizedState={dehydrated:D,treeContext:Un!==null?{id:ys,overflow:vs}:null,retryLane:536870912,hydrationErrors:null},P=ri(18,null,null,0),P.stateNode=D,P.return=a,a.child=P,Ge=a,re=null,P=!0):P=!1}P||$n(a)}if(D=a.memoizedState,D!==null&&(D=D.dehydrated,D!==null))return Sh(D)?a.lanes=32:a.lanes=536870912,null;xs(a)}return D=d.children,d=d.fallback,p?(Ws(),p=a.mode,D=Vo({mode:"hidden",children:D},p),d=Nn(d,p,u,null),D.return=a,d.return=a,D.sibling=d,a.child=D,p=a.child,p.memoizedState=Uf(u),p.childLanes=Bf(n,b,u),a.memoizedState=Nf,d):(Qs(a),Ff(a,D))}if(P=n.memoizedState,P!==null&&(D=P.dehydrated,D!==null)){if(E)a.flags&256?(Qs(a),a.flags&=-257,a=$f(n,a,u)):a.memoizedState!==null?(Ws(),a.child=n.child,a.flags|=128,a=null):(Ws(),p=d.fallback,D=a.mode,d=Vo({mode:"visible",children:d.children},D),p=Nn(p,D,u,null),p.flags|=2,d.return=a,p.return=a,d.sibling=p,a.child=d,Br(a,n.child,null,u),d=a.child,d.memoizedState=Uf(u),d.childLanes=Bf(n,b,u),a.memoizedState=Nf,a=p);else if(Qs(a),Sh(D)){if(b=D.nextSibling&&D.nextSibling.dataset,b)var Y=b.dgst;b=Y,d=Error(i(419)),d.stack="",d.digest=b,$a({value:d,source:null,stack:null}),a=$f(n,a,u)}else if(Ae||Ga(n,a,u,!1),b=(u&n.childLanes)!==0,Ae||b){if(b=Qt,b!==null&&(d=u&-u,d=(d&42)!==0?1:Sc(d),d=(d&(b.suspendedLanes|u))!==0?0:d,d!==0&&d!==P.retryLane))throw P.retryLane=d,Lr(n,d),ci(b,n,d),rp;D.data==="$?"||nh(),a=$f(n,a,u)}else D.data==="$?"?(a.flags|=192,a.child=n.child,a=null):(n=P.treeContext,re=Hi(D.nextSibling),Ge=a,Pt=!0,Fn=null,qi=!1,n!==null&&(bi[Ri++]=ys,bi[Ri++]=vs,bi[Ri++]=Un,ys=n.id,vs=n.overflow,Un=a),a=Ff(a,d.children),a.flags|=4096);return a}return p?(Ws(),p=d.fallback,D=a.mode,P=n.child,Y=P.sibling,d=ps(P,{mode:"hidden",children:d.children}),d.subtreeFlags=P.subtreeFlags&65011712,Y!==null?p=ps(Y,p):(p=Nn(p,D,u,null),p.flags|=2),p.return=a,d.return=a,d.sibling=p,a.child=d,d=p,p=a.child,D=n.child.memoizedState,D===null?D=Uf(u):(P=D.cachePool,P!==null?(Y=Ee._currentValue,P=P.parent!==Y?{parent:Y,pool:Y}:P):P=t0(),D={baseLanes:D.baseLanes|u,cachePool:P}),p.memoizedState=D,p.childLanes=Bf(n,b,u),a.memoizedState=Nf,d):(Qs(a),u=n.child,n=u.sibling,u=ps(u,{mode:"visible",children:d.children}),u.return=a,u.sibling=null,n!==null&&(b=a.deletions,b===null?(a.deletions=[n],a.flags|=16):b.push(n)),a.child=u,a.memoizedState=null,u)}function Ff(n,a){return a=Vo({mode:"visible",children:a},n.mode),a.return=n,n.child=a}function Vo(n,a){return n=ri(22,n,null,a),n.lanes=0,n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},n}function $f(n,a,u){return Br(a,n.child,null,u),n=Ff(a,a.pendingProps.children),n.flags|=2,a.memoizedState=null,n}function mp(n,a,u){n.lanes|=a;var d=n.alternate;d!==null&&(d.lanes|=a),nf(n.return,a,u)}function Gf(n,a,u,d,p){var E=n.memoizedState;E===null?n.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:d,tail:u,tailMode:p}:(E.isBackwards=a,E.rendering=null,E.renderingStartTime=0,E.last=d,E.tail=u,E.tailMode=p)}function pp(n,a,u){var d=a.pendingProps,p=d.revealOrder,E=d.tail;if(Ie(n,a,d.children,u),d=Te.current,(d&2)!==0)d=d&1|2,a.flags|=128;else{if(n!==null&&(n.flags&128)!==0)t:for(n=a.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&mp(n,u,a);else if(n.tag===19)mp(n,u,a);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===a)break t;for(;n.sibling===null;){if(n.return===null||n.return===a)break t;n=n.return}n.sibling.return=n.return,n=n.sibling}d&=1}switch(st(Te,d),p){case"forwards":for(u=a.child,p=null;u!==null;)n=u.alternate,n!==null&&Fo(n)===null&&(p=u),u=u.sibling;u=p,u===null?(p=a.child,a.child=null):(p=u.sibling,u.sibling=null),Gf(a,!1,p,u,E);break;case"backwards":for(u=null,p=a.child,a.child=null;p!==null;){if(n=p.alternate,n!==null&&Fo(n)===null){a.child=p;break}n=p.sibling,p.sibling=u,u=p,p=n}Gf(a,!0,u,null,E);break;case"together":Gf(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function _s(n,a,u){if(n!==null&&(a.dependencies=n.dependencies),sn|=a.lanes,(u&a.childLanes)===0)if(n!==null){if(Ga(n,a,u,!1),(u&a.childLanes)===0)return null}else return null;if(n!==null&&a.child!==n.child)throw Error(i(153));if(a.child!==null){for(n=a.child,u=ps(n,n.pendingProps),a.child=u,u.return=a;n.sibling!==null;)n=n.sibling,u=u.sibling=ps(n,n.pendingProps),u.return=a;u.sibling=null}return a.child}function Hf(n,a){return(n.lanes&a)!==0?!0:(n=n.dependencies,!!(n!==null&&_o(n)))}function k_(n,a,u){switch(a.tag){case 3:_t(a,a.stateNode.containerInfo),zs(a,Ee,n.memoizedState.cache),Fa();break;case 27:case 5:Ve(a);break;case 4:_t(a,a.stateNode.containerInfo);break;case 10:zs(a,a.type,a.memoizedProps.value);break;case 13:var d=a.memoizedState;if(d!==null)return d.dehydrated!==null?(Qs(a),a.flags|=128,null):(u&a.child.childLanes)!==0?gp(n,a,u):(Qs(a),n=_s(n,a,u),n!==null?n.sibling:null);Qs(a);break;case 19:var p=(n.flags&128)!==0;if(d=(u&a.childLanes)!==0,d||(Ga(n,a,u,!1),d=(u&a.childLanes)!==0),p){if(d)return pp(n,a,u);a.flags|=128}if(p=a.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),st(Te,Te.current),d)break;return null;case 22:case 23:return a.lanes=0,up(n,a,u);case 24:zs(a,Ee,n.memoizedState.cache)}return _s(n,a,u)}function yp(n,a,u){if(n!==null)if(n.memoizedProps!==a.pendingProps)Ae=!0;else{if(!Hf(n,u)&&(a.flags&128)===0)return Ae=!1,k_(n,a,u);Ae=(n.flags&131072)!==0}else Ae=!1,Pt&&(a.flags&1048576)!==0&&jm(a,xo,a.index);switch(a.lanes=0,a.tag){case 16:t:{n=a.pendingProps;var d=a.elementType,p=d._init;if(d=p(d._payload),a.type=d,typeof d=="function")Qc(d)?(n=zn(d,n),a.tag=1,a=hp(null,a,d,n,u)):(a.tag=0,a=Pf(null,a,d,n,u));else{if(d!=null){if(p=d.$$typeof,p===C){a.tag=11,a=ap(null,a,d,n,u);break t}else if(p===O){a.tag=14,a=lp(null,a,d,n,u);break t}}throw a=ct(d)||d,Error(i(306,a,""))}}return a;case 0:return Pf(n,a,a.type,a.pendingProps,u);case 1:return d=a.type,p=zn(d,a.pendingProps),hp(n,a,d,p,u);case 3:t:{if(_t(a,a.stateNode.containerInfo),n===null)throw Error(i(387));d=a.pendingProps;var E=a.memoizedState;p=E.element,ff(n,a),qa(a,d,null,u);var b=a.memoizedState;if(d=b.cache,zs(a,Ee,d),d!==E.cache&&rf(a,[Ee],u,!0),ja(),d=b.element,E.isDehydrated)if(E={element:d,isDehydrated:!1,cache:b.cache},a.updateQueue.baseState=E,a.memoizedState=E,a.flags&256){a=dp(n,a,d,u);break t}else if(d!==p){p=_i(Error(i(424)),a),$a(p),a=dp(n,a,d,u);break t}else{switch(n=a.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(re=Hi(n.firstChild),Ge=a,Pt=!0,Fn=null,qi=!0,u=X0(a,null,d,u),a.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Fa(),d===p){a=_s(n,a,u);break t}Ie(n,a,d,u)}a=a.child}return a;case 26:return Ho(n,a),n===null?(u=Sy(a.type,null,a.pendingProps,null))?a.memoizedState=u:Pt||(u=a.type,n=a.pendingProps,d=su(ht.current).createElement(u),d[Pe]=a,d[Ye]=n,Oe(d,u,n),_e(d),a.stateNode=d):a.memoizedState=Sy(a.type,n.memoizedProps,a.pendingProps,n.memoizedState),null;case 27:return Ve(a),n===null&&Pt&&(d=a.stateNode=vy(a.type,a.pendingProps,ht.current),Ge=a,qi=!0,p=re,ln(a.type)?(xh=p,re=Hi(d.firstChild)):re=p),Ie(n,a,a.pendingProps.children,u),Ho(n,a),n===null&&(a.flags|=4194304),a.child;case 5:return n===null&&Pt&&((p=d=re)&&(d=lA(d,a.type,a.pendingProps,qi),d!==null?(a.stateNode=d,Ge=a,re=Hi(d.firstChild),qi=!1,p=!0):p=!1),p||$n(a)),Ve(a),p=a.type,E=a.pendingProps,b=n!==null?n.memoizedProps:null,d=E.children,vh(p,E)?d=null:b!==null&&vh(p,b)&&(a.flags|=32),a.memoizedState!==null&&(p=yf(n,a,b_,null,null,u),pl._currentValue=p),Ho(n,a),Ie(n,a,d,u),a.child;case 6:return n===null&&Pt&&((n=u=re)&&(u=oA(u,a.pendingProps,qi),u!==null?(a.stateNode=u,Ge=a,re=null,n=!0):n=!1),n||$n(a)),null;case 13:return gp(n,a,u);case 4:return _t(a,a.stateNode.containerInfo),d=a.pendingProps,n===null?a.child=Br(a,null,d,u):Ie(n,a,d,u),a.child;case 11:return ap(n,a,a.type,a.pendingProps,u);case 7:return Ie(n,a,a.pendingProps,u),a.child;case 8:return Ie(n,a,a.pendingProps.children,u),a.child;case 12:return Ie(n,a,a.pendingProps.children,u),a.child;case 10:return d=a.pendingProps,zs(a,a.type,d.value),Ie(n,a,d.children,u),a.child;case 9:return p=a.type._context,d=a.pendingProps.children,Hn(a),p=Ne(p),d=d(p),a.flags|=1,Ie(n,a,d,u),a.child;case 14:return lp(n,a,a.type,a.pendingProps,u);case 15:return op(n,a,a.type,a.pendingProps,u);case 19:return pp(n,a,u);case 31:return d=a.pendingProps,u=a.mode,d={mode:d.mode,children:d.children},n===null?(u=Vo(d,u),u.ref=a.ref,a.child=u,u.return=a,a=u):(u=ps(n.child,d),u.ref=a.ref,a.child=u,u.return=a,a=u),a;case 22:return up(n,a,u);case 24:return Hn(a),d=Ne(Ee),n===null?(p=of(),p===null&&(p=Qt,E=af(),p.pooledCache=E,E.refCount++,E!==null&&(p.pooledCacheLanes|=u),p=E),a.memoizedState={parent:d,cache:p},cf(a),zs(a,Ee,p)):((n.lanes&u)!==0&&(ff(n,a),qa(a,null,null,u),ja()),p=n.memoizedState,E=a.memoizedState,p.parent!==d?(p={parent:d,cache:d},a.memoizedState=p,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=p),zs(a,Ee,d)):(d=E.cache,zs(a,Ee,d),d!==p.cache&&rf(a,[Ee],u,!0))),Ie(n,a,a.pendingProps.children,u),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function As(n){n.flags|=4}function vp(n,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!Ry(a)){if(a=Li.current,a!==null&&((kt&4194048)===kt?Xi!==null:(kt&62914560)!==kt&&(kt&536870912)===0||a!==Xi))throw za=uf,e0;n.flags|=8192}}function Ko(n,a){a!==null&&(n.flags|=4),n.flags&16384&&(a=n.tag!==22?Qg():536870912,n.lanes|=a,Hr|=a)}function el(n,a){if(!Pt)switch(n.tailMode){case"hidden":a=n.tail;for(var u=null;a!==null;)a.alternate!==null&&(u=a),a=a.sibling;u===null?n.tail=null:u.sibling=null;break;case"collapsed":u=n.tail;for(var d=null;u!==null;)u.alternate!==null&&(d=u),u=u.sibling;d===null?a||n.tail===null?n.tail=null:n.tail.sibling=null:d.sibling=null}}function te(n){var a=n.alternate!==null&&n.alternate.child===n.child,u=0,d=0;if(a)for(var p=n.child;p!==null;)u|=p.lanes|p.childLanes,d|=p.subtreeFlags&65011712,d|=p.flags&65011712,p.return=n,p=p.sibling;else for(p=n.child;p!==null;)u|=p.lanes|p.childLanes,d|=p.subtreeFlags,d|=p.flags,p.return=n,p=p.sibling;return n.subtreeFlags|=d,n.childLanes=u,a}function M_(n,a,u){var d=a.pendingProps;switch(tf(a),a.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return te(a),null;case 1:return te(a),null;case 3:return u=a.stateNode,d=null,n!==null&&(d=n.memoizedState.cache),a.memoizedState.cache!==d&&(a.flags|=2048),Ts(Ee),ce(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(n===null||n.child===null)&&(Ba(a)?As(a):n===null||n.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Qm())),te(a),null;case 26:return u=a.memoizedState,n===null?(As(a),u!==null?(te(a),vp(a,u)):(te(a),a.flags&=-16777217)):u?u!==n.memoizedState?(As(a),te(a),vp(a,u)):(te(a),a.flags&=-16777217):(n.memoizedProps!==d&&As(a),te(a),a.flags&=-16777217),null;case 27:Ti(a),u=ht.current;var p=a.type;if(n!==null&&a.stateNode!=null)n.memoizedProps!==d&&As(a);else{if(!d){if(a.stateNode===null)throw Error(i(166));return te(a),null}n=ut.current,Ba(a)?qm(a):(n=vy(p,d,u),a.stateNode=n,As(a))}return te(a),null;case 5:if(Ti(a),u=a.type,n!==null&&a.stateNode!=null)n.memoizedProps!==d&&As(a);else{if(!d){if(a.stateNode===null)throw Error(i(166));return te(a),null}if(n=ut.current,Ba(a))qm(a);else{switch(p=su(ht.current),n){case 1:n=p.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:n=p.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":n=p.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":n=p.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":n=p.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild);break;case"select":n=typeof d.is=="string"?p.createElement("select",{is:d.is}):p.createElement("select"),d.multiple?n.multiple=!0:d.size&&(n.size=d.size);break;default:n=typeof d.is=="string"?p.createElement(u,{is:d.is}):p.createElement(u)}}n[Pe]=a,n[Ye]=d;t:for(p=a.child;p!==null;){if(p.tag===5||p.tag===6)n.appendChild(p.stateNode);else if(p.tag!==4&&p.tag!==27&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===a)break t;for(;p.sibling===null;){if(p.return===null||p.return===a)break t;p=p.return}p.sibling.return=p.return,p=p.sibling}a.stateNode=n;t:switch(Oe(n,u,d),u){case"button":case"input":case"select":case"textarea":n=!!d.autoFocus;break t;case"img":n=!0;break t;default:n=!1}n&&As(a)}}return te(a),a.flags&=-16777217,null;case 6:if(n&&a.stateNode!=null)n.memoizedProps!==d&&As(a);else{if(typeof d!="string"&&a.stateNode===null)throw Error(i(166));if(n=ht.current,Ba(a)){if(n=a.stateNode,u=a.memoizedProps,d=null,p=Ge,p!==null)switch(p.tag){case 27:case 5:d=p.memoizedProps}n[Pe]=a,n=!!(n.nodeValue===u||d!==null&&d.suppressHydrationWarning===!0||fy(n.nodeValue,u)),n||$n(a)}else n=su(n).createTextNode(d),n[Pe]=a,a.stateNode=n}return te(a),null;case 13:if(d=a.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(p=Ba(a),d!==null&&d.dehydrated!==null){if(n===null){if(!p)throw Error(i(318));if(p=a.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));p[Pe]=a}else Fa(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;te(a),p=!1}else p=Qm(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=p),p=!0;if(!p)return a.flags&256?(xs(a),a):(xs(a),null)}if(xs(a),(a.flags&128)!==0)return a.lanes=u,a;if(u=d!==null,n=n!==null&&n.memoizedState!==null,u){d=a.child,p=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(p=d.alternate.memoizedState.cachePool.pool);var E=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(E=d.memoizedState.cachePool.pool),E!==p&&(d.flags|=2048)}return u!==n&&u&&(a.child.flags|=8192),Ko(a,a.updateQueue),te(a),null;case 4:return ce(),n===null&&dh(a.stateNode.containerInfo),te(a),null;case 10:return Ts(a.type),te(a),null;case 19:if(j(Te),p=a.memoizedState,p===null)return te(a),null;if(d=(a.flags&128)!==0,E=p.rendering,E===null)if(d)el(p,!1);else{if(ae!==0||n!==null&&(n.flags&128)!==0)for(n=a.child;n!==null;){if(E=Fo(n),E!==null){for(a.flags|=128,el(p,!1),n=E.updateQueue,a.updateQueue=n,Ko(a,n),a.subtreeFlags=0,n=u,u=a.child;u!==null;)Ym(u,n),u=u.sibling;return st(Te,Te.current&1|2),a.child}n=n.sibling}p.tail!==null&&zt()>jo&&(a.flags|=128,d=!0,el(p,!1),a.lanes=4194304)}else{if(!d)if(n=Fo(E),n!==null){if(a.flags|=128,d=!0,n=n.updateQueue,a.updateQueue=n,Ko(a,n),el(p,!0),p.tail===null&&p.tailMode==="hidden"&&!E.alternate&&!Pt)return te(a),null}else 2*zt()-p.renderingStartTime>jo&&u!==536870912&&(a.flags|=128,d=!0,el(p,!1),a.lanes=4194304);p.isBackwards?(E.sibling=a.child,a.child=E):(n=p.last,n!==null?n.sibling=E:a.child=E,p.last=E)}return p.tail!==null?(a=p.tail,p.rendering=a,p.tail=a.sibling,p.renderingStartTime=zt(),a.sibling=null,n=Te.current,st(Te,d?n&1|2:n&1),a):(te(a),null);case 22:case 23:return xs(a),mf(),d=a.memoizedState!==null,n!==null?n.memoizedState!==null!==d&&(a.flags|=8192):d&&(a.flags|=8192),d?(u&536870912)!==0&&(a.flags&128)===0&&(te(a),a.subtreeFlags&6&&(a.flags|=8192)):te(a),u=a.updateQueue,u!==null&&Ko(a,u.retryQueue),u=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(u=n.memoizedState.cachePool.pool),d=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),d!==u&&(a.flags|=2048),n!==null&&j(Vn),null;case 24:return u=null,n!==null&&(u=n.memoizedState.cache),a.memoizedState.cache!==u&&(a.flags|=2048),Ts(Ee),te(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function P_(n,a){switch(tf(a),a.tag){case 1:return n=a.flags,n&65536?(a.flags=n&-65537|128,a):null;case 3:return Ts(Ee),ce(),n=a.flags,(n&65536)!==0&&(n&128)===0?(a.flags=n&-65537|128,a):null;case 26:case 27:case 5:return Ti(a),null;case 13:if(xs(a),n=a.memoizedState,n!==null&&n.dehydrated!==null){if(a.alternate===null)throw Error(i(340));Fa()}return n=a.flags,n&65536?(a.flags=n&-65537|128,a):null;case 19:return j(Te),null;case 4:return ce(),null;case 10:return Ts(a.type),null;case 22:case 23:return xs(a),mf(),n!==null&&j(Vn),n=a.flags,n&65536?(a.flags=n&-65537|128,a):null;case 24:return Ts(Ee),null;case 25:return null;default:return null}}function Ep(n,a){switch(tf(a),a.tag){case 3:Ts(Ee),ce();break;case 26:case 27:case 5:Ti(a);break;case 4:ce();break;case 13:xs(a);break;case 19:j(Te);break;case 10:Ts(a.type);break;case 22:case 23:xs(a),mf(),n!==null&&j(Vn);break;case 24:Ts(Ee)}}function il(n,a){try{var u=a.updateQueue,d=u!==null?u.lastEffect:null;if(d!==null){var p=d.next;u=p;do{if((u.tag&n)===n){d=void 0;var E=u.create,b=u.inst;d=E(),b.destroy=d}u=u.next}while(u!==p)}}catch(D){Yt(a,a.return,D)}}function Zs(n,a,u){try{var d=a.updateQueue,p=d!==null?d.lastEffect:null;if(p!==null){var E=p.next;d=E;do{if((d.tag&n)===n){var b=d.inst,D=b.destroy;if(D!==void 0){b.destroy=void 0,p=a;var P=u,Y=D;try{Y()}catch(tt){Yt(p,P,tt)}}}d=d.next}while(d!==E)}}catch(tt){Yt(a,a.return,tt)}}function Tp(n){var a=n.updateQueue;if(a!==null){var u=n.stateNode;try{l0(a,u)}catch(d){Yt(n,n.return,d)}}}function Sp(n,a,u){u.props=zn(n.type,n.memoizedProps),u.state=n.memoizedState;try{u.componentWillUnmount()}catch(d){Yt(n,a,d)}}function sl(n,a){try{var u=n.ref;if(u!==null){switch(n.tag){case 26:case 27:case 5:var d=n.stateNode;break;case 30:d=n.stateNode;break;default:d=n.stateNode}typeof u=="function"?n.refCleanup=u(d):u.current=d}}catch(p){Yt(n,a,p)}}function Qi(n,a){var u=n.ref,d=n.refCleanup;if(u!==null)if(typeof d=="function")try{d()}catch(p){Yt(n,a,p)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(p){Yt(n,a,p)}else u.current=null}function xp(n){var a=n.type,u=n.memoizedProps,d=n.stateNode;try{t:switch(a){case"button":case"input":case"select":case"textarea":u.autoFocus&&d.focus();break t;case"img":u.src?d.src=u.src:u.srcSet&&(d.srcset=u.srcSet)}}catch(p){Yt(n,n.return,p)}}function Vf(n,a,u){try{var d=n.stateNode;iA(d,n.type,u,a),d[Ye]=a}catch(p){Yt(n,n.return,p)}}function _p(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&ln(n.type)||n.tag===4}function Kf(n){t:for(;;){for(;n.sibling===null;){if(n.return===null||_p(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&ln(n.type)||n.flags&2||n.child===null||n.tag===4)continue t;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function zf(n,a,u){var d=n.tag;if(d===5||d===6)n=n.stateNode,a?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(n,a):(a=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,a.appendChild(n),u=u._reactRootContainer,u!=null||a.onclick!==null||(a.onclick=iu));else if(d!==4&&(d===27&&ln(n.type)&&(u=n.stateNode,a=null),n=n.child,n!==null))for(zf(n,a,u),n=n.sibling;n!==null;)zf(n,a,u),n=n.sibling}function zo(n,a,u){var d=n.tag;if(d===5||d===6)n=n.stateNode,a?u.insertBefore(n,a):u.appendChild(n);else if(d!==4&&(d===27&&ln(n.type)&&(u=n.stateNode),n=n.child,n!==null))for(zo(n,a,u),n=n.sibling;n!==null;)zo(n,a,u),n=n.sibling}function Ap(n){var a=n.stateNode,u=n.memoizedProps;try{for(var d=n.type,p=a.attributes;p.length;)a.removeAttributeNode(p[0]);Oe(a,d,u),a[Pe]=n,a[Ye]=u}catch(E){Yt(n,n.return,E)}}var bs=!1,he=!1,Yf=!1,bp=typeof WeakSet=="function"?WeakSet:Set,be=null;function N_(n,a){if(n=n.containerInfo,ph=uu,n=Nm(n),Vc(n)){if("selectionStart"in n)var u={start:n.selectionStart,end:n.selectionEnd};else t:{u=(u=n.ownerDocument)&&u.defaultView||window;var d=u.getSelection&&u.getSelection();if(d&&d.rangeCount!==0){u=d.anchorNode;var p=d.anchorOffset,E=d.focusNode;d=d.focusOffset;try{u.nodeType,E.nodeType}catch{u=null;break t}var b=0,D=-1,P=-1,Y=0,tt=0,nt=n,X=null;e:for(;;){for(var Q;nt!==u||p!==0&&nt.nodeType!==3||(D=b+p),nt!==E||d!==0&&nt.nodeType!==3||(P=b+d),nt.nodeType===3&&(b+=nt.nodeValue.length),(Q=nt.firstChild)!==null;)X=nt,nt=Q;for(;;){if(nt===n)break e;if(X===u&&++Y===p&&(D=b),X===E&&++tt===d&&(P=b),(Q=nt.nextSibling)!==null)break;nt=X,X=nt.parentNode}nt=Q}u=D===-1||P===-1?null:{start:D,end:P}}else u=null}u=u||{start:0,end:0}}else u=null;for(yh={focusedElem:n,selectionRange:u},uu=!1,be=a;be!==null;)if(a=be,n=a.child,(a.subtreeFlags&1024)!==0&&n!==null)n.return=a,be=n;else for(;be!==null;){switch(a=be,E=a.alternate,n=a.flags,a.tag){case 0:break;case 11:case 15:break;case 1:if((n&1024)!==0&&E!==null){n=void 0,u=a,p=E.memoizedProps,E=E.memoizedState,d=u.stateNode;try{var Tt=zn(u.type,p,u.elementType===u.type);n=d.getSnapshotBeforeUpdate(Tt,E),d.__reactInternalSnapshotBeforeUpdate=n}catch(vt){Yt(u,u.return,vt)}}break;case 3:if((n&1024)!==0){if(n=a.stateNode.containerInfo,u=n.nodeType,u===9)Th(n);else if(u===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":Th(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(i(163))}if(n=a.sibling,n!==null){n.return=a.return,be=n;break}be=a.return}}function Rp(n,a,u){var d=u.flags;switch(u.tag){case 0:case 11:case 15:Js(n,u),d&4&&il(5,u);break;case 1:if(Js(n,u),d&4)if(n=u.stateNode,a===null)try{n.componentDidMount()}catch(b){Yt(u,u.return,b)}else{var p=zn(u.type,a.memoizedProps);a=a.memoizedState;try{n.componentDidUpdate(p,a,n.__reactInternalSnapshotBeforeUpdate)}catch(b){Yt(u,u.return,b)}}d&64&&Tp(u),d&512&&sl(u,u.return);break;case 3:if(Js(n,u),d&64&&(n=u.updateQueue,n!==null)){if(a=null,u.child!==null)switch(u.child.tag){case 27:case 5:a=u.child.stateNode;break;case 1:a=u.child.stateNode}try{l0(n,a)}catch(b){Yt(u,u.return,b)}}break;case 27:a===null&&d&4&&Ap(u);case 26:case 5:Js(n,u),a===null&&d&4&&xp(u),d&512&&sl(u,u.return);break;case 12:Js(n,u);break;case 13:Js(n,u),d&4&&Ip(n,u),d&64&&(n=u.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(u=z_.bind(null,u),uA(n,u))));break;case 22:if(d=u.memoizedState!==null||bs,!d){a=a!==null&&a.memoizedState!==null||he,p=bs;var E=he;bs=d,(he=a)&&!E?tn(n,u,(u.subtreeFlags&8772)!==0):Js(n,u),bs=p,he=E}break;case 30:break;default:Js(n,u)}}function Lp(n){var a=n.alternate;a!==null&&(n.alternate=null,Lp(a)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(a=n.stateNode,a!==null&&Ac(a)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var Zt=null,Xe=!1;function Rs(n,a,u){for(u=u.child;u!==null;)Dp(n,a,u),u=u.sibling}function Dp(n,a,u){if(ke&&typeof ke.onCommitFiberUnmount=="function")try{ke.onCommitFiberUnmount(Fi,u)}catch{}switch(u.tag){case 26:he||Qi(u,a),Rs(n,a,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:he||Qi(u,a);var d=Zt,p=Xe;ln(u.type)&&(Zt=u.stateNode,Xe=!1),Rs(n,a,u),hl(u.stateNode),Zt=d,Xe=p;break;case 5:he||Qi(u,a);case 6:if(d=Zt,p=Xe,Zt=null,Rs(n,a,u),Zt=d,Xe=p,Zt!==null)if(Xe)try{(Zt.nodeType===9?Zt.body:Zt.nodeName==="HTML"?Zt.ownerDocument.body:Zt).removeChild(u.stateNode)}catch(E){Yt(u,a,E)}else try{Zt.removeChild(u.stateNode)}catch(E){Yt(u,a,E)}break;case 18:Zt!==null&&(Xe?(n=Zt,py(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,u.stateNode),Tl(n)):py(Zt,u.stateNode));break;case 4:d=Zt,p=Xe,Zt=u.stateNode.containerInfo,Xe=!0,Rs(n,a,u),Zt=d,Xe=p;break;case 0:case 11:case 14:case 15:he||Zs(2,u,a),he||Zs(4,u,a),Rs(n,a,u);break;case 1:he||(Qi(u,a),d=u.stateNode,typeof d.componentWillUnmount=="function"&&Sp(u,a,d)),Rs(n,a,u);break;case 21:Rs(n,a,u);break;case 22:he=(d=he)||u.memoizedState!==null,Rs(n,a,u),he=d;break;default:Rs(n,a,u)}}function Ip(n,a){if(a.memoizedState===null&&(n=a.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{Tl(n)}catch(u){Yt(a,a.return,u)}}function U_(n){switch(n.tag){case 13:case 19:var a=n.stateNode;return a===null&&(a=n.stateNode=new bp),a;case 22:return n=n.stateNode,a=n._retryCache,a===null&&(a=n._retryCache=new bp),a;default:throw Error(i(435,n.tag))}}function jf(n,a){var u=U_(n);a.forEach(function(d){var p=Y_.bind(null,n,d);u.has(d)||(u.add(d),d.then(p,p))})}function ai(n,a){var u=a.deletions;if(u!==null)for(var d=0;d<u.length;d++){var p=u[d],E=n,b=a,D=b;t:for(;D!==null;){switch(D.tag){case 27:if(ln(D.type)){Zt=D.stateNode,Xe=!1;break t}break;case 5:Zt=D.stateNode,Xe=!1;break t;case 3:case 4:Zt=D.stateNode.containerInfo,Xe=!0;break t}D=D.return}if(Zt===null)throw Error(i(160));Dp(E,b,p),Zt=null,Xe=!1,E=p.alternate,E!==null&&(E.return=null),p.return=null}if(a.subtreeFlags&13878)for(a=a.child;a!==null;)Cp(a,n),a=a.sibling}var Gi=null;function Cp(n,a){var u=n.alternate,d=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:ai(a,n),li(n),d&4&&(Zs(3,n,n.return),il(3,n),Zs(5,n,n.return));break;case 1:ai(a,n),li(n),d&512&&(he||u===null||Qi(u,u.return)),d&64&&bs&&(n=n.updateQueue,n!==null&&(d=n.callbacks,d!==null&&(u=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=u===null?d:u.concat(d))));break;case 26:var p=Gi;if(ai(a,n),li(n),d&512&&(he||u===null||Qi(u,u.return)),d&4){var E=u!==null?u.memoizedState:null;if(d=n.memoizedState,u===null)if(d===null)if(n.stateNode===null){t:{d=n.type,u=n.memoizedProps,p=p.ownerDocument||p;e:switch(d){case"title":E=p.getElementsByTagName("title")[0],(!E||E[La]||E[Pe]||E.namespaceURI==="http://www.w3.org/2000/svg"||E.hasAttribute("itemprop"))&&(E=p.createElement(d),p.head.insertBefore(E,p.querySelector("head > title"))),Oe(E,d,u),E[Pe]=n,_e(E),d=E;break t;case"link":var b=Ay("link","href",p).get(d+(u.href||""));if(b){for(var D=0;D<b.length;D++)if(E=b[D],E.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&E.getAttribute("rel")===(u.rel==null?null:u.rel)&&E.getAttribute("title")===(u.title==null?null:u.title)&&E.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){b.splice(D,1);break e}}E=p.createElement(d),Oe(E,d,u),p.head.appendChild(E);break;case"meta":if(b=Ay("meta","content",p).get(d+(u.content||""))){for(D=0;D<b.length;D++)if(E=b[D],E.getAttribute("content")===(u.content==null?null:""+u.content)&&E.getAttribute("name")===(u.name==null?null:u.name)&&E.getAttribute("property")===(u.property==null?null:u.property)&&E.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&E.getAttribute("charset")===(u.charSet==null?null:u.charSet)){b.splice(D,1);break e}}E=p.createElement(d),Oe(E,d,u),p.head.appendChild(E);break;default:throw Error(i(468,d))}E[Pe]=n,_e(E),d=E}n.stateNode=d}else by(p,n.type,n.stateNode);else n.stateNode=_y(p,d,n.memoizedProps);else E!==d?(E===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):E.count--,d===null?by(p,n.type,n.stateNode):_y(p,d,n.memoizedProps)):d===null&&n.stateNode!==null&&Vf(n,n.memoizedProps,u.memoizedProps)}break;case 27:ai(a,n),li(n),d&512&&(he||u===null||Qi(u,u.return)),u!==null&&d&4&&Vf(n,n.memoizedProps,u.memoizedProps);break;case 5:if(ai(a,n),li(n),d&512&&(he||u===null||Qi(u,u.return)),n.flags&32){p=n.stateNode;try{Tr(p,"")}catch(Q){Yt(n,n.return,Q)}}d&4&&n.stateNode!=null&&(p=n.memoizedProps,Vf(n,p,u!==null?u.memoizedProps:p)),d&1024&&(Yf=!0);break;case 6:if(ai(a,n),li(n),d&4){if(n.stateNode===null)throw Error(i(162));d=n.memoizedProps,u=n.stateNode;try{u.nodeValue=d}catch(Q){Yt(n,n.return,Q)}}break;case 3:if(au=null,p=Gi,Gi=nu(a.containerInfo),ai(a,n),Gi=p,li(n),d&4&&u!==null&&u.memoizedState.isDehydrated)try{Tl(a.containerInfo)}catch(Q){Yt(n,n.return,Q)}Yf&&(Yf=!1,Op(n));break;case 4:d=Gi,Gi=nu(n.stateNode.containerInfo),ai(a,n),li(n),Gi=d;break;case 12:ai(a,n),li(n);break;case 13:ai(a,n),li(n),n.child.flags&8192&&n.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(Jf=zt()),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,jf(n,d)));break;case 22:p=n.memoizedState!==null;var P=u!==null&&u.memoizedState!==null,Y=bs,tt=he;if(bs=Y||p,he=tt||P,ai(a,n),he=tt,bs=Y,li(n),d&8192)t:for(a=n.stateNode,a._visibility=p?a._visibility&-2:a._visibility|1,p&&(u===null||P||bs||he||Yn(n)),u=null,a=n;;){if(a.tag===5||a.tag===26){if(u===null){P=u=a;try{if(E=P.stateNode,p)b=E.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{D=P.stateNode;var nt=P.memoizedProps.style,X=nt!=null&&nt.hasOwnProperty("display")?nt.display:null;D.style.display=X==null||typeof X=="boolean"?"":(""+X).trim()}}catch(Q){Yt(P,P.return,Q)}}}else if(a.tag===6){if(u===null){P=a;try{P.stateNode.nodeValue=p?"":P.memoizedProps}catch(Q){Yt(P,P.return,Q)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===n)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===n)break t;for(;a.sibling===null;){if(a.return===null||a.return===n)break t;u===a&&(u=null),a=a.return}u===a&&(u=null),a.sibling.return=a.return,a=a.sibling}d&4&&(d=n.updateQueue,d!==null&&(u=d.retryQueue,u!==null&&(d.retryQueue=null,jf(n,u))));break;case 19:ai(a,n),li(n),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,jf(n,d)));break;case 30:break;case 21:break;default:ai(a,n),li(n)}}function li(n){var a=n.flags;if(a&2){try{for(var u,d=n.return;d!==null;){if(_p(d)){u=d;break}d=d.return}if(u==null)throw Error(i(160));switch(u.tag){case 27:var p=u.stateNode,E=Kf(n);zo(n,E,p);break;case 5:var b=u.stateNode;u.flags&32&&(Tr(b,""),u.flags&=-33);var D=Kf(n);zo(n,D,b);break;case 3:case 4:var P=u.stateNode.containerInfo,Y=Kf(n);zf(n,Y,P);break;default:throw Error(i(161))}}catch(tt){Yt(n,n.return,tt)}n.flags&=-3}a&4096&&(n.flags&=-4097)}function Op(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var a=n;Op(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),n=n.sibling}}function Js(n,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Rp(n,a.alternate,a),a=a.sibling}function Yn(n){for(n=n.child;n!==null;){var a=n;switch(a.tag){case 0:case 11:case 14:case 15:Zs(4,a,a.return),Yn(a);break;case 1:Qi(a,a.return);var u=a.stateNode;typeof u.componentWillUnmount=="function"&&Sp(a,a.return,u),Yn(a);break;case 27:hl(a.stateNode);case 26:case 5:Qi(a,a.return),Yn(a);break;case 22:a.memoizedState===null&&Yn(a);break;case 30:Yn(a);break;default:Yn(a)}n=n.sibling}}function tn(n,a,u){for(u=u&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var d=a.alternate,p=n,E=a,b=E.flags;switch(E.tag){case 0:case 11:case 15:tn(p,E,u),il(4,E);break;case 1:if(tn(p,E,u),d=E,p=d.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(Y){Yt(d,d.return,Y)}if(d=E,p=d.updateQueue,p!==null){var D=d.stateNode;try{var P=p.shared.hiddenCallbacks;if(P!==null)for(p.shared.hiddenCallbacks=null,p=0;p<P.length;p++)a0(P[p],D)}catch(Y){Yt(d,d.return,Y)}}u&&b&64&&Tp(E),sl(E,E.return);break;case 27:Ap(E);case 26:case 5:tn(p,E,u),u&&d===null&&b&4&&xp(E),sl(E,E.return);break;case 12:tn(p,E,u);break;case 13:tn(p,E,u),u&&b&4&&Ip(p,E);break;case 22:E.memoizedState===null&&tn(p,E,u),sl(E,E.return);break;case 30:break;default:tn(p,E,u)}a=a.sibling}}function qf(n,a){var u=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(u=n.memoizedState.cachePool.pool),n=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(n=a.memoizedState.cachePool.pool),n!==u&&(n!=null&&n.refCount++,u!=null&&Ha(u))}function Xf(n,a){n=null,a.alternate!==null&&(n=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==n&&(a.refCount++,n!=null&&Ha(n))}function Wi(n,a,u,d){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)wp(n,a,u,d),a=a.sibling}function wp(n,a,u,d){var p=a.flags;switch(a.tag){case 0:case 11:case 15:Wi(n,a,u,d),p&2048&&il(9,a);break;case 1:Wi(n,a,u,d);break;case 3:Wi(n,a,u,d),p&2048&&(n=null,a.alternate!==null&&(n=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==n&&(a.refCount++,n!=null&&Ha(n)));break;case 12:if(p&2048){Wi(n,a,u,d),n=a.stateNode;try{var E=a.memoizedProps,b=E.id,D=E.onPostCommit;typeof D=="function"&&D(b,a.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(P){Yt(a,a.return,P)}}else Wi(n,a,u,d);break;case 13:Wi(n,a,u,d);break;case 23:break;case 22:E=a.stateNode,b=a.alternate,a.memoizedState!==null?E._visibility&2?Wi(n,a,u,d):nl(n,a):E._visibility&2?Wi(n,a,u,d):(E._visibility|=2,Fr(n,a,u,d,(a.subtreeFlags&10256)!==0)),p&2048&&qf(b,a);break;case 24:Wi(n,a,u,d),p&2048&&Xf(a.alternate,a);break;default:Wi(n,a,u,d)}}function Fr(n,a,u,d,p){for(p=p&&(a.subtreeFlags&10256)!==0,a=a.child;a!==null;){var E=n,b=a,D=u,P=d,Y=b.flags;switch(b.tag){case 0:case 11:case 15:Fr(E,b,D,P,p),il(8,b);break;case 23:break;case 22:var tt=b.stateNode;b.memoizedState!==null?tt._visibility&2?Fr(E,b,D,P,p):nl(E,b):(tt._visibility|=2,Fr(E,b,D,P,p)),p&&Y&2048&&qf(b.alternate,b);break;case 24:Fr(E,b,D,P,p),p&&Y&2048&&Xf(b.alternate,b);break;default:Fr(E,b,D,P,p)}a=a.sibling}}function nl(n,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var u=n,d=a,p=d.flags;switch(d.tag){case 22:nl(u,d),p&2048&&qf(d.alternate,d);break;case 24:nl(u,d),p&2048&&Xf(d.alternate,d);break;default:nl(u,d)}a=a.sibling}}var rl=8192;function $r(n){if(n.subtreeFlags&rl)for(n=n.child;n!==null;)kp(n),n=n.sibling}function kp(n){switch(n.tag){case 26:$r(n),n.flags&rl&&n.memoizedState!==null&&xA(Gi,n.memoizedState,n.memoizedProps);break;case 5:$r(n);break;case 3:case 4:var a=Gi;Gi=nu(n.stateNode.containerInfo),$r(n),Gi=a;break;case 22:n.memoizedState===null&&(a=n.alternate,a!==null&&a.memoizedState!==null?(a=rl,rl=16777216,$r(n),rl=a):$r(n));break;default:$r(n)}}function Mp(n){var a=n.alternate;if(a!==null&&(n=a.child,n!==null)){a.child=null;do a=n.sibling,n.sibling=null,n=a;while(n!==null)}}function al(n){var a=n.deletions;if((n.flags&16)!==0){if(a!==null)for(var u=0;u<a.length;u++){var d=a[u];be=d,Np(d,n)}Mp(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Pp(n),n=n.sibling}function Pp(n){switch(n.tag){case 0:case 11:case 15:al(n),n.flags&2048&&Zs(9,n,n.return);break;case 3:al(n);break;case 12:al(n);break;case 22:var a=n.stateNode;n.memoizedState!==null&&a._visibility&2&&(n.return===null||n.return.tag!==13)?(a._visibility&=-3,Yo(n)):al(n);break;default:al(n)}}function Yo(n){var a=n.deletions;if((n.flags&16)!==0){if(a!==null)for(var u=0;u<a.length;u++){var d=a[u];be=d,Np(d,n)}Mp(n)}for(n=n.child;n!==null;){switch(a=n,a.tag){case 0:case 11:case 15:Zs(8,a,a.return),Yo(a);break;case 22:u=a.stateNode,u._visibility&2&&(u._visibility&=-3,Yo(a));break;default:Yo(a)}n=n.sibling}}function Np(n,a){for(;be!==null;){var u=be;switch(u.tag){case 0:case 11:case 15:Zs(8,u,a);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var d=u.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Ha(u.memoizedState.cache)}if(d=u.child,d!==null)d.return=u,be=d;else t:for(u=n;be!==null;){d=be;var p=d.sibling,E=d.return;if(Lp(d),d===u){be=null;break t}if(p!==null){p.return=E,be=p;break t}be=E}}}var B_={getCacheForType:function(n){var a=Ne(Ee),u=a.data.get(n);return u===void 0&&(u=n(),a.data.set(n,u)),u}},F_=typeof WeakMap=="function"?WeakMap:Map,Ut=0,Qt=null,It=null,kt=0,Bt=0,oi=null,en=!1,Gr=!1,Qf=!1,Ls=0,ae=0,sn=0,jn=0,Wf=0,Di=0,Hr=0,ll=null,Qe=null,Zf=!1,Jf=0,jo=1/0,qo=null,nn=null,Ce=0,rn=null,Vr=null,Kr=0,th=0,eh=null,Up=null,ol=0,ih=null;function ui(){if((Ut&2)!==0&&kt!==0)return kt&-kt;if(B.T!==null){var n=Or;return n!==0?n:uh()}return Jg()}function Bp(){Di===0&&(Di=(kt&536870912)===0||Pt?Xg():536870912);var n=Li.current;return n!==null&&(n.flags|=32),Di}function ci(n,a,u){(n===Qt&&(Bt===2||Bt===9)||n.cancelPendingCommit!==null)&&(zr(n,0),an(n,kt,Di,!1)),Ra(n,u),((Ut&2)===0||n!==Qt)&&(n===Qt&&((Ut&2)===0&&(jn|=u),ae===4&&an(n,kt,Di,!1)),Zi(n))}function Fp(n,a,u){if((Ut&6)!==0)throw Error(i(327));var d=!u&&(a&124)===0&&(a&n.expiredLanes)===0||ba(n,a),p=d?H_(n,a):rh(n,a,!0),E=d;do{if(p===0){Gr&&!d&&an(n,a,0,!1);break}else{if(u=n.current.alternate,E&&!$_(u)){p=rh(n,a,!1),E=!1;continue}if(p===2){if(E=a,n.errorRecoveryDisabledLanes&E)var b=0;else b=n.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){a=b;t:{var D=n;p=ll;var P=D.current.memoizedState.isDehydrated;if(P&&(zr(D,b).flags|=256),b=rh(D,b,!1),b!==2){if(Qf&&!P){D.errorRecoveryDisabledLanes|=E,jn|=E,p=4;break t}E=Qe,Qe=p,E!==null&&(Qe===null?Qe=E:Qe.push.apply(Qe,E))}p=b}if(E=!1,p!==2)continue}}if(p===1){zr(n,0),an(n,a,0,!0);break}t:{switch(d=n,E=p,E){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:an(d,a,Di,!en);break t;case 2:Qe=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(p=Jf+300-zt(),10<p)){if(an(d,a,Di,!en),no(d,0,!0)!==0)break t;d.timeoutHandle=gy($p.bind(null,d,u,Qe,qo,Zf,a,Di,jn,Hr,en,E,2,-0,0),p);break t}$p(d,u,Qe,qo,Zf,a,Di,jn,Hr,en,E,0,-0,0)}}break}while(!0);Zi(n)}function $p(n,a,u,d,p,E,b,D,P,Y,tt,nt,X,Q){if(n.timeoutHandle=-1,nt=a.subtreeFlags,(nt&8192||(nt&16785408)===16785408)&&(ml={stylesheets:null,count:0,unsuspend:SA},kp(a),nt=_A(),nt!==null)){n.cancelPendingCommit=nt(jp.bind(null,n,a,E,u,d,p,b,D,P,tt,1,X,Q)),an(n,E,b,!Y);return}jp(n,a,E,u,d,p,b,D,P)}function $_(n){for(var a=n;;){var u=a.tag;if((u===0||u===11||u===15)&&a.flags&16384&&(u=a.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var d=0;d<u.length;d++){var p=u[d],E=p.getSnapshot;p=p.value;try{if(!ni(E(),p))return!1}catch{return!1}}if(u=a.child,a.subtreeFlags&16384&&u!==null)u.return=a,a=u;else{if(a===n)break;for(;a.sibling===null;){if(a.return===null||a.return===n)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function an(n,a,u,d){a&=~Wf,a&=~jn,n.suspendedLanes|=a,n.pingedLanes&=~a,d&&(n.warmLanes|=a),d=n.expirationTimes;for(var p=a;0<p;){var E=31-Me(p),b=1<<E;d[E]=-1,p&=~b}u!==0&&Wg(n,u,a)}function Xo(){return(Ut&6)===0?(ul(0),!1):!0}function sh(){if(It!==null){if(Bt===0)var n=It.return;else n=It,Es=Gn=null,Tf(n),Ur=null,Ja=0,n=It;for(;n!==null;)Ep(n.alternate,n),n=n.return;It=null}}function zr(n,a){var u=n.timeoutHandle;u!==-1&&(n.timeoutHandle=-1,nA(u)),u=n.cancelPendingCommit,u!==null&&(n.cancelPendingCommit=null,u()),sh(),Qt=n,It=u=ps(n.current,null),kt=a,Bt=0,oi=null,en=!1,Gr=ba(n,a),Qf=!1,Hr=Di=Wf=jn=sn=ae=0,Qe=ll=null,Zf=!1,(a&8)!==0&&(a|=a&32);var d=n.entangledLanes;if(d!==0)for(n=n.entanglements,d&=a;0<d;){var p=31-Me(d),E=1<<p;a|=n[p],d&=~E}return Ls=a,yo(),u}function Gp(n,a){bt=null,B.H=No,a===Ka||a===Ro?(a=n0(),Bt=3):a===e0?(a=n0(),Bt=4):Bt=a===rp?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,oi=a,It===null&&(ae=1,Go(n,_i(a,n.current)))}function Hp(){var n=B.H;return B.H=No,n===null?No:n}function Vp(){var n=B.A;return B.A=B_,n}function nh(){ae=4,en||(kt&4194048)!==kt&&Li.current!==null||(Gr=!0),(sn&134217727)===0&&(jn&134217727)===0||Qt===null||an(Qt,kt,Di,!1)}function rh(n,a,u){var d=Ut;Ut|=2;var p=Hp(),E=Vp();(Qt!==n||kt!==a)&&(qo=null,zr(n,a)),a=!1;var b=ae;t:do try{if(Bt!==0&&It!==null){var D=It,P=oi;switch(Bt){case 8:sh(),b=6;break t;case 3:case 2:case 9:case 6:Li.current===null&&(a=!0);var Y=Bt;if(Bt=0,oi=null,Yr(n,D,P,Y),u&&Gr){b=0;break t}break;default:Y=Bt,Bt=0,oi=null,Yr(n,D,P,Y)}}G_(),b=ae;break}catch(tt){Gp(n,tt)}while(!0);return a&&n.shellSuspendCounter++,Es=Gn=null,Ut=d,B.H=p,B.A=E,It===null&&(Qt=null,kt=0,yo()),b}function G_(){for(;It!==null;)Kp(It)}function H_(n,a){var u=Ut;Ut|=2;var d=Hp(),p=Vp();Qt!==n||kt!==a?(qo=null,jo=zt()+500,zr(n,a)):Gr=ba(n,a);t:do try{if(Bt!==0&&It!==null){a=It;var E=oi;e:switch(Bt){case 1:Bt=0,oi=null,Yr(n,a,E,1);break;case 2:case 9:if(i0(E)){Bt=0,oi=null,zp(a);break}a=function(){Bt!==2&&Bt!==9||Qt!==n||(Bt=7),Zi(n)},E.then(a,a);break t;case 3:Bt=7;break t;case 4:Bt=5;break t;case 7:i0(E)?(Bt=0,oi=null,zp(a)):(Bt=0,oi=null,Yr(n,a,E,7));break;case 5:var b=null;switch(It.tag){case 26:b=It.memoizedState;case 5:case 27:var D=It;if(!b||Ry(b)){Bt=0,oi=null;var P=D.sibling;if(P!==null)It=P;else{var Y=D.return;Y!==null?(It=Y,Qo(Y)):It=null}break e}}Bt=0,oi=null,Yr(n,a,E,5);break;case 6:Bt=0,oi=null,Yr(n,a,E,6);break;case 8:sh(),ae=6;break t;default:throw Error(i(462))}}V_();break}catch(tt){Gp(n,tt)}while(!0);return Es=Gn=null,B.H=d,B.A=p,Ut=u,It!==null?0:(Qt=null,kt=0,yo(),ae)}function V_(){for(;It!==null&&!qg();)Kp(It)}function Kp(n){var a=yp(n.alternate,n,Ls);n.memoizedProps=n.pendingProps,a===null?Qo(n):It=a}function zp(n){var a=n,u=a.alternate;switch(a.tag){case 15:case 0:a=fp(u,a,a.pendingProps,a.type,void 0,kt);break;case 11:a=fp(u,a,a.pendingProps,a.type.render,a.ref,kt);break;case 5:Tf(a);default:Ep(u,a),a=It=Ym(a,Ls),a=yp(u,a,Ls)}n.memoizedProps=n.pendingProps,a===null?Qo(n):It=a}function Yr(n,a,u,d){Es=Gn=null,Tf(a),Ur=null,Ja=0;var p=a.return;try{if(w_(n,p,a,u,kt)){ae=1,Go(n,_i(u,n.current)),It=null;return}}catch(E){if(p!==null)throw It=p,E;ae=1,Go(n,_i(u,n.current)),It=null;return}a.flags&32768?(Pt||d===1?n=!0:Gr||(kt&536870912)!==0?n=!1:(en=n=!0,(d===2||d===9||d===3||d===6)&&(d=Li.current,d!==null&&d.tag===13&&(d.flags|=16384))),Yp(a,n)):Qo(a)}function Qo(n){var a=n;do{if((a.flags&32768)!==0){Yp(a,en);return}n=a.return;var u=M_(a.alternate,a,Ls);if(u!==null){It=u;return}if(a=a.sibling,a!==null){It=a;return}It=a=n}while(a!==null);ae===0&&(ae=5)}function Yp(n,a){do{var u=P_(n.alternate,n);if(u!==null){u.flags&=32767,It=u;return}if(u=n.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!a&&(n=n.sibling,n!==null)){It=n;return}It=n=u}while(n!==null);ae=6,It=null}function jp(n,a,u,d,p,E,b,D,P){n.cancelPendingCommit=null;do Wo();while(Ce!==0);if((Ut&6)!==0)throw Error(i(327));if(a!==null){if(a===n.current)throw Error(i(177));if(E=a.lanes|a.childLanes,E|=qc,Sx(n,u,E,b,D,P),n===Qt&&(It=Qt=null,kt=0),Vr=a,rn=n,Kr=u,th=E,eh=p,Up=d,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,j_(Bi,function(){return Zp(),null})):(n.callbackNode=null,n.callbackPriority=0),d=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||d){d=B.T,B.T=null,p=q.p,q.p=2,b=Ut,Ut|=4;try{N_(n,a,u)}finally{Ut=b,q.p=p,B.T=d}}Ce=1,qp(),Xp(),Qp()}}function qp(){if(Ce===1){Ce=0;var n=rn,a=Vr,u=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||u){u=B.T,B.T=null;var d=q.p;q.p=2;var p=Ut;Ut|=4;try{Cp(a,n);var E=yh,b=Nm(n.containerInfo),D=E.focusedElem,P=E.selectionRange;if(b!==D&&D&&D.ownerDocument&&Pm(D.ownerDocument.documentElement,D)){if(P!==null&&Vc(D)){var Y=P.start,tt=P.end;if(tt===void 0&&(tt=Y),"selectionStart"in D)D.selectionStart=Y,D.selectionEnd=Math.min(tt,D.value.length);else{var nt=D.ownerDocument||document,X=nt&&nt.defaultView||window;if(X.getSelection){var Q=X.getSelection(),Tt=D.textContent.length,vt=Math.min(P.start,Tt),Ht=P.end===void 0?vt:Math.min(P.end,Tt);!Q.extend&&vt>Ht&&(b=Ht,Ht=vt,vt=b);var G=Mm(D,vt),F=Mm(D,Ht);if(G&&F&&(Q.rangeCount!==1||Q.anchorNode!==G.node||Q.anchorOffset!==G.offset||Q.focusNode!==F.node||Q.focusOffset!==F.offset)){var V=nt.createRange();V.setStart(G.node,G.offset),Q.removeAllRanges(),vt>Ht?(Q.addRange(V),Q.extend(F.node,F.offset)):(V.setEnd(F.node,F.offset),Q.addRange(V))}}}}for(nt=[],Q=D;Q=Q.parentNode;)Q.nodeType===1&&nt.push({element:Q,left:Q.scrollLeft,top:Q.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<nt.length;D++){var it=nt[D];it.element.scrollLeft=it.left,it.element.scrollTop=it.top}}uu=!!ph,yh=ph=null}finally{Ut=p,q.p=d,B.T=u}}n.current=a,Ce=2}}function Xp(){if(Ce===2){Ce=0;var n=rn,a=Vr,u=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||u){u=B.T,B.T=null;var d=q.p;q.p=2;var p=Ut;Ut|=4;try{Rp(n,a.alternate,a)}finally{Ut=p,q.p=d,B.T=u}}Ce=3}}function Qp(){if(Ce===4||Ce===3){Ce=0,wt();var n=rn,a=Vr,u=Kr,d=Up;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Ce=5:(Ce=0,Vr=rn=null,Wp(n,n.pendingLanes));var p=n.pendingLanes;if(p===0&&(nn=null),xc(u),a=a.stateNode,ke&&typeof ke.onCommitFiberRoot=="function")try{ke.onCommitFiberRoot(Fi,a,void 0,(a.current.flags&128)===128)}catch{}if(d!==null){a=B.T,p=q.p,q.p=2,B.T=null;try{for(var E=n.onRecoverableError,b=0;b<d.length;b++){var D=d[b];E(D.value,{componentStack:D.stack})}}finally{B.T=a,q.p=p}}(Kr&3)!==0&&Wo(),Zi(n),p=n.pendingLanes,(u&4194090)!==0&&(p&42)!==0?n===ih?ol++:(ol=0,ih=n):ol=0,ul(0)}}function Wp(n,a){(n.pooledCacheLanes&=a)===0&&(a=n.pooledCache,a!=null&&(n.pooledCache=null,Ha(a)))}function Wo(n){return qp(),Xp(),Qp(),Zp()}function Zp(){if(Ce!==5)return!1;var n=rn,a=th;th=0;var u=xc(Kr),d=B.T,p=q.p;try{q.p=32>u?32:u,B.T=null,u=eh,eh=null;var E=rn,b=Kr;if(Ce=0,Vr=rn=null,Kr=0,(Ut&6)!==0)throw Error(i(331));var D=Ut;if(Ut|=4,Pp(E.current),wp(E,E.current,b,u),Ut=D,ul(0,!1),ke&&typeof ke.onPostCommitFiberRoot=="function")try{ke.onPostCommitFiberRoot(Fi,E)}catch{}return!0}finally{q.p=p,B.T=d,Wp(n,a)}}function Jp(n,a,u){a=_i(u,a),a=Mf(n.stateNode,a,2),n=qs(n,a,2),n!==null&&(Ra(n,2),Zi(n))}function Yt(n,a,u){if(n.tag===3)Jp(n,n,u);else for(;a!==null;){if(a.tag===3){Jp(a,n,u);break}else if(a.tag===1){var d=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(nn===null||!nn.has(d))){n=_i(u,n),u=sp(2),d=qs(a,u,2),d!==null&&(np(u,d,a,n),Ra(d,2),Zi(d));break}}a=a.return}}function ah(n,a,u){var d=n.pingCache;if(d===null){d=n.pingCache=new F_;var p=new Set;d.set(a,p)}else p=d.get(a),p===void 0&&(p=new Set,d.set(a,p));p.has(u)||(Qf=!0,p.add(u),n=K_.bind(null,n,a,u),a.then(n,n))}function K_(n,a,u){var d=n.pingCache;d!==null&&d.delete(a),n.pingedLanes|=n.suspendedLanes&u,n.warmLanes&=~u,Qt===n&&(kt&u)===u&&(ae===4||ae===3&&(kt&62914560)===kt&&300>zt()-Jf?(Ut&2)===0&&zr(n,0):Wf|=u,Hr===kt&&(Hr=0)),Zi(n)}function ty(n,a){a===0&&(a=Qg()),n=Lr(n,a),n!==null&&(Ra(n,a),Zi(n))}function z_(n){var a=n.memoizedState,u=0;a!==null&&(u=a.retryLane),ty(n,u)}function Y_(n,a){var u=0;switch(n.tag){case 13:var d=n.stateNode,p=n.memoizedState;p!==null&&(u=p.retryLane);break;case 19:d=n.stateNode;break;case 22:d=n.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(a),ty(n,u)}function j_(n,a){return Dn(n,a)}var Zo=null,jr=null,lh=!1,Jo=!1,oh=!1,qn=0;function Zi(n){n!==jr&&n.next===null&&(jr===null?Zo=jr=n:jr=jr.next=n),Jo=!0,lh||(lh=!0,X_())}function ul(n,a){if(!oh&&Jo){oh=!0;do for(var u=!1,d=Zo;d!==null;){if(n!==0){var p=d.pendingLanes;if(p===0)var E=0;else{var b=d.suspendedLanes,D=d.pingedLanes;E=(1<<31-Me(42|n)+1)-1,E&=p&~(b&~D),E=E&201326741?E&201326741|1:E?E|2:0}E!==0&&(u=!0,ny(d,E))}else E=kt,E=no(d,d===Qt?E:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(E&3)===0||ba(d,E)||(u=!0,ny(d,E));d=d.next}while(u);oh=!1}}function q_(){ey()}function ey(){Jo=lh=!1;var n=0;qn!==0&&(sA()&&(n=qn),qn=0);for(var a=zt(),u=null,d=Zo;d!==null;){var p=d.next,E=iy(d,a);E===0?(d.next=null,u===null?Zo=p:u.next=p,p===null&&(jr=u)):(u=d,(n!==0||(E&3)!==0)&&(Jo=!0)),d=p}ul(n)}function iy(n,a){for(var u=n.suspendedLanes,d=n.pingedLanes,p=n.expirationTimes,E=n.pendingLanes&-62914561;0<E;){var b=31-Me(E),D=1<<b,P=p[b];P===-1?((D&u)===0||(D&d)!==0)&&(p[b]=Tx(D,a)):P<=a&&(n.expiredLanes|=D),E&=~D}if(a=Qt,u=kt,u=no(n,n===a?u:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d=n.callbackNode,u===0||n===a&&(Bt===2||Bt===9)||n.cancelPendingCommit!==null)return d!==null&&d!==null&&In(d),n.callbackNode=null,n.callbackPriority=0;if((u&3)===0||ba(n,u)){if(a=u&-u,a===n.callbackPriority)return a;switch(d!==null&&In(d),xc(u)){case 2:case 8:u=ze;break;case 32:u=Bi;break;case 268435456:u=Aa;break;default:u=Bi}return d=sy.bind(null,n),u=Dn(u,d),n.callbackPriority=a,n.callbackNode=u,a}return d!==null&&d!==null&&In(d),n.callbackPriority=2,n.callbackNode=null,2}function sy(n,a){if(Ce!==0&&Ce!==5)return n.callbackNode=null,n.callbackPriority=0,null;var u=n.callbackNode;if(Wo()&&n.callbackNode!==u)return null;var d=kt;return d=no(n,n===Qt?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d===0?null:(Fp(n,d,a),iy(n,zt()),n.callbackNode!=null&&n.callbackNode===u?sy.bind(null,n):null)}function ny(n,a){if(Wo())return null;Fp(n,a,!0)}function X_(){rA(function(){(Ut&6)!==0?Dn(Yi,q_):ey()})}function uh(){return qn===0&&(qn=Xg()),qn}function ry(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:uo(""+n)}function ay(n,a){var u=a.ownerDocument.createElement("input");return u.name=a.name,u.value=a.value,n.id&&u.setAttribute("form",n.id),a.parentNode.insertBefore(u,a),n=new FormData(n),u.parentNode.removeChild(u),n}function Q_(n,a,u,d,p){if(a==="submit"&&u&&u.stateNode===p){var E=ry((p[Ye]||null).action),b=d.submitter;b&&(a=(a=b[Ye]||null)?ry(a.formAction):b.getAttribute("formAction"),a!==null&&(E=a,b=null));var D=new go("action","action",null,d,p);n.push({event:D,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(qn!==0){var P=b?ay(p,b):new FormData(p);If(u,{pending:!0,data:P,method:p.method,action:E},null,P)}}else typeof E=="function"&&(D.preventDefault(),P=b?ay(p,b):new FormData(p),If(u,{pending:!0,data:P,method:p.method,action:E},E,P))},currentTarget:p}]})}}for(var ch=0;ch<jc.length;ch++){var fh=jc[ch],W_=fh.toLowerCase(),Z_=fh[0].toUpperCase()+fh.slice(1);$i(W_,"on"+Z_)}$i(Fm,"onAnimationEnd"),$i($m,"onAnimationIteration"),$i(Gm,"onAnimationStart"),$i("dblclick","onDoubleClick"),$i("focusin","onFocus"),$i("focusout","onBlur"),$i(m_,"onTransitionRun"),$i(p_,"onTransitionStart"),$i(y_,"onTransitionCancel"),$i(Hm,"onTransitionEnd"),yr("onMouseEnter",["mouseout","mouseover"]),yr("onMouseLeave",["mouseout","mouseover"]),yr("onPointerEnter",["pointerout","pointerover"]),yr("onPointerLeave",["pointerout","pointerover"]),wn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),wn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),wn("onBeforeInput",["compositionend","keypress","textInput","paste"]),wn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),wn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),wn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),J_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(cl));function ly(n,a){a=(a&4)!==0;for(var u=0;u<n.length;u++){var d=n[u],p=d.event;d=d.listeners;t:{var E=void 0;if(a)for(var b=d.length-1;0<=b;b--){var D=d[b],P=D.instance,Y=D.currentTarget;if(D=D.listener,P!==E&&p.isPropagationStopped())break t;E=D,p.currentTarget=Y;try{E(p)}catch(tt){$o(tt)}p.currentTarget=null,E=P}else for(b=0;b<d.length;b++){if(D=d[b],P=D.instance,Y=D.currentTarget,D=D.listener,P!==E&&p.isPropagationStopped())break t;E=D,p.currentTarget=Y;try{E(p)}catch(tt){$o(tt)}p.currentTarget=null,E=P}}}}function Ct(n,a){var u=a[_c];u===void 0&&(u=a[_c]=new Set);var d=n+"__bubble";u.has(d)||(oy(a,n,2,!1),u.add(d))}function hh(n,a,u){var d=0;a&&(d|=4),oy(u,n,d,a)}var tu="_reactListening"+Math.random().toString(36).slice(2);function dh(n){if(!n[tu]){n[tu]=!0,em.forEach(function(u){u!=="selectionchange"&&(J_.has(u)||hh(u,!1,n),hh(u,!0,n))});var a=n.nodeType===9?n:n.ownerDocument;a===null||a[tu]||(a[tu]=!0,hh("selectionchange",!1,a))}}function oy(n,a,u,d){switch(wy(a)){case 2:var p=RA;break;case 8:p=LA;break;default:p=Lh}u=p.bind(null,a,u,n),p=void 0,!Mc||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(p=!0),d?p!==void 0?n.addEventListener(a,u,{capture:!0,passive:p}):n.addEventListener(a,u,!0):p!==void 0?n.addEventListener(a,u,{passive:p}):n.addEventListener(a,u,!1)}function gh(n,a,u,d,p){var E=d;if((a&1)===0&&(a&2)===0&&d!==null)t:for(;;){if(d===null)return;var b=d.tag;if(b===3||b===4){var D=d.stateNode.containerInfo;if(D===p)break;if(b===4)for(b=d.return;b!==null;){var P=b.tag;if((P===3||P===4)&&b.stateNode.containerInfo===p)return;b=b.return}for(;D!==null;){if(b=gr(D),b===null)return;if(P=b.tag,P===5||P===6||P===26||P===27){d=E=b;continue t}D=D.parentNode}}d=d.return}mm(function(){var Y=E,tt=wc(u),nt=[];t:{var X=Vm.get(n);if(X!==void 0){var Q=go,Tt=n;switch(n){case"keypress":if(fo(u)===0)break t;case"keydown":case"keyup":Q=jx;break;case"focusin":Tt="focus",Q=Bc;break;case"focusout":Tt="blur",Q=Bc;break;case"beforeblur":case"afterblur":Q=Bc;break;case"click":if(u.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Q=vm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Q=Px;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Q=Qx;break;case Fm:case $m:case Gm:Q=Bx;break;case Hm:Q=Zx;break;case"scroll":case"scrollend":Q=kx;break;case"wheel":Q=t_;break;case"copy":case"cut":case"paste":Q=$x;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Q=Tm;break;case"toggle":case"beforetoggle":Q=i_}var vt=(a&4)!==0,Ht=!vt&&(n==="scroll"||n==="scrollend"),G=vt?X!==null?X+"Capture":null:X;vt=[];for(var F=Y,V;F!==null;){var it=F;if(V=it.stateNode,it=it.tag,it!==5&&it!==26&&it!==27||V===null||G===null||(it=Ia(F,G),it!=null&&vt.push(fl(F,it,V))),Ht)break;F=F.return}0<vt.length&&(X=new Q(X,Tt,null,u,tt),nt.push({event:X,listeners:vt}))}}if((a&7)===0){t:{if(X=n==="mouseover"||n==="pointerover",Q=n==="mouseout"||n==="pointerout",X&&u!==Oc&&(Tt=u.relatedTarget||u.fromElement)&&(gr(Tt)||Tt[dr]))break t;if((Q||X)&&(X=tt.window===tt?tt:(X=tt.ownerDocument)?X.defaultView||X.parentWindow:window,Q?(Tt=u.relatedTarget||u.toElement,Q=Y,Tt=Tt?gr(Tt):null,Tt!==null&&(Ht=r(Tt),vt=Tt.tag,Tt!==Ht||vt!==5&&vt!==27&&vt!==6)&&(Tt=null)):(Q=null,Tt=Y),Q!==Tt)){if(vt=vm,it="onMouseLeave",G="onMouseEnter",F="mouse",(n==="pointerout"||n==="pointerover")&&(vt=Tm,it="onPointerLeave",G="onPointerEnter",F="pointer"),Ht=Q==null?X:Da(Q),V=Tt==null?X:Da(Tt),X=new vt(it,F+"leave",Q,u,tt),X.target=Ht,X.relatedTarget=V,it=null,gr(tt)===Y&&(vt=new vt(G,F+"enter",Tt,u,tt),vt.target=V,vt.relatedTarget=Ht,it=vt),Ht=it,Q&&Tt)e:{for(vt=Q,G=Tt,F=0,V=vt;V;V=qr(V))F++;for(V=0,it=G;it;it=qr(it))V++;for(;0<F-V;)vt=qr(vt),F--;for(;0<V-F;)G=qr(G),V--;for(;F--;){if(vt===G||G!==null&&vt===G.alternate)break e;vt=qr(vt),G=qr(G)}vt=null}else vt=null;Q!==null&&uy(nt,X,Q,vt,!1),Tt!==null&&Ht!==null&&uy(nt,Ht,Tt,vt,!0)}}t:{if(X=Y?Da(Y):window,Q=X.nodeName&&X.nodeName.toLowerCase(),Q==="select"||Q==="input"&&X.type==="file")var gt=Dm;else if(Rm(X))if(Im)gt=h_;else{gt=c_;var Lt=u_}else Q=X.nodeName,!Q||Q.toLowerCase()!=="input"||X.type!=="checkbox"&&X.type!=="radio"?Y&&Cc(Y.elementType)&&(gt=Dm):gt=f_;if(gt&&(gt=gt(n,Y))){Lm(nt,gt,u,tt);break t}Lt&&Lt(n,X,Y),n==="focusout"&&Y&&X.type==="number"&&Y.memoizedProps.value!=null&&Ic(X,"number",X.value)}switch(Lt=Y?Da(Y):window,n){case"focusin":(Rm(Lt)||Lt.contentEditable==="true")&&(Ar=Lt,Kc=Y,Ua=null);break;case"focusout":Ua=Kc=Ar=null;break;case"mousedown":zc=!0;break;case"contextmenu":case"mouseup":case"dragend":zc=!1,Um(nt,u,tt);break;case"selectionchange":if(g_)break;case"keydown":case"keyup":Um(nt,u,tt)}var yt;if($c)t:{switch(n){case"compositionstart":var Et="onCompositionStart";break t;case"compositionend":Et="onCompositionEnd";break t;case"compositionupdate":Et="onCompositionUpdate";break t}Et=void 0}else _r?Am(n,u)&&(Et="onCompositionEnd"):n==="keydown"&&u.keyCode===229&&(Et="onCompositionStart");Et&&(Sm&&u.locale!=="ko"&&(_r||Et!=="onCompositionStart"?Et==="onCompositionEnd"&&_r&&(yt=pm()):(Ks=tt,Pc="value"in Ks?Ks.value:Ks.textContent,_r=!0)),Lt=eu(Y,Et),0<Lt.length&&(Et=new Em(Et,n,null,u,tt),nt.push({event:Et,listeners:Lt}),yt?Et.data=yt:(yt=bm(u),yt!==null&&(Et.data=yt)))),(yt=n_?r_(n,u):a_(n,u))&&(Et=eu(Y,"onBeforeInput"),0<Et.length&&(Lt=new Em("onBeforeInput","beforeinput",null,u,tt),nt.push({event:Lt,listeners:Et}),Lt.data=yt)),Q_(nt,n,Y,u,tt)}ly(nt,a)})}function fl(n,a,u){return{instance:n,listener:a,currentTarget:u}}function eu(n,a){for(var u=a+"Capture",d=[];n!==null;){var p=n,E=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||E===null||(p=Ia(n,u),p!=null&&d.unshift(fl(n,p,E)),p=Ia(n,a),p!=null&&d.push(fl(n,p,E))),n.tag===3)return d;n=n.return}return[]}function qr(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function uy(n,a,u,d,p){for(var E=a._reactName,b=[];u!==null&&u!==d;){var D=u,P=D.alternate,Y=D.stateNode;if(D=D.tag,P!==null&&P===d)break;D!==5&&D!==26&&D!==27||Y===null||(P=Y,p?(Y=Ia(u,E),Y!=null&&b.unshift(fl(u,Y,P))):p||(Y=Ia(u,E),Y!=null&&b.push(fl(u,Y,P)))),u=u.return}b.length!==0&&n.push({event:a,listeners:b})}var tA=/\r\n?/g,eA=/\u0000|\uFFFD/g;function cy(n){return(typeof n=="string"?n:""+n).replace(tA,`
`).replace(eA,"")}function fy(n,a){return a=cy(a),cy(n)===a}function iu(){}function Gt(n,a,u,d,p,E){switch(u){case"children":typeof d=="string"?a==="body"||a==="textarea"&&d===""||Tr(n,d):(typeof d=="number"||typeof d=="bigint")&&a!=="body"&&Tr(n,""+d);break;case"className":ao(n,"class",d);break;case"tabIndex":ao(n,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":ao(n,u,d);break;case"style":dm(n,d,E);break;case"data":if(a!=="object"){ao(n,"data",d);break}case"src":case"href":if(d===""&&(a!=="a"||u!=="href")){n.removeAttribute(u);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(u);break}d=uo(""+d),n.setAttribute(u,d);break;case"action":case"formAction":if(typeof d=="function"){n.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof E=="function"&&(u==="formAction"?(a!=="input"&&Gt(n,a,"name",p.name,p,null),Gt(n,a,"formEncType",p.formEncType,p,null),Gt(n,a,"formMethod",p.formMethod,p,null),Gt(n,a,"formTarget",p.formTarget,p,null)):(Gt(n,a,"encType",p.encType,p,null),Gt(n,a,"method",p.method,p,null),Gt(n,a,"target",p.target,p,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(u);break}d=uo(""+d),n.setAttribute(u,d);break;case"onClick":d!=null&&(n.onclick=iu);break;case"onScroll":d!=null&&Ct("scroll",n);break;case"onScrollEnd":d!=null&&Ct("scrollend",n);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(u=d.__html,u!=null){if(p.children!=null)throw Error(i(60));n.innerHTML=u}}break;case"multiple":n.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":n.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){n.removeAttribute("xlink:href");break}u=uo(""+d),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(u,""+d):n.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(u,""):n.removeAttribute(u);break;case"capture":case"download":d===!0?n.setAttribute(u,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(u,d):n.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?n.setAttribute(u,d):n.removeAttribute(u);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?n.removeAttribute(u):n.setAttribute(u,d);break;case"popover":Ct("beforetoggle",n),Ct("toggle",n),ro(n,"popover",d);break;case"xlinkActuate":gs(n,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":gs(n,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":gs(n,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":gs(n,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":gs(n,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":gs(n,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":gs(n,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":gs(n,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":gs(n,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":ro(n,"is",d);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=Ox.get(u)||u,ro(n,u,d))}}function mh(n,a,u,d,p,E){switch(u){case"style":dm(n,d,E);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(u=d.__html,u!=null){if(p.children!=null)throw Error(i(60));n.innerHTML=u}}break;case"children":typeof d=="string"?Tr(n,d):(typeof d=="number"||typeof d=="bigint")&&Tr(n,""+d);break;case"onScroll":d!=null&&Ct("scroll",n);break;case"onScrollEnd":d!=null&&Ct("scrollend",n);break;case"onClick":d!=null&&(n.onclick=iu);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!im.hasOwnProperty(u))t:{if(u[0]==="o"&&u[1]==="n"&&(p=u.endsWith("Capture"),a=u.slice(2,p?u.length-7:void 0),E=n[Ye]||null,E=E!=null?E[u]:null,typeof E=="function"&&n.removeEventListener(a,E,p),typeof d=="function")){typeof E!="function"&&E!==null&&(u in n?n[u]=null:n.hasAttribute(u)&&n.removeAttribute(u)),n.addEventListener(a,d,p);break t}u in n?n[u]=d:d===!0?n.setAttribute(u,""):ro(n,u,d)}}}function Oe(n,a,u){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ct("error",n),Ct("load",n);var d=!1,p=!1,E;for(E in u)if(u.hasOwnProperty(E)){var b=u[E];if(b!=null)switch(E){case"src":d=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:Gt(n,a,E,b,u,null)}}p&&Gt(n,a,"srcSet",u.srcSet,u,null),d&&Gt(n,a,"src",u.src,u,null);return;case"input":Ct("invalid",n);var D=E=b=p=null,P=null,Y=null;for(d in u)if(u.hasOwnProperty(d)){var tt=u[d];if(tt!=null)switch(d){case"name":p=tt;break;case"type":b=tt;break;case"checked":P=tt;break;case"defaultChecked":Y=tt;break;case"value":E=tt;break;case"defaultValue":D=tt;break;case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(i(137,a));break;default:Gt(n,a,d,tt,u,null)}}um(n,E,D,P,Y,b,p,!1),lo(n);return;case"select":Ct("invalid",n),d=b=E=null;for(p in u)if(u.hasOwnProperty(p)&&(D=u[p],D!=null))switch(p){case"value":E=D;break;case"defaultValue":b=D;break;case"multiple":d=D;default:Gt(n,a,p,D,u,null)}a=E,u=b,n.multiple=!!d,a!=null?Er(n,!!d,a,!1):u!=null&&Er(n,!!d,u,!0);return;case"textarea":Ct("invalid",n),E=p=d=null;for(b in u)if(u.hasOwnProperty(b)&&(D=u[b],D!=null))switch(b){case"value":d=D;break;case"defaultValue":p=D;break;case"children":E=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(i(91));break;default:Gt(n,a,b,D,u,null)}fm(n,d,p,E),lo(n);return;case"option":for(P in u)if(u.hasOwnProperty(P)&&(d=u[P],d!=null))switch(P){case"selected":n.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:Gt(n,a,P,d,u,null)}return;case"dialog":Ct("beforetoggle",n),Ct("toggle",n),Ct("cancel",n),Ct("close",n);break;case"iframe":case"object":Ct("load",n);break;case"video":case"audio":for(d=0;d<cl.length;d++)Ct(cl[d],n);break;case"image":Ct("error",n),Ct("load",n);break;case"details":Ct("toggle",n);break;case"embed":case"source":case"link":Ct("error",n),Ct("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Y in u)if(u.hasOwnProperty(Y)&&(d=u[Y],d!=null))switch(Y){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:Gt(n,a,Y,d,u,null)}return;default:if(Cc(a)){for(tt in u)u.hasOwnProperty(tt)&&(d=u[tt],d!==void 0&&mh(n,a,tt,d,u,void 0));return}}for(D in u)u.hasOwnProperty(D)&&(d=u[D],d!=null&&Gt(n,a,D,d,u,null))}function iA(n,a,u,d){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,E=null,b=null,D=null,P=null,Y=null,tt=null;for(Q in u){var nt=u[Q];if(u.hasOwnProperty(Q)&&nt!=null)switch(Q){case"checked":break;case"value":break;case"defaultValue":P=nt;default:d.hasOwnProperty(Q)||Gt(n,a,Q,null,d,nt)}}for(var X in d){var Q=d[X];if(nt=u[X],d.hasOwnProperty(X)&&(Q!=null||nt!=null))switch(X){case"type":E=Q;break;case"name":p=Q;break;case"checked":Y=Q;break;case"defaultChecked":tt=Q;break;case"value":b=Q;break;case"defaultValue":D=Q;break;case"children":case"dangerouslySetInnerHTML":if(Q!=null)throw Error(i(137,a));break;default:Q!==nt&&Gt(n,a,X,Q,d,nt)}}Dc(n,b,D,P,Y,tt,E,p);return;case"select":Q=b=D=X=null;for(E in u)if(P=u[E],u.hasOwnProperty(E)&&P!=null)switch(E){case"value":break;case"multiple":Q=P;default:d.hasOwnProperty(E)||Gt(n,a,E,null,d,P)}for(p in d)if(E=d[p],P=u[p],d.hasOwnProperty(p)&&(E!=null||P!=null))switch(p){case"value":X=E;break;case"defaultValue":D=E;break;case"multiple":b=E;default:E!==P&&Gt(n,a,p,E,d,P)}a=D,u=b,d=Q,X!=null?Er(n,!!u,X,!1):!!d!=!!u&&(a!=null?Er(n,!!u,a,!0):Er(n,!!u,u?[]:"",!1));return;case"textarea":Q=X=null;for(D in u)if(p=u[D],u.hasOwnProperty(D)&&p!=null&&!d.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:Gt(n,a,D,null,d,p)}for(b in d)if(p=d[b],E=u[b],d.hasOwnProperty(b)&&(p!=null||E!=null))switch(b){case"value":X=p;break;case"defaultValue":Q=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(i(91));break;default:p!==E&&Gt(n,a,b,p,d,E)}cm(n,X,Q);return;case"option":for(var Tt in u)if(X=u[Tt],u.hasOwnProperty(Tt)&&X!=null&&!d.hasOwnProperty(Tt))switch(Tt){case"selected":n.selected=!1;break;default:Gt(n,a,Tt,null,d,X)}for(P in d)if(X=d[P],Q=u[P],d.hasOwnProperty(P)&&X!==Q&&(X!=null||Q!=null))switch(P){case"selected":n.selected=X&&typeof X!="function"&&typeof X!="symbol";break;default:Gt(n,a,P,X,d,Q)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var vt in u)X=u[vt],u.hasOwnProperty(vt)&&X!=null&&!d.hasOwnProperty(vt)&&Gt(n,a,vt,null,d,X);for(Y in d)if(X=d[Y],Q=u[Y],d.hasOwnProperty(Y)&&X!==Q&&(X!=null||Q!=null))switch(Y){case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(i(137,a));break;default:Gt(n,a,Y,X,d,Q)}return;default:if(Cc(a)){for(var Ht in u)X=u[Ht],u.hasOwnProperty(Ht)&&X!==void 0&&!d.hasOwnProperty(Ht)&&mh(n,a,Ht,void 0,d,X);for(tt in d)X=d[tt],Q=u[tt],!d.hasOwnProperty(tt)||X===Q||X===void 0&&Q===void 0||mh(n,a,tt,X,d,Q);return}}for(var G in u)X=u[G],u.hasOwnProperty(G)&&X!=null&&!d.hasOwnProperty(G)&&Gt(n,a,G,null,d,X);for(nt in d)X=d[nt],Q=u[nt],!d.hasOwnProperty(nt)||X===Q||X==null&&Q==null||Gt(n,a,nt,X,d,Q)}var ph=null,yh=null;function su(n){return n.nodeType===9?n:n.ownerDocument}function hy(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function dy(n,a){if(n===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&a==="foreignObject"?0:n}function vh(n,a){return n==="textarea"||n==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Eh=null;function sA(){var n=window.event;return n&&n.type==="popstate"?n===Eh?!1:(Eh=n,!0):(Eh=null,!1)}var gy=typeof setTimeout=="function"?setTimeout:void 0,nA=typeof clearTimeout=="function"?clearTimeout:void 0,my=typeof Promise=="function"?Promise:void 0,rA=typeof queueMicrotask=="function"?queueMicrotask:typeof my<"u"?function(n){return my.resolve(null).then(n).catch(aA)}:gy;function aA(n){setTimeout(function(){throw n})}function ln(n){return n==="head"}function py(n,a){var u=a,d=0,p=0;do{var E=u.nextSibling;if(n.removeChild(u),E&&E.nodeType===8)if(u=E.data,u==="/$"){if(0<d&&8>d){u=d;var b=n.ownerDocument;if(u&1&&hl(b.documentElement),u&2&&hl(b.body),u&4)for(u=b.head,hl(u),b=u.firstChild;b;){var D=b.nextSibling,P=b.nodeName;b[La]||P==="SCRIPT"||P==="STYLE"||P==="LINK"&&b.rel.toLowerCase()==="stylesheet"||u.removeChild(b),b=D}}if(p===0){n.removeChild(E),Tl(a);return}p--}else u==="$"||u==="$?"||u==="$!"?p++:d=u.charCodeAt(0)-48;else d=0;u=E}while(u);Tl(a)}function Th(n){var a=n.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var u=a;switch(a=a.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Th(u),Ac(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}n.removeChild(u)}}function lA(n,a,u,d){for(;n.nodeType===1;){var p=u;if(n.nodeName.toLowerCase()!==a.toLowerCase()){if(!d&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(d){if(!n[La])switch(a){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(E=n.getAttribute("rel"),E==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(E!==p.rel||n.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||n.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||n.getAttribute("title")!==(p.title==null?null:p.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(E=n.getAttribute("src"),(E!==(p.src==null?null:p.src)||n.getAttribute("type")!==(p.type==null?null:p.type)||n.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&E&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(a==="input"&&n.type==="hidden"){var E=p.name==null?null:""+p.name;if(p.type==="hidden"&&n.getAttribute("name")===E)return n}else return n;if(n=Hi(n.nextSibling),n===null)break}return null}function oA(n,a,u){if(a==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!u||(n=Hi(n.nextSibling),n===null))return null;return n}function Sh(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState==="complete"}function uA(n,a){var u=n.ownerDocument;if(n.data!=="$?"||u.readyState==="complete")a();else{var d=function(){a(),u.removeEventListener("DOMContentLoaded",d)};u.addEventListener("DOMContentLoaded",d),n._reactRetry=d}}function Hi(n){for(;n!=null;n=n.nextSibling){var a=n.nodeType;if(a===1||a===3)break;if(a===8){if(a=n.data,a==="$"||a==="$!"||a==="$?"||a==="F!"||a==="F")break;if(a==="/$")return null}}return n}var xh=null;function yy(n){n=n.previousSibling;for(var a=0;n;){if(n.nodeType===8){var u=n.data;if(u==="$"||u==="$!"||u==="$?"){if(a===0)return n;a--}else u==="/$"&&a++}n=n.previousSibling}return null}function vy(n,a,u){switch(a=su(u),n){case"html":if(n=a.documentElement,!n)throw Error(i(452));return n;case"head":if(n=a.head,!n)throw Error(i(453));return n;case"body":if(n=a.body,!n)throw Error(i(454));return n;default:throw Error(i(451))}}function hl(n){for(var a=n.attributes;a.length;)n.removeAttributeNode(a[0]);Ac(n)}var Ii=new Map,Ey=new Set;function nu(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var Ds=q.d;q.d={f:cA,r:fA,D:hA,C:dA,L:gA,m:mA,X:yA,S:pA,M:vA};function cA(){var n=Ds.f(),a=Xo();return n||a}function fA(n){var a=mr(n);a!==null&&a.tag===5&&a.type==="form"?F0(a):Ds.r(n)}var Xr=typeof document>"u"?null:document;function Ty(n,a,u){var d=Xr;if(d&&typeof a=="string"&&a){var p=xi(a);p='link[rel="'+n+'"][href="'+p+'"]',typeof u=="string"&&(p+='[crossorigin="'+u+'"]'),Ey.has(p)||(Ey.add(p),n={rel:n,crossOrigin:u,href:a},d.querySelector(p)===null&&(a=d.createElement("link"),Oe(a,"link",n),_e(a),d.head.appendChild(a)))}}function hA(n){Ds.D(n),Ty("dns-prefetch",n,null)}function dA(n,a){Ds.C(n,a),Ty("preconnect",n,a)}function gA(n,a,u){Ds.L(n,a,u);var d=Xr;if(d&&n&&a){var p='link[rel="preload"][as="'+xi(a)+'"]';a==="image"&&u&&u.imageSrcSet?(p+='[imagesrcset="'+xi(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(p+='[imagesizes="'+xi(u.imageSizes)+'"]')):p+='[href="'+xi(n)+'"]';var E=p;switch(a){case"style":E=Qr(n);break;case"script":E=Wr(n)}Ii.has(E)||(n=g({rel:"preload",href:a==="image"&&u&&u.imageSrcSet?void 0:n,as:a},u),Ii.set(E,n),d.querySelector(p)!==null||a==="style"&&d.querySelector(dl(E))||a==="script"&&d.querySelector(gl(E))||(a=d.createElement("link"),Oe(a,"link",n),_e(a),d.head.appendChild(a)))}}function mA(n,a){Ds.m(n,a);var u=Xr;if(u&&n){var d=a&&typeof a.as=="string"?a.as:"script",p='link[rel="modulepreload"][as="'+xi(d)+'"][href="'+xi(n)+'"]',E=p;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":E=Wr(n)}if(!Ii.has(E)&&(n=g({rel:"modulepreload",href:n},a),Ii.set(E,n),u.querySelector(p)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(gl(E)))return}d=u.createElement("link"),Oe(d,"link",n),_e(d),u.head.appendChild(d)}}}function pA(n,a,u){Ds.S(n,a,u);var d=Xr;if(d&&n){var p=pr(d).hoistableStyles,E=Qr(n);a=a||"default";var b=p.get(E);if(!b){var D={loading:0,preload:null};if(b=d.querySelector(dl(E)))D.loading=5;else{n=g({rel:"stylesheet",href:n,"data-precedence":a},u),(u=Ii.get(E))&&_h(n,u);var P=b=d.createElement("link");_e(P),Oe(P,"link",n),P._p=new Promise(function(Y,tt){P.onload=Y,P.onerror=tt}),P.addEventListener("load",function(){D.loading|=1}),P.addEventListener("error",function(){D.loading|=2}),D.loading|=4,ru(b,a,d)}b={type:"stylesheet",instance:b,count:1,state:D},p.set(E,b)}}}function yA(n,a){Ds.X(n,a);var u=Xr;if(u&&n){var d=pr(u).hoistableScripts,p=Wr(n),E=d.get(p);E||(E=u.querySelector(gl(p)),E||(n=g({src:n,async:!0},a),(a=Ii.get(p))&&Ah(n,a),E=u.createElement("script"),_e(E),Oe(E,"link",n),u.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},d.set(p,E))}}function vA(n,a){Ds.M(n,a);var u=Xr;if(u&&n){var d=pr(u).hoistableScripts,p=Wr(n),E=d.get(p);E||(E=u.querySelector(gl(p)),E||(n=g({src:n,async:!0,type:"module"},a),(a=Ii.get(p))&&Ah(n,a),E=u.createElement("script"),_e(E),Oe(E,"link",n),u.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},d.set(p,E))}}function Sy(n,a,u,d){var p=(p=ht.current)?nu(p):null;if(!p)throw Error(i(446));switch(n){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(a=Qr(u.href),u=pr(p).hoistableStyles,d=u.get(a),d||(d={type:"style",instance:null,count:0,state:null},u.set(a,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){n=Qr(u.href);var E=pr(p).hoistableStyles,b=E.get(n);if(b||(p=p.ownerDocument||p,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},E.set(n,b),(E=p.querySelector(dl(n)))&&!E._p&&(b.instance=E,b.state.loading=5),Ii.has(n)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Ii.set(n,u),E||EA(p,n,u,b.state))),a&&d===null)throw Error(i(528,""));return b}if(a&&d!==null)throw Error(i(529,""));return null;case"script":return a=u.async,u=u.src,typeof u=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Wr(u),u=pr(p).hoistableScripts,d=u.get(a),d||(d={type:"script",instance:null,count:0,state:null},u.set(a,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,n))}}function Qr(n){return'href="'+xi(n)+'"'}function dl(n){return'link[rel="stylesheet"]['+n+"]"}function xy(n){return g({},n,{"data-precedence":n.precedence,precedence:null})}function EA(n,a,u,d){n.querySelector('link[rel="preload"][as="style"]['+a+"]")?d.loading=1:(a=n.createElement("link"),d.preload=a,a.addEventListener("load",function(){return d.loading|=1}),a.addEventListener("error",function(){return d.loading|=2}),Oe(a,"link",u),_e(a),n.head.appendChild(a))}function Wr(n){return'[src="'+xi(n)+'"]'}function gl(n){return"script[async]"+n}function _y(n,a,u){if(a.count++,a.instance===null)switch(a.type){case"style":var d=n.querySelector('style[data-href~="'+xi(u.href)+'"]');if(d)return a.instance=d,_e(d),d;var p=g({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return d=(n.ownerDocument||n).createElement("style"),_e(d),Oe(d,"style",p),ru(d,u.precedence,n),a.instance=d;case"stylesheet":p=Qr(u.href);var E=n.querySelector(dl(p));if(E)return a.state.loading|=4,a.instance=E,_e(E),E;d=xy(u),(p=Ii.get(p))&&_h(d,p),E=(n.ownerDocument||n).createElement("link"),_e(E);var b=E;return b._p=new Promise(function(D,P){b.onload=D,b.onerror=P}),Oe(E,"link",d),a.state.loading|=4,ru(E,u.precedence,n),a.instance=E;case"script":return E=Wr(u.src),(p=n.querySelector(gl(E)))?(a.instance=p,_e(p),p):(d=u,(p=Ii.get(E))&&(d=g({},u),Ah(d,p)),n=n.ownerDocument||n,p=n.createElement("script"),_e(p),Oe(p,"link",d),n.head.appendChild(p),a.instance=p);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(d=a.instance,a.state.loading|=4,ru(d,u.precedence,n));return a.instance}function ru(n,a,u){for(var d=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=d.length?d[d.length-1]:null,E=p,b=0;b<d.length;b++){var D=d[b];if(D.dataset.precedence===a)E=D;else if(E!==p)break}E?E.parentNode.insertBefore(n,E.nextSibling):(a=u.nodeType===9?u.head:u,a.insertBefore(n,a.firstChild))}function _h(n,a){n.crossOrigin==null&&(n.crossOrigin=a.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=a.referrerPolicy),n.title==null&&(n.title=a.title)}function Ah(n,a){n.crossOrigin==null&&(n.crossOrigin=a.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=a.referrerPolicy),n.integrity==null&&(n.integrity=a.integrity)}var au=null;function Ay(n,a,u){if(au===null){var d=new Map,p=au=new Map;p.set(u,d)}else p=au,d=p.get(u),d||(d=new Map,p.set(u,d));if(d.has(n))return d;for(d.set(n,null),u=u.getElementsByTagName(n),p=0;p<u.length;p++){var E=u[p];if(!(E[La]||E[Pe]||n==="link"&&E.getAttribute("rel")==="stylesheet")&&E.namespaceURI!=="http://www.w3.org/2000/svg"){var b=E.getAttribute(a)||"";b=n+b;var D=d.get(b);D?D.push(E):d.set(b,[E])}}return d}function by(n,a,u){n=n.ownerDocument||n,n.head.insertBefore(u,a==="title"?n.querySelector("head > title"):null)}function TA(n,a,u){if(u===1||a.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return n=a.disabled,typeof a.precedence=="string"&&n==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function Ry(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}var ml=null;function SA(){}function xA(n,a,u){if(ml===null)throw Error(i(475));var d=ml;if(a.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var p=Qr(u.href),E=n.querySelector(dl(p));if(E){n=E._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(d.count++,d=lu.bind(d),n.then(d,d)),a.state.loading|=4,a.instance=E,_e(E);return}E=n.ownerDocument||n,u=xy(u),(p=Ii.get(p))&&_h(u,p),E=E.createElement("link"),_e(E);var b=E;b._p=new Promise(function(D,P){b.onload=D,b.onerror=P}),Oe(E,"link",u),a.instance=E}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(a,n),(n=a.state.preload)&&(a.state.loading&3)===0&&(d.count++,a=lu.bind(d),n.addEventListener("load",a),n.addEventListener("error",a))}}function _A(){if(ml===null)throw Error(i(475));var n=ml;return n.stylesheets&&n.count===0&&bh(n,n.stylesheets),0<n.count?function(a){var u=setTimeout(function(){if(n.stylesheets&&bh(n,n.stylesheets),n.unsuspend){var d=n.unsuspend;n.unsuspend=null,d()}},6e4);return n.unsuspend=a,function(){n.unsuspend=null,clearTimeout(u)}}:null}function lu(){if(this.count--,this.count===0){if(this.stylesheets)bh(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var ou=null;function bh(n,a){n.stylesheets=null,n.unsuspend!==null&&(n.count++,ou=new Map,a.forEach(AA,n),ou=null,lu.call(n))}function AA(n,a){if(!(a.state.loading&4)){var u=ou.get(n);if(u)var d=u.get(null);else{u=new Map,ou.set(n,u);for(var p=n.querySelectorAll("link[data-precedence],style[data-precedence]"),E=0;E<p.length;E++){var b=p[E];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(u.set(b.dataset.precedence,b),d=b)}d&&u.set(null,d)}p=a.instance,b=p.getAttribute("data-precedence"),E=u.get(b)||d,E===d&&u.set(null,p),u.set(b,p),this.count++,d=lu.bind(this),p.addEventListener("load",d),p.addEventListener("error",d),E?E.parentNode.insertBefore(p,E.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(p,n.firstChild)),a.state.loading|=4}}var pl={$$typeof:R,Provider:null,Consumer:null,_currentValue:W,_currentValue2:W,_threadCount:0};function bA(n,a,u,d,p,E,b,D){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Tc(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Tc(0),this.hiddenUpdates=Tc(null),this.identifierPrefix=d,this.onUncaughtError=p,this.onCaughtError=E,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=D,this.incompleteTransitions=new Map}function Ly(n,a,u,d,p,E,b,D,P,Y,tt,nt){return n=new bA(n,a,u,b,D,P,Y,nt),a=1,E===!0&&(a|=24),E=ri(3,null,null,a),n.current=E,E.stateNode=n,a=af(),a.refCount++,n.pooledCache=a,a.refCount++,E.memoizedState={element:d,isDehydrated:u,cache:a},cf(E),n}function Dy(n){return n?(n=Dr,n):Dr}function Iy(n,a,u,d,p,E){p=Dy(p),d.context===null?d.context=p:d.pendingContext=p,d=js(a),d.payload={element:u},E=E===void 0?null:E,E!==null&&(d.callback=E),u=qs(n,d,a),u!==null&&(ci(u,n,a),Ya(u,n,a))}function Cy(n,a){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var u=n.retryLane;n.retryLane=u!==0&&u<a?u:a}}function Rh(n,a){Cy(n,a),(n=n.alternate)&&Cy(n,a)}function Oy(n){if(n.tag===13){var a=Lr(n,67108864);a!==null&&ci(a,n,67108864),Rh(n,67108864)}}var uu=!0;function RA(n,a,u,d){var p=B.T;B.T=null;var E=q.p;try{q.p=2,Lh(n,a,u,d)}finally{q.p=E,B.T=p}}function LA(n,a,u,d){var p=B.T;B.T=null;var E=q.p;try{q.p=8,Lh(n,a,u,d)}finally{q.p=E,B.T=p}}function Lh(n,a,u,d){if(uu){var p=Dh(d);if(p===null)gh(n,a,d,cu,u),ky(n,d);else if(IA(p,n,a,u,d))d.stopPropagation();else if(ky(n,d),a&4&&-1<DA.indexOf(n)){for(;p!==null;){var E=mr(p);if(E!==null)switch(E.tag){case 3:if(E=E.stateNode,E.current.memoizedState.isDehydrated){var b=On(E.pendingLanes);if(b!==0){var D=E;for(D.pendingLanes|=2,D.entangledLanes|=2;b;){var P=1<<31-Me(b);D.entanglements[1]|=P,b&=~P}Zi(E),(Ut&6)===0&&(jo=zt()+500,ul(0))}}break;case 13:D=Lr(E,2),D!==null&&ci(D,E,2),Xo(),Rh(E,2)}if(E=Dh(d),E===null&&gh(n,a,d,cu,u),E===p)break;p=E}p!==null&&d.stopPropagation()}else gh(n,a,d,null,u)}}function Dh(n){return n=wc(n),Ih(n)}var cu=null;function Ih(n){if(cu=null,n=gr(n),n!==null){var a=r(n);if(a===null)n=null;else{var u=a.tag;if(u===13){if(n=o(a),n!==null)return n;n=null}else if(u===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;n=null}else a!==n&&(n=null)}}return cu=n,null}function wy(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ke()){case Yi:return 2;case ze:return 8;case Bi:case ds:return 32;case Aa:return 268435456;default:return 32}default:return 32}}var Ch=!1,on=null,un=null,cn=null,yl=new Map,vl=new Map,fn=[],DA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ky(n,a){switch(n){case"focusin":case"focusout":on=null;break;case"dragenter":case"dragleave":un=null;break;case"mouseover":case"mouseout":cn=null;break;case"pointerover":case"pointerout":yl.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":vl.delete(a.pointerId)}}function El(n,a,u,d,p,E){return n===null||n.nativeEvent!==E?(n={blockedOn:a,domEventName:u,eventSystemFlags:d,nativeEvent:E,targetContainers:[p]},a!==null&&(a=mr(a),a!==null&&Oy(a)),n):(n.eventSystemFlags|=d,a=n.targetContainers,p!==null&&a.indexOf(p)===-1&&a.push(p),n)}function IA(n,a,u,d,p){switch(a){case"focusin":return on=El(on,n,a,u,d,p),!0;case"dragenter":return un=El(un,n,a,u,d,p),!0;case"mouseover":return cn=El(cn,n,a,u,d,p),!0;case"pointerover":var E=p.pointerId;return yl.set(E,El(yl.get(E)||null,n,a,u,d,p)),!0;case"gotpointercapture":return E=p.pointerId,vl.set(E,El(vl.get(E)||null,n,a,u,d,p)),!0}return!1}function My(n){var a=gr(n.target);if(a!==null){var u=r(a);if(u!==null){if(a=u.tag,a===13){if(a=o(u),a!==null){n.blockedOn=a,xx(n.priority,function(){if(u.tag===13){var d=ui();d=Sc(d);var p=Lr(u,d);p!==null&&ci(p,u,d),Rh(u,d)}});return}}else if(a===3&&u.stateNode.current.memoizedState.isDehydrated){n.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}n.blockedOn=null}function fu(n){if(n.blockedOn!==null)return!1;for(var a=n.targetContainers;0<a.length;){var u=Dh(n.nativeEvent);if(u===null){u=n.nativeEvent;var d=new u.constructor(u.type,u);Oc=d,u.target.dispatchEvent(d),Oc=null}else return a=mr(u),a!==null&&Oy(a),n.blockedOn=u,!1;a.shift()}return!0}function Py(n,a,u){fu(n)&&u.delete(a)}function CA(){Ch=!1,on!==null&&fu(on)&&(on=null),un!==null&&fu(un)&&(un=null),cn!==null&&fu(cn)&&(cn=null),yl.forEach(Py),vl.forEach(Py)}function hu(n,a){n.blockedOn===a&&(n.blockedOn=null,Ch||(Ch=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,CA)))}var du=null;function Ny(n){du!==n&&(du=n,l.unstable_scheduleCallback(l.unstable_NormalPriority,function(){du===n&&(du=null);for(var a=0;a<n.length;a+=3){var u=n[a],d=n[a+1],p=n[a+2];if(typeof d!="function"){if(Ih(d||u)===null)continue;break}var E=mr(u);E!==null&&(n.splice(a,3),a-=3,If(E,{pending:!0,data:p,method:u.method,action:d},d,p))}}))}function Tl(n){function a(P){return hu(P,n)}on!==null&&hu(on,n),un!==null&&hu(un,n),cn!==null&&hu(cn,n),yl.forEach(a),vl.forEach(a);for(var u=0;u<fn.length;u++){var d=fn[u];d.blockedOn===n&&(d.blockedOn=null)}for(;0<fn.length&&(u=fn[0],u.blockedOn===null);)My(u),u.blockedOn===null&&fn.shift();if(u=(n.ownerDocument||n).$$reactFormReplay,u!=null)for(d=0;d<u.length;d+=3){var p=u[d],E=u[d+1],b=p[Ye]||null;if(typeof E=="function")b||Ny(u);else if(b){var D=null;if(E&&E.hasAttribute("formAction")){if(p=E,b=E[Ye]||null)D=b.formAction;else if(Ih(p)!==null)continue}else D=b.action;typeof D=="function"?u[d+1]=D:(u.splice(d,3),d-=3),Ny(u)}}}function Oh(n){this._internalRoot=n}gu.prototype.render=Oh.prototype.render=function(n){var a=this._internalRoot;if(a===null)throw Error(i(409));var u=a.current,d=ui();Iy(u,d,n,a,null,null)},gu.prototype.unmount=Oh.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var a=n.containerInfo;Iy(n.current,2,null,n,null,null),Xo(),a[dr]=null}};function gu(n){this._internalRoot=n}gu.prototype.unstable_scheduleHydration=function(n){if(n){var a=Jg();n={blockedOn:null,target:n,priority:a};for(var u=0;u<fn.length&&a!==0&&a<fn[u].priority;u++);fn.splice(u,0,n),u===0&&My(n)}};var Uy=t.version;if(Uy!=="19.1.1")throw Error(i(527,Uy,"19.1.1"));q.findDOMNode=function(n){var a=n._reactInternals;if(a===void 0)throw typeof n.render=="function"?Error(i(188)):(n=Object.keys(n).join(","),Error(i(268,n)));return n=h(a),n=n!==null?f(n):null,n=n===null?null:n.stateNode,n};var OA={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:B,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var mu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!mu.isDisabled&&mu.supportsFiber)try{Fi=mu.inject(OA),ke=mu}catch{}}return xl.createRoot=function(n,a){if(!s(n))throw Error(i(299));var u=!1,d="",p=J0,E=tp,b=ep,D=null;return a!=null&&(a.unstable_strictMode===!0&&(u=!0),a.identifierPrefix!==void 0&&(d=a.identifierPrefix),a.onUncaughtError!==void 0&&(p=a.onUncaughtError),a.onCaughtError!==void 0&&(E=a.onCaughtError),a.onRecoverableError!==void 0&&(b=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(D=a.unstable_transitionCallbacks)),a=Ly(n,1,!1,null,null,u,d,p,E,b,D,null),n[dr]=a.current,dh(n),new Oh(a)},xl.hydrateRoot=function(n,a,u){if(!s(n))throw Error(i(299));var d=!1,p="",E=J0,b=tp,D=ep,P=null,Y=null;return u!=null&&(u.unstable_strictMode===!0&&(d=!0),u.identifierPrefix!==void 0&&(p=u.identifierPrefix),u.onUncaughtError!==void 0&&(E=u.onUncaughtError),u.onCaughtError!==void 0&&(b=u.onCaughtError),u.onRecoverableError!==void 0&&(D=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(P=u.unstable_transitionCallbacks),u.formState!==void 0&&(Y=u.formState)),a=Ly(n,1,!0,a,u??null,d,p,E,b,D,P,Y),a.context=Dy(null),u=a.current,d=ui(),d=Sc(d),p=js(d),p.callback=null,qs(u,p,d),u=d,a.current.lanes=u,Ra(a,u),Zi(a),n[dr]=a.current,dh(n),new gu(a)},xl.version="19.1.1",xl}var jy;function GA(){if(jy)return Mh.exports;jy=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(t){console.error(t)}}return l(),Mh.exports=$A(),Mh.exports}var HA=GA();/**
 * react-router v7.8.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var qy="popstate";function VA(l={}){function t(i,s){let{pathname:r,search:o,hash:c}=i.location;return vd("",{pathname:r,search:o,hash:c},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function e(i,s){return typeof s=="string"?s:Pl(s)}return zA(t,e,null,l)}function ne(l,t){if(l===!1||l===null||typeof l>"u")throw new Error(t)}function os(l,t){if(!l){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function KA(){return Math.random().toString(36).substring(2,10)}function Xy(l,t){return{usr:l.state,key:l.key,idx:t}}function vd(l,t,e=null,i){return{pathname:typeof l=="string"?l:l.pathname,search:"",hash:"",...typeof t=="string"?Sa(t):t,state:e,key:t&&t.key||i||KA()}}function Pl({pathname:l="/",search:t="",hash:e=""}){return t&&t!=="?"&&(l+=t.charAt(0)==="?"?t:"?"+t),e&&e!=="#"&&(l+=e.charAt(0)==="#"?e:"#"+e),l}function Sa(l){let t={};if(l){let e=l.indexOf("#");e>=0&&(t.hash=l.substring(e),l=l.substring(0,e));let i=l.indexOf("?");i>=0&&(t.search=l.substring(i),l=l.substring(0,i)),l&&(t.pathname=l)}return t}function zA(l,t,e,i={}){let{window:s=document.defaultView,v5Compat:r=!1}=i,o=s.history,c="POP",h=null,f=g();f==null&&(f=0,o.replaceState({...o.state,idx:f},""));function g(){return(o.state||{idx:null}).idx}function m(){c="POP";let x=g(),_=x==null?null:x-f;f=x,h&&h({action:c,location:S.location,delta:_})}function y(x,_){c="PUSH";let L=vd(S.location,x,_);f=g()+1;let R=Xy(L,f),C=S.createHref(L);try{o.pushState(R,"",C)}catch(I){if(I instanceof DOMException&&I.name==="DataCloneError")throw I;s.location.assign(C)}r&&h&&h({action:c,location:S.location,delta:1})}function v(x,_){c="REPLACE";let L=vd(S.location,x,_);f=g();let R=Xy(L,f),C=S.createHref(L);o.replaceState(R,"",C),r&&h&&h({action:c,location:S.location,delta:0})}function T(x){return YA(x)}let S={get action(){return c},get location(){return l(s,o)},listen(x){if(h)throw new Error("A history only accepts one active listener");return s.addEventListener(qy,m),h=x,()=>{s.removeEventListener(qy,m),h=null}},createHref(x){return t(s,x)},createURL:T,encodeLocation(x){let _=T(x);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:y,replace:v,go(x){return o.go(x)}};return S}function YA(l,t=!1){let e="http://localhost";typeof window<"u"&&(e=window.location.origin!=="null"?window.location.origin:window.location.href),ne(e,"No window.location.(origin|href) available to create URL");let i=typeof l=="string"?l:Pl(l);return i=i.replace(/ $/,"%20"),!t&&i.startsWith("//")&&(i=e+i),new URL(i,e)}function IE(l,t,e="/"){return jA(l,t,e,!1)}function jA(l,t,e,i){let s=typeof t=="string"?Sa(t):t,r=Fs(s.pathname||"/",e);if(r==null)return null;let o=CE(l);qA(o);let c=null;for(let h=0;c==null&&h<o.length;++h){let f=rb(r);c=sb(o[h],f,i)}return c}function CE(l,t=[],e=[],i=""){let s=(r,o,c)=>{let h={relativePath:c===void 0?r.path||"":c,caseSensitive:r.caseSensitive===!0,childrenIndex:o,route:r};h.relativePath.startsWith("/")&&(ne(h.relativePath.startsWith(i),`Absolute route path "${h.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),h.relativePath=h.relativePath.slice(i.length));let f=Bs([i,h.relativePath]),g=e.concat(h);r.children&&r.children.length>0&&(ne(r.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),CE(r.children,t,g,f)),!(r.path==null&&!r.index)&&t.push({path:f,score:eb(f,r.index),routesMeta:g})};return l.forEach((r,o)=>{if(r.path===""||!r.path?.includes("?"))s(r,o);else for(let c of OE(r.path))s(r,o,c)}),t}function OE(l){let t=l.split("/");if(t.length===0)return[];let[e,...i]=t,s=e.endsWith("?"),r=e.replace(/\?$/,"");if(i.length===0)return s?[r,""]:[r];let o=OE(i.join("/")),c=[];return c.push(...o.map(h=>h===""?r:[r,h].join("/"))),s&&c.push(...o),c.map(h=>l.startsWith("/")&&h===""?"/":h)}function qA(l){l.sort((t,e)=>t.score!==e.score?e.score-t.score:ib(t.routesMeta.map(i=>i.childrenIndex),e.routesMeta.map(i=>i.childrenIndex)))}var XA=/^:[\w-]+$/,QA=3,WA=2,ZA=1,JA=10,tb=-2,Qy=l=>l==="*";function eb(l,t){let e=l.split("/"),i=e.length;return e.some(Qy)&&(i+=tb),t&&(i+=WA),e.filter(s=>!Qy(s)).reduce((s,r)=>s+(XA.test(r)?QA:r===""?ZA:JA),i)}function ib(l,t){return l.length===t.length&&l.slice(0,-1).every((i,s)=>i===t[s])?l[l.length-1]-t[t.length-1]:0}function sb(l,t,e=!1){let{routesMeta:i}=l,s={},r="/",o=[];for(let c=0;c<i.length;++c){let h=i[c],f=c===i.length-1,g=r==="/"?t:t.slice(r.length)||"/",m=ju({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},g),y=h.route;if(!m&&f&&e&&!i[i.length-1].route.index&&(m=ju({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},g)),!m)return null;Object.assign(s,m.params),o.push({params:s,pathname:Bs([r,m.pathname]),pathnameBase:ub(Bs([r,m.pathnameBase])),route:y}),m.pathnameBase!=="/"&&(r=Bs([r,m.pathnameBase]))}return o}function ju(l,t){typeof l=="string"&&(l={path:l,caseSensitive:!1,end:!0});let[e,i]=nb(l.path,l.caseSensitive,l.end),s=t.match(e);if(!s)return null;let r=s[0],o=r.replace(/(.)\/+$/,"$1"),c=s.slice(1);return{params:i.reduce((f,{paramName:g,isOptional:m},y)=>{if(g==="*"){let T=c[y]||"";o=r.slice(0,r.length-T.length).replace(/(.)\/+$/,"$1")}const v=c[y];return m&&!v?f[g]=void 0:f[g]=(v||"").replace(/%2F/g,"/"),f},{}),pathname:r,pathnameBase:o,pattern:l}}function nb(l,t=!1,e=!0){os(l==="*"||!l.endsWith("*")||l.endsWith("/*"),`Route path "${l}" will be treated as if it were "${l.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${l.replace(/\*$/,"/*")}".`);let i=[],s="^"+l.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,c,h)=>(i.push({paramName:c,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)"));return l.endsWith("*")?(i.push({paramName:"*"}),s+=l==="*"||l==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):e?s+="\\/*$":l!==""&&l!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),i]}function rb(l){try{return l.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return os(!1,`The URL path "${l}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),l}}function Fs(l,t){if(t==="/")return l;if(!l.toLowerCase().startsWith(t.toLowerCase()))return null;let e=t.endsWith("/")?t.length-1:t.length,i=l.charAt(e);return i&&i!=="/"?null:l.slice(e)||"/"}function ab(l,t="/"){let{pathname:e,search:i="",hash:s=""}=typeof l=="string"?Sa(l):l;return{pathname:e?e.startsWith("/")?e:lb(e,t):t,search:cb(i),hash:fb(s)}}function lb(l,t){let e=t.replace(/\/+$/,"").split("/");return l.split("/").forEach(s=>{s===".."?e.length>1&&e.pop():s!=="."&&e.push(s)}),e.length>1?e.join("/"):"/"}function Bh(l,t,e,i){return`Cannot include a '${l}' character in a manually specified \`to.${t}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${e}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function ob(l){return l.filter((t,e)=>e===0||t.route.path&&t.route.path.length>0)}function wE(l){let t=ob(l);return t.map((e,i)=>i===t.length-1?e.pathname:e.pathnameBase)}function kE(l,t,e,i=!1){let s;typeof l=="string"?s=Sa(l):(s={...l},ne(!s.pathname||!s.pathname.includes("?"),Bh("?","pathname","search",s)),ne(!s.pathname||!s.pathname.includes("#"),Bh("#","pathname","hash",s)),ne(!s.search||!s.search.includes("#"),Bh("#","search","hash",s)));let r=l===""||s.pathname==="",o=r?"/":s.pathname,c;if(o==null)c=e;else{let m=t.length-1;if(!i&&o.startsWith("..")){let y=o.split("/");for(;y[0]==="..";)y.shift(),m-=1;s.pathname=y.join("/")}c=m>=0?t[m]:"/"}let h=ab(s,c),f=o&&o!=="/"&&o.endsWith("/"),g=(r||o===".")&&e.endsWith("/");return!h.pathname.endsWith("/")&&(f||g)&&(h.pathname+="/"),h}var Bs=l=>l.join("/").replace(/\/\/+/g,"/"),ub=l=>l.replace(/\/+$/,"").replace(/^\/*/,"/"),cb=l=>!l||l==="?"?"":l.startsWith("?")?l:"?"+l,fb=l=>!l||l==="#"?"":l.startsWith("#")?l:"#"+l;function hb(l){return l!=null&&typeof l.status=="number"&&typeof l.statusText=="string"&&typeof l.internal=="boolean"&&"data"in l}var ME=["POST","PUT","PATCH","DELETE"];new Set(ME);var db=["GET",...ME];new Set(db);var xa=Z.createContext(null);xa.displayName="DataRouter";var fc=Z.createContext(null);fc.displayName="DataRouterState";Z.createContext(!1);var PE=Z.createContext({isTransitioning:!1});PE.displayName="ViewTransition";var gb=Z.createContext(new Map);gb.displayName="Fetchers";var mb=Z.createContext(null);mb.displayName="Await";var hs=Z.createContext(null);hs.displayName="Navigation";var Ql=Z.createContext(null);Ql.displayName="Location";var Hs=Z.createContext({outlet:null,matches:[],isDataRoute:!1});Hs.displayName="Route";var eg=Z.createContext(null);eg.displayName="RouteError";function pb(l,{relative:t}={}){ne(Wl(),"useHref() may be used only in the context of a <Router> component.");let{basename:e,navigator:i}=Z.useContext(hs),{hash:s,pathname:r,search:o}=Zl(l,{relative:t}),c=r;return e!=="/"&&(c=r==="/"?e:Bs([e,r])),i.createHref({pathname:c,search:o,hash:s})}function Wl(){return Z.useContext(Ql)!=null}function cr(){return ne(Wl(),"useLocation() may be used only in the context of a <Router> component."),Z.useContext(Ql).location}var NE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function UE(l){Z.useContext(hs).static||Z.useLayoutEffect(l)}function yb(){let{isDataRoute:l}=Z.useContext(Hs);return l?Cb():vb()}function vb(){ne(Wl(),"useNavigate() may be used only in the context of a <Router> component.");let l=Z.useContext(xa),{basename:t,navigator:e}=Z.useContext(hs),{matches:i}=Z.useContext(Hs),{pathname:s}=cr(),r=JSON.stringify(wE(i)),o=Z.useRef(!1);return UE(()=>{o.current=!0}),Z.useCallback((h,f={})=>{if(os(o.current,NE),!o.current)return;if(typeof h=="number"){e.go(h);return}let g=kE(h,JSON.parse(r),s,f.relative==="path");l==null&&t!=="/"&&(g.pathname=g.pathname==="/"?t:Bs([t,g.pathname])),(f.replace?e.replace:e.push)(g,f.state,f)},[t,e,r,s,l])}Z.createContext(null);function Zl(l,{relative:t}={}){let{matches:e}=Z.useContext(Hs),{pathname:i}=cr(),s=JSON.stringify(wE(e));return Z.useMemo(()=>kE(l,JSON.parse(s),i,t==="path"),[l,s,i,t])}function Eb(l,t){return BE(l,t)}function BE(l,t,e,i){ne(Wl(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=Z.useContext(hs),{matches:r}=Z.useContext(Hs),o=r[r.length-1],c=o?o.params:{},h=o?o.pathname:"/",f=o?o.pathnameBase:"/",g=o&&o.route;{let _=g&&g.path||"";FE(h,!g||_.endsWith("*")||_.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${_}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${_}"> to <Route path="${_==="/"?"*":`${_}/*`}">.`)}let m=cr(),y;if(t){let _=typeof t=="string"?Sa(t):t;ne(f==="/"||_.pathname?.startsWith(f),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${_.pathname}" was given in the \`location\` prop.`),y=_}else y=m;let v=y.pathname||"/",T=v;if(f!=="/"){let _=f.replace(/^\//,"").split("/");T="/"+v.replace(/^\//,"").split("/").slice(_.length).join("/")}let S=IE(l,{pathname:T});os(g||S!=null,`No routes matched location "${y.pathname}${y.search}${y.hash}" `),os(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${y.pathname}${y.search}${y.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let x=Ab(S&&S.map(_=>Object.assign({},_,{params:Object.assign({},c,_.params),pathname:Bs([f,s.encodeLocation?s.encodeLocation(_.pathname).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?f:Bs([f,s.encodeLocation?s.encodeLocation(_.pathnameBase).pathname:_.pathnameBase])})),r,e,i);return t&&x?Z.createElement(Ql.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...y},navigationType:"POP"}},x):x}function Tb(){let l=Ib(),t=hb(l)?`${l.status} ${l.statusText}`:l instanceof Error?l.message:JSON.stringify(l),e=l instanceof Error?l.stack:null,i="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:i},r={padding:"2px 4px",backgroundColor:i},o=null;return console.error("Error handled by React Router default ErrorBoundary:",l),o=Z.createElement(Z.Fragment,null,Z.createElement("p",null," Hey developer "),Z.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Z.createElement("code",{style:r},"ErrorBoundary")," or"," ",Z.createElement("code",{style:r},"errorElement")," prop on your route.")),Z.createElement(Z.Fragment,null,Z.createElement("h2",null,"Unexpected Application Error!"),Z.createElement("h3",{style:{fontStyle:"italic"}},t),e?Z.createElement("pre",{style:s},e):null,o)}var Sb=Z.createElement(Tb,null),xb=class extends Z.Component{constructor(l){super(l),this.state={location:l.location,revalidation:l.revalidation,error:l.error}}static getDerivedStateFromError(l){return{error:l}}static getDerivedStateFromProps(l,t){return t.location!==l.location||t.revalidation!=="idle"&&l.revalidation==="idle"?{error:l.error,location:l.location,revalidation:l.revalidation}:{error:l.error!==void 0?l.error:t.error,location:t.location,revalidation:l.revalidation||t.revalidation}}componentDidCatch(l,t){console.error("React Router caught the following error during render",l,t)}render(){return this.state.error!==void 0?Z.createElement(Hs.Provider,{value:this.props.routeContext},Z.createElement(eg.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function _b({routeContext:l,match:t,children:e}){let i=Z.useContext(xa);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),Z.createElement(Hs.Provider,{value:l},e)}function Ab(l,t=[],e=null,i=null){if(l==null){if(!e)return null;if(e.errors)l=e.matches;else if(t.length===0&&!e.initialized&&e.matches.length>0)l=e.matches;else return null}let s=l,r=e?.errors;if(r!=null){let h=s.findIndex(f=>f.route.id&&r?.[f.route.id]!==void 0);ne(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(r).join(",")}`),s=s.slice(0,Math.min(s.length,h+1))}let o=!1,c=-1;if(e)for(let h=0;h<s.length;h++){let f=s[h];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(c=h),f.route.id){let{loaderData:g,errors:m}=e,y=f.route.loader&&!g.hasOwnProperty(f.route.id)&&(!m||m[f.route.id]===void 0);if(f.route.lazy||y){o=!0,c>=0?s=s.slice(0,c+1):s=[s[0]];break}}}return s.reduceRight((h,f,g)=>{let m,y=!1,v=null,T=null;e&&(m=r&&f.route.id?r[f.route.id]:void 0,v=f.route.errorElement||Sb,o&&(c<0&&g===0?(FE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),y=!0,T=null):c===g&&(y=!0,T=f.route.hydrateFallbackElement||null)));let S=t.concat(s.slice(0,g+1)),x=()=>{let _;return m?_=v:y?_=T:f.route.Component?_=Z.createElement(f.route.Component,null):f.route.element?_=f.route.element:_=h,Z.createElement(_b,{match:f,routeContext:{outlet:h,matches:S,isDataRoute:e!=null},children:_})};return e&&(f.route.ErrorBoundary||f.route.errorElement||g===0)?Z.createElement(xb,{location:e.location,revalidation:e.revalidation,component:v,error:m,children:x(),routeContext:{outlet:null,matches:S,isDataRoute:!0}}):x()},null)}function ig(l){return`${l} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function bb(l){let t=Z.useContext(xa);return ne(t,ig(l)),t}function Rb(l){let t=Z.useContext(fc);return ne(t,ig(l)),t}function Lb(l){let t=Z.useContext(Hs);return ne(t,ig(l)),t}function sg(l){let t=Lb(l),e=t.matches[t.matches.length-1];return ne(e.route.id,`${l} can only be used on routes that contain a unique "id"`),e.route.id}function Db(){return sg("useRouteId")}function Ib(){let l=Z.useContext(eg),t=Rb("useRouteError"),e=sg("useRouteError");return l!==void 0?l:t.errors?.[e]}function Cb(){let{router:l}=bb("useNavigate"),t=sg("useNavigate"),e=Z.useRef(!1);return UE(()=>{e.current=!0}),Z.useCallback(async(s,r={})=>{os(e.current,NE),e.current&&(typeof s=="number"?l.navigate(s):await l.navigate(s,{fromRouteId:t,...r}))},[l,t])}var Wy={};function FE(l,t,e){!t&&!Wy[l]&&(Wy[l]=!0,os(!1,e))}Z.memo(Ob);function Ob({routes:l,future:t,state:e}){return BE(l,void 0,e,t)}function Jn(l){ne(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function wb({basename:l="/",children:t=null,location:e,navigationType:i="POP",navigator:s,static:r=!1}){ne(!Wl(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=l.replace(/^\/*/,"/"),c=Z.useMemo(()=>({basename:o,navigator:s,static:r,future:{}}),[o,s,r]);typeof e=="string"&&(e=Sa(e));let{pathname:h="/",search:f="",hash:g="",state:m=null,key:y="default"}=e,v=Z.useMemo(()=>{let T=Fs(h,o);return T==null?null:{location:{pathname:T,search:f,hash:g,state:m,key:y},navigationType:i}},[o,h,f,g,m,y,i]);return os(v!=null,`<Router basename="${o}"> is not able to match the URL "${h}${f}${g}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:Z.createElement(hs.Provider,{value:c},Z.createElement(Ql.Provider,{children:t,value:v}))}function kb({children:l,location:t}){return Eb(Ed(l),t)}function Ed(l,t=[]){let e=[];return Z.Children.forEach(l,(i,s)=>{if(!Z.isValidElement(i))return;let r=[...t,s];if(i.type===Z.Fragment){e.push.apply(e,Ed(i.props.children,r));return}ne(i.type===Jn,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ne(!i.props.index||!i.props.children,"An index route cannot have child routes.");let o={id:i.props.id||r.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(o.children=Ed(i.props.children,r)),e.push(o)}),e}var Mu="get",Pu="application/x-www-form-urlencoded";function hc(l){return l!=null&&typeof l.tagName=="string"}function Mb(l){return hc(l)&&l.tagName.toLowerCase()==="button"}function Pb(l){return hc(l)&&l.tagName.toLowerCase()==="form"}function Nb(l){return hc(l)&&l.tagName.toLowerCase()==="input"}function Ub(l){return!!(l.metaKey||l.altKey||l.ctrlKey||l.shiftKey)}function Bb(l,t){return l.button===0&&(!t||t==="_self")&&!Ub(l)}var pu=null;function Fb(){if(pu===null)try{new FormData(document.createElement("form"),0),pu=!1}catch{pu=!0}return pu}var $b=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Fh(l){return l!=null&&!$b.has(l)?(os(!1,`"${l}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Pu}"`),null):l}function Gb(l,t){let e,i,s,r,o;if(Pb(l)){let c=l.getAttribute("action");i=c?Fs(c,t):null,e=l.getAttribute("method")||Mu,s=Fh(l.getAttribute("enctype"))||Pu,r=new FormData(l)}else if(Mb(l)||Nb(l)&&(l.type==="submit"||l.type==="image")){let c=l.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=l.getAttribute("formaction")||c.getAttribute("action");if(i=h?Fs(h,t):null,e=l.getAttribute("formmethod")||c.getAttribute("method")||Mu,s=Fh(l.getAttribute("formenctype"))||Fh(c.getAttribute("enctype"))||Pu,r=new FormData(c,l),!Fb()){let{name:f,type:g,value:m}=l;if(g==="image"){let y=f?`${f}.`:"";r.append(`${y}x`,"0"),r.append(`${y}y`,"0")}else f&&r.append(f,m)}}else{if(hc(l))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');e=Mu,i=null,s=Pu,o=l}return r&&s==="text/plain"&&(o=r,r=void 0),{action:i,method:e.toLowerCase(),encType:s,formData:r,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function ng(l,t){if(l===!1||l===null||typeof l>"u")throw new Error(t)}function Hb(l,t,e){let i=typeof l=="string"?new URL(l,typeof window>"u"?"server://singlefetch/":window.location.origin):l;return i.pathname==="/"?i.pathname=`_root.${e}`:t&&Fs(i.pathname,t)==="/"?i.pathname=`${t.replace(/\/$/,"")}/_root.${e}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${e}`,i}async function Vb(l,t){if(l.id in t)return t[l.id];try{let e=await import(l.module);return t[l.id]=e,e}catch(e){return console.error(`Error loading route module \`${l.module}\`, reloading page...`),console.error(e),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Kb(l){return l==null?!1:l.href==null?l.rel==="preload"&&typeof l.imageSrcSet=="string"&&typeof l.imageSizes=="string":typeof l.rel=="string"&&typeof l.href=="string"}async function zb(l,t,e){let i=await Promise.all(l.map(async s=>{let r=t.routes[s.route.id];if(r){let o=await Vb(r,e);return o.links?o.links():[]}return[]}));return Xb(i.flat(1).filter(Kb).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function Zy(l,t,e,i,s,r){let o=(h,f)=>e[f]?h.route.id!==e[f].route.id:!0,c=(h,f)=>e[f].pathname!==h.pathname||e[f].route.path?.endsWith("*")&&e[f].params["*"]!==h.params["*"];return r==="assets"?t.filter((h,f)=>o(h,f)||c(h,f)):r==="data"?t.filter((h,f)=>{let g=i.routes[h.route.id];if(!g||!g.hasLoader)return!1;if(o(h,f)||c(h,f))return!0;if(h.route.shouldRevalidate){let m=h.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:e[0]?.params||{},nextUrl:new URL(l,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function Yb(l,t,{includeHydrateFallback:e}={}){return jb(l.map(i=>{let s=t.routes[i.route.id];if(!s)return[];let r=[s.module];return s.clientActionModule&&(r=r.concat(s.clientActionModule)),s.clientLoaderModule&&(r=r.concat(s.clientLoaderModule)),e&&s.hydrateFallbackModule&&(r=r.concat(s.hydrateFallbackModule)),s.imports&&(r=r.concat(s.imports)),r}).flat(1))}function jb(l){return[...new Set(l)]}function qb(l){let t={},e=Object.keys(l).sort();for(let i of e)t[i]=l[i];return t}function Xb(l,t){let e=new Set;return new Set(t),l.reduce((i,s)=>{let r=JSON.stringify(qb(s));return e.has(r)||(e.add(r),i.push({key:r,link:s})),i},[])}function $E(){let l=Z.useContext(xa);return ng(l,"You must render this element inside a <DataRouterContext.Provider> element"),l}function Qb(){let l=Z.useContext(fc);return ng(l,"You must render this element inside a <DataRouterStateContext.Provider> element"),l}var rg=Z.createContext(void 0);rg.displayName="FrameworkContext";function GE(){let l=Z.useContext(rg);return ng(l,"You must render this element inside a <HydratedRouter> element"),l}function Wb(l,t){let e=Z.useContext(rg),[i,s]=Z.useState(!1),[r,o]=Z.useState(!1),{onFocus:c,onBlur:h,onMouseEnter:f,onMouseLeave:g,onTouchStart:m}=t,y=Z.useRef(null);Z.useEffect(()=>{if(l==="render"&&o(!0),l==="viewport"){let S=_=>{_.forEach(L=>{o(L.isIntersecting)})},x=new IntersectionObserver(S,{threshold:.5});return y.current&&x.observe(y.current),()=>{x.disconnect()}}},[l]),Z.useEffect(()=>{if(i){let S=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(S)}}},[i]);let v=()=>{s(!0)},T=()=>{s(!1),o(!1)};return e?l!=="intent"?[r,y,{}]:[r,y,{onFocus:_l(c,v),onBlur:_l(h,T),onMouseEnter:_l(f,v),onMouseLeave:_l(g,T),onTouchStart:_l(m,v)}]:[!1,y,{}]}function _l(l,t){return e=>{l&&l(e),e.defaultPrevented||t(e)}}function Zb({page:l,...t}){let{router:e}=$E(),i=Z.useMemo(()=>IE(e.routes,l,e.basename),[e.routes,l,e.basename]);return i?Z.createElement(t1,{page:l,matches:i,...t}):null}function Jb(l){let{manifest:t,routeModules:e}=GE(),[i,s]=Z.useState([]);return Z.useEffect(()=>{let r=!1;return zb(l,t,e).then(o=>{r||s(o)}),()=>{r=!0}},[l,t,e]),i}function t1({page:l,matches:t,...e}){let i=cr(),{manifest:s,routeModules:r}=GE(),{basename:o}=$E(),{loaderData:c,matches:h}=Qb(),f=Z.useMemo(()=>Zy(l,t,h,s,i,"data"),[l,t,h,s,i]),g=Z.useMemo(()=>Zy(l,t,h,s,i,"assets"),[l,t,h,s,i]),m=Z.useMemo(()=>{if(l===i.pathname+i.search+i.hash)return[];let T=new Set,S=!1;if(t.forEach(_=>{let L=s.routes[_.route.id];!L||!L.hasLoader||(!f.some(R=>R.route.id===_.route.id)&&_.route.id in c&&r[_.route.id]?.shouldRevalidate||L.hasClientLoader?S=!0:T.add(_.route.id))}),T.size===0)return[];let x=Hb(l,o,"data");return S&&T.size>0&&x.searchParams.set("_routes",t.filter(_=>T.has(_.route.id)).map(_=>_.route.id).join(",")),[x.pathname+x.search]},[o,c,i,s,f,t,l,r]),y=Z.useMemo(()=>Yb(g,s),[g,s]),v=Jb(g);return Z.createElement(Z.Fragment,null,m.map(T=>Z.createElement("link",{key:T,rel:"prefetch",as:"fetch",href:T,...e})),y.map(T=>Z.createElement("link",{key:T,rel:"modulepreload",href:T,...e})),v.map(({key:T,link:S})=>Z.createElement("link",{key:T,nonce:e.nonce,...S})))}function e1(...l){return t=>{l.forEach(e=>{typeof e=="function"?e(t):e!=null&&(e.current=t)})}}var HE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{HE&&(window.__reactRouterVersion="7.8.0")}catch{}function i1({basename:l,children:t,window:e}){let i=Z.useRef();i.current==null&&(i.current=VA({window:e,v5Compat:!0}));let s=i.current,[r,o]=Z.useState({action:s.action,location:s.location}),c=Z.useCallback(h=>{Z.startTransition(()=>o(h))},[o]);return Z.useLayoutEffect(()=>s.listen(c),[s,c]),Z.createElement(wb,{basename:l,children:t,location:r.location,navigationType:r.action,navigator:s})}var VE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,KE=Z.forwardRef(function({onClick:t,discover:e="render",prefetch:i="none",relative:s,reloadDocument:r,replace:o,state:c,target:h,to:f,preventScrollReset:g,viewTransition:m,...y},v){let{basename:T}=Z.useContext(hs),S=typeof f=="string"&&VE.test(f),x,_=!1;if(typeof f=="string"&&S&&(x=f,HE))try{let w=new URL(window.location.href),N=f.startsWith("//")?new URL(w.protocol+f):new URL(f),z=Fs(N.pathname,T);N.origin===w.origin&&z!=null?f=z+N.search+N.hash:_=!0}catch{os(!1,`<Link to="${f}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let L=pb(f,{relative:s}),[R,C,I]=Wb(i,y),U=r1(f,{replace:o,state:c,target:h,preventScrollReset:g,relative:s,viewTransition:m});function O(w){t&&t(w),w.defaultPrevented||U(w)}let M=Z.createElement("a",{...y,...I,href:x||L,onClick:_||r?t:O,ref:e1(v,C),target:h,"data-discover":!S&&e==="render"?"true":void 0});return R&&!S?Z.createElement(Z.Fragment,null,M,Z.createElement(Zb,{page:L})):M});KE.displayName="Link";var zE=Z.forwardRef(function({"aria-current":t="page",caseSensitive:e=!1,className:i="",end:s=!1,style:r,to:o,viewTransition:c,children:h,...f},g){let m=Zl(o,{relative:f.relative}),y=cr(),v=Z.useContext(fc),{navigator:T,basename:S}=Z.useContext(hs),x=v!=null&&c1(m)&&c===!0,_=T.encodeLocation?T.encodeLocation(m).pathname:m.pathname,L=y.pathname,R=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;e||(L=L.toLowerCase(),R=R?R.toLowerCase():null,_=_.toLowerCase()),R&&S&&(R=Fs(R,S)||R);const C=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let I=L===_||!s&&L.startsWith(_)&&L.charAt(C)==="/",U=R!=null&&(R===_||!s&&R.startsWith(_)&&R.charAt(_.length)==="/"),O={isActive:I,isPending:U,isTransitioning:x},M=I?t:void 0,w;typeof i=="function"?w=i(O):w=[i,I?"active":null,U?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let N=typeof r=="function"?r(O):r;return Z.createElement(KE,{...f,"aria-current":M,className:w,ref:g,style:N,to:o,viewTransition:c},typeof h=="function"?h(O):h)});zE.displayName="NavLink";var s1=Z.forwardRef(({discover:l="render",fetcherKey:t,navigate:e,reloadDocument:i,replace:s,state:r,method:o=Mu,action:c,onSubmit:h,relative:f,preventScrollReset:g,viewTransition:m,...y},v)=>{let T=o1(),S=u1(c,{relative:f}),x=o.toLowerCase()==="get"?"get":"post",_=typeof c=="string"&&VE.test(c),L=R=>{if(h&&h(R),R.defaultPrevented)return;R.preventDefault();let C=R.nativeEvent.submitter,I=C?.getAttribute("formmethod")||o;T(C||R.currentTarget,{fetcherKey:t,method:I,navigate:e,replace:s,state:r,relative:f,preventScrollReset:g,viewTransition:m})};return Z.createElement("form",{ref:v,method:x,action:S,onSubmit:i?h:L,...y,"data-discover":!_&&l==="render"?"true":void 0})});s1.displayName="Form";function n1(l){return`${l} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function YE(l){let t=Z.useContext(xa);return ne(t,n1(l)),t}function r1(l,{target:t,replace:e,state:i,preventScrollReset:s,relative:r,viewTransition:o}={}){let c=yb(),h=cr(),f=Zl(l,{relative:r});return Z.useCallback(g=>{if(Bb(g,t)){g.preventDefault();let m=e!==void 0?e:Pl(h)===Pl(f);c(l,{replace:m,state:i,preventScrollReset:s,relative:r,viewTransition:o})}},[h,c,f,e,i,t,l,s,r,o])}var a1=0,l1=()=>`__${String(++a1)}__`;function o1(){let{router:l}=YE("useSubmit"),{basename:t}=Z.useContext(hs),e=Db();return Z.useCallback(async(i,s={})=>{let{action:r,method:o,encType:c,formData:h,body:f}=Gb(i,t);if(s.navigate===!1){let g=s.fetcherKey||l1();await l.fetch(g,e,s.action||r,{preventScrollReset:s.preventScrollReset,formData:h,body:f,formMethod:s.method||o,formEncType:s.encType||c,flushSync:s.flushSync})}else await l.navigate(s.action||r,{preventScrollReset:s.preventScrollReset,formData:h,body:f,formMethod:s.method||o,formEncType:s.encType||c,replace:s.replace,state:s.state,fromRouteId:e,flushSync:s.flushSync,viewTransition:s.viewTransition})},[l,t,e])}function u1(l,{relative:t}={}){let{basename:e}=Z.useContext(hs),i=Z.useContext(Hs);ne(i,"useFormAction must be used inside a RouteContext");let[s]=i.matches.slice(-1),r={...Zl(l||".",{relative:t})},o=cr();if(l==null){r.search=o.search;let c=new URLSearchParams(r.search),h=c.getAll("index");if(h.some(g=>g==="")){c.delete("index"),h.filter(m=>m).forEach(m=>c.append("index",m));let g=c.toString();r.search=g?`?${g}`:""}}return(!l||l===".")&&s.route.index&&(r.search=r.search?r.search.replace(/^\?/,"?index&"):"?index"),e!=="/"&&(r.pathname=r.pathname==="/"?e:Bs([e,r.pathname])),Pl(r)}function c1(l,{relative:t}={}){let e=Z.useContext(PE);ne(e!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=YE("useViewTransitionState"),s=Zl(l,{relative:t});if(!e.isTransitioning)return!1;let r=Fs(e.currentLocation.pathname,i)||e.currentLocation.pathname,o=Fs(e.nextLocation.pathname,i)||e.nextLocation.pathname;return ju(s.pathname,o)!=null||ju(s.pathname,r)!=null}function ws(l){if(l===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l}function jE(l,t){l.prototype=Object.create(t.prototype),l.prototype.constructor=l,l.__proto__=t}/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var pi={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},da={duration:.5,overwrite:!1,delay:0},ag,we,Jt,ki=1e8,qt=1/ki,Td=Math.PI*2,f1=Td/4,h1=0,qE=Math.sqrt,d1=Math.cos,g1=Math.sin,De=function(t){return typeof t=="string"},ue=function(t){return typeof t=="function"},$s=function(t){return typeof t=="number"},lg=function(t){return typeof t>"u"},us=function(t){return typeof t=="object"},Je=function(t){return t!==!1},og=function(){return typeof window<"u"},yu=function(t){return ue(t)||De(t)},XE=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},$e=Array.isArray,Sd=/(?:-?\.?\d|\.)+/gi,QE=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,na=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,$h=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,WE=/[+-]=-?[.\d]+/,ZE=/[^,'"\[\]\s]+/gi,m1=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,ie,is,xd,ug,vi={},qu={},JE,tT=function(t){return(qu=ga(t,vi))&&si},cg=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},Nl=function(t,e){return!e&&console.warn(t)},eT=function(t,e){return t&&(vi[t]=e)&&qu&&(qu[t]=e)||vi},Ul=function(){return 0},p1={suppressEvents:!0,isStart:!0,kill:!1},Nu={suppressEvents:!0,kill:!1},y1={suppressEvents:!0},fg={},Tn=[],_d={},iT,fi={},Gh={},Jy=30,Uu=[],hg="",dg=function(t){var e=t[0],i,s;if(us(e)||ue(e)||(t=[t]),!(i=(e._gsap||{}).harness)){for(s=Uu.length;s--&&!Uu[s].targetTest(e););i=Uu[s]}for(s=t.length;s--;)t[s]&&(t[s]._gsap||(t[s]._gsap=new RT(t[s],i)))||t.splice(s,1);return t},sr=function(t){return t._gsap||dg(Mi(t))[0]._gsap},sT=function(t,e,i){return(i=t[e])&&ue(i)?t[e]():lg(i)&&t.getAttribute&&t.getAttribute(e)||i},ti=function(t,e){return(t=t.split(",")).forEach(e)||t},de=function(t){return Math.round(t*1e5)/1e5||0},ye=function(t){return Math.round(t*1e7)/1e7||0},la=function(t,e){var i=e.charAt(0),s=parseFloat(e.substr(2));return t=parseFloat(t),i==="+"?t+s:i==="-"?t-s:i==="*"?t*s:t/s},v1=function(t,e){for(var i=e.length,s=0;t.indexOf(e[s])<0&&++s<i;);return s<i},Xu=function(){var t=Tn.length,e=Tn.slice(0),i,s;for(_d={},Tn.length=0,i=0;i<t;i++)s=e[i],s&&s._lazy&&(s.render(s._lazy[0],s._lazy[1],!0)._lazy=0)},gg=function(t){return!!(t._initted||t._startAt||t.add)},nT=function(t,e,i,s){Tn.length&&!we&&Xu(),t.render(e,i,!!(we&&e<0&&gg(t))),Tn.length&&!we&&Xu()},rT=function(t){var e=parseFloat(t);return(e||e===0)&&(t+"").match(ZE).length<2?e:De(t)?t.trim():t},aT=function(t){return t},Ei=function(t,e){for(var i in e)i in t||(t[i]=e[i]);return t},E1=function(t){return function(e,i){for(var s in i)s in e||s==="duration"&&t||s==="ease"||(e[s]=i[s])}},ga=function(t,e){for(var i in e)t[i]=e[i];return t},tv=function l(t,e){for(var i in e)i!=="__proto__"&&i!=="constructor"&&i!=="prototype"&&(t[i]=us(e[i])?l(t[i]||(t[i]={}),e[i]):e[i]);return t},Qu=function(t,e){var i={},s;for(s in t)s in e||(i[s]=t[s]);return i},Il=function(t){var e=t.parent||ie,i=t.keyframes?E1($e(t.keyframes)):Ei;if(Je(t.inherit))for(;e;)i(t,e.vars.defaults),e=e.parent||e._dp;return t},T1=function(t,e){for(var i=t.length,s=i===e.length;s&&i--&&t[i]===e[i];);return i<0},lT=function(t,e,i,s,r){var o=t[s],c;if(r)for(c=e[r];o&&o[r]>c;)o=o._prev;return o?(e._next=o._next,o._next=e):(e._next=t[i],t[i]=e),e._next?e._next._prev=e:t[s]=e,e._prev=o,e.parent=e._dp=t,e},dc=function(t,e,i,s){i===void 0&&(i="_first"),s===void 0&&(s="_last");var r=e._prev,o=e._next;r?r._next=o:t[i]===e&&(t[i]=o),o?o._prev=r:t[s]===e&&(t[s]=r),e._next=e._prev=e.parent=null},xn=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},nr=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var i=t;i;)i._dirty=1,i=i.parent;return t},S1=function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t},Ad=function(t,e,i,s){return t._startAt&&(we?t._startAt.revert(Nu):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,s))},x1=function l(t){return!t||t._ts&&l(t.parent)},ev=function(t){return t._repeat?ma(t._tTime,t=t.duration()+t._rDelay)*t:0},ma=function(t,e){var i=Math.floor(t=ye(t/e));return t&&i===t?i-1:i},Wu=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},gc=function(t){return t._end=ye(t._start+(t._tDur/Math.abs(t._ts||t._rts||qt)||0))},mc=function(t,e){var i=t._dp;return i&&i.smoothChildTiming&&t._ts&&(t._start=ye(i._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),gc(t),i._dirty||nr(i,t)),t},oT=function(t,e){var i;if((e._time||!e._dur&&e._initted||e._start<t._time&&(e._dur||!e.add))&&(i=Wu(t.rawTime(),e),(!e._dur||Jl(0,e.totalDuration(),i)-e._tTime>qt)&&e.render(i,!0)),nr(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(i=t;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;t._zTime=-qt}},ns=function(t,e,i,s){return e.parent&&xn(e),e._start=ye(($s(i)?i:i||t!==ie?Oi(t,i,e):t._time)+e._delay),e._end=ye(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),lT(t,e,"_first","_last",t._sort?"_start":0),bd(e)||(t._recent=e),s||oT(t,e),t._ts<0&&mc(t,t._tTime),t},uT=function(t,e){return(vi.ScrollTrigger||cg("scrollTrigger",e))&&vi.ScrollTrigger.create(e,t)},cT=function(t,e,i,s,r){if(pg(t,e,r),!t._initted)return 1;if(!i&&t._pt&&!we&&(t._dur&&t.vars.lazy!==!1||!t._dur&&t.vars.lazy)&&iT!==di.frame)return Tn.push(t),t._lazy=[r,s],1},_1=function l(t){var e=t.parent;return e&&e._ts&&e._initted&&!e._lock&&(e.rawTime()<0||l(e))},bd=function(t){var e=t.data;return e==="isFromStart"||e==="isStart"},A1=function(t,e,i,s){var r=t.ratio,o=e<0||!e&&(!t._start&&_1(t)&&!(!t._initted&&bd(t))||(t._ts<0||t._dp._ts<0)&&!bd(t))?0:1,c=t._rDelay,h=0,f,g,m;if(c&&t._repeat&&(h=Jl(0,t._tDur,e),g=ma(h,c),t._yoyo&&g&1&&(o=1-o),g!==ma(t._tTime,c)&&(r=1-o,t.vars.repeatRefresh&&t._initted&&t.invalidate())),o!==r||we||s||t._zTime===qt||!e&&t._zTime){if(!t._initted&&cT(t,e,s,i,h))return;for(m=t._zTime,t._zTime=e||(i?qt:0),i||(i=e&&!m),t.ratio=o,t._from&&(o=1-o),t._time=0,t._tTime=h,f=t._pt;f;)f.r(o,f.d),f=f._next;e<0&&Ad(t,e,i,!0),t._onUpdate&&!i&&gi(t,"onUpdate"),h&&t._repeat&&!i&&t.parent&&gi(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===o&&(o&&xn(t,1),!i&&!we&&(gi(t,o?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)},b1=function(t,e,i){var s;if(i>e)for(s=t._first;s&&s._start<=i;){if(s.data==="isPause"&&s._start>e)return s;s=s._next}else for(s=t._last;s&&s._start>=i;){if(s.data==="isPause"&&s._start<e)return s;s=s._prev}},pa=function(t,e,i,s){var r=t._repeat,o=ye(e)||0,c=t._tTime/t._tDur;return c&&!s&&(t._time*=o/t._dur),t._dur=o,t._tDur=r?r<0?1e10:ye(o*(r+1)+t._rDelay*r):o,c>0&&!s&&mc(t,t._tTime=t._tDur*c),t.parent&&gc(t),i||nr(t.parent,t),t},iv=function(t){return t instanceof He?nr(t):pa(t,t._dur)},R1={_start:0,endTime:Ul,totalDuration:Ul},Oi=function l(t,e,i){var s=t.labels,r=t._recent||R1,o=t.duration()>=ki?r.endTime(!1):t._dur,c,h,f;return De(e)&&(isNaN(e)||e in s)?(h=e.charAt(0),f=e.substr(-1)==="%",c=e.indexOf("="),h==="<"||h===">"?(c>=0&&(e=e.replace(/=/,"")),(h==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(e.substr(1))||0)*(f?(c<0?r:i).totalDuration()/100:1)):c<0?(e in s||(s[e]=o),s[e]):(h=parseFloat(e.charAt(c-1)+e.substr(c+1)),f&&i&&(h=h/100*($e(i)?i[0]:i).totalDuration()),c>1?l(t,e.substr(0,c-1),i)+h:o+h)):e==null?o:+e},Cl=function(t,e,i){var s=$s(e[1]),r=(s?2:1)+(t<2?0:1),o=e[r],c,h;if(s&&(o.duration=e[1]),o.parent=i,t){for(c=o,h=i;h&&!("immediateRender"in c);)c=h.vars.defaults||{},h=Je(h.vars.inherit)&&h.parent;o.immediateRender=Je(c.immediateRender),t<2?o.runBackwards=1:o.startAt=e[r-1]}return new pe(e[0],o,e[r+1])},Ln=function(t,e){return t||t===0?e(t):e},Jl=function(t,e,i){return i<t?t:i>e?e:i},Fe=function(t,e){return!De(t)||!(e=m1.exec(t))?"":e[1]},L1=function(t,e,i){return Ln(i,function(s){return Jl(t,e,s)})},Rd=[].slice,fT=function(t,e){return t&&us(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&us(t[0]))&&!t.nodeType&&t!==is},D1=function(t,e,i){return i===void 0&&(i=[]),t.forEach(function(s){var r;return De(s)&&!e||fT(s,1)?(r=i).push.apply(r,Mi(s)):i.push(s)})||i},Mi=function(t,e,i){return Jt&&!e&&Jt.selector?Jt.selector(t):De(t)&&!i&&(xd||!ya())?Rd.call((e||ug).querySelectorAll(t),0):$e(t)?D1(t,i):fT(t)?Rd.call(t,0):t?[t]:[]},Ld=function(t){return t=Mi(t)[0]||Nl("Invalid scope")||{},function(e){var i=t.current||t.nativeElement||t;return Mi(e,i.querySelectorAll?i:i===t?Nl("Invalid scope")||ug.createElement("div"):t)}},hT=function(t){return t.sort(function(){return .5-Math.random()})},dT=function(t){if(ue(t))return t;var e=us(t)?t:{each:t},i=rr(e.ease),s=e.from||0,r=parseFloat(e.base)||0,o={},c=s>0&&s<1,h=isNaN(s)||c,f=e.axis,g=s,m=s;return De(s)?g=m={center:.5,edges:.5,end:1}[s]||0:!c&&h&&(g=s[0],m=s[1]),function(y,v,T){var S=(T||e).length,x=o[S],_,L,R,C,I,U,O,M,w;if(!x){if(w=e.grid==="auto"?0:(e.grid||[1,ki])[1],!w){for(O=-ki;O<(O=T[w++].getBoundingClientRect().left)&&w<S;);w<S&&w--}for(x=o[S]=[],_=h?Math.min(w,S)*g-.5:s%w,L=w===ki?0:h?S*m/w-.5:s/w|0,O=0,M=ki,U=0;U<S;U++)R=U%w-_,C=L-(U/w|0),x[U]=I=f?Math.abs(f==="y"?C:R):qE(R*R+C*C),I>O&&(O=I),I<M&&(M=I);s==="random"&&hT(x),x.max=O-M,x.min=M,x.v=S=(parseFloat(e.amount)||parseFloat(e.each)*(w>S?S-1:f?f==="y"?S/w:w:Math.max(w,S/w))||0)*(s==="edges"?-1:1),x.b=S<0?r-S:r,x.u=Fe(e.amount||e.each)||0,i=i&&S<0?_T(i):i}return S=(x[y]-x.min)/x.max||0,ye(x.b+(i?i(S):S)*x.v)+x.u}},Dd=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(i){var s=ye(Math.round(parseFloat(i)/t)*t*e);return(s-s%1)/e+($s(i)?0:Fe(i))}},gT=function(t,e){var i=$e(t),s,r;return!i&&us(t)&&(s=i=t.radius||ki,t.values?(t=Mi(t.values),(r=!$s(t[0]))&&(s*=s)):t=Dd(t.increment)),Ln(e,i?ue(t)?function(o){return r=t(o),Math.abs(r-o)<=s?r:o}:function(o){for(var c=parseFloat(r?o.x:o),h=parseFloat(r?o.y:0),f=ki,g=0,m=t.length,y,v;m--;)r?(y=t[m].x-c,v=t[m].y-h,y=y*y+v*v):y=Math.abs(t[m]-c),y<f&&(f=y,g=m);return g=!s||f<=s?t[g]:o,r||g===o||$s(o)?g:g+Fe(o)}:Dd(t))},mT=function(t,e,i,s){return Ln($e(t)?!e:i===!0?!!(i=0):!s,function(){return $e(t)?t[~~(Math.random()*t.length)]:(i=i||1e-5)&&(s=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((t-i/2+Math.random()*(e-t+i*.99))/i)*i*s)/s})},I1=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return function(s){return e.reduce(function(r,o){return o(r)},s)}},C1=function(t,e){return function(i){return t(parseFloat(i))+(e||Fe(i))}},O1=function(t,e,i){return yT(t,e,0,1,i)},pT=function(t,e,i){return Ln(i,function(s){return t[~~e(s)]})},w1=function l(t,e,i){var s=e-t;return $e(t)?pT(t,l(0,t.length),e):Ln(i,function(r){return(s+(r-t)%s)%s+t})},k1=function l(t,e,i){var s=e-t,r=s*2;return $e(t)?pT(t,l(0,t.length-1),e):Ln(i,function(o){return o=(r+(o-t)%r)%r||0,t+(o>s?r-o:o)})},Bl=function(t){for(var e=0,i="",s,r,o,c;~(s=t.indexOf("random(",e));)o=t.indexOf(")",s),c=t.charAt(s+7)==="[",r=t.substr(s+7,o-s-7).match(c?ZE:Sd),i+=t.substr(e,s-e)+mT(c?r:+r[0],c?0:+r[1],+r[2]||1e-5),e=o+1;return i+t.substr(e,t.length-e)},yT=function(t,e,i,s,r){var o=e-t,c=s-i;return Ln(r,function(h){return i+((h-t)/o*c||0)})},M1=function l(t,e,i,s){var r=isNaN(t+e)?0:function(v){return(1-v)*t+v*e};if(!r){var o=De(t),c={},h,f,g,m,y;if(i===!0&&(s=1)&&(i=null),o)t={p:t},e={p:e};else if($e(t)&&!$e(e)){for(g=[],m=t.length,y=m-2,f=1;f<m;f++)g.push(l(t[f-1],t[f]));m--,r=function(T){T*=m;var S=Math.min(y,~~T);return g[S](T-S)},i=e}else s||(t=ga($e(t)?[]:{},t));if(!g){for(h in e)mg.call(c,t,h,"get",e[h]);r=function(T){return Eg(T,c)||(o?t.p:t)}}}return Ln(i,r)},sv=function(t,e,i){var s=t.labels,r=ki,o,c,h;for(o in s)c=s[o]-e,c<0==!!i&&c&&r>(c=Math.abs(c))&&(h=o,r=c);return h},gi=function(t,e,i){var s=t.vars,r=s[e],o=Jt,c=t._ctx,h,f,g;if(r)return h=s[e+"Params"],f=s.callbackScope||t,i&&Tn.length&&Xu(),c&&(Jt=c),g=h?r.apply(f,h):r.call(f),Jt=o,g},Rl=function(t){return xn(t),t.scrollTrigger&&t.scrollTrigger.kill(!!we),t.progress()<1&&gi(t,"onInterrupt"),t},ra,vT=[],ET=function(t){if(t)if(t=!t.name&&t.default||t,og()||t.headless){var e=t.name,i=ue(t),s=e&&!i&&t.init?function(){this._props=[]}:t,r={init:Ul,render:Eg,add:mg,kill:Q1,modifier:X1,rawVars:0},o={targetTest:0,get:0,getSetter:vg,aliases:{},register:0};if(ya(),t!==s){if(fi[e])return;Ei(s,Ei(Qu(t,r),o)),ga(s.prototype,ga(r,Qu(t,o))),fi[s.prop=e]=s,t.targetTest&&(Uu.push(s),fg[e]=1),e=(e==="css"?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}eT(e,s),t.register&&t.register(si,s,ei)}else vT.push(t)},jt=255,Ll={aqua:[0,jt,jt],lime:[0,jt,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,jt],navy:[0,0,128],white:[jt,jt,jt],olive:[128,128,0],yellow:[jt,jt,0],orange:[jt,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[jt,0,0],pink:[jt,192,203],cyan:[0,jt,jt],transparent:[jt,jt,jt,0]},Hh=function(t,e,i){return t+=t<0?1:t>1?-1:0,(t*6<1?e+(i-e)*t*6:t<.5?i:t*3<2?e+(i-e)*(2/3-t)*6:e)*jt+.5|0},TT=function(t,e,i){var s=t?$s(t)?[t>>16,t>>8&jt,t&jt]:0:Ll.black,r,o,c,h,f,g,m,y,v,T;if(!s){if(t.substr(-1)===","&&(t=t.substr(0,t.length-1)),Ll[t])s=Ll[t];else if(t.charAt(0)==="#"){if(t.length<6&&(r=t.charAt(1),o=t.charAt(2),c=t.charAt(3),t="#"+r+r+o+o+c+c+(t.length===5?t.charAt(4)+t.charAt(4):"")),t.length===9)return s=parseInt(t.substr(1,6),16),[s>>16,s>>8&jt,s&jt,parseInt(t.substr(7),16)/255];t=parseInt(t.substr(1),16),s=[t>>16,t>>8&jt,t&jt]}else if(t.substr(0,3)==="hsl"){if(s=T=t.match(Sd),!e)h=+s[0]%360/360,f=+s[1]/100,g=+s[2]/100,o=g<=.5?g*(f+1):g+f-g*f,r=g*2-o,s.length>3&&(s[3]*=1),s[0]=Hh(h+1/3,r,o),s[1]=Hh(h,r,o),s[2]=Hh(h-1/3,r,o);else if(~t.indexOf("="))return s=t.match(QE),i&&s.length<4&&(s[3]=1),s}else s=t.match(Sd)||Ll.transparent;s=s.map(Number)}return e&&!T&&(r=s[0]/jt,o=s[1]/jt,c=s[2]/jt,m=Math.max(r,o,c),y=Math.min(r,o,c),g=(m+y)/2,m===y?h=f=0:(v=m-y,f=g>.5?v/(2-m-y):v/(m+y),h=m===r?(o-c)/v+(o<c?6:0):m===o?(c-r)/v+2:(r-o)/v+4,h*=60),s[0]=~~(h+.5),s[1]=~~(f*100+.5),s[2]=~~(g*100+.5)),i&&s.length<4&&(s[3]=1),s},ST=function(t){var e=[],i=[],s=-1;return t.split(Sn).forEach(function(r){var o=r.match(na)||[];e.push.apply(e,o),i.push(s+=o.length+1)}),e.c=i,e},nv=function(t,e,i){var s="",r=(t+s).match(Sn),o=e?"hsla(":"rgba(",c=0,h,f,g,m;if(!r)return t;if(r=r.map(function(y){return(y=TT(y,e,1))&&o+(e?y[0]+","+y[1]+"%,"+y[2]+"%,"+y[3]:y.join(","))+")"}),i&&(g=ST(t),h=i.c,h.join(s)!==g.c.join(s)))for(f=t.replace(Sn,"1").split(na),m=f.length-1;c<m;c++)s+=f[c]+(~h.indexOf(c)?r.shift()||o+"0,0,0,0)":(g.length?g:r.length?r:i).shift());if(!f)for(f=t.split(Sn),m=f.length-1;c<m;c++)s+=f[c]+r[c];return s+f[m]},Sn=function(){var l="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",t;for(t in Ll)l+="|"+t+"\\b";return new RegExp(l+")","gi")}(),P1=/hsl[a]?\(/,xT=function(t){var e=t.join(" "),i;if(Sn.lastIndex=0,Sn.test(e))return i=P1.test(e),t[1]=nv(t[1],i),t[0]=nv(t[0],i,ST(t[1])),!0},Fl,di=function(){var l=Date.now,t=500,e=33,i=l(),s=i,r=1e3/240,o=r,c=[],h,f,g,m,y,v,T=function S(x){var _=l()-s,L=x===!0,R,C,I,U;if((_>t||_<0)&&(i+=_-e),s+=_,I=s-i,R=I-o,(R>0||L)&&(U=++m.frame,y=I-m.time*1e3,m.time=I=I/1e3,o+=R+(R>=r?4:r-R),C=1),L||(h=f(S)),C)for(v=0;v<c.length;v++)c[v](I,y,U,x)};return m={time:0,frame:0,tick:function(){T(!0)},deltaRatio:function(x){return y/(1e3/(x||60))},wake:function(){JE&&(!xd&&og()&&(is=xd=window,ug=is.document||{},vi.gsap=si,(is.gsapVersions||(is.gsapVersions=[])).push(si.version),tT(qu||is.GreenSockGlobals||!is.gsap&&is||{}),vT.forEach(ET)),g=typeof requestAnimationFrame<"u"&&requestAnimationFrame,h&&m.sleep(),f=g||function(x){return setTimeout(x,o-m.time*1e3+1|0)},Fl=1,T(2))},sleep:function(){(g?cancelAnimationFrame:clearTimeout)(h),Fl=0,f=Ul},lagSmoothing:function(x,_){t=x||1/0,e=Math.min(_||33,t)},fps:function(x){r=1e3/(x||240),o=m.time*1e3+r},add:function(x,_,L){var R=_?function(C,I,U,O){x(C,I,U,O),m.remove(R)}:x;return m.remove(x),c[L?"unshift":"push"](R),ya(),R},remove:function(x,_){~(_=c.indexOf(x))&&c.splice(_,1)&&v>=_&&v--},_listeners:c},m}(),ya=function(){return!Fl&&di.wake()},Ot={},N1=/^[\d.\-M][\d.\-,\s]/,U1=/["']/g,B1=function(t){for(var e={},i=t.substr(1,t.length-3).split(":"),s=i[0],r=1,o=i.length,c,h,f;r<o;r++)h=i[r],c=r!==o-1?h.lastIndexOf(","):h.length,f=h.substr(0,c),e[s]=isNaN(f)?f.replace(U1,"").trim():+f,s=h.substr(c+1).trim();return e},F1=function(t){var e=t.indexOf("(")+1,i=t.indexOf(")"),s=t.indexOf("(",e);return t.substring(e,~s&&s<i?t.indexOf(")",i+1):i)},$1=function(t){var e=(t+"").split("("),i=Ot[e[0]];return i&&e.length>1&&i.config?i.config.apply(null,~t.indexOf("{")?[B1(e[1])]:F1(t).split(",").map(rT)):Ot._CE&&N1.test(t)?Ot._CE("",t):i},_T=function(t){return function(e){return 1-t(1-e)}},AT=function l(t,e){for(var i=t._first,s;i;)i instanceof He?l(i,e):i.vars.yoyoEase&&(!i._yoyo||!i._repeat)&&i._yoyo!==e&&(i.timeline?l(i.timeline,e):(s=i._ease,i._ease=i._yEase,i._yEase=s,i._yoyo=e)),i=i._next},rr=function(t,e){return t&&(ue(t)?t:Ot[t]||$1(t))||e},fr=function(t,e,i,s){i===void 0&&(i=function(h){return 1-e(1-h)}),s===void 0&&(s=function(h){return h<.5?e(h*2)/2:1-e((1-h)*2)/2});var r={easeIn:e,easeOut:i,easeInOut:s},o;return ti(t,function(c){Ot[c]=vi[c]=r,Ot[o=c.toLowerCase()]=i;for(var h in r)Ot[o+(h==="easeIn"?".in":h==="easeOut"?".out":".inOut")]=Ot[c+"."+h]=r[h]}),r},bT=function(t){return function(e){return e<.5?(1-t(1-e*2))/2:.5+t((e-.5)*2)/2}},Vh=function l(t,e,i){var s=e>=1?e:1,r=(i||(t?.3:.45))/(e<1?e:1),o=r/Td*(Math.asin(1/s)||0),c=function(g){return g===1?1:s*Math.pow(2,-10*g)*g1((g-o)*r)+1},h=t==="out"?c:t==="in"?function(f){return 1-c(1-f)}:bT(c);return r=Td/r,h.config=function(f,g){return l(t,f,g)},h},Kh=function l(t,e){e===void 0&&(e=1.70158);var i=function(o){return o?--o*o*((e+1)*o+e)+1:0},s=t==="out"?i:t==="in"?function(r){return 1-i(1-r)}:bT(i);return s.config=function(r){return l(t,r)},s};ti("Linear,Quad,Cubic,Quart,Quint,Strong",function(l,t){var e=t<5?t+1:t;fr(l+",Power"+(e-1),t?function(i){return Math.pow(i,e)}:function(i){return i},function(i){return 1-Math.pow(1-i,e)},function(i){return i<.5?Math.pow(i*2,e)/2:1-Math.pow((1-i)*2,e)/2})});Ot.Linear.easeNone=Ot.none=Ot.Linear.easeIn;fr("Elastic",Vh("in"),Vh("out"),Vh());(function(l,t){var e=1/t,i=2*e,s=2.5*e,r=function(c){return c<e?l*c*c:c<i?l*Math.pow(c-1.5/t,2)+.75:c<s?l*(c-=2.25/t)*c+.9375:l*Math.pow(c-2.625/t,2)+.984375};fr("Bounce",function(o){return 1-r(1-o)},r)})(7.5625,2.75);fr("Expo",function(l){return Math.pow(2,10*(l-1))*l+l*l*l*l*l*l*(1-l)});fr("Circ",function(l){return-(qE(1-l*l)-1)});fr("Sine",function(l){return l===1?1:-d1(l*f1)+1});fr("Back",Kh("in"),Kh("out"),Kh());Ot.SteppedEase=Ot.steps=vi.SteppedEase={config:function(t,e){t===void 0&&(t=1);var i=1/t,s=t+(e?0:1),r=e?1:0,o=1-qt;return function(c){return((s*Jl(0,o,c)|0)+r)*i}}};da.ease=Ot["quad.out"];ti("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(l){return hg+=l+","+l+"Params,"});var RT=function(t,e){this.id=h1++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:sT,this.set=e?e.getSetter:vg},$l=function(){function l(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,pa(this,+e.duration,1,1),this.data=e.data,Jt&&(this._ctx=Jt,Jt.data.push(this)),Fl||di.wake()}var t=l.prototype;return t.delay=function(i){return i||i===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+i-this._delay),this._delay=i,this):this._delay},t.duration=function(i){return arguments.length?this.totalDuration(this._repeat>0?i+(i+this._rDelay)*this._repeat:i):this.totalDuration()&&this._dur},t.totalDuration=function(i){return arguments.length?(this._dirty=0,pa(this,this._repeat<0?i:(i-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(i,s){if(ya(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(mc(this,i),!r._dp||r.parent||oT(r,this);r&&r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&i<this._tDur||this._ts<0&&i>0||!this._tDur&&!i)&&ns(this._dp,this,this._start-this._delay)}return(this._tTime!==i||!this._dur&&!s||this._initted&&Math.abs(this._zTime)===qt||!i&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=i),nT(this,i,s)),this},t.time=function(i,s){return arguments.length?this.totalTime(Math.min(this.totalDuration(),i+ev(this))%(this._dur+this._rDelay)||(i?this._dur:0),s):this._time},t.totalProgress=function(i,s){return arguments.length?this.totalTime(this.totalDuration()*i,s):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},t.progress=function(i,s){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-i:i)+ev(this),s):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},t.iteration=function(i,s){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(i-1)*r,s):this._repeat?ma(this._tTime,r)+1:1},t.timeScale=function(i,s){if(!arguments.length)return this._rts===-qt?0:this._rts;if(this._rts===i)return this;var r=this.parent&&this._ts?Wu(this.parent._time,this):this._tTime;return this._rts=+i||0,this._ts=this._ps||i===-qt?0:this._rts,this.totalTime(Jl(-Math.abs(this._delay),this.totalDuration(),r),s!==!1),gc(this),S1(this)},t.paused=function(i){return arguments.length?(this._ps!==i&&(this._ps=i,i?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(ya(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==qt&&(this._tTime-=qt)))),this):this._ps},t.startTime=function(i){if(arguments.length){this._start=i;var s=this.parent||this._dp;return s&&(s._sort||!this.parent)&&ns(s,this,i-this._delay),this}return this._start},t.endTime=function(i){return this._start+(Je(i)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(i){var s=this.parent||this._dp;return s?i&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Wu(s.rawTime(i),this):this._tTime:this._tTime},t.revert=function(i){i===void 0&&(i=y1);var s=we;return we=i,gg(this)&&(this.timeline&&this.timeline.revert(i),this.totalTime(-.01,i.suppressEvents)),this.data!=="nested"&&i.kill!==!1&&this.kill(),we=s,this},t.globalTime=function(i){for(var s=this,r=arguments.length?i:s.rawTime();s;)r=s._start+r/(Math.abs(s._ts)||1),s=s._dp;return!this.parent&&this._sat?this._sat.globalTime(i):r},t.repeat=function(i){return arguments.length?(this._repeat=i===1/0?-2:i,iv(this)):this._repeat===-2?1/0:this._repeat},t.repeatDelay=function(i){if(arguments.length){var s=this._time;return this._rDelay=i,iv(this),s?this.time(s):this}return this._rDelay},t.yoyo=function(i){return arguments.length?(this._yoyo=i,this):this._yoyo},t.seek=function(i,s){return this.totalTime(Oi(this,i),Je(s))},t.restart=function(i,s){return this.play().totalTime(i?-this._delay:0,Je(s)),this._dur||(this._zTime=-qt),this},t.play=function(i,s){return i!=null&&this.seek(i,s),this.reversed(!1).paused(!1)},t.reverse=function(i,s){return i!=null&&this.seek(i||this.totalDuration(),s),this.reversed(!0).paused(!1)},t.pause=function(i,s){return i!=null&&this.seek(i,s),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(i){return arguments.length?(!!i!==this.reversed()&&this.timeScale(-this._rts||(i?-qt:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-qt,this},t.isActive=function(){var i=this.parent||this._dp,s=this._start,r;return!!(!i||this._ts&&this._initted&&i.isActive()&&(r=i.rawTime(!0))>=s&&r<this.endTime(!0)-qt)},t.eventCallback=function(i,s,r){var o=this.vars;return arguments.length>1?(s?(o[i]=s,r&&(o[i+"Params"]=r),i==="onUpdate"&&(this._onUpdate=s)):delete o[i],this):o[i]},t.then=function(i){var s=this;return new Promise(function(r){var o=ue(i)?i:aT,c=function(){var f=s.then;s.then=null,ue(o)&&(o=o(s))&&(o.then||o===s)&&(s.then=f),r(o),s.then=f};s._initted&&s.totalProgress()===1&&s._ts>=0||!s._tTime&&s._ts<0?c():s._prom=c})},t.kill=function(){Rl(this)},l}();Ei($l.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-qt,_prom:0,_ps:!1,_rts:1});var He=function(l){jE(t,l);function t(i,s){var r;return i===void 0&&(i={}),r=l.call(this,i)||this,r.labels={},r.smoothChildTiming=!!i.smoothChildTiming,r.autoRemoveChildren=!!i.autoRemoveChildren,r._sort=Je(i.sortChildren),ie&&ns(i.parent||ie,ws(r),s),i.reversed&&r.reverse(),i.paused&&r.paused(!0),i.scrollTrigger&&uT(ws(r),i.scrollTrigger),r}var e=t.prototype;return e.to=function(s,r,o){return Cl(0,arguments,this),this},e.from=function(s,r,o){return Cl(1,arguments,this),this},e.fromTo=function(s,r,o,c){return Cl(2,arguments,this),this},e.set=function(s,r,o){return r.duration=0,r.parent=this,Il(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new pe(s,r,Oi(this,o),1),this},e.call=function(s,r,o){return ns(this,pe.delayedCall(0,s,r),o)},e.staggerTo=function(s,r,o,c,h,f,g){return o.duration=r,o.stagger=o.stagger||c,o.onComplete=f,o.onCompleteParams=g,o.parent=this,new pe(s,o,Oi(this,h)),this},e.staggerFrom=function(s,r,o,c,h,f,g){return o.runBackwards=1,Il(o).immediateRender=Je(o.immediateRender),this.staggerTo(s,r,o,c,h,f,g)},e.staggerFromTo=function(s,r,o,c,h,f,g,m){return c.startAt=o,Il(c).immediateRender=Je(c.immediateRender),this.staggerTo(s,r,c,h,f,g,m)},e.render=function(s,r,o){var c=this._time,h=this._dirty?this.totalDuration():this._tDur,f=this._dur,g=s<=0?0:ye(s),m=this._zTime<0!=s<0&&(this._initted||!f),y,v,T,S,x,_,L,R,C,I,U,O;if(this!==ie&&g>h&&s>=0&&(g=h),g!==this._tTime||o||m){if(c!==this._time&&f&&(g+=this._time-c,s+=this._time-c),y=g,C=this._start,R=this._ts,_=!R,m&&(f||(c=this._zTime),(s||!r)&&(this._zTime=s)),this._repeat){if(U=this._yoyo,x=f+this._rDelay,this._repeat<-1&&s<0)return this.totalTime(x*100+s,r,o);if(y=ye(g%x),g===h?(S=this._repeat,y=f):(I=ye(g/x),S=~~I,S&&S===I&&(y=f,S--),y>f&&(y=f)),I=ma(this._tTime,x),!c&&this._tTime&&I!==S&&this._tTime-I*x-this._dur<=0&&(I=S),U&&S&1&&(y=f-y,O=1),S!==I&&!this._lock){var M=U&&I&1,w=M===(U&&S&1);if(S<I&&(M=!M),c=M?0:g%f?f:g,this._lock=1,this.render(c||(O?0:ye(S*x)),r,!f)._lock=0,this._tTime=g,!r&&this.parent&&gi(this,"onRepeat"),this.vars.repeatRefresh&&!O&&(this.invalidate()._lock=1),c&&c!==this._time||_!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(f=this._dur,h=this._tDur,w&&(this._lock=2,c=M?f:-1e-4,this.render(c,!0),this.vars.repeatRefresh&&!O&&this.invalidate()),this._lock=0,!this._ts&&!_)return this;AT(this,O)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(L=b1(this,ye(c),ye(y)),L&&(g-=y-(y=L._start))),this._tTime=g,this._time=y,this._act=!R,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=s,c=0),!c&&g&&!r&&!I&&(gi(this,"onStart"),this._tTime!==g))return this;if(y>=c&&s>=0)for(v=this._first;v;){if(T=v._next,(v._act||y>=v._start)&&v._ts&&L!==v){if(v.parent!==this)return this.render(s,r,o);if(v.render(v._ts>0?(y-v._start)*v._ts:(v._dirty?v.totalDuration():v._tDur)+(y-v._start)*v._ts,r,o),y!==this._time||!this._ts&&!_){L=0,T&&(g+=this._zTime=-qt);break}}v=T}else{v=this._last;for(var N=s<0?s:y;v;){if(T=v._prev,(v._act||N<=v._end)&&v._ts&&L!==v){if(v.parent!==this)return this.render(s,r,o);if(v.render(v._ts>0?(N-v._start)*v._ts:(v._dirty?v.totalDuration():v._tDur)+(N-v._start)*v._ts,r,o||we&&gg(v)),y!==this._time||!this._ts&&!_){L=0,T&&(g+=this._zTime=N?-qt:qt);break}}v=T}}if(L&&!r&&(this.pause(),L.render(y>=c?0:-qt)._zTime=y>=c?1:-1,this._ts))return this._start=C,gc(this),this.render(s,r,o);this._onUpdate&&!r&&gi(this,"onUpdate",!0),(g===h&&this._tTime>=this.totalDuration()||!g&&c)&&(C===this._start||Math.abs(R)!==Math.abs(this._ts))&&(this._lock||((s||!f)&&(g===h&&this._ts>0||!g&&this._ts<0)&&xn(this,1),!r&&!(s<0&&!c)&&(g||c||!h)&&(gi(this,g===h&&s>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(g<h&&this.timeScale()>0)&&this._prom())))}return this},e.add=function(s,r){var o=this;if($s(r)||(r=Oi(this,r,s)),!(s instanceof $l)){if($e(s))return s.forEach(function(c){return o.add(c,r)}),this;if(De(s))return this.addLabel(s,r);if(ue(s))s=pe.delayedCall(0,s);else return this}return this!==s?ns(this,s,r):this},e.getChildren=function(s,r,o,c){s===void 0&&(s=!0),r===void 0&&(r=!0),o===void 0&&(o=!0),c===void 0&&(c=-ki);for(var h=[],f=this._first;f;)f._start>=c&&(f instanceof pe?r&&h.push(f):(o&&h.push(f),s&&h.push.apply(h,f.getChildren(!0,r,o)))),f=f._next;return h},e.getById=function(s){for(var r=this.getChildren(1,1,1),o=r.length;o--;)if(r[o].vars.id===s)return r[o]},e.remove=function(s){return De(s)?this.removeLabel(s):ue(s)?this.killTweensOf(s):(s.parent===this&&dc(this,s),s===this._recent&&(this._recent=this._last),nr(this))},e.totalTime=function(s,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=ye(di.time-(this._ts>0?s/this._ts:(this.totalDuration()-s)/-this._ts))),l.prototype.totalTime.call(this,s,r),this._forcing=0,this):this._tTime},e.addLabel=function(s,r){return this.labels[s]=Oi(this,r),this},e.removeLabel=function(s){return delete this.labels[s],this},e.addPause=function(s,r,o){var c=pe.delayedCall(0,r||Ul,o);return c.data="isPause",this._hasPause=1,ns(this,c,Oi(this,s))},e.removePause=function(s){var r=this._first;for(s=Oi(this,s);r;)r._start===s&&r.data==="isPause"&&xn(r),r=r._next},e.killTweensOf=function(s,r,o){for(var c=this.getTweensOf(s,o),h=c.length;h--;)yn!==c[h]&&c[h].kill(s,r);return this},e.getTweensOf=function(s,r){for(var o=[],c=Mi(s),h=this._first,f=$s(r),g;h;)h instanceof pe?v1(h._targets,c)&&(f?(!yn||h._initted&&h._ts)&&h.globalTime(0)<=r&&h.globalTime(h.totalDuration())>r:!r||h.isActive())&&o.push(h):(g=h.getTweensOf(c,r)).length&&o.push.apply(o,g),h=h._next;return o},e.tweenTo=function(s,r){r=r||{};var o=this,c=Oi(o,s),h=r,f=h.startAt,g=h.onStart,m=h.onStartParams,y=h.immediateRender,v,T=pe.to(o,Ei({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:c,overwrite:"auto",duration:r.duration||Math.abs((c-(f&&"time"in f?f.time:o._time))/o.timeScale())||qt,onStart:function(){if(o.pause(),!v){var x=r.duration||Math.abs((c-(f&&"time"in f?f.time:o._time))/o.timeScale());T._dur!==x&&pa(T,x,0,1).render(T._time,!0,!0),v=1}g&&g.apply(T,m||[])}},r));return y?T.render(0):T},e.tweenFromTo=function(s,r,o){return this.tweenTo(r,Ei({startAt:{time:Oi(this,s)}},o))},e.recent=function(){return this._recent},e.nextLabel=function(s){return s===void 0&&(s=this._time),sv(this,Oi(this,s))},e.previousLabel=function(s){return s===void 0&&(s=this._time),sv(this,Oi(this,s),1)},e.currentLabel=function(s){return arguments.length?this.seek(s,!0):this.previousLabel(this._time+qt)},e.shiftChildren=function(s,r,o){o===void 0&&(o=0);for(var c=this._first,h=this.labels,f;c;)c._start>=o&&(c._start+=s,c._end+=s),c=c._next;if(r)for(f in h)h[f]>=o&&(h[f]+=s);return nr(this)},e.invalidate=function(s){var r=this._first;for(this._lock=0;r;)r.invalidate(s),r=r._next;return l.prototype.invalidate.call(this,s)},e.clear=function(s){s===void 0&&(s=!0);for(var r=this._first,o;r;)o=r._next,this.remove(r),r=o;return this._dp&&(this._time=this._tTime=this._pTime=0),s&&(this.labels={}),nr(this)},e.totalDuration=function(s){var r=0,o=this,c=o._last,h=ki,f,g,m;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-s:s));if(o._dirty){for(m=o.parent;c;)f=c._prev,c._dirty&&c.totalDuration(),g=c._start,g>h&&o._sort&&c._ts&&!o._lock?(o._lock=1,ns(o,c,g-c._delay,1)._lock=0):h=g,g<0&&c._ts&&(r-=g,(!m&&!o._dp||m&&m.smoothChildTiming)&&(o._start+=g/o._ts,o._time-=g,o._tTime-=g),o.shiftChildren(-g,!1,-1/0),h=0),c._end>r&&c._ts&&(r=c._end),c=f;pa(o,o===ie&&o._time>r?o._time:r,1,1),o._dirty=0}return o._tDur},t.updateRoot=function(s){if(ie._ts&&(nT(ie,Wu(s,ie)),iT=di.frame),di.frame>=Jy){Jy+=pi.autoSleep||120;var r=ie._first;if((!r||!r._ts)&&pi.autoSleep&&di._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||di.sleep()}}},t}($l);Ei(He.prototype,{_lock:0,_hasPause:0,_forcing:0});var G1=function(t,e,i,s,r,o,c){var h=new ei(this._pt,t,e,0,1,wT,null,r),f=0,g=0,m,y,v,T,S,x,_,L;for(h.b=i,h.e=s,i+="",s+="",(_=~s.indexOf("random("))&&(s=Bl(s)),o&&(L=[i,s],o(L,t,e),i=L[0],s=L[1]),y=i.match($h)||[];m=$h.exec(s);)T=m[0],S=s.substring(f,m.index),v?v=(v+1)%5:S.substr(-5)==="rgba("&&(v=1),T!==y[g++]&&(x=parseFloat(y[g-1])||0,h._pt={_next:h._pt,p:S||g===1?S:",",s:x,c:T.charAt(1)==="="?la(x,T)-x:parseFloat(T)-x,m:v&&v<4?Math.round:0},f=$h.lastIndex);return h.c=f<s.length?s.substring(f,s.length):"",h.fp=c,(WE.test(s)||_)&&(h.e=0),this._pt=h,h},mg=function(t,e,i,s,r,o,c,h,f,g){ue(s)&&(s=s(r||0,t,o));var m=t[e],y=i!=="get"?i:ue(m)?f?t[e.indexOf("set")||!ue(t["get"+e.substr(3)])?e:"get"+e.substr(3)](f):t[e]():m,v=ue(m)?f?Y1:CT:yg,T;if(De(s)&&(~s.indexOf("random(")&&(s=Bl(s)),s.charAt(1)==="="&&(T=la(y,s)+(Fe(y)||0),(T||T===0)&&(s=T))),!g||y!==s||Id)return!isNaN(y*s)&&s!==""?(T=new ei(this._pt,t,e,+y||0,s-(y||0),typeof m=="boolean"?q1:OT,0,v),f&&(T.fp=f),c&&T.modifier(c,this,t),this._pt=T):(!m&&!(e in t)&&cg(e,s),G1.call(this,t,e,y,s,v,h||pi.stringFilter,f))},H1=function(t,e,i,s,r){if(ue(t)&&(t=Ol(t,r,e,i,s)),!us(t)||t.style&&t.nodeType||$e(t)||XE(t))return De(t)?Ol(t,r,e,i,s):t;var o={},c;for(c in t)o[c]=Ol(t[c],r,e,i,s);return o},LT=function(t,e,i,s,r,o){var c,h,f,g;if(fi[t]&&(c=new fi[t]).init(r,c.rawVars?e[t]:H1(e[t],s,r,o,i),i,s,o)!==!1&&(i._pt=h=new ei(i._pt,r,t,0,1,c.render,c,0,c.priority),i!==ra))for(f=i._ptLookup[i._targets.indexOf(r)],g=c._props.length;g--;)f[c._props[g]]=h;return c},yn,Id,pg=function l(t,e,i){var s=t.vars,r=s.ease,o=s.startAt,c=s.immediateRender,h=s.lazy,f=s.onUpdate,g=s.runBackwards,m=s.yoyoEase,y=s.keyframes,v=s.autoRevert,T=t._dur,S=t._startAt,x=t._targets,_=t.parent,L=_&&_.data==="nested"?_.vars.targets:x,R=t._overwrite==="auto"&&!ag,C=t.timeline,I,U,O,M,w,N,z,J,lt,ct,at,B,q;if(C&&(!y||!r)&&(r="none"),t._ease=rr(r,da.ease),t._yEase=m?_T(rr(m===!0?r:m,da.ease)):0,m&&t._yoyo&&!t._repeat&&(m=t._yEase,t._yEase=t._ease,t._ease=m),t._from=!C&&!!s.runBackwards,!C||y&&!s.stagger){if(J=x[0]?sr(x[0]).harness:0,B=J&&s[J.prop],I=Qu(s,fg),S&&(S._zTime<0&&S.progress(1),e<0&&g&&c&&!v?S.render(-1,!0):S.revert(g&&T?Nu:p1),S._lazy=0),o){if(xn(t._startAt=pe.set(x,Ei({data:"isStart",overwrite:!1,parent:_,immediateRender:!0,lazy:!S&&Je(h),startAt:null,delay:0,onUpdate:f&&function(){return gi(t,"onUpdate")},stagger:0},o))),t._startAt._dp=0,t._startAt._sat=t,e<0&&(we||!c&&!v)&&t._startAt.revert(Nu),c&&T&&e<=0&&i<=0){e&&(t._zTime=e);return}}else if(g&&T&&!S){if(e&&(c=!1),O=Ei({overwrite:!1,data:"isFromStart",lazy:c&&!S&&Je(h),immediateRender:c,stagger:0,parent:_},I),B&&(O[J.prop]=B),xn(t._startAt=pe.set(x,O)),t._startAt._dp=0,t._startAt._sat=t,e<0&&(we?t._startAt.revert(Nu):t._startAt.render(-1,!0)),t._zTime=e,!c)l(t._startAt,qt,qt);else if(!e)return}for(t._pt=t._ptCache=0,h=T&&Je(h)||h&&!T,U=0;U<x.length;U++){if(w=x[U],z=w._gsap||dg(x)[U]._gsap,t._ptLookup[U]=ct={},_d[z.id]&&Tn.length&&Xu(),at=L===x?U:L.indexOf(w),J&&(lt=new J).init(w,B||I,t,at,L)!==!1&&(t._pt=M=new ei(t._pt,w,lt.name,0,1,lt.render,lt,0,lt.priority),lt._props.forEach(function(W){ct[W]=M}),lt.priority&&(N=1)),!J||B)for(O in I)fi[O]&&(lt=LT(O,I,t,at,w,L))?lt.priority&&(N=1):ct[O]=M=mg.call(t,w,O,"get",I[O],at,L,0,s.stringFilter);t._op&&t._op[U]&&t.kill(w,t._op[U]),R&&t._pt&&(yn=t,ie.killTweensOf(w,ct,t.globalTime(e)),q=!t.parent,yn=0),t._pt&&h&&(_d[z.id]=1)}N&&kT(t),t._onInit&&t._onInit(t)}t._onUpdate=f,t._initted=(!t._op||t._pt)&&!q,y&&e<=0&&C.render(ki,!0,!0)},V1=function(t,e,i,s,r,o,c,h){var f=(t._pt&&t._ptCache||(t._ptCache={}))[e],g,m,y,v;if(!f)for(f=t._ptCache[e]=[],y=t._ptLookup,v=t._targets.length;v--;){if(g=y[v][e],g&&g.d&&g.d._pt)for(g=g.d._pt;g&&g.p!==e&&g.fp!==e;)g=g._next;if(!g)return Id=1,t.vars[e]="+=0",pg(t,c),Id=0,h?Nl(e+" not eligible for reset"):1;f.push(g)}for(v=f.length;v--;)m=f[v],g=m._pt||m,g.s=(s||s===0)&&!r?s:g.s+(s||0)+o*g.c,g.c=i-g.s,m.e&&(m.e=de(i)+Fe(m.e)),m.b&&(m.b=g.s+Fe(m.b))},K1=function(t,e){var i=t[0]?sr(t[0]).harness:0,s=i&&i.aliases,r,o,c,h;if(!s)return e;r=ga({},e);for(o in s)if(o in r)for(h=s[o].split(","),c=h.length;c--;)r[h[c]]=r[o];return r},z1=function(t,e,i,s){var r=e.ease||s||"power1.inOut",o,c;if($e(e))c=i[t]||(i[t]=[]),e.forEach(function(h,f){return c.push({t:f/(e.length-1)*100,v:h,e:r})});else for(o in e)c=i[o]||(i[o]=[]),o==="ease"||c.push({t:parseFloat(t),v:e[o],e:r})},Ol=function(t,e,i,s,r){return ue(t)?t.call(e,i,s,r):De(t)&&~t.indexOf("random(")?Bl(t):t},DT=hg+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",IT={};ti(DT+",id,stagger,delay,duration,paused,scrollTrigger",function(l){return IT[l]=1});var pe=function(l){jE(t,l);function t(i,s,r,o){var c;typeof s=="number"&&(r.duration=s,s=r,r=null),c=l.call(this,o?s:Il(s))||this;var h=c.vars,f=h.duration,g=h.delay,m=h.immediateRender,y=h.stagger,v=h.overwrite,T=h.keyframes,S=h.defaults,x=h.scrollTrigger,_=h.yoyoEase,L=s.parent||ie,R=($e(i)||XE(i)?$s(i[0]):"length"in s)?[i]:Mi(i),C,I,U,O,M,w,N,z;if(c._targets=R.length?dg(R):Nl("GSAP target "+i+" not found. https://gsap.com",!pi.nullTargetWarn)||[],c._ptLookup=[],c._overwrite=v,T||y||yu(f)||yu(g)){if(s=c.vars,C=c.timeline=new He({data:"nested",defaults:S||{},targets:L&&L.data==="nested"?L.vars.targets:R}),C.kill(),C.parent=C._dp=ws(c),C._start=0,y||yu(f)||yu(g)){if(O=R.length,N=y&&dT(y),us(y))for(M in y)~DT.indexOf(M)&&(z||(z={}),z[M]=y[M]);for(I=0;I<O;I++)U=Qu(s,IT),U.stagger=0,_&&(U.yoyoEase=_),z&&ga(U,z),w=R[I],U.duration=+Ol(f,ws(c),I,w,R),U.delay=(+Ol(g,ws(c),I,w,R)||0)-c._delay,!y&&O===1&&U.delay&&(c._delay=g=U.delay,c._start+=g,U.delay=0),C.to(w,U,N?N(I,w,R):0),C._ease=Ot.none;C.duration()?f=g=0:c.timeline=0}else if(T){Il(Ei(C.vars.defaults,{ease:"none"})),C._ease=rr(T.ease||s.ease||"none");var J=0,lt,ct,at;if($e(T))T.forEach(function(B){return C.to(R,B,">")}),C.duration();else{U={};for(M in T)M==="ease"||M==="easeEach"||z1(M,T[M],U,T.easeEach);for(M in U)for(lt=U[M].sort(function(B,q){return B.t-q.t}),J=0,I=0;I<lt.length;I++)ct=lt[I],at={ease:ct.e,duration:(ct.t-(I?lt[I-1].t:0))/100*f},at[M]=ct.v,C.to(R,at,J),J+=at.duration;C.duration()<f&&C.to({},{duration:f-C.duration()})}}f||c.duration(f=C.duration())}else c.timeline=0;return v===!0&&!ag&&(yn=ws(c),ie.killTweensOf(R),yn=0),ns(L,ws(c),r),s.reversed&&c.reverse(),s.paused&&c.paused(!0),(m||!f&&!T&&c._start===ye(L._time)&&Je(m)&&x1(ws(c))&&L.data!=="nested")&&(c._tTime=-qt,c.render(Math.max(0,-g)||0)),x&&uT(ws(c),x),c}var e=t.prototype;return e.render=function(s,r,o){var c=this._time,h=this._tDur,f=this._dur,g=s<0,m=s>h-qt&&!g?h:s<qt?0:s,y,v,T,S,x,_,L,R,C;if(!f)A1(this,s,r,o);else if(m!==this._tTime||!s||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==g||this._lazy){if(y=m,R=this.timeline,this._repeat){if(S=f+this._rDelay,this._repeat<-1&&g)return this.totalTime(S*100+s,r,o);if(y=ye(m%S),m===h?(T=this._repeat,y=f):(x=ye(m/S),T=~~x,T&&T===x?(y=f,T--):y>f&&(y=f)),_=this._yoyo&&T&1,_&&(C=this._yEase,y=f-y),x=ma(this._tTime,S),y===c&&!o&&this._initted&&T===x)return this._tTime=m,this;T!==x&&(R&&this._yEase&&AT(R,_),this.vars.repeatRefresh&&!_&&!this._lock&&y!==S&&this._initted&&(this._lock=o=1,this.render(ye(S*T),!0).invalidate()._lock=0))}if(!this._initted){if(cT(this,g?s:y,o,r,m))return this._tTime=0,this;if(c!==this._time&&!(o&&this.vars.repeatRefresh&&T!==x))return this;if(f!==this._dur)return this.render(s,r,o)}if(this._tTime=m,this._time=y,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=L=(C||this._ease)(y/f),this._from&&(this.ratio=L=1-L),!c&&m&&!r&&!x&&(gi(this,"onStart"),this._tTime!==m))return this;for(v=this._pt;v;)v.r(L,v.d),v=v._next;R&&R.render(s<0?s:R._dur*R._ease(y/this._dur),r,o)||this._startAt&&(this._zTime=s),this._onUpdate&&!r&&(g&&Ad(this,s,r,o),gi(this,"onUpdate")),this._repeat&&T!==x&&this.vars.onRepeat&&!r&&this.parent&&gi(this,"onRepeat"),(m===this._tDur||!m)&&this._tTime===m&&(g&&!this._onUpdate&&Ad(this,s,!0,!0),(s||!f)&&(m===this._tDur&&this._ts>0||!m&&this._ts<0)&&xn(this,1),!r&&!(g&&!c)&&(m||c||_)&&(gi(this,m===h?"onComplete":"onReverseComplete",!0),this._prom&&!(m<h&&this.timeScale()>0)&&this._prom()))}return this},e.targets=function(){return this._targets},e.invalidate=function(s){return(!s||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(s),l.prototype.invalidate.call(this,s)},e.resetTo=function(s,r,o,c,h){Fl||di.wake(),this._ts||this.play();var f=Math.min(this._dur,(this._dp._time-this._start)*this._ts),g;return this._initted||pg(this,f),g=this._ease(f/this._dur),V1(this,s,r,o,c,g,f,h)?this.resetTo(s,r,o,c,1):(mc(this,0),this.parent||lT(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},e.kill=function(s,r){if(r===void 0&&(r="all"),!s&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?Rl(this):this.scrollTrigger&&this.scrollTrigger.kill(!!we),this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(s,r,yn&&yn.vars.overwrite!==!0)._first||Rl(this),this.parent&&o!==this.timeline.totalDuration()&&pa(this,this._dur*this.timeline._tDur/o,0,1),this}var c=this._targets,h=s?Mi(s):c,f=this._ptLookup,g=this._pt,m,y,v,T,S,x,_;if((!r||r==="all")&&T1(c,h))return r==="all"&&(this._pt=0),Rl(this);for(m=this._op=this._op||[],r!=="all"&&(De(r)&&(S={},ti(r,function(L){return S[L]=1}),r=S),r=K1(c,r)),_=c.length;_--;)if(~h.indexOf(c[_])){y=f[_],r==="all"?(m[_]=r,T=y,v={}):(v=m[_]=m[_]||{},T=r);for(S in T)x=y&&y[S],x&&((!("kill"in x.d)||x.d.kill(S)===!0)&&dc(this,x,"_pt"),delete y[S]),v!=="all"&&(v[S]=1)}return this._initted&&!this._pt&&g&&Rl(this),this},t.to=function(s,r){return new t(s,r,arguments[2])},t.from=function(s,r){return Cl(1,arguments)},t.delayedCall=function(s,r,o,c){return new t(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:s,onComplete:r,onReverseComplete:r,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:c})},t.fromTo=function(s,r,o){return Cl(2,arguments)},t.set=function(s,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new t(s,r)},t.killTweensOf=function(s,r,o){return ie.killTweensOf(s,r,o)},t}($l);Ei(pe.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});ti("staggerTo,staggerFrom,staggerFromTo",function(l){pe[l]=function(){var t=new He,e=Rd.call(arguments,0);return e.splice(l==="staggerFromTo"?5:4,0,0),t[l].apply(t,e)}});var yg=function(t,e,i){return t[e]=i},CT=function(t,e,i){return t[e](i)},Y1=function(t,e,i,s){return t[e](s.fp,i)},j1=function(t,e,i){return t.setAttribute(e,i)},vg=function(t,e){return ue(t[e])?CT:lg(t[e])&&t.setAttribute?j1:yg},OT=function(t,e){return e.set(e.t,e.p,Math.round((e.s+e.c*t)*1e6)/1e6,e)},q1=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},wT=function(t,e){var i=e._pt,s="";if(!t&&e.b)s=e.b;else if(t===1&&e.e)s=e.e;else{for(;i;)s=i.p+(i.m?i.m(i.s+i.c*t):Math.round((i.s+i.c*t)*1e4)/1e4)+s,i=i._next;s+=e.c}e.set(e.t,e.p,s,e)},Eg=function(t,e){for(var i=e._pt;i;)i.r(t,i.d),i=i._next},X1=function(t,e,i,s){for(var r=this._pt,o;r;)o=r._next,r.p===s&&r.modifier(t,e,i),r=o},Q1=function(t){for(var e=this._pt,i,s;e;)s=e._next,e.p===t&&!e.op||e.op===t?dc(this,e,"_pt"):e.dep||(i=1),e=s;return!i},W1=function(t,e,i,s){s.mSet(t,e,s.m.call(s.tween,i,s.mt),s)},kT=function(t){for(var e=t._pt,i,s,r,o;e;){for(i=e._next,s=r;s&&s.pr>e.pr;)s=s._next;(e._prev=s?s._prev:o)?e._prev._next=e:r=e,(e._next=s)?s._prev=e:o=e,e=i}t._pt=r},ei=function(){function l(e,i,s,r,o,c,h,f,g){this.t=i,this.s=r,this.c=o,this.p=s,this.r=c||OT,this.d=h||this,this.set=f||yg,this.pr=g||0,this._next=e,e&&(e._prev=this)}var t=l.prototype;return t.modifier=function(i,s,r){this.mSet=this.mSet||this.set,this.set=W1,this.m=i,this.mt=r,this.tween=s},l}();ti(hg+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(l){return fg[l]=1});vi.TweenMax=vi.TweenLite=pe;vi.TimelineLite=vi.TimelineMax=He;ie=new He({sortChildren:!1,defaults:da,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});pi.stringFilter=xT;var ar=[],Bu={},Z1=[],rv=0,J1=0,zh=function(t){return(Bu[t]||Z1).map(function(e){return e()})},Cd=function(){var t=Date.now(),e=[];t-rv>2&&(zh("matchMediaInit"),ar.forEach(function(i){var s=i.queries,r=i.conditions,o,c,h,f;for(c in s)o=is.matchMedia(s[c]).matches,o&&(h=1),o!==r[c]&&(r[c]=o,f=1);f&&(i.revert(),h&&e.push(i))}),zh("matchMediaRevert"),e.forEach(function(i){return i.onMatch(i,function(s){return i.add(null,s)})}),rv=t,zh("matchMedia"))},MT=function(){function l(e,i){this.selector=i&&Ld(i),this.data=[],this._r=[],this.isReverted=!1,this.id=J1++,e&&this.add(e)}var t=l.prototype;return t.add=function(i,s,r){ue(i)&&(r=s,s=i,i=ue);var o=this,c=function(){var f=Jt,g=o.selector,m;return f&&f!==o&&f.data.push(o),r&&(o.selector=Ld(r)),Jt=o,m=s.apply(o,arguments),ue(m)&&o._r.push(m),Jt=f,o.selector=g,o.isReverted=!1,m};return o.last=c,i===ue?c(o,function(h){return o.add(null,h)}):i?o[i]=c:c},t.ignore=function(i){var s=Jt;Jt=null,i(this),Jt=s},t.getTweens=function(){var i=[];return this.data.forEach(function(s){return s instanceof l?i.push.apply(i,s.getTweens()):s instanceof pe&&!(s.parent&&s.parent.data==="nested")&&i.push(s)}),i},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(i,s){var r=this;if(i?function(){for(var c=r.getTweens(),h=r.data.length,f;h--;)f=r.data[h],f.data==="isFlip"&&(f.revert(),f.getChildren(!0,!0,!1).forEach(function(g){return c.splice(c.indexOf(g),1)}));for(c.map(function(g){return{g:g._dur||g._delay||g._sat&&!g._sat.vars.immediateRender?g.globalTime(0):-1/0,t:g}}).sort(function(g,m){return m.g-g.g||-1/0}).forEach(function(g){return g.t.revert(i)}),h=r.data.length;h--;)f=r.data[h],f instanceof He?f.data!=="nested"&&(f.scrollTrigger&&f.scrollTrigger.revert(),f.kill()):!(f instanceof pe)&&f.revert&&f.revert(i);r._r.forEach(function(g){return g(i,r)}),r.isReverted=!0}():this.data.forEach(function(c){return c.kill&&c.kill()}),this.clear(),s)for(var o=ar.length;o--;)ar[o].id===this.id&&ar.splice(o,1)},t.revert=function(i){this.kill(i||{})},l}(),tR=function(){function l(e){this.contexts=[],this.scope=e,Jt&&Jt.data.push(this)}var t=l.prototype;return t.add=function(i,s,r){us(i)||(i={matches:i});var o=new MT(0,r||this.scope),c=o.conditions={},h,f,g;Jt&&!o.selector&&(o.selector=Jt.selector),this.contexts.push(o),s=o.add("onMatch",s),o.queries=i;for(f in i)f==="all"?g=1:(h=is.matchMedia(i[f]),h&&(ar.indexOf(o)<0&&ar.push(o),(c[f]=h.matches)&&(g=1),h.addListener?h.addListener(Cd):h.addEventListener("change",Cd)));return g&&s(o,function(m){return o.add(null,m)}),this},t.revert=function(i){this.kill(i||{})},t.kill=function(i){this.contexts.forEach(function(s){return s.kill(i,!0)})},l}(),Zu={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach(function(s){return ET(s)})},timeline:function(t){return new He(t)},getTweensOf:function(t,e){return ie.getTweensOf(t,e)},getProperty:function(t,e,i,s){De(t)&&(t=Mi(t)[0]);var r=sr(t||{}).get,o=i?aT:rT;return i==="native"&&(i=""),t&&(e?o((fi[e]&&fi[e].get||r)(t,e,i,s)):function(c,h,f){return o((fi[c]&&fi[c].get||r)(t,c,h,f))})},quickSetter:function(t,e,i){if(t=Mi(t),t.length>1){var s=t.map(function(g){return si.quickSetter(g,e,i)}),r=s.length;return function(g){for(var m=r;m--;)s[m](g)}}t=t[0]||{};var o=fi[e],c=sr(t),h=c.harness&&(c.harness.aliases||{})[e]||e,f=o?function(g){var m=new o;ra._pt=0,m.init(t,i?g+i:g,ra,0,[t]),m.render(1,m),ra._pt&&Eg(1,ra)}:c.set(t,h);return o?f:function(g){return f(t,h,i?g+i:g,c,1)}},quickTo:function(t,e,i){var s,r=si.to(t,Ei((s={},s[e]="+=0.1",s.paused=!0,s.stagger=0,s),i||{})),o=function(h,f,g){return r.resetTo(e,h,f,g)};return o.tween=r,o},isTweening:function(t){return ie.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=rr(t.ease,da.ease)),tv(da,t||{})},config:function(t){return tv(pi,t||{})},registerEffect:function(t){var e=t.name,i=t.effect,s=t.plugins,r=t.defaults,o=t.extendTimeline;(s||"").split(",").forEach(function(c){return c&&!fi[c]&&!vi[c]&&Nl(e+" effect requires "+c+" plugin.")}),Gh[e]=function(c,h,f){return i(Mi(c),Ei(h||{},r),f)},o&&(He.prototype[e]=function(c,h,f){return this.add(Gh[e](c,us(h)?h:(f=h)&&{},this),f)})},registerEase:function(t,e){Ot[t]=rr(e)},parseEase:function(t,e){return arguments.length?rr(t,e):Ot},getById:function(t){return ie.getById(t)},exportRoot:function(t,e){t===void 0&&(t={});var i=new He(t),s,r;for(i.smoothChildTiming=Je(t.smoothChildTiming),ie.remove(i),i._dp=0,i._time=i._tTime=ie._time,s=ie._first;s;)r=s._next,(e||!(!s._dur&&s instanceof pe&&s.vars.onComplete===s._targets[0]))&&ns(i,s,s._start-s._delay),s=r;return ns(ie,i,0),i},context:function(t,e){return t?new MT(t,e):Jt},matchMedia:function(t){return new tR(t)},matchMediaRefresh:function(){return ar.forEach(function(t){var e=t.conditions,i,s;for(s in e)e[s]&&(e[s]=!1,i=1);i&&t.revert()})||Cd()},addEventListener:function(t,e){var i=Bu[t]||(Bu[t]=[]);~i.indexOf(e)||i.push(e)},removeEventListener:function(t,e){var i=Bu[t],s=i&&i.indexOf(e);s>=0&&i.splice(s,1)},utils:{wrap:w1,wrapYoyo:k1,distribute:dT,random:mT,snap:gT,normalize:O1,getUnit:Fe,clamp:L1,splitColor:TT,toArray:Mi,selector:Ld,mapRange:yT,pipe:I1,unitize:C1,interpolate:M1,shuffle:hT},install:tT,effects:Gh,ticker:di,updateRoot:He.updateRoot,plugins:fi,globalTimeline:ie,core:{PropTween:ei,globals:eT,Tween:pe,Timeline:He,Animation:$l,getCache:sr,_removeLinkedListItem:dc,reverting:function(){return we},context:function(t){return t&&Jt&&(Jt.data.push(t),t._ctx=Jt),Jt},suppressOverwrites:function(t){return ag=t}}};ti("to,from,fromTo,delayedCall,set,killTweensOf",function(l){return Zu[l]=pe[l]});di.add(He.updateRoot);ra=Zu.to({},{duration:0});var eR=function(t,e){for(var i=t._pt;i&&i.p!==e&&i.op!==e&&i.fp!==e;)i=i._next;return i},iR=function(t,e){var i=t._targets,s,r,o;for(s in e)for(r=i.length;r--;)o=t._ptLookup[r][s],o&&(o=o.d)&&(o._pt&&(o=eR(o,s)),o&&o.modifier&&o.modifier(e[s],t,i[r],s))},Yh=function(t,e){return{name:t,headless:1,rawVars:1,init:function(s,r,o){o._onInit=function(c){var h,f;if(De(r)&&(h={},ti(r,function(g){return h[g]=1}),r=h),e){h={};for(f in r)h[f]=e(r[f]);r=h}iR(c,r)}}}},si=Zu.registerPlugin({name:"attr",init:function(t,e,i,s,r){var o,c,h;this.tween=i;for(o in e)h=t.getAttribute(o)||"",c=this.add(t,"setAttribute",(h||0)+"",e[o],s,r,0,0,o),c.op=o,c.b=h,this._props.push(o)},render:function(t,e){for(var i=e._pt;i;)we?i.set(i.t,i.p,i.b,i):i.r(t,i.d),i=i._next}},{name:"endArray",headless:1,init:function(t,e){for(var i=e.length;i--;)this.add(t,i,t[i]||0,e[i],0,0,0,0,0,1)}},Yh("roundProps",Dd),Yh("modifiers"),Yh("snap",gT))||Zu;pe.version=He.version=si.version="3.13.0";JE=1;og()&&ya();Ot.Power0;Ot.Power1;Ot.Power2;Ot.Power3;Ot.Power4;Ot.Linear;Ot.Quad;Ot.Cubic;Ot.Quart;Ot.Quint;Ot.Strong;Ot.Elastic;Ot.Back;Ot.SteppedEase;Ot.Bounce;Ot.Sine;Ot.Expo;Ot.Circ;/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var av,vn,oa,Tg,ir,lv,Sg,sR=function(){return typeof window<"u"},Gs={},tr=180/Math.PI,ua=Math.PI/180,Zr=Math.atan2,ov=1e8,xg=/([A-Z])/g,nR=/(left|right|width|margin|padding|x)/i,rR=/[\s,\(]\S/,rs={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Od=function(t,e){return e.set(e.t,e.p,Math.round((e.s+e.c*t)*1e4)/1e4+e.u,e)},aR=function(t,e){return e.set(e.t,e.p,t===1?e.e:Math.round((e.s+e.c*t)*1e4)/1e4+e.u,e)},lR=function(t,e){return e.set(e.t,e.p,t?Math.round((e.s+e.c*t)*1e4)/1e4+e.u:e.b,e)},oR=function(t,e){var i=e.s+e.c*t;e.set(e.t,e.p,~~(i+(i<0?-.5:.5))+e.u,e)},PT=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},NT=function(t,e){return e.set(e.t,e.p,t!==1?e.b:e.e,e)},uR=function(t,e,i){return t.style[e]=i},cR=function(t,e,i){return t.style.setProperty(e,i)},fR=function(t,e,i){return t._gsap[e]=i},hR=function(t,e,i){return t._gsap.scaleX=t._gsap.scaleY=i},dR=function(t,e,i,s,r){var o=t._gsap;o.scaleX=o.scaleY=i,o.renderTransform(r,o)},gR=function(t,e,i,s,r){var o=t._gsap;o[e]=i,o.renderTransform(r,o)},se="transform",ii=se+"Origin",mR=function l(t,e){var i=this,s=this.target,r=s.style,o=s._gsap;if(t in Gs&&r){if(this.tfm=this.tfm||{},t!=="transform")t=rs[t]||t,~t.indexOf(",")?t.split(",").forEach(function(c){return i.tfm[c]=Ns(s,c)}):this.tfm[t]=o.x?o[t]:Ns(s,t),t===ii&&(this.tfm.zOrigin=o.zOrigin);else return rs.transform.split(",").forEach(function(c){return l.call(i,c,e)});if(this.props.indexOf(se)>=0)return;o.svg&&(this.svgo=s.getAttribute("data-svg-origin"),this.props.push(ii,e,"")),t=se}(r||e)&&this.props.push(t,e,r[t])},UT=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},pR=function(){var t=this.props,e=this.target,i=e.style,s=e._gsap,r,o;for(r=0;r<t.length;r+=3)t[r+1]?t[r+1]===2?e[t[r]](t[r+2]):e[t[r]]=t[r+2]:t[r+2]?i[t[r]]=t[r+2]:i.removeProperty(t[r].substr(0,2)==="--"?t[r]:t[r].replace(xg,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)s[o]=this.tfm[o];s.svg&&(s.renderTransform(),e.setAttribute("data-svg-origin",this.svgo||"")),r=Sg(),(!r||!r.isStart)&&!i[se]&&(UT(i),s.zOrigin&&i[ii]&&(i[ii]+=" "+s.zOrigin+"px",s.zOrigin=0,s.renderTransform()),s.uncache=1)}},BT=function(t,e){var i={target:t,props:[],revert:pR,save:mR};return t._gsap||si.core.getCache(t),e&&t.style&&t.nodeType&&e.split(",").forEach(function(s){return i.save(s)}),i},FT,wd=function(t,e){var i=vn.createElementNS?vn.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):vn.createElement(t);return i&&i.style?i:vn.createElement(t)},Pi=function l(t,e,i){var s=getComputedStyle(t);return s[e]||s.getPropertyValue(e.replace(xg,"-$1").toLowerCase())||s.getPropertyValue(e)||!i&&l(t,va(e)||e,1)||""},uv="O,Moz,ms,Ms,Webkit".split(","),va=function(t,e,i){var s=e||ir,r=s.style,o=5;if(t in r&&!i)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);o--&&!(uv[o]+t in r););return o<0?null:(o===3?"ms":o>=0?uv[o]:"")+t},kd=function(){sR()&&window.document&&(av=window,vn=av.document,oa=vn.documentElement,ir=wd("div")||{style:{}},wd("div"),se=va(se),ii=se+"Origin",ir.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",FT=!!va("perspective"),Sg=si.core.reverting,Tg=1)},cv=function(t){var e=t.ownerSVGElement,i=wd("svg",e&&e.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=t.cloneNode(!0),r;s.style.display="block",i.appendChild(s),oa.appendChild(i);try{r=s.getBBox()}catch{}return i.removeChild(s),oa.removeChild(i),r},fv=function(t,e){for(var i=e.length;i--;)if(t.hasAttribute(e[i]))return t.getAttribute(e[i])},$T=function(t){var e,i;try{e=t.getBBox()}catch{e=cv(t),i=1}return e&&(e.width||e.height)||i||(e=cv(t)),e&&!e.width&&!e.x&&!e.y?{x:+fv(t,["x","cx","x1"])||0,y:+fv(t,["y","cy","y1"])||0,width:0,height:0}:e},GT=function(t){return!!(t.getCTM&&(!t.parentNode||t.ownerSVGElement)&&$T(t))},or=function(t,e){if(e){var i=t.style,s;e in Gs&&e!==ii&&(e=se),i.removeProperty?(s=e.substr(0,2),(s==="ms"||e.substr(0,6)==="webkit")&&(e="-"+e),i.removeProperty(s==="--"?e:e.replace(xg,"-$1").toLowerCase())):i.removeAttribute(e)}},En=function(t,e,i,s,r,o){var c=new ei(t._pt,e,i,0,1,o?NT:PT);return t._pt=c,c.b=s,c.e=r,t._props.push(i),c},hv={deg:1,rad:1,turn:1},yR={grid:1,flex:1},_n=function l(t,e,i,s){var r=parseFloat(i)||0,o=(i+"").trim().substr((r+"").length)||"px",c=ir.style,h=nR.test(e),f=t.tagName.toLowerCase()==="svg",g=(f?"client":"offset")+(h?"Width":"Height"),m=100,y=s==="px",v=s==="%",T,S,x,_;if(s===o||!r||hv[s]||hv[o])return r;if(o!=="px"&&!y&&(r=l(t,e,i,"px")),_=t.getCTM&&GT(t),(v||o==="%")&&(Gs[e]||~e.indexOf("adius")))return T=_?t.getBBox()[h?"width":"height"]:t[g],de(v?r/T*m:r/100*T);if(c[h?"width":"height"]=m+(y?o:s),S=s!=="rem"&&~e.indexOf("adius")||s==="em"&&t.appendChild&&!f?t:t.parentNode,_&&(S=(t.ownerSVGElement||{}).parentNode),(!S||S===vn||!S.appendChild)&&(S=vn.body),x=S._gsap,x&&v&&x.width&&h&&x.time===di.time&&!x.uncache)return de(r/x.width*m);if(v&&(e==="height"||e==="width")){var L=t.style[e];t.style[e]=m+s,T=t[g],L?t.style[e]=L:or(t,e)}else(v||o==="%")&&!yR[Pi(S,"display")]&&(c.position=Pi(t,"position")),S===t&&(c.position="static"),S.appendChild(ir),T=ir[g],S.removeChild(ir),c.position="absolute";return h&&v&&(x=sr(S),x.time=di.time,x.width=S[g]),de(y?T*r/m:T&&r?m/T*r:0)},Ns=function(t,e,i,s){var r;return Tg||kd(),e in rs&&e!=="transform"&&(e=rs[e],~e.indexOf(",")&&(e=e.split(",")[0])),Gs[e]&&e!=="transform"?(r=Hl(t,s),r=e!=="transformOrigin"?r[e]:r.svg?r.origin:tc(Pi(t,ii))+" "+r.zOrigin+"px"):(r=t.style[e],(!r||r==="auto"||s||~(r+"").indexOf("calc("))&&(r=Ju[e]&&Ju[e](t,e,i)||Pi(t,e)||sT(t,e)||(e==="opacity"?1:0))),i&&!~(r+"").trim().indexOf(" ")?_n(t,e,r,i)+i:r},vR=function(t,e,i,s){if(!i||i==="none"){var r=va(e,t,1),o=r&&Pi(t,r,1);o&&o!==i?(e=r,i=o):e==="borderColor"&&(i=Pi(t,"borderTopColor"))}var c=new ei(this._pt,t.style,e,0,1,wT),h=0,f=0,g,m,y,v,T,S,x,_,L,R,C,I;if(c.b=i,c.e=s,i+="",s+="",s.substring(0,6)==="var(--"&&(s=Pi(t,s.substring(4,s.indexOf(")")))),s==="auto"&&(S=t.style[e],t.style[e]=s,s=Pi(t,e)||s,S?t.style[e]=S:or(t,e)),g=[i,s],xT(g),i=g[0],s=g[1],y=i.match(na)||[],I=s.match(na)||[],I.length){for(;m=na.exec(s);)x=m[0],L=s.substring(h,m.index),T?T=(T+1)%5:(L.substr(-5)==="rgba("||L.substr(-5)==="hsla(")&&(T=1),x!==(S=y[f++]||"")&&(v=parseFloat(S)||0,C=S.substr((v+"").length),x.charAt(1)==="="&&(x=la(v,x)+C),_=parseFloat(x),R=x.substr((_+"").length),h=na.lastIndex-R.length,R||(R=R||pi.units[e]||C,h===s.length&&(s+=R,c.e+=R)),C!==R&&(v=_n(t,e,S,R)||0),c._pt={_next:c._pt,p:L||f===1?L:",",s:v,c:_-v,m:T&&T<4||e==="zIndex"?Math.round:0});c.c=h<s.length?s.substring(h,s.length):""}else c.r=e==="display"&&s==="none"?NT:PT;return WE.test(s)&&(c.e=0),this._pt=c,c},dv={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},ER=function(t){var e=t.split(" "),i=e[0],s=e[1]||"50%";return(i==="top"||i==="bottom"||s==="left"||s==="right")&&(t=i,i=s,s=t),e[0]=dv[i]||i,e[1]=dv[s]||s,e.join(" ")},TR=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var i=e.t,s=i.style,r=e.u,o=i._gsap,c,h,f;if(r==="all"||r===!0)s.cssText="",h=1;else for(r=r.split(","),f=r.length;--f>-1;)c=r[f],Gs[c]&&(h=1,c=c==="transformOrigin"?ii:se),or(i,c);h&&(or(i,se),o&&(o.svg&&i.removeAttribute("transform"),s.scale=s.rotate=s.translate="none",Hl(i,1),o.uncache=1,UT(s)))}},Ju={clearProps:function(t,e,i,s,r){if(r.data!=="isFromStart"){var o=t._pt=new ei(t._pt,e,i,0,0,TR);return o.u=s,o.pr=-10,o.tween=r,t._props.push(i),1}}},Gl=[1,0,0,1,0,0],HT={},VT=function(t){return t==="matrix(1, 0, 0, 1, 0, 0)"||t==="none"||!t},gv=function(t){var e=Pi(t,se);return VT(e)?Gl:e.substr(7).match(QE).map(de)},_g=function(t,e){var i=t._gsap||sr(t),s=t.style,r=gv(t),o,c,h,f;return i.svg&&t.getAttribute("transform")?(h=t.transform.baseVal.consolidate().matrix,r=[h.a,h.b,h.c,h.d,h.e,h.f],r.join(",")==="1,0,0,1,0,0"?Gl:r):(r===Gl&&!t.offsetParent&&t!==oa&&!i.svg&&(h=s.display,s.display="block",o=t.parentNode,(!o||!t.offsetParent&&!t.getBoundingClientRect().width)&&(f=1,c=t.nextElementSibling,oa.appendChild(t)),r=gv(t),h?s.display=h:or(t,"display"),f&&(c?o.insertBefore(t,c):o?o.appendChild(t):oa.removeChild(t))),e&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},Md=function(t,e,i,s,r,o){var c=t._gsap,h=r||_g(t,!0),f=c.xOrigin||0,g=c.yOrigin||0,m=c.xOffset||0,y=c.yOffset||0,v=h[0],T=h[1],S=h[2],x=h[3],_=h[4],L=h[5],R=e.split(" "),C=parseFloat(R[0])||0,I=parseFloat(R[1])||0,U,O,M,w;i?h!==Gl&&(O=v*x-T*S)&&(M=C*(x/O)+I*(-S/O)+(S*L-x*_)/O,w=C*(-T/O)+I*(v/O)-(v*L-T*_)/O,C=M,I=w):(U=$T(t),C=U.x+(~R[0].indexOf("%")?C/100*U.width:C),I=U.y+(~(R[1]||R[0]).indexOf("%")?I/100*U.height:I)),s||s!==!1&&c.smooth?(_=C-f,L=I-g,c.xOffset=m+(_*v+L*S)-_,c.yOffset=y+(_*T+L*x)-L):c.xOffset=c.yOffset=0,c.xOrigin=C,c.yOrigin=I,c.smooth=!!s,c.origin=e,c.originIsAbsolute=!!i,t.style[ii]="0px 0px",o&&(En(o,c,"xOrigin",f,C),En(o,c,"yOrigin",g,I),En(o,c,"xOffset",m,c.xOffset),En(o,c,"yOffset",y,c.yOffset)),t.setAttribute("data-svg-origin",C+" "+I)},Hl=function(t,e){var i=t._gsap||new RT(t);if("x"in i&&!e&&!i.uncache)return i;var s=t.style,r=i.scaleX<0,o="px",c="deg",h=getComputedStyle(t),f=Pi(t,ii)||"0",g,m,y,v,T,S,x,_,L,R,C,I,U,O,M,w,N,z,J,lt,ct,at,B,q,W,ot,k,$,j,st,ut,ft;return g=m=y=S=x=_=L=R=C=0,v=T=1,i.svg=!!(t.getCTM&&GT(t)),h.translate&&((h.translate!=="none"||h.scale!=="none"||h.rotate!=="none")&&(s[se]=(h.translate!=="none"?"translate3d("+(h.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(h.rotate!=="none"?"rotate("+h.rotate+") ":"")+(h.scale!=="none"?"scale("+h.scale.split(" ").join(",")+") ":"")+(h[se]!=="none"?h[se]:"")),s.scale=s.rotate=s.translate="none"),O=_g(t,i.svg),i.svg&&(i.uncache?(W=t.getBBox(),f=i.xOrigin-W.x+"px "+(i.yOrigin-W.y)+"px",q=""):q=!e&&t.getAttribute("data-svg-origin"),Md(t,q||f,!!q||i.originIsAbsolute,i.smooth!==!1,O)),I=i.xOrigin||0,U=i.yOrigin||0,O!==Gl&&(z=O[0],J=O[1],lt=O[2],ct=O[3],g=at=O[4],m=B=O[5],O.length===6?(v=Math.sqrt(z*z+J*J),T=Math.sqrt(ct*ct+lt*lt),S=z||J?Zr(J,z)*tr:0,L=lt||ct?Zr(lt,ct)*tr+S:0,L&&(T*=Math.abs(Math.cos(L*ua))),i.svg&&(g-=I-(I*z+U*lt),m-=U-(I*J+U*ct))):(ft=O[6],st=O[7],k=O[8],$=O[9],j=O[10],ut=O[11],g=O[12],m=O[13],y=O[14],M=Zr(ft,j),x=M*tr,M&&(w=Math.cos(-M),N=Math.sin(-M),q=at*w+k*N,W=B*w+$*N,ot=ft*w+j*N,k=at*-N+k*w,$=B*-N+$*w,j=ft*-N+j*w,ut=st*-N+ut*w,at=q,B=W,ft=ot),M=Zr(-lt,j),_=M*tr,M&&(w=Math.cos(-M),N=Math.sin(-M),q=z*w-k*N,W=J*w-$*N,ot=lt*w-j*N,ut=ct*N+ut*w,z=q,J=W,lt=ot),M=Zr(J,z),S=M*tr,M&&(w=Math.cos(M),N=Math.sin(M),q=z*w+J*N,W=at*w+B*N,J=J*w-z*N,B=B*w-at*N,z=q,at=W),x&&Math.abs(x)+Math.abs(S)>359.9&&(x=S=0,_=180-_),v=de(Math.sqrt(z*z+J*J+lt*lt)),T=de(Math.sqrt(B*B+ft*ft)),M=Zr(at,B),L=Math.abs(M)>2e-4?M*tr:0,C=ut?1/(ut<0?-ut:ut):0),i.svg&&(q=t.getAttribute("transform"),i.forceCSS=t.setAttribute("transform","")||!VT(Pi(t,se)),q&&t.setAttribute("transform",q))),Math.abs(L)>90&&Math.abs(L)<270&&(r?(v*=-1,L+=S<=0?180:-180,S+=S<=0?180:-180):(T*=-1,L+=L<=0?180:-180)),e=e||i.uncache,i.x=g-((i.xPercent=g&&(!e&&i.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-g)?-50:0)))?t.offsetWidth*i.xPercent/100:0)+o,i.y=m-((i.yPercent=m&&(!e&&i.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-m)?-50:0)))?t.offsetHeight*i.yPercent/100:0)+o,i.z=y+o,i.scaleX=de(v),i.scaleY=de(T),i.rotation=de(S)+c,i.rotationX=de(x)+c,i.rotationY=de(_)+c,i.skewX=L+c,i.skewY=R+c,i.transformPerspective=C+o,(i.zOrigin=parseFloat(f.split(" ")[2])||!e&&i.zOrigin||0)&&(s[ii]=tc(f)),i.xOffset=i.yOffset=0,i.force3D=pi.force3D,i.renderTransform=i.svg?xR:FT?KT:SR,i.uncache=0,i},tc=function(t){return(t=t.split(" "))[0]+" "+t[1]},jh=function(t,e,i){var s=Fe(e);return de(parseFloat(e)+parseFloat(_n(t,"x",i+"px",s)))+s},SR=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,KT(t,e)},Xn="0deg",Al="0px",Qn=") ",KT=function(t,e){var i=e||this,s=i.xPercent,r=i.yPercent,o=i.x,c=i.y,h=i.z,f=i.rotation,g=i.rotationY,m=i.rotationX,y=i.skewX,v=i.skewY,T=i.scaleX,S=i.scaleY,x=i.transformPerspective,_=i.force3D,L=i.target,R=i.zOrigin,C="",I=_==="auto"&&t&&t!==1||_===!0;if(R&&(m!==Xn||g!==Xn)){var U=parseFloat(g)*ua,O=Math.sin(U),M=Math.cos(U),w;U=parseFloat(m)*ua,w=Math.cos(U),o=jh(L,o,O*w*-R),c=jh(L,c,-Math.sin(U)*-R),h=jh(L,h,M*w*-R+R)}x!==Al&&(C+="perspective("+x+Qn),(s||r)&&(C+="translate("+s+"%, "+r+"%) "),(I||o!==Al||c!==Al||h!==Al)&&(C+=h!==Al||I?"translate3d("+o+", "+c+", "+h+") ":"translate("+o+", "+c+Qn),f!==Xn&&(C+="rotate("+f+Qn),g!==Xn&&(C+="rotateY("+g+Qn),m!==Xn&&(C+="rotateX("+m+Qn),(y!==Xn||v!==Xn)&&(C+="skew("+y+", "+v+Qn),(T!==1||S!==1)&&(C+="scale("+T+", "+S+Qn),L.style[se]=C||"translate(0, 0)"},xR=function(t,e){var i=e||this,s=i.xPercent,r=i.yPercent,o=i.x,c=i.y,h=i.rotation,f=i.skewX,g=i.skewY,m=i.scaleX,y=i.scaleY,v=i.target,T=i.xOrigin,S=i.yOrigin,x=i.xOffset,_=i.yOffset,L=i.forceCSS,R=parseFloat(o),C=parseFloat(c),I,U,O,M,w;h=parseFloat(h),f=parseFloat(f),g=parseFloat(g),g&&(g=parseFloat(g),f+=g,h+=g),h||f?(h*=ua,f*=ua,I=Math.cos(h)*m,U=Math.sin(h)*m,O=Math.sin(h-f)*-y,M=Math.cos(h-f)*y,f&&(g*=ua,w=Math.tan(f-g),w=Math.sqrt(1+w*w),O*=w,M*=w,g&&(w=Math.tan(g),w=Math.sqrt(1+w*w),I*=w,U*=w)),I=de(I),U=de(U),O=de(O),M=de(M)):(I=m,M=y,U=O=0),(R&&!~(o+"").indexOf("px")||C&&!~(c+"").indexOf("px"))&&(R=_n(v,"x",o,"px"),C=_n(v,"y",c,"px")),(T||S||x||_)&&(R=de(R+T-(T*I+S*O)+x),C=de(C+S-(T*U+S*M)+_)),(s||r)&&(w=v.getBBox(),R=de(R+s/100*w.width),C=de(C+r/100*w.height)),w="matrix("+I+","+U+","+O+","+M+","+R+","+C+")",v.setAttribute("transform",w),L&&(v.style[se]=w)},_R=function(t,e,i,s,r){var o=360,c=De(r),h=parseFloat(r)*(c&&~r.indexOf("rad")?tr:1),f=h-s,g=s+f+"deg",m,y;return c&&(m=r.split("_")[1],m==="short"&&(f%=o,f!==f%(o/2)&&(f+=f<0?o:-o)),m==="cw"&&f<0?f=(f+o*ov)%o-~~(f/o)*o:m==="ccw"&&f>0&&(f=(f-o*ov)%o-~~(f/o)*o)),t._pt=y=new ei(t._pt,e,i,s,f,aR),y.e=g,y.u="deg",t._props.push(i),y},mv=function(t,e){for(var i in e)t[i]=e[i];return t},AR=function(t,e,i){var s=mv({},i._gsap),r="perspective,force3D,transformOrigin,svgOrigin",o=i.style,c,h,f,g,m,y,v,T;s.svg?(f=i.getAttribute("transform"),i.setAttribute("transform",""),o[se]=e,c=Hl(i,1),or(i,se),i.setAttribute("transform",f)):(f=getComputedStyle(i)[se],o[se]=e,c=Hl(i,1),o[se]=f);for(h in Gs)f=s[h],g=c[h],f!==g&&r.indexOf(h)<0&&(v=Fe(f),T=Fe(g),m=v!==T?_n(i,h,f,T):parseFloat(f),y=parseFloat(g),t._pt=new ei(t._pt,c,h,m,y-m,Od),t._pt.u=T||0,t._props.push(h));mv(c,s)};ti("padding,margin,Width,Radius",function(l,t){var e="Top",i="Right",s="Bottom",r="Left",o=(t<3?[e,i,s,r]:[e+r,e+i,s+i,s+r]).map(function(c){return t<2?l+c:"border"+c+l});Ju[t>1?"border"+l:l]=function(c,h,f,g,m){var y,v;if(arguments.length<4)return y=o.map(function(T){return Ns(c,T,f)}),v=y.join(" "),v.split(y[0]).length===5?y[0]:v;y=(g+"").split(" "),v={},o.forEach(function(T,S){return v[T]=y[S]=y[S]||y[(S-1)/2|0]}),c.init(h,v,m)}});var zT={name:"css",register:kd,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,i,s,r){var o=this._props,c=t.style,h=i.vars.startAt,f,g,m,y,v,T,S,x,_,L,R,C,I,U,O,M;Tg||kd(),this.styles=this.styles||BT(t),M=this.styles.props,this.tween=i;for(S in e)if(S!=="autoRound"&&(g=e[S],!(fi[S]&&LT(S,e,i,s,t,r)))){if(v=typeof g,T=Ju[S],v==="function"&&(g=g.call(i,s,t,r),v=typeof g),v==="string"&&~g.indexOf("random(")&&(g=Bl(g)),T)T(this,t,S,g,i)&&(O=1);else if(S.substr(0,2)==="--")f=(getComputedStyle(t).getPropertyValue(S)+"").trim(),g+="",Sn.lastIndex=0,Sn.test(f)||(x=Fe(f),_=Fe(g)),_?x!==_&&(f=_n(t,S,f,_)+_):x&&(g+=x),this.add(c,"setProperty",f,g,s,r,0,0,S),o.push(S),M.push(S,0,c[S]);else if(v!=="undefined"){if(h&&S in h?(f=typeof h[S]=="function"?h[S].call(i,s,t,r):h[S],De(f)&&~f.indexOf("random(")&&(f=Bl(f)),Fe(f+"")||f==="auto"||(f+=pi.units[S]||Fe(Ns(t,S))||""),(f+"").charAt(1)==="="&&(f=Ns(t,S))):f=Ns(t,S),y=parseFloat(f),L=v==="string"&&g.charAt(1)==="="&&g.substr(0,2),L&&(g=g.substr(2)),m=parseFloat(g),S in rs&&(S==="autoAlpha"&&(y===1&&Ns(t,"visibility")==="hidden"&&m&&(y=0),M.push("visibility",0,c.visibility),En(this,c,"visibility",y?"inherit":"hidden",m?"inherit":"hidden",!m)),S!=="scale"&&S!=="transform"&&(S=rs[S],~S.indexOf(",")&&(S=S.split(",")[0]))),R=S in Gs,R){if(this.styles.save(S),v==="string"&&g.substring(0,6)==="var(--"&&(g=Pi(t,g.substring(4,g.indexOf(")"))),m=parseFloat(g)),C||(I=t._gsap,I.renderTransform&&!e.parseTransform||Hl(t,e.parseTransform),U=e.smoothOrigin!==!1&&I.smooth,C=this._pt=new ei(this._pt,c,se,0,1,I.renderTransform,I,0,-1),C.dep=1),S==="scale")this._pt=new ei(this._pt,I,"scaleY",I.scaleY,(L?la(I.scaleY,L+m):m)-I.scaleY||0,Od),this._pt.u=0,o.push("scaleY",S),S+="X";else if(S==="transformOrigin"){M.push(ii,0,c[ii]),g=ER(g),I.svg?Md(t,g,0,U,0,this):(_=parseFloat(g.split(" ")[2])||0,_!==I.zOrigin&&En(this,I,"zOrigin",I.zOrigin,_),En(this,c,S,tc(f),tc(g)));continue}else if(S==="svgOrigin"){Md(t,g,1,U,0,this);continue}else if(S in HT){_R(this,I,S,y,L?la(y,L+g):g);continue}else if(S==="smoothOrigin"){En(this,I,"smooth",I.smooth,g);continue}else if(S==="force3D"){I[S]=g;continue}else if(S==="transform"){AR(this,g,t);continue}}else S in c||(S=va(S)||S);if(R||(m||m===0)&&(y||y===0)&&!rR.test(g)&&S in c)x=(f+"").substr((y+"").length),m||(m=0),_=Fe(g)||(S in pi.units?pi.units[S]:x),x!==_&&(y=_n(t,S,f,_)),this._pt=new ei(this._pt,R?I:c,S,y,(L?la(y,L+m):m)-y,!R&&(_==="px"||S==="zIndex")&&e.autoRound!==!1?oR:Od),this._pt.u=_||0,x!==_&&_!=="%"&&(this._pt.b=f,this._pt.r=lR);else if(S in c)vR.call(this,t,S,f,L?L+g:g);else if(S in t)this.add(t,S,f||t[S],L?L+g:g,s,r);else if(S!=="parseTransform"){cg(S,g);continue}R||(S in c?M.push(S,0,c[S]):typeof t[S]=="function"?M.push(S,2,t[S]()):M.push(S,1,f||t[S])),o.push(S)}}O&&kT(this)},render:function(t,e){if(e.tween._time||!Sg())for(var i=e._pt;i;)i.r(t,i.d),i=i._next;else e.styles.revert()},get:Ns,aliases:rs,getSetter:function(t,e,i){var s=rs[e];return s&&s.indexOf(",")<0&&(e=s),e in Gs&&e!==ii&&(t._gsap.x||Ns(t,"x"))?i&&lv===i?e==="scale"?hR:fR:(lv=i||{})&&(e==="scale"?dR:gR):t.style&&!lg(t.style[e])?uR:~e.indexOf("-")?cR:vg(t,e)},core:{_removeProperty:or,_getMatrix:_g}};si.utils.checkPrefix=va;si.core.getStyleSaver=BT;(function(l,t,e,i){var s=ti(l+","+t+","+e,function(r){Gs[r]=1});ti(t,function(r){pi.units[r]="deg",HT[r]=1}),rs[s[13]]=l+","+t,ti(i,function(r){var o=r.split(":");rs[o[1]]=s[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");ti("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(l){pi.units[l]="px"});si.registerPlugin(zT);var An=si.registerPlugin(zT)||si;An.core.Tween;const bR=[{title:"Home",icon:"./assets/sidebar/home.svg",link:"/"},{title:"Szenen",icon:"./assets/sidebar/scenes.svg",link:"/scenes"},{title:"Automation",icon:"./assets/sidebar/automations.svg",link:"/automation"},{title:"Licht",icon:"./assets/sidebar/lights.svg",link:"/light"},{title:"Security",icon:"./assets/sidebar/security.svg",link:"/security"},{title:"Kameras",icon:"./assets/sidebar/cameras.svg",link:"/cameras"},{title:"Temperatur",icon:"./assets/sidebar/temperature.svg",link:"/climate"},{title:"Wasser",icon:"./assets/sidebar/water.svg",link:"/water"},{title:"Jalousie",icon:"./assets/sidebar/jalousie.svg",link:"/blinds"}],RR=()=>{const l=t=>{const e=t.currentTarget.querySelector(".nav-icon-wrapper");An.fromTo(e,{scale:.9,y:4},{scale:1,y:0,duration:.5,ease:"elastic.out(1, 0.5)"})};return rt.jsx("div",{className:"h-screen w-[130px] fixed left-0 top-0 flex flex-col items-center",children:rt.jsx("ul",{className:"p-3 rounded-full shadow-xl bg-[#f7f6f3dd] my-auto flex flex-col gap-2",children:bR.map((t,e)=>rt.jsx("li",{children:rt.jsx(zE,{to:t.link,end:t.link==="/",className:({isActive:i})=>`flex justify-center items-center w-[65px] h-[65px] rounded-full transition-all ${i?"bg-[#E8E7E4]":"bg-transparent"}`,onClick:l,children:rt.jsx("div",{className:"nav-icon-wrapper flex justify-center items-center w-full h-full",children:rt.jsx("img",{src:t.icon,alt:t.title,className:"object-contain",draggable:"false"})})})},e))})})},LR=()=>rt.jsx("div",{children:"Home"}),YT=[{id:"01_strahler_eingang",title:"Eingang",room:"Eingang",status:"off"},{id:"02_strahler_kche",title:"Kche Strahler",room:"Eingang",status:"off"},{id:3,title:"Kche LED",room:"Eingang",status:"off"},{id:4,title:"Kche",room:"Eingang",status:"off"},{id:5,title:"WC Decke",room:"Eingang",status:"off"},{id:6,title:"Wohnzimmer L",room:"Eingang",status:"off"},{id:7,title:"Wohnz. LED",room:"Eingang",status:"off"},{id:8,title:"Flur Scheinwerfer",room:"Eingang",status:"off"},{id:9,title:"Wohzimmer Links",room:"Kinderbad",status:"off"},{title:"Balkon Auen",room:"Auen",status:"off"}];for(let l=11;l<=67;l++)YT.push({id:l,title:`Lampe ${l}`,room:"Raum",status:"off"});const pv=async(l=null,t=null)=>{try{let e="http://192.168.30.113:1880/lights",i={};if(l==="all")i={action:"all",status:t};else if(l)i={id:l,status:t};else throw new Error("No light id or action specified");const r=await(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).json();return console.log(l==="all"?`All lights set to ${t}`:`Light ${r.id} toggled to ${r.status}`),r}catch(e){return console.error("Error toggling light:",e),null}},vu=20,DR=()=>{const[l,t]=Z.useState(YT),[e,i]=Z.useState(0),s=async f=>{const g=await pv(f);g&&t(m=>m.map(y=>y.id===f?{...y,status:g.status}:y))},r=async f=>{await pv("all",f)&&t(m=>m.map(y=>({...y,status:f})))},o=(f,g)=>{const m=f.currentTarget;An.to(m,{scale:.75,duration:.08,ease:"power1.out",onComplete:()=>{An.to(m,{scale:1,duration:.04,ease:"elastic.out(1, 0.6)"}),g&&g()}})},c=e*vu,h=l.slice(c,c+vu);return rt.jsxs("div",{className:"w-full h-full flex flex-col px-8 py-6",children:[rt.jsxs("div",{className:"flex justify-between items-center mb-6",children:[rt.jsxs("div",{className:"flex items-center gap-4",children:[rt.jsx("button",{disabled:e===0,onClick:f=>o(f,()=>i(g=>Math.max(0,g-1))),className:"w-12 h-12 flex items-center justify-center bg-transparent rounded-full disabled:opacity-40 transform",children:rt.jsx("img",{src:"/assets/symbols/arrow-left.svg",alt:"Prev",className:"w-5 h-5"})}),rt.jsx("button",{disabled:c+vu>=l.length,onClick:f=>o(f,()=>i(g=>c+vu<l.length?g+1:g)),className:"w-12 h-12 flex items-center justify-center bg-transparent rounded-full disabled:opacity-40 transform",children:rt.jsx("img",{src:"/assets/symbols/arrow-right.svg",alt:"Next",className:"w-5 h-5"})})]}),rt.jsxs("div",{className:"flex items-center gap-4",children:[rt.jsx("button",{onClick:f=>o(f,()=>r("on")),className:"p-3 flex items-center transition-all justify-center bg-[#dfdedaaa] shadow-md rounded-full transform",children:rt.jsx("img",{src:"/assets/symbols/light.svg",alt:"All On",className:"w-8 h-8"})}),rt.jsx("button",{onClick:f=>o(f,()=>r("off")),className:"p-3 flex items-center transition-all bg-[#dfdedaaa] shadow-md justify-center rounded-full transform",children:rt.jsx("img",{src:"/assets/symbols/light-turn-off.svg",alt:"All Off",className:"w-8 h-8"})})]})]}),rt.jsx("div",{className:"grid grid-cols-5 gap-4",children:h.map(f=>rt.jsxs("div",{onClick:g=>o(g,()=>s(f.id)),className:`flex gap-2 items-center justify-start p-3 h-[100px] shadow-xs rounded-2xl cursor-pointer transition-all transform ${f.status==="on"?"bg-[#ffffffee]":"bg-[#dfdedaaa]"}`,children:[rt.jsx("div",{className:"shadow-xs bg-[#b1aeae30] w-14 h-14 flex items-center justify-center rounded-full",children:rt.jsx("img",{src:`/assets/symbols/light-${f.status==="on"?"on":"off"}.svg`,alt:f.title,className:"w-10 h-10"})}),rt.jsxs("div",{children:[rt.jsx("p",{className:"font-medium text-xl leading-tight h-[50px] w-[95%] flex",children:f.title}),rt.jsx("span",{className:"text-neutral-400",children:f.room})]})]},f.id))})]})},IR=()=>rt.jsx("div",{children:"Automation"}),jT=[{id:1,name:"Garage L",status:"closed"},{id:2,name:"Garage M",status:"closed"},{id:3,name:"Garage R",status:"closed"},{id:4,name:"Haustr",status:"closed"},{id:5,name:"Kche",status:"closed"},{id:6,name:"WC",status:"closed"},{id:7,name:"Bro W",status:"closed"},{id:8,name:"Bro M",status:"closed"},{id:9,name:"Bro N",status:"closed"},{id:10,name:"Treppe",status:"closed"},{id:11,name:"Kellertreppe",status:"closed"},{id:12,name:"Wohnzimmer R",status:"closed"},{id:13,name:"Wohnzimmer L",status:"closed"},{id:14,name:"Abstellraum",status:"closed"},{id:15,name:"Zimmer David",status:"closed"},{id:16,name:"Zimmer Julia",status:"closed"},{id:17,name:"Kinderbad",status:"closed"},{id:18,name:"Dachterasse",status:"closed"},{id:19,name:"Elternzimmer",status:"closed"},{id:20,name:"Elternbad",status:"closed"},{id:21,name:"Schrankraum",status:"closed"},{id:22,name:"Indoor Pool",status:"closed"},{id:23,name:"Keller",status:"closed"},{id:24,name:"Waschraum",status:"closed"}],Eu=jT.every(l=>l.status==="closed"),CR=({title:l,button1Text:t,button2Text:e,onButton1:i,onButton2:s})=>rt.jsx("div",{className:"fixed bg-black/20 inset-0 flex items-center justify-center z-50",children:rt.jsxs("div",{className:"bg-[#ffffff] shadow-2xl px-6 py-10 rounded-2xl text-center max-w-[500px]",children:[rt.jsx("h2",{className:"text-xl mb-8 text-black",children:l}),rt.jsxs("div",{className:"flex justify-center gap-4",children:[rt.jsx("button",{onClick:i,className:"px-4 py-2 w-30 bg-red-500 text-white rounded-lg transition",children:t}),rt.jsx("button",{onClick:s,className:"px-4 py-2 w-30 bg-gray-300 text-black rounded-lg transition",children:e})]})]})}),OR=({length:l=4,onCancel:t,onSubmit:e})=>{const[i,s]=Z.useState(""),[r,o]=Z.useState(!1),[c,h]=Z.useState(!1),f=Z.useRef(null);Z.useEffect(()=>{const y=v=>{f.current&&!f.current.contains(v.target)&&t()};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[t]);const g=async y=>{if(i.length>=l||c)return;const v=i+y;if(s(v),v.length===l){h(!0);try{(await(await fetch("http://localhost:3001/check-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:v})})).json()).success?e(v):(o(!0),setTimeout(()=>{s(""),o(!1),h(!1)},500))}catch(T){console.error(T),h(!1)}}},m=()=>{c||s(y=>y.slice(0,-1))};return rt.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:rt.jsxs("div",{ref:f,className:"bg-black/50 backdrop-blur-xl shadow-2xl px-40 py-8 rounded-[45px] flex flex-col justify-center items-center gap-4 translate-x-10 translate-y-17",children:[rt.jsx("h2",{className:"text-white text-3xl",children:"Geben Sie den Code ein"}),rt.jsx("div",{className:"flex gap-2 mb-3",children:Array.from({length:l}).map((y,v)=>rt.jsx("div",{className:`w-3 h-3 mx-2 rounded-full border ${i.length>v?"bg-white border-white":"border-white/50 bg-transparent"} ${r?"bg-red-500 border-red-500":""}`,style:r?{border:"none"}:{}},v))}),rt.jsx("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3,4,5,6,7,8,9,"",0,""].map((y,v)=>rt.jsx("div",{className:"flex justify-center",children:y!==""&&rt.jsx("button",{onClick:()=>g(y.toString()),disabled:c,className:"bg-recessed text-white text-4xl py-8 px-11 rounded-full disabled:opacity-50",children:y})},v))}),rt.jsxs("div",{className:"flex gap-20 mt-4",children:[rt.jsx("button",{onClick:t,className:"flex text-primary",disabled:c,children:"Abbrechen"}),rt.jsx("button",{onClick:m,className:"flex text-primary",disabled:c||i.length===0,children:"Lschen"})]})]})})},qh=(l,t)=>{const e=l.currentTarget;An.to(e,{scale:.97,duration:.08,ease:"power1.out",onComplete:()=>{An.to(e,{scale:1,duration:.35,ease:"elastic.out(1, 0.6)"}),typeof t=="function"&&t()}})},wR=()=>{const[l,t]=Z.useState(!1),[e,i]=Z.useState(!1),[s,r]=Z.useState({gesamt:!1,aussenhaut:!1}),o=()=>{fetch("http://192.168.30.113:3001/alarm-status").then(h=>h.json()).then(h=>{h.alarmAktiv!==void 0&&r({gesamt:h.alarmAktiv,aussenhaut:h.alarmAktiv})})};Z.useEffect(()=>{o()},[]);const c=h=>{r(f=>({...f,[h]:!f[h]}))};return e?rt.jsxs("div",{className:"w-full flex flex-col px-8 py-6 select-none",children:[rt.jsxs("div",{className:"grid grid-cols-5 gap-5 mb-10",children:[rt.jsxs("div",{onClick:h=>{Eu&&qh(h,()=>c("gesamt"))},className:`flex items-center justify-center p-3 gap-2 rounded-full shadow-md cursor-pointer transition-all
            ${Eu?"bg-[#dfdedaaa]":"cursor-not-allowed opacity-30"}
            ${s.gesamt?"bg-red-500 text-white":""}`,children:[rt.jsx("div",{className:"flex items-center justify-center",children:rt.jsx("img",{src:s.gesamt?"/assets/symbols/protection-on.svg":"/assets/symbols/protection.svg",alt:"Alarm",className:"w-8 h-8"})}),rt.jsx("span",{className:"font-medium",children:"Gesamt"})]}),rt.jsxs("div",{onClick:h=>{Eu&&qh(h,()=>c("aussenhaut"))},className:`flex items-center justify-center gap-2 p-3 rounded-full shadow-md cursor-pointer transition-all
            ${Eu?"bg-[#dfdedaaa]":"cursor-not-allowed opacity-30"}
            ${s.aussenhaut?"bg-red-500 text-white":""}`,children:[rt.jsx("div",{className:"flex items-center justify-center",children:rt.jsx("img",{src:s.aussenhaut?"/assets/symbols/protection-on.svg":"/assets/symbols/protection.svg",alt:"Alarm",className:"w-8 h-8"})}),rt.jsx("span",{className:"font-medium",children:"Auenhaut"})]}),rt.jsx("div",{className:"col-span-2"}),rt.jsxs("div",{onClick:h=>qh(h,()=>t(!0)),className:"flex items-center justify-center gap-2 p-3 rounded-full shadow-md bg-[#dfdedaaa] cursor-pointer",children:[rt.jsx("div",{className:"flex items-center justify-center",children:rt.jsx("img",{src:"/assets/icons/bell-red.svg",alt:"berfall",className:"w-8 h-8"})}),rt.jsx("span",{className:"font-medium",children:"berfall"})]})]}),rt.jsx("h3",{className:"text-xl font-medium mb-3 ml-2",children:"Kontakte"}),rt.jsx("div",{className:"p-3 bg-[#dfdedaaa] rounded-3xl",children:rt.jsx("div",{className:"grid grid-cols-5 gap-5",children:jT.map(h=>rt.jsxs("div",{className:`flex items-center justify-start gap-2 p-4 rounded-2xl transition-all
                ${h.status==="open"?"bg-[#ffffffee]":"bg-transparent"}`,children:[rt.jsx("div",{className:"w-14 h-14 flex items-center justify-center rounded-full bg-[#b1aeae30]",children:rt.jsx("img",{src:`/assets/symbols/lock-${h.status==="open"?"filled-open":"filled"}.svg`,alt:h.name,className:"w-7 h-7"})}),rt.jsx("span",{className:`font-medium text-md ${h.status==="open"?"text-black":"text-neutral-400"}`,children:h.name})]},h.id))})}),l&&rt.jsx(CR,{title:"Sind Sie sicher, dass Sie einen berfall auslsen mchten?",button1Text:"Ja",button2Text:"Abbrechen",onButton1:()=>{console.log("berfall ausgelst"),t(!1)},onButton2:()=>t(!1)})]}):rt.jsx(OR,{length:4,correctHash:"your_sha256_hash_here",onSubmit:h=>{fetch("http://192.168.30.113:3001/check-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:h})}).then(f=>f.json()).then(f=>{f.success?i(!0):console.log("Falscher Code")})},onCancel:()=>{navigate("/")}})},dt=Number.isFinite||function(l){return typeof l=="number"&&isFinite(l)},kR=Number.isSafeInteger||function(l){return typeof l=="number"&&Math.abs(l)<=MR},MR=Number.MAX_SAFE_INTEGER||9007199254740991;let pt=function(l){return l.NETWORK_ERROR="networkError",l.MEDIA_ERROR="mediaError",l.KEY_SYSTEM_ERROR="keySystemError",l.MUX_ERROR="muxError",l.OTHER_ERROR="otherError",l}({}),K=function(l){return l.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",l.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",l.KEY_SYSTEM_NO_SESSION="keySystemNoSession",l.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",l.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",l.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",l.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",l.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",l.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",l.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",l.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",l.MANIFEST_LOAD_ERROR="manifestLoadError",l.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",l.MANIFEST_PARSING_ERROR="manifestParsingError",l.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",l.LEVEL_EMPTY_ERROR="levelEmptyError",l.LEVEL_LOAD_ERROR="levelLoadError",l.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",l.LEVEL_PARSING_ERROR="levelParsingError",l.LEVEL_SWITCH_ERROR="levelSwitchError",l.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",l.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",l.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",l.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",l.FRAG_LOAD_ERROR="fragLoadError",l.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",l.FRAG_DECRYPT_ERROR="fragDecryptError",l.FRAG_PARSING_ERROR="fragParsingError",l.FRAG_GAP="fragGap",l.REMUX_ALLOC_ERROR="remuxAllocError",l.KEY_LOAD_ERROR="keyLoadError",l.KEY_LOAD_TIMEOUT="keyLoadTimeOut",l.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",l.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",l.BUFFER_APPEND_ERROR="bufferAppendError",l.BUFFER_APPENDING_ERROR="bufferAppendingError",l.BUFFER_STALLED_ERROR="bufferStalledError",l.BUFFER_FULL_ERROR="bufferFullError",l.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",l.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",l.ASSET_LIST_LOAD_ERROR="assetListLoadError",l.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",l.ASSET_LIST_PARSING_ERROR="assetListParsingError",l.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",l.INTERNAL_EXCEPTION="internalException",l.INTERNAL_ABORTED="aborted",l.ATTACH_MEDIA_ERROR="attachMediaError",l.UNKNOWN="unknown",l}({}),A=function(l){return l.MEDIA_ATTACHING="hlsMediaAttaching",l.MEDIA_ATTACHED="hlsMediaAttached",l.MEDIA_DETACHING="hlsMediaDetaching",l.MEDIA_DETACHED="hlsMediaDetached",l.MEDIA_ENDED="hlsMediaEnded",l.STALL_RESOLVED="hlsStallResolved",l.BUFFER_RESET="hlsBufferReset",l.BUFFER_CODECS="hlsBufferCodecs",l.BUFFER_CREATED="hlsBufferCreated",l.BUFFER_APPENDING="hlsBufferAppending",l.BUFFER_APPENDED="hlsBufferAppended",l.BUFFER_EOS="hlsBufferEos",l.BUFFERED_TO_END="hlsBufferedToEnd",l.BUFFER_FLUSHING="hlsBufferFlushing",l.BUFFER_FLUSHED="hlsBufferFlushed",l.MANIFEST_LOADING="hlsManifestLoading",l.MANIFEST_LOADED="hlsManifestLoaded",l.MANIFEST_PARSED="hlsManifestParsed",l.LEVEL_SWITCHING="hlsLevelSwitching",l.LEVEL_SWITCHED="hlsLevelSwitched",l.LEVEL_LOADING="hlsLevelLoading",l.LEVEL_LOADED="hlsLevelLoaded",l.LEVEL_UPDATED="hlsLevelUpdated",l.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",l.LEVELS_UPDATED="hlsLevelsUpdated",l.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",l.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",l.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",l.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",l.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",l.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",l.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",l.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",l.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",l.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",l.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",l.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",l.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",l.CUES_PARSED="hlsCuesParsed",l.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",l.INIT_PTS_FOUND="hlsInitPtsFound",l.FRAG_LOADING="hlsFragLoading",l.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",l.FRAG_LOADED="hlsFragLoaded",l.FRAG_DECRYPTED="hlsFragDecrypted",l.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",l.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",l.FRAG_PARSING_METADATA="hlsFragParsingMetadata",l.FRAG_PARSED="hlsFragParsed",l.FRAG_BUFFERED="hlsFragBuffered",l.FRAG_CHANGED="hlsFragChanged",l.FPS_DROP="hlsFpsDrop",l.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",l.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",l.ERROR="hlsError",l.DESTROYING="hlsDestroying",l.KEY_LOADING="hlsKeyLoading",l.KEY_LOADED="hlsKeyLoaded",l.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",l.BACK_BUFFER_REACHED="hlsBackBufferReached",l.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",l.ASSET_LIST_LOADING="hlsAssetListLoading",l.ASSET_LIST_LOADED="hlsAssetListLoaded",l.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",l.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",l.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",l.INTERSTITIAL_STARTED="hlsInterstitialStarted",l.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",l.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",l.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",l.INTERSTITIAL_ENDED="hlsInterstitialEnded",l.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",l.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",l.EVENT_CUE_ENTER="hlsEventCueEnter",l}({});var Dt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},mt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Jr{constructor(t,e=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=i}sample(t,e){const i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_}}class PR{constructor(t,e,i,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Jr(t),this.fast_=new Jr(e),this.defaultTTFB_=s,this.ttfb_=new Jr(t)}update(t,e){const{slow_:i,fast_:s,ttfb_:r}=this;i.halfLife!==t&&(this.slow_=new Jr(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.fast_=new Jr(e,s.getEstimate(),s.getTotalWeight())),r.halfLife!==t&&(this.ttfb_=new Jr(t,r.getEstimate(),r.getTotalWeight()))}sample(t,e){t=Math.max(t,this.minDelayMs_);const i=8*e,s=t/1e3,r=i/s;this.fast_.sample(s,r),this.slow_.sample(s,r)}sampleTTFB(t){const e=t/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(i,Math.max(t,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function NR(l,t,e){return(t=BR(t))in l?Object.defineProperty(l,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):l[t]=e,l}function Kt(){return Kt=Object.assign?Object.assign.bind():function(l){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)({}).hasOwnProperty.call(e,i)&&(l[i]=e[i])}return l},Kt.apply(null,arguments)}function yv(l,t){var e=Object.keys(l);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(l);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(l,s).enumerable})),e.push.apply(e,i)}return e}function Vt(l){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?yv(Object(e),!0).forEach(function(i){NR(l,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(e)):yv(Object(e)).forEach(function(i){Object.defineProperty(l,i,Object.getOwnPropertyDescriptor(e,i))})}return l}function UR(l,t){if(typeof l!="object"||!l)return l;var e=l[Symbol.toPrimitive];if(e!==void 0){var i=e.call(l,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(l)}function BR(l){var t=UR(l,"string");return typeof t=="symbol"?t:t+""}class zi{constructor(t,e){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${t}]:`;this.trace=mn,this.debug=e.debug.bind(null,i),this.log=e.log.bind(null,i),this.warn=e.warn.bind(null,i),this.info=e.info.bind(null,i),this.error=e.error.bind(null,i)}}const mn=function(){},FR={trace:mn,debug:mn,log:mn,warn:mn,info:mn,error:mn};function Pd(){return Kt({},FR)}function $R(l,t){const e=self.console[l];return e?e.bind(self.console,`${t?"["+t+"] ":""}[${l}] >`):mn}function vv(l,t,e){return t[l]?t[l].bind(t):$R(l,e)}const Nd=Pd();function GR(l,t,e){const i=Pd();if(typeof console=="object"&&l===!0||typeof l=="object"){const s=["debug","log","info","warn","error"];s.forEach(r=>{i[r]=vv(r,l,e)});try{i.log(`Debug logs enabled for "${t}" in hls.js version 1.6.9`)}catch{return Pd()}s.forEach(r=>{Nd[r]=vv(r,l)})}else Kt(Nd,i);return i}const Ft=Nd;function bn(l=!0){return typeof self>"u"?void 0:(l||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function HR(l){return typeof self<"u"&&l===self.ManagedMediaSource}function qT(l,t){const e=Object.keys(l),i=Object.keys(t),s=e.length,r=i.length;return!s||!r||s===r&&!e.some(o=>i.indexOf(o)===-1)}function yi(l,t=!1){if(typeof TextDecoder<"u"){const f=new TextDecoder("utf-8").decode(l);if(t){const g=f.indexOf("\0");return g!==-1?f.substring(0,g):f}return f.replace(/\0/g,"")}const e=l.length;let i,s,r,o="",c=0;for(;c<e;){if(i=l[c++],i===0&&t)return o;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:s=l[c++],o+=String.fromCharCode((i&31)<<6|s&63);break;case 14:s=l[c++],r=l[c++],o+=String.fromCharCode((i&15)<<12|(s&63)<<6|(r&63)<<0);break}}return o}const ks={hexDump:function(l){let t="";for(let e=0;e<l.length;e++){let i=l[e].toString(16);i.length<2&&(i="0"+i),t+=i}return t}};function XT(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function VR(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Xh={exports:{}},Ev;function KR(){return Ev||(Ev=1,function(l,t){(function(e){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(h,f,g){if(g=g||{},h=h.trim(),f=f.trim(),!f){if(!g.alwaysNormalize)return h;var m=c.parseURL(h);if(!m)throw new Error("Error trying to parse base URL.");return m.path=c.normalizePath(m.path),c.buildURLFromParts(m)}var y=c.parseURL(f);if(!y)throw new Error("Error trying to parse relative URL.");if(y.scheme)return g.alwaysNormalize?(y.path=c.normalizePath(y.path),c.buildURLFromParts(y)):f;var v=c.parseURL(h);if(!v)throw new Error("Error trying to parse base URL.");if(!v.netLoc&&v.path&&v.path[0]!=="/"){var T=s.exec(v.path);v.netLoc=T[1],v.path=T[2]}v.netLoc&&!v.path&&(v.path="/");var S={scheme:v.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(S.netLoc=v.netLoc,y.path[0]!=="/"))if(!y.path)S.path=v.path,y.params||(S.params=v.params,y.query||(S.query=v.query));else{var x=v.path,_=x.substring(0,x.lastIndexOf("/")+1)+y.path;S.path=c.normalizePath(_)}return S.path===null&&(S.path=g.alwaysNormalize?c.normalizePath(y.path):y.path),c.buildURLFromParts(S)},parseURL:function(h){var f=i.exec(h);return f?{scheme:f[1]||"",netLoc:f[2]||"",path:f[3]||"",params:f[4]||"",query:f[5]||"",fragment:f[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(r,"");h.length!==(h=h.replace(o,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};l.exports=c})()}(Xh)),Xh.exports}var Ag=KR();class bg{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Xt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class QT{constructor(t){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof t=="string"&&(t={url:t}),this.base=t,YR(this,"stats")}setByteRange(t,e){const i=t.split("@",2);let s;i.length===1?s=e?.byteRangeEndOffset||0:s=parseInt(i[1]),this._byteRange=[s,parseInt(i[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Xt.AUDIO]:null,[Xt.VIDEO]:null,[Xt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(t){this._streams=t}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new bg),this._stats}set stats(t){this._stats=t}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Ag.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(t){this._url=t}clearElementaryStreamInfo(){const{elementaryStreams:t}=this;t[Xt.AUDIO]=null,t[Xt.VIDEO]=null,t[Xt.AUDIOVIDEO]=null}}function ve(l){return l.sn!=="initSegment"}class Qh extends QT{constructor(t,e){super(e),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=t}get byteLength(){if(this.hasStats){const t=this.stats.total;if(t)return t}if(this.byteRange.length){const t=this.byteRange[0],e=this.byteRange[1];if(dt(t)&&dt(e))return e-t}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(t){this._bitrate=t}get decryptdata(){const{levelkeys:t}=this;if(!t&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1){const s=this._decryptdata=this.levelkeys[i[0]]||null;if(s)return s.getDecryptData(this.sn)}}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const t=dt(this.duration)?this.duration:0;return this.programDateTime+t*1e3}get encrypted(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){var e;const i=Object.keys(this.levelkeys),s=i.length;if(s>1||s===1&&(e=this.levelkeys[i[0]])!=null&&e.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(t){if(!dt(t)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=t}get ref(){return ve(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(t){this.setStart(this.start+t)}setStart(t){this.start=t,this._ref&&(this._ref.start=t)}setDuration(t){this.duration=t,this._ref&&(this._ref.duration=t)}setKeyFormat(t){if(this.levelkeys){const e=this.levelkeys[t];e&&!this._decryptdata&&(this._decryptdata=e.getDecryptData(this.sn))}}abortRequests(){var t,e;(t=this.loader)==null||t.abort(),(e=this.keyLoader)==null||e.abort()}setElementaryStreamInfo(t,e,i,s,r,o=!1){const{elementaryStreams:c}=this,h=c[t];if(!h){c[t]={startPTS:e,endPTS:i,startDTS:s,endDTS:r,partial:o};return}h.startPTS=Math.min(h.startPTS,e),h.endPTS=Math.max(h.endPTS,i),h.startDTS=Math.min(h.startDTS,s),h.endDTS=Math.max(h.endDTS,r)}}class zR extends QT{constructor(t,e,i,s,r){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=t.decimalFloatingPoint("DURATION"),this.gap=t.bool("GAP"),this.independent=t.bool("INDEPENDENT"),this.relurl=t.enumeratedString("URI"),this.fragment=e,this.index=s;const o=t.enumeratedString("BYTERANGE");o&&this.setByteRange(o,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:t}=this;return!!(t.audio||t.video||t.audiovideo)}}function WT(l,t){const e=Object.getPrototypeOf(l);if(e){const i=Object.getOwnPropertyDescriptor(e,t);return i||WT(e,t)}}function YR(l,t){const e=WT(l,t);e&&(e.enumerable=!0,Object.defineProperty(l,t,e))}const Tv=Math.pow(2,32)-1,jR=[].push,ZT={video:1,audio:2,id3:3,text:4};function Se(l){return String.fromCharCode.apply(null,l)}function JT(l,t){const e=l[t]<<8|l[t+1];return e<0?65536+e:e}function St(l,t){const e=tS(l,t);return e<0?4294967296+e:e}function Sv(l,t){let e=St(l,t);return e*=Math.pow(2,32),e+=St(l,t+4),e}function tS(l,t){return l[t]<<24|l[t+1]<<16|l[t+2]<<8|l[t+3]}function qR(l){const t=l.byteLength;for(let e=0;e<t;){const i=St(l,e);if(i>8&&l[e+4]===109&&l[e+5]===111&&l[e+6]===111&&l[e+7]===102)return!0;e=i>1?e+i:t}return!1}function Rt(l,t){const e=[];if(!t.length)return e;const i=l.byteLength;for(let s=0;s<i;){const r=St(l,s),o=Se(l.subarray(s+4,s+8)),c=r>1?s+r:i;if(o===t[0])if(t.length===1)e.push(l.subarray(s+8,c));else{const h=Rt(l.subarray(s+8,c),t.slice(1));h.length&&jR.apply(e,h)}s=c}return e}function XR(l){const t=[],e=l[0];let i=8;const s=St(l,i);i+=4;let r=0,o=0;e===0?(r=St(l,i),o=St(l,i+4),i+=8):(r=Sv(l,i),o=Sv(l,i+8),i+=16),i+=2;let c=l.length+o;const h=JT(l,i);i+=2;for(let f=0;f<h;f++){let g=i;const m=St(l,g);g+=4;const y=m&2147483647;if((m&2147483648)>>>31===1)return Ft.warn("SIDX has hierarchical references (not supported)"),null;const T=St(l,g);g+=4,t.push({referenceSize:y,subsegmentDuration:T,info:{duration:T/s,start:c,end:c+y-1}}),c+=y,g+=4,i=g}return{earliestPresentationTime:r,timescale:s,version:e,referencesCount:h,references:t}}function eS(l){const t=[],e=Rt(l,["moov","trak"]);for(let s=0;s<e.length;s++){const r=e[s],o=Rt(r,["tkhd"])[0];if(o){let c=o[0];const h=St(o,c===0?12:20),f=Rt(r,["mdia","mdhd"])[0];if(f){c=f[0];const g=St(f,c===0?12:20),m=Rt(r,["mdia","hdlr"])[0];if(m){const y=Se(m.subarray(8,12)),v={soun:Xt.AUDIO,vide:Xt.VIDEO}[y],T=Rt(r,["mdia","minf","stbl","stsd"])[0],S=QR(T);v?(t[h]={timescale:g,type:v,stsd:S},t[v]=Vt({timescale:g,id:h},S)):t[h]={timescale:g,type:y,stsd:S}}}}}return Rt(l,["moov","mvex","trex"]).forEach(s=>{const r=St(s,4),o=t[r];o&&(o.default={duration:St(s,12),flags:St(s,20)})}),t}function QR(l){const t=l.subarray(8),e=t.subarray(86),i=Se(t.subarray(4,8));let s=i,r;const o=i==="enca"||i==="encv";if(o){const f=Rt(t,[i])[0].subarray(i==="enca"?28:78);Rt(f,["sinf"]).forEach(m=>{const y=Rt(m,["schm"])[0];if(y){const v=Se(y.subarray(4,8));if(v==="cbcs"||v==="cenc"){const T=Rt(m,["frma"])[0];T&&(s=Se(T))}}})}const c=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const h=Rt(e,["avcC"])[0];h&&h.length>3&&(s+="."+Su(h[1])+Su(h[2])+Su(h[3]),r=Tu(c==="avc1"?"dva1":"dvav",e));break}case"mp4a":{const h=Rt(t,[i])[0],f=Rt(h.subarray(28),["esds"])[0];if(f&&f.length>7){let g=4;if(f[g++]!==3)break;g=Wh(f,g),g+=2;const m=f[g++];if(m&128&&(g+=2),m&64&&(g+=f[g++]),f[g++]!==4)break;g=Wh(f,g);const y=f[g++];if(y===64)s+="."+Su(y);else break;if(g+=12,f[g++]!==5)break;g=Wh(f,g);const v=f[g++];let T=(v&248)>>3;T===31&&(T+=1+((v&7)<<3)+((f[g]&224)>>5)),s+="."+T}break}case"hvc1":case"hev1":{const h=Rt(e,["hvcC"])[0];if(h&&h.length>12){const f=h[1],g=["","A","B","C"][f>>6],m=f&31,y=St(h,2),v=(f&32)>>5?"H":"L",T=h[12],S=h.subarray(6,12);s+="."+g+m,s+="."+WR(y).toString(16).toUpperCase(),s+="."+v+T;let x="";for(let _=S.length;_--;){const L=S[_];(L||x)&&(x="."+L.toString(16).toUpperCase()+x)}s+=x}r=Tu(c=="hev1"?"dvhe":"dvh1",e);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=Tu(s,e)||s;break}case"vp09":{const h=Rt(e,["vpcC"])[0];if(h&&h.length>6){const f=h[4],g=h[5],m=h[6]>>4&15;s+="."+es(f)+"."+es(g)+"."+es(m)}break}case"av01":{const h=Rt(e,["av1C"])[0];if(h&&h.length>2){const f=h[1]>>>5,g=h[1]&31,m=h[2]>>>7?"H":"M",y=(h[2]&64)>>6,v=(h[2]&32)>>5,T=f===2&&y?v?12:10:y?10:8,S=(h[2]&16)>>4,x=(h[2]&8)>>3,_=(h[2]&4)>>2,L=h[2]&3;s+="."+f+"."+es(g)+m+"."+es(T)+"."+S+"."+x+_+L+"."+es(1)+"."+es(1)+"."+es(1)+"."+0,r=Tu("dav1",e)}break}}return{codec:s,encrypted:o,supplemental:r}}function Tu(l,t){const e=Rt(t,["dvvC"]),i=e.length?e[0]:Rt(t,["dvcC"])[0];if(i){const s=i[2]>>1&127,r=i[2]<<5&32|i[3]>>3&31;return l+"."+es(s)+"."+es(r)}}function WR(l){let t=0;for(let e=0;e<32;e++)t|=(l>>e&1)<<31-e;return t>>>0}function Wh(l,t){const e=t+5;for(;l[t++]&128&&t<e;);return t}function Su(l){return("0"+l.toString(16).toUpperCase()).slice(-2)}function es(l){return(l<10?"0":"")+l}function ZR(l,t){if(!l||!t)return;const e=t.keyId;e&&t.isCommonEncryption&&Rt(l,["moov","trak"]).forEach(s=>{const o=Rt(s,["mdia","minf","stbl","stsd"])[0].subarray(8);let c=Rt(o,["enca"]);const h=c.length>0;h||(c=Rt(o,["encv"])),c.forEach(f=>{const g=h?f.subarray(28):f.subarray(78);Rt(g,["sinf"]).forEach(y=>{const v=iS(y);if(v){const T=v.subarray(8,24);T.some(S=>S!==0)||(Ft.log(`[eme] Patching keyId in 'enc${h?"a":"v"}>sinf>>tenc' box: ${ks.hexDump(T)} -> ${ks.hexDump(e)}`),v.set(e,8))}})})})}function iS(l){const t=Rt(l,["schm"])[0];if(t){const e=Se(t.subarray(4,8));if(e==="cbcs"||e==="cenc")return Rt(l,["schi","tenc"])[0]}return null}function JR(l,t,e){const i={},s=Rt(l,["moof","traf"]);for(let r=0;r<s.length;r++){const o=s[r],c=Rt(o,["tfhd"])[0],h=St(c,4),f=t[h];if(!f)continue;i[h]||(i[h]={start:NaN,duration:0,sampleCount:0,timescale:f.timescale,type:f.type});const g=i[h],m=Rt(o,["tfdt"])[0];if(m){const R=m[0];let C=St(m,4);R===1&&(C===Tv?e.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(C*=Tv+1,C+=St(m,8))),dt(C)&&(!dt(g.start)||C<g.start)&&(g.start=C)}const y=f.default,v=St(c,0)|y?.flags;let T=y?.duration||0;v&8&&(v&2?T=St(c,12):T=St(c,8));const S=Rt(o,["trun"]);let x=g.start||0,_=0,L=T;for(let R=0;R<S.length;R++){const C=S[R],I=St(C,4),U=g.sampleCount;g.sampleCount+=I;const O=C[3]&1,M=C[3]&4,w=C[2]&1,N=C[2]&2,z=C[2]&4,J=C[2]&8;let lt=8,ct=I;for(O&&(lt+=4),M&&I&&(!(C[lt+1]&1)&&g.keyFrameIndex===void 0&&(g.keyFrameIndex=U),lt+=4,w?(L=St(C,lt),lt+=4):L=T,N&&(lt+=4),J&&(lt+=4),x+=L,_+=L,ct--);ct--;)w?(L=St(C,lt),lt+=4):L=T,N&&(lt+=4),z&&(C[lt+1]&1||g.keyFrameIndex===void 0&&(g.keyFrameIndex=g.sampleCount-(ct+1),g.keyFrameStart=x),lt+=4),J&&(lt+=4),x+=L,_+=L;!_&&T&&(_+=T*I)}g.duration+=_}if(!Object.keys(i).some(r=>i[r].duration)){let r=1/0,o=0;const c=Rt(l,["sidx"]);for(let h=0;h<c.length;h++){const f=XR(c[h]);if(f!=null&&f.references){r=Math.min(r,f.earliestPresentationTime/f.timescale);const g=f.references.reduce((m,y)=>m+y.info.duration||0,0);o=Math.max(o,g+f.earliestPresentationTime/f.timescale)}}o&&dt(o)&&Object.keys(i).forEach(h=>{i[h].duration||(i[h].duration=o*i[h].timescale-i[h].start)})}return i}function tL(l){const t={valid:null,remainder:null},e=Rt(l,["moof"]);if(e.length<2)return t.remainder=l,t;const i=e[e.length-1];return t.valid=l.slice(0,i.byteOffset-8),t.remainder=l.slice(i.byteOffset-8),t}function Ui(l,t){const e=new Uint8Array(l.length+t.length);return e.set(l),e.set(t,l.length),e}function xv(l,t){const e=[],i=t.samples,s=t.timescale,r=t.id;let o=!1;return Rt(i,["moof"]).map(h=>{const f=h.byteOffset-8;Rt(h,["traf"]).map(m=>{const y=Rt(m,["tfdt"]).map(v=>{const T=v[0];let S=St(v,4);return T===1&&(S*=Math.pow(2,32),S+=St(v,8)),S/s})[0];return y!==void 0&&(l=y),Rt(m,["tfhd"]).map(v=>{const T=St(v,4),S=St(v,0)&16777215,x=(S&1)!==0,_=(S&2)!==0,L=(S&8)!==0;let R=0;const C=(S&16)!==0;let I=0;const U=(S&32)!==0;let O=8;T===r&&(x&&(O+=8),_&&(O+=4),L&&(R=St(v,O),O+=4),C&&(I=St(v,O),O+=4),U&&(O+=4),t.type==="video"&&(o=pc(t.codec)),Rt(m,["trun"]).map(M=>{const w=M[0],N=St(M,0)&16777215,z=(N&1)!==0;let J=0;const lt=(N&4)!==0,ct=(N&256)!==0;let at=0;const B=(N&512)!==0;let q=0;const W=(N&1024)!==0,ot=(N&2048)!==0;let k=0;const $=St(M,4);let j=8;z&&(J=St(M,j),j+=4),lt&&(j+=4);let st=J+f;for(let ut=0;ut<$;ut++){if(ct?(at=St(M,j),j+=4):at=R,B?(q=St(M,j),j+=4):q=I,W&&(j+=4),ot&&(w===0?k=St(M,j):k=tS(M,j),j+=4),t.type===Xt.VIDEO){let ft=0;for(;ft<q;){const ht=St(i,st);if(st+=4,eL(o,i[st])){const Nt=i.subarray(st,st+ht);Rg(Nt,o?2:1,l+k/s,e)}st+=ht,ft+=ht+4}}l+=at/s}}))})})}),e}function pc(l){if(!l)return!1;const t=l.substring(0,4);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function eL(l,t){if(l){const e=t>>1&63;return e===39||e===40}else return(t&31)===6}function Rg(l,t,e,i){const s=sS(l);let r=0;r+=t;let o=0,c=0,h=0;for(;r<s.length;){o=0;do{if(r>=s.length)break;h=s[r++],o+=h}while(h===255);c=0;do{if(r>=s.length)break;h=s[r++],c+=h}while(h===255);const f=s.length-r;let g=r;if(c<f)r+=c;else if(c>f){Ft.error(`Malformed SEI payload. ${c} is too small, only ${f} bytes left to parse.`);break}if(o===4){if(s[g++]===181){const y=JT(s,g);if(g+=2,y===49){const v=St(s,g);if(g+=4,v===1195456820){const T=s[g++];if(T===3){const S=s[g++],x=31&S,_=64&S,L=_?2+x*3:0,R=new Uint8Array(L);if(_){R[0]=S;for(let C=1;C<L;C++)R[C]=s[g++]}i.push({type:T,payloadType:o,pts:e,bytes:R})}}}}}else if(o===5&&c>16){const m=[];for(let T=0;T<16;T++){const S=s[g++].toString(16);m.push(S.length==1?"0"+S:S),(T===3||T===5||T===7||T===9)&&m.push("-")}const y=c-16,v=new Uint8Array(y);for(let T=0;T<y;T++)v[T]=s[g++];i.push({payloadType:o,pts:e,uuid:m.join(""),userData:yi(v),userDataBytes:v})}}}function sS(l){const t=l.byteLength,e=[];let i=1;for(;i<t-2;)l[i]===0&&l[i+1]===0&&l[i+2]===3?(e.push(i+2),i+=2):i++;if(e.length===0)return l;const s=t-e.length,r=new Uint8Array(s);let o=0;for(i=0;i<s;o++,i++)o===e[0]&&(o++,e.shift()),r[i]=l[o];return r}function iL(l){const t=l[0];let e="",i="",s=0,r=0,o=0,c=0,h=0,f=0;if(t===0){for(;Se(l.subarray(f,f+1))!=="\0";)e+=Se(l.subarray(f,f+1)),f+=1;for(e+=Se(l.subarray(f,f+1)),f+=1;Se(l.subarray(f,f+1))!=="\0";)i+=Se(l.subarray(f,f+1)),f+=1;i+=Se(l.subarray(f,f+1)),f+=1,s=St(l,12),r=St(l,16),c=St(l,20),h=St(l,24),f=28}else if(t===1){f+=4,s=St(l,f),f+=4;const m=St(l,f);f+=4;const y=St(l,f);for(f+=4,o=2**32*m+y,kR(o)||(o=Number.MAX_SAFE_INTEGER,Ft.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=St(l,f),f+=4,h=St(l,f),f+=4;Se(l.subarray(f,f+1))!=="\0";)e+=Se(l.subarray(f,f+1)),f+=1;for(e+=Se(l.subarray(f,f+1)),f+=1;Se(l.subarray(f,f+1))!=="\0";)i+=Se(l.subarray(f,f+1)),f+=1;i+=Se(l.subarray(f,f+1)),f+=1}const g=l.subarray(f,l.byteLength);return{schemeIdUri:e,value:i,timeScale:s,presentationTime:o,presentationTimeDelta:r,eventDuration:c,id:h,payload:g}}function sL(l,...t){const e=t.length;let i=8,s=e;for(;s--;)i+=t[s].byteLength;const r=new Uint8Array(i);for(r[0]=i>>24&255,r[1]=i>>16&255,r[2]=i>>8&255,r[3]=i&255,r.set(l,4),s=0,i=8;s<e;s++)r.set(t[s],i),i+=t[s].byteLength;return r}function nL(l,t,e){if(l.byteLength!==16)throw new RangeError("Invalid system id");let i,s;i=0,s=new Uint8Array;let r;i>0?(r=new Uint8Array(4),t.length>0&&new DataView(r.buffer).setUint32(0,t.length,!1)):r=new Uint8Array;const o=new Uint8Array(4);return e.byteLength>0&&new DataView(o.buffer).setUint32(0,e.byteLength,!1),sL([112,115,115,104],new Uint8Array([i,0,0,0]),l,r,s,o,e)}const nS=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Ea={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Lg(l,t){const e=Ea[t];return!!e&&!!e[l.slice(0,4)]}function Ud(l,t,e=!0){return!l.split(",").some(i=>!Dg(i,t,e))}function Dg(l,t,e=!0){var i;const s=bn(e);return(i=s?.isTypeSupported(Vl(l,t)))!=null?i:!1}function Vl(l,t){return`${t}/mp4;codecs=${l}`}function _v(l){if(l){const t=l.substring(0,4);return Ea.video[t]}return 2}function ec(l){const t=nS();return l.split(",").reduce((e,i)=>{const r=t&&pc(i)?9:Ea.video[i];return r?(r*2+e)/(e?3:2):(Ea.audio[i]+e)/(e?2:1)},0)}const Zh={};function rL(l,t=!0){if(Zh[l])return Zh[l];const e={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[l];for(let s=0;s<e.length;s++){var i;if(Dg(e[s],"audio",t))return Zh[l]=e[s],e[s];if(e[s]==="mp3"&&(i=bn(t))!=null&&i.isTypeSupported("audio/mpeg"))return""}return l}const aL=/flac|opus|mp4a\.40\.34/i;function ic(l,t=!0){return l.replace(aL,e=>rL(e.toLowerCase(),t))}function lL(l,t){const e=[];if(l){const i=l.split(",");for(let s=0;s<i.length;s++)Lg(i[s],"video")||e.push(i[s])}return t&&e.push(t),e.join(",")}function Fu(l,t){if(l&&(l.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(l)!==-1)&&(Av(l,"audio")||Av(l,"video")))return l;if(t){const e=t.split(",");if(e.length>1){if(l){for(let i=e.length;i--;)if(e[i].substring(0,4)===l.substring(0,4))return e[i]}return e[0]}}return t||l}function Av(l,t){return Lg(l,t)&&Dg(l,t)}function oL(l){const t=l.split(",");for(let e=0;e<t.length;e++){const i=t[e].split(".");i.length>2&&i[0]==="avc1"&&(t[e]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return t.join(",")}function uL(l){if(l.startsWith("av01.")){const t=l.split("."),e=["0","111","01","01","01","0"];for(let i=t.length;i>4&&i<10;i++)t[i]=e[i-4];return t.join(".")}return l}function bv(l){const t=bn(l)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Bd(l){return l.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const rS={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function aS(l,t){return{supported:!1,configurations:t,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:l}}function cL(l,t,e,i,s,r){const o=l.videoCodec,c=l.audioCodec?l.audioGroups:null,h=r?.audioCodec,f=r?.channels,g=f?parseInt(f):h?1/0:2;let m=null;if(c!=null&&c.length)try{c.length===1&&c[0]?m=t.groups[c[0]].channels:m=c.reduce((y,v)=>{if(v){const T=t.groups[v];if(!T)throw new Error(`Audio track group ${v} not found`);Object.keys(T.channels).forEach(S=>{y[S]=(y[S]||0)+T.channels[S]})}return y},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(y=>pc(y))||l.width>1920&&l.height>1088||l.height>1920&&l.width>1088||l.frameRate>Math.max(i,30)||l.videoRange!=="SDR"&&l.videoRange!==e||l.bitrate>Math.max(s,8e6))||!!m&&dt(g)&&Object.keys(m).some(y=>parseInt(y)>g)}function lS(l,t,e,i={}){const s=l.videoCodec;if(!s&&!l.audioCodec||!e)return Promise.resolve(rS);const r=[],o=fL(l),c=o.length,h=hL(l,t,c>0),f=h.length;for(let g=c||1*f||1;g--;){const m={type:"media-source"};if(c&&(m.video=o[g%c]),f){m.audio=h[g%f];const y=m.audio.bitrate;m.video&&y&&(m.video.bitrate-=y)}r.push(m)}if(s){const g=navigator.userAgent;if(s.split(",").some(m=>pc(m))&&nS())return Promise.resolve(aS(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${g})`),r))}return Promise.all(r.map(g=>{const m=gL(g);return i[m]||(i[m]=e.decodingInfo(g))})).then(g=>({supported:!g.some(m=>!m.supported),configurations:r,decodingInfoResults:g})).catch(g=>({supported:!1,configurations:r,decodingInfoResults:[],error:g}))}function fL(l){var t;const e=(t=l.videoCodec)==null?void 0:t.split(","),i=oS(l),s=l.width||640,r=l.height||480,o=l.frameRate||30,c=l.videoRange.toLowerCase();return e?e.map(h=>{const f={contentType:Vl(uL(h),"video"),width:s,height:r,bitrate:i,framerate:o};return c!=="sdr"&&(f.transferFunction=c),f}):[]}function hL(l,t,e){var i;const s=(i=l.audioCodec)==null?void 0:i.split(","),r=oS(l);return s&&l.audioGroups?l.audioGroups.reduce((o,c)=>{var h;const f=c?(h=t.groups[c])==null?void 0:h.tracks:null;return f?f.reduce((g,m)=>{if(m.groupId===c){const y=parseFloat(m.channels||"");s.forEach(v=>{const T={contentType:Vl(v,"audio"),bitrate:e?dL(v,r):r};y&&(T.channels=""+y),g.push(T)})}return g},o):o},[]):[]}function dL(l,t){if(t<=1)return 1;let e=128e3;return l==="ec-3"?e=768e3:l==="ac-3"&&(e=64e4),Math.min(t/2,e)}function oS(l){return Math.ceil(Math.max(l.bitrate*.9,l.averageBitrate)/1e3)*1e3||1}function gL(l){let t="";const{audio:e,video:i}=l;if(i){const s=Bd(i.contentType);t+=`${s}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(e){const s=Bd(e.contentType);t+=`${i?"_":""}${s}_c${e.channels}`}return t}const Fd=["NONE","TYPE-0","TYPE-1",null];function mL(l){return Fd.indexOf(l)>-1}const sc=["SDR","PQ","HLG"];function pL(l){return!!l&&sc.indexOf(l)>-1}var $u={No:"",Yes:"YES",v2:"v2"};function Rv(l){const{canSkipUntil:t,canSkipDateRanges:e,age:i}=l,s=i<t/2;return t&&s?e?$u.v2:$u.Yes:$u.No}class Lv{constructor(t,e,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=i}addDirectives(t){const e=new self.URL(t);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class Kl{constructor(t){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.frameRate=t.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=t.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.codecSet=[t.videoCodec,t.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in t){var e;this.supplemental=t.supplemental;const i=(e=t.supplemental)==null?void 0:e.videoCodec;i&&i!==t.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",t.attrs.AUDIO),this.addGroupId("text",t.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(t){return Dv(this._audioGroups,t)}hasSubtitleGroup(t){return Dv(this._subtitleGroups,t)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(t,e){if(e){if(t==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(e)===-1&&i.push(e)}else if(t==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(e)===-1&&i.push(e)}}}get urlId(){return 0}set urlId(t){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var t;return(t=this.audioGroups)==null?void 0:t[0]}get textGroupId(){var t;return(t=this.subtitleGroups)==null?void 0:t[0]}addFallback(){}}function Dv(l,t){return!t||!l?!1:l.indexOf(t)!==-1}function yL(){if(typeof matchMedia=="function"){const l=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(l.media!==t.media)return l.matches===!0}return!1}function vL(l,t){let e=!1,i=[];if(l&&(e=l!=="SDR",i=[l]),t){i=t.allowedVideoRanges||sc.slice(0);const s=i.join("")!=="SDR"&&!t.videoCodec;e=t.preferHDR!==void 0?t.preferHDR:s&&yL(),e||(i=["SDR"])}return{preferHDR:e,allowedVideoRanges:i}}const EL=l=>{const t=new WeakSet;return(e,i)=>{if(l&&(i=l(e,i)),typeof i=="object"&&i!==null){if(t.has(i))return;t.add(i)}return i}},Wt=(l,t)=>JSON.stringify(l,EL(t));function TL(l,t,e,i,s){const r=Object.keys(l),o=i?.channels,c=i?.audioCodec,h=s?.videoCodec,f=o&&parseInt(o)===2;let g=!1,m=!1,y=1/0,v=1/0,T=1/0,S=1/0,x=0,_=[];const{preferHDR:L,allowedVideoRanges:R}=vL(t,s);for(let M=r.length;M--;){const w=l[r[M]];g||(g=w.channels[2]>0),y=Math.min(y,w.minHeight),v=Math.min(v,w.minFramerate),T=Math.min(T,w.minBitrate),R.filter(z=>w.videoRanges[z]>0).length>0&&(m=!0)}y=dt(y)?y:0,v=dt(v)?v:0;const C=Math.max(1080,y),I=Math.max(30,v);T=dt(T)?T:e,e=Math.max(T,e),m||(t=void 0);const U=r.length>1;return{codecSet:r.reduce((M,w)=>{const N=l[w];if(w===M)return M;if(_=m?R.filter(z=>N.videoRanges[z]>0):[],U){if(N.minBitrate>e)return Ji(w,`min bitrate of ${N.minBitrate} > current estimate of ${e}`),M;if(!N.hasDefaultAudio)return Ji(w,"no renditions with default or auto-select sound found"),M;if(c&&w.indexOf(c.substring(0,4))%5!==0)return Ji(w,`audio codec preference "${c}" not found`),M;if(o&&!f){if(!N.channels[o])return Ji(w,`no renditions with ${o} channel sound found (channels options: ${Object.keys(N.channels)})`),M}else if((!c||f)&&g&&N.channels[2]===0)return Ji(w,"no renditions with stereo sound found"),M;if(N.minHeight>C)return Ji(w,`min resolution of ${N.minHeight} > maximum of ${C}`),M;if(N.minFramerate>I)return Ji(w,`min framerate of ${N.minFramerate} > maximum of ${I}`),M;if(!_.some(z=>N.videoRanges[z]>0))return Ji(w,`no variants with VIDEO-RANGE of ${Wt(_)} found`),M;if(h&&w.indexOf(h.substring(0,4))%5!==0)return Ji(w,`video codec preference "${h}" not found`),M;if(N.maxScore<x)return Ji(w,`max score of ${N.maxScore} < selected max of ${x}`),M}return M&&(ec(w)>=ec(M)||N.fragmentError>l[M].fragmentError)?M:(S=N.minIndex,x=N.maxScore,w)},void 0),videoRanges:_,preferHDR:L,minFramerate:v,minBitrate:T,minIndex:S}}function Ji(l,t){Ft.log(`[abr] start candidates with "${l}" ignored because ${t}`)}function uS(l){return l.reduce((t,e)=>{let i=t.groups[e.groupId];i||(i=t.groups[e.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(e);const s=e.channels||"2";return i.channels[s]=(i.channels[s]||0)+1,i.hasDefault=i.hasDefault||e.default,i.hasAutoSelect=i.hasAutoSelect||e.autoselect,i.hasDefault&&(t.hasDefaultAudio=!0),i.hasAutoSelect&&(t.hasAutoSelectAudio=!0),t},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function SL(l,t,e,i){return l.slice(e,i+1).reduce((s,r,o)=>{if(!r.codecSet)return s;const c=r.audioGroups;let h=s[r.codecSet];h||(s[r.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,r.bitrate);const f=Math.min(r.height,r.width);return h.minHeight=Math.min(h.minHeight,f),h.minFramerate=Math.min(h.minFramerate,r.frameRate),h.minIndex=Math.min(h.minIndex,o),h.maxScore=Math.max(h.maxScore,r.score),h.fragmentError+=r.fragmentError,h.videoRanges[r.videoRange]=(h.videoRanges[r.videoRange]||0)+1,c&&c.forEach(g=>{if(!g)return;const m=t.groups[g];m&&(h.hasDefaultAudio=h.hasDefaultAudio||t.hasDefaultAudio?m.hasDefault:m.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(m.channels).forEach(y=>{h.channels[y]=(h.channels[y]||0)+m.channels[y]}))}),s},{})}function Iv(l){if(!l)return l;const{lang:t,assocLang:e,characteristics:i,channels:s,audioCodec:r}=l;return{lang:t,assocLang:e,characteristics:i,channels:s,audioCodec:r}}function as(l,t,e){if("attrs"in l){const i=t.indexOf(l);if(i!==-1)return i}for(let i=0;i<t.length;i++){const s=t[i];if(lr(l,s,e))return i}return-1}function lr(l,t,e){const{groupId:i,name:s,lang:r,assocLang:o,default:c}=l,h=l.forced;return(i===void 0||t.groupId===i)&&(s===void 0||t.name===s)&&(r===void 0||xL(r,t.lang))&&(r===void 0||t.assocLang===o)&&(c===void 0||t.default===c)&&(h===void 0||t.forced===h)&&(!("characteristics"in l)||_L(l.characteristics||"",t.characteristics))&&(e===void 0||e(l,t))}function xL(l,t="--"){return l.length===t.length?l===t:l.startsWith(t)||t.startsWith(l)}function _L(l,t=""){const e=l.split(","),i=t.split(",");return e.length===i.length&&!e.some(s=>i.indexOf(s)===-1)}function er(l,t){const{audioCodec:e,channels:i}=l;return(e===void 0||(t.audioCodec||"").substring(0,4)===e.substring(0,4))&&(i===void 0||i===(t.channels||"2"))}function AL(l,t,e,i,s){const r=t[i],c=t.reduce((y,v,T)=>{const S=v.uri;return(y[S]||(y[S]=[])).push(T),y},{})[r.uri];c.length>1&&(i=Math.max.apply(Math,c));const h=r.videoRange,f=r.frameRate,g=r.codecSet.substring(0,4),m=Cv(t,i,y=>{if(y.videoRange!==h||y.frameRate!==f||y.codecSet.substring(0,4)!==g)return!1;const v=y.audioGroups,T=e.filter(S=>!v||v.indexOf(S.groupId)!==-1);return as(l,T,s)>-1});return m>-1?m:Cv(t,i,y=>{const v=y.audioGroups,T=e.filter(S=>!v||v.indexOf(S.groupId)!==-1);return as(l,T,s)>-1})}function Cv(l,t,e){for(let i=t;i>-1;i--)if(e(l[i]))return i;for(let i=t+1;i<l.length;i++)if(e(l[i]))return i;return-1}function nc(l,t){var e;return!!l&&l!==((e=t.loadLevelObj)==null?void 0:e.uri)}class bL extends zi{constructor(t){super("abr",t.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var i;const{fragCurrent:s,partCurrent:r,hls:o}=this,{autoLevelEnabled:c,media:h}=o;if(!s||!h)return;const f=performance.now(),g=r?r.stats:s.stats,m=r?r.duration:s.duration,y=f-g.loading.start,v=o.minAutoLevel,T=s.level,S=this._nextAutoLevel;if(g.aborted||g.loaded&&g.loaded===g.total||T<=v){this.clearTimer(),this._nextAutoLevel=-1;return}if(!c)return;const x=S>-1&&S!==T,_=!!e||x;if(!_&&(h.paused||!h.playbackRate||!h.readyState))return;const L=o.mainForwardBufferInfo;if(!_&&L===null)return;const R=this.bwEstimator.getEstimateTTFB(),C=Math.abs(h.playbackRate);if(y<=Math.max(R,1e3*(m/(C*2))))return;const I=L?L.len/C:0,U=g.loading.first?g.loading.first-g.loading.start:-1,O=g.loaded&&U>-1,M=this.getBwEstimate(),w=o.levels,N=w[T],z=Math.max(g.loaded,Math.round(m*(s.bitrate||N.averageBitrate)/8));let J=O?y-U:y;J<1&&O&&(J=Math.min(y,g.loaded*8/M));const lt=O?g.loaded*1e3/J:0,ct=R/1e3,at=lt?(z-g.loaded)/lt:z*8/M+ct;if(at<=I)return;const B=lt?lt*8:M,q=((i=e?.details||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,W=this.hls.config.abrBandWidthUpFactor;let ot=Number.POSITIVE_INFINITY,k;for(k=T-1;k>v;k--){const ut=w[k].maxBitrate,ft=!w[k].details||q;if(ot=this.getTimeToLoadFrag(ct,B,m*ut,ft),ot<Math.min(I,m+ct))break}if(ot>=at||ot>m*10)return;O?this.bwEstimator.sample(y-Math.min(R,U),g.loaded):this.bwEstimator.sampleTTFB(y);const $=w[k].maxBitrate;this.getBwEstimate()*W>$&&this.resetEstimator($);const j=this.findBestLevel($,v,k,0,I,1,1);j>-1&&(k=j),this.warn(`Fragment ${s.sn}${r?" part "+r.index:""} of level ${T} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${I.toFixed(3)} s
      Estimated load time for current fragment: ${at.toFixed(3)} s
      Estimated load time for down switch fragment: ${ot.toFixed(3)} s
      TTFB estimate: ${U|0} ms
      Current BW estimate: ${dt(M)?M|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${k} @ ${$|0} bps`),o.nextLoadLevel=o.nextAutoLevel=k,this.clearTimer();const st=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===k&&k>0){const ut=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${k>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${ut.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,k>v){let ft=this.findBestLevel(this.hls.levels[v].bitrate,v,k,0,ut,1,1);ft===-1&&(ft=v),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ft,this.resetEstimator(this.hls.levels[ft].bitrate)}}};x||at>ot*2?st():this.timer=self.setInterval(st,ot*1e3),o.trigger(A.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:r,stats:g})},this.hls=t,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(t){t&&(this.log(`setting initial bwe to ${t}`),this.hls.config.abrEwmaDefaultEstimate=t),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const t=this.hls.config;return new PR(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate)}registerListeners(){const{hls:t}=this;t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.FRAG_LOADING,this.onFragLoading,this),t.on(A.FRAG_LOADED,this.onFragLoaded,this),t.on(A.FRAG_BUFFERED,this.onFragBuffered,this),t.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(A.LEVEL_LOADED,this.onLevelLoaded,this),t.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(A.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t&&(t.off(A.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.FRAG_LOADING,this.onFragLoading,this),t.off(A.FRAG_LOADED,this.onFragLoaded,this),t.off(A.FRAG_BUFFERED,this.onFragBuffered,this),t.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(A.LEVEL_LOADED,this.onLevelLoaded,this),t.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(A.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.off(A.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(t,e){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(t,e){const i=e.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var s;this.fragCurrent=i,this.partCurrent=(s=e.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(t,e){this.clearTimer()}onError(t,e){if(!e.fatal)switch(e.details){case K.BUFFER_ADD_CODEC_ERROR:case K.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case K.FRAG_LOAD_TIMEOUT:{const i=e.frag,{fragCurrent:s,partCurrent:r}=this;if(i&&s&&i.sn===s.sn&&i.level===s.level){const o=performance.now(),c=r?r.stats:i.stats,h=o-c.loading.start,f=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&f>-1){const m=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(m,f),c.loaded)}else this.bwEstimator.sampleTTFB(h)}break}}}getTimeToLoadFrag(t,e,i,s){const r=t+i/e,o=s?t+this.lastLevelLoadSec:0;return r+o}onLevelLoaded(t,e){const i=this.hls.config,{loading:s}=e.stats,r=s.end-s.first;dt(r)&&(this.lastLevelLoadSec=r/1e3),e.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(e.levelInfo)}onFragLoaded(t,{frag:e,part:i}){const s=i?i.stats:e.stats;if(e.type===mt.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(e)){if(this.clearTimer(),e.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const r=i?i.duration:e.duration,o=this.hls.levels[e.level],c=(o.loaded?o.loaded.bytes:0)+s.loaded,h=(o.loaded?o.loaded.duration:0)+r;o.loaded={bytes:c,duration:h},o.realBitrate=Math.round(8*c/h)}if(e.bitrateTest){const r={stats:s,frag:e,part:i,id:e.type};this.onFragBuffered(A.FRAG_BUFFERED,r),e.bitrateTest=!1}else this.lastLoadedFragLevel=e.level}}onFragBuffered(t,e){const{frag:i,part:s}=e,r=s!=null&&s.stats.loaded?s.stats:i.stats;if(r.aborted||this.ignoreFragment(i))return;const o=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,r.loaded),r.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(t){return t.type!==mt.MAIN||t.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:t,minAutoLevel:e}=this.hls,i=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,r=this.findBestLevel(i,e,t,0,s,1,1);if(r>-1)return r;const o=this.hls.firstLevel,c=Math.min(Math.max(o,e),t);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const t=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(t!==-1&&(!i||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return t;const r=i&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(t!==-1){const o=this.hls.levels;if(o.length>Math.max(t,r)&&o[t].loadError<=o[r].loadError)return t}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:t,partCurrent:e,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:s,config:r,minAutoLevel:o}=i,c=e?e.duration:t?t.duration:0,h=this.getBwEstimate(),f=this.getStarvationDelay();let g=r.abrBandWidthFactor,m=r.abrBandWidthUpFactor;if(f){const x=this.findBestLevel(h,o,s,f,0,g,m);if(x>=0)return this.rebufferNotice=-1,x}let y=c?Math.min(c,r.maxStarvationDelay):r.maxStarvationDelay;if(!f){const x=this.bitrateTestDelay;x&&(y=(c?Math.min(c,r.maxLoadingDelay):r.maxLoadingDelay)-x,this.info(`bitrate test took ${Math.round(1e3*x)}ms, set first fragment max fetchDuration to ${Math.round(1e3*y)} ms`),g=m=1)}const v=this.findBestLevel(h,o,s,f,y,g,m);if(this.rebufferNotice!==v&&(this.rebufferNotice=v,this.info(`${f?"rebuffering expected":"buffer is empty"}, optimal quality level ${v}`)),v>-1)return v;const T=i.levels[o],S=i.loadLevelObj;return S&&T?.bitrate<S.bitrate?o:i.loadLevel}getStarvationDelay(){const t=this.hls,e=t.media;if(!e)return 1/0;const i=e&&e.playbackRate!==0?Math.abs(e.playbackRate):1,s=t.mainForwardBufferInfo;return(s?s.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(t,e,i,s,r,o,c){var h;const f=s+r,g=this.lastLoadedFragLevel,m=g===-1?this.hls.firstLevel:g,{fragCurrent:y,partCurrent:v}=this,{levels:T,allAudioTracks:S,loadLevel:x,config:_}=this.hls;if(T.length===1)return 0;const L=T[m],R=!!((h=this.hls.latestLevelDetails)!=null&&h.live),C=x===-1||g===-1;let I,U="SDR",O=L?.frameRate||0;const{audioPreference:M,videoPreference:w}=_,N=this.audioTracksByGroup||(this.audioTracksByGroup=uS(S));let z=-1;if(C){if(this.firstSelection!==-1)return this.firstSelection;const B=this.codecTiers||(this.codecTiers=SL(T,N,e,i)),q=TL(B,U,t,M,w),{codecSet:W,videoRanges:ot,minFramerate:k,minBitrate:$,minIndex:j,preferHDR:st}=q;z=j,I=W,U=st?ot[ot.length-1]:ot[0],O=k,t=Math.max(t,$),this.log(`picked start tier ${Wt(q)}`)}else I=L?.codecSet,U=L?.videoRange;const J=v?v.duration:y?y.duration:0,lt=this.bwEstimator.getEstimateTTFB()/1e3,ct=[];for(let B=i;B>=e;B--){var at;const q=T[B],W=B>m;if(!q)continue;if(_.useMediaCapabilities&&!q.supportedResult&&!q.supportedPromise){const ft=navigator.mediaCapabilities;typeof ft?.decodingInfo=="function"&&cL(q,N,U,O,t,M)?(q.supportedPromise=lS(q,N,ft,this.supportedCache),q.supportedPromise.then(ht=>{if(!this.hls)return;q.supportedResult=ht;const Nt=this.hls.levels,_t=Nt.indexOf(q);ht.error?this.warn(`MediaCapabilities decodingInfo error: "${ht.error}" for level ${_t} ${Wt(ht)}`):ht.supported?ht.decodingInfoResults.some(ce=>ce.smooth===!1||ce.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${_t} not smooth or powerEfficient: ${Wt(ht)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${_t} ${Wt(ht)}`),_t>-1&&Nt.length>1&&(this.log(`Removing unsupported level ${_t}`),this.hls.removeLevel(_t),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):q.supportedResult=rS}if((I&&q.codecSet!==I||U&&q.videoRange!==U||W&&O>q.frameRate||!W&&O>0&&O<q.frameRate||(at=q.supportedResult)!=null&&(at=at.decodingInfoResults)!=null&&at.some(ft=>ft.smooth===!1))&&(!C||B!==z)){ct.push(B);continue}const ot=q.details,k=(v?ot?.partTarget:ot?.averagetargetduration)||J;let $;W?$=c*t:$=o*t;const j=J&&s>=J*2&&r===0?q.averageBitrate:q.maxBitrate,st=this.getTimeToLoadFrag(lt,$,j*k,ot===void 0);if($>=j&&(B===g||q.loadError===0&&q.fragmentError===0)&&(st<=lt||!dt(st)||R&&!this.bitrateTestDelay||st<f)){const ft=this.forcedAutoLevel;return B!==x&&(ft===-1||ft!==x)&&(ct.length&&this.trace(`Skipped level(s) ${ct.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${T[ct[0]].codecs}" ${T[ct[0]].videoRange}; not compatible with "${I}" ${U}`),this.info(`switch candidate:${m}->${B} adjustedbw(${Math.round($)})-bitrate=${Math.round($-j)} ttfb:${lt.toFixed(1)} avgDuration:${k.toFixed(1)} maxFetchDuration:${f.toFixed(1)} fetchDuration:${st.toFixed(1)} firstSelection:${C} codecSet:${q.codecSet} videoRange:${q.videoRange} hls.loadLevel:${x}`)),C&&(this.firstSelection=B),B}}return-1}set nextAutoLevel(t){const e=this.deriveNextAutoLevel(t);this._nextAutoLevel!==e&&(this.nextAutoLevelKey="",this._nextAutoLevel=e)}deriveNextAutoLevel(t){const{maxAutoLevel:e,minAutoLevel:i}=this.hls;return Math.min(Math.max(t,i),e)}}const cS={search:function(l,t){let e=0,i=l.length-1,s=null,r=null;for(;e<=i;){s=(e+i)/2|0,r=l[s];const o=t(r);if(o>0)e=s+1;else if(o<0)i=s-1;else return r}return null}};function RL(l,t,e){if(t===null||!Array.isArray(l)||!l.length||!dt(t))return null;const i=l[0].programDateTime;if(t<(i||0))return null;const s=l[l.length-1].endProgramDateTime;if(t>=(s||0))return null;for(let r=0;r<l.length;++r){const o=l[r];if(DL(t,e,o))return o}return null}function ur(l,t,e=0,i=0,s=.005){let r=null;if(l){r=t[1+l.sn-t[0].sn]||null;const c=l.endDTS-e;c>0&&c<15e-7&&(e+=15e-7),r&&l.level!==r.level&&r.end<=l.end&&(r=t[2+l.sn-t[0].sn]||null)}else e===0&&t[0].start===0&&(r=t[0]);if(r&&((!l||l.level===r.level)&&Ov(e,i,r)===0||LL(r,l,Math.min(s,i))))return r;const o=cS.search(t,Ov.bind(null,e,i));return o&&(o!==l||!r)?o:r}function LL(l,t,e){if(t&&t.start===0&&t.level<l.level&&(t.endPTS||0)>0){const i=t.tagList.reduce((s,r)=>(r[0]==="INF"&&(s+=parseFloat(r[1])),s),e);return l.start<=i}return!1}function Ov(l=0,t=0,e){if(e.start<=l&&e.start+e.duration>l)return 0;const i=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-i<=l?1:e.start-i>l&&e.start?-1:0}function DL(l,t,e){const i=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0))*1e3;return(e.endProgramDateTime||0)-i>l}function fS(l,t,e){if(l&&l.startCC<=t&&l.endCC>=t){let i=l.fragments;const{fragmentHint:s}=l;s&&(i=i.concat(s));let r;return cS.search(i,o=>o.cc<t?1:o.cc>t?-1:(r=o,o.end<=e?1:o.start>e?-1:0)),r||null}return null}function rc(l){switch(l.details){case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_TIMEOUT:case K.LEVEL_LOAD_TIMEOUT:case K.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function wv(l,t){const e=rc(t);return l.default[`${e?"timeout":"error"}Retry`]}function Ig(l,t){const e=l.backoff==="linear"?1:Math.pow(2,t);return Math.min(e*l.retryDelayMs,l.maxRetryDelayMs)}function kv(l){return Vt(Vt({},l),{errorRetry:null,timeoutRetry:null})}function ac(l,t,e,i){if(!l)return!1;const s=i?.code,r=t<l.maxNumRetry&&(IL(s)||!!e);return l.shouldRetry?l.shouldRetry(l,t,e,i,r):r}function IL(l){return l===0&&navigator.onLine===!1||!!l&&(l<400||l>499)}var Be={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Ki={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2};class CL extends zi{constructor(t){super("error-controller",t.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=t,this.registerListeners()}registerListeners(){const t=this.hls;t.on(A.ERROR,this.onError,this),t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const t=this.hls;t&&(t.off(A.ERROR,this.onError,this),t.off(A.ERROR,this.onErrorOut,this),t.off(A.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(t){}stopLoad(){this.playlistError=0}getVariantLevelIndex(t){return t?.type===mt.MAIN?t.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(t,e){var i;if(e.fatal)return;const s=this.hls,r=e.context;switch(e.details){case K.FRAG_LOAD_ERROR:case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_ERROR:case K.KEY_LOAD_TIMEOUT:e.errorAction=this.getFragRetryOrSwitchAction(e);return;case K.FRAG_PARSING_ERROR:if((i=e.frag)!=null&&i.gap){e.errorAction=zl();return}case K.FRAG_GAP:case K.FRAG_DECRYPT_ERROR:{e.errorAction=this.getFragRetryOrSwitchAction(e),e.errorAction.action=Be.SendAlternateToPenaltyBox;return}case K.LEVEL_EMPTY_ERROR:case K.LEVEL_PARSING_ERROR:{var o;const h=e.parent===mt.MAIN?e.level:s.loadLevel;e.details===K.LEVEL_EMPTY_ERROR&&((o=e.context)!=null&&(o=o.levelDetails)!=null&&o.live)?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,h):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,h))}return;case K.LEVEL_LOAD_ERROR:case K.LEVEL_LOAD_TIMEOUT:typeof r?.level=="number"&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,r.level));return;case K.AUDIO_TRACK_LOAD_ERROR:case K.AUDIO_TRACK_LOAD_TIMEOUT:case K.SUBTITLE_LOAD_ERROR:case K.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const h=s.loadLevelObj;if(h&&(r.type===Dt.AUDIO_TRACK&&h.hasAudioGroup(r.groupId)||r.type===Dt.SUBTITLE_TRACK&&h.hasSubtitleGroup(r.groupId))){e.errorAction=this.getPlaylistRetryOrSwitchAction(e,s.loadLevel),e.errorAction.action=Be.SendAlternateToPenaltyBox,e.errorAction.flags=Ki.MoveAllAlternatesMatchingHost;return}}return;case K.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const h=s.loadLevelObj,f=h?.attrs["HDCP-LEVEL"];f?e.errorAction={action:Be.SendAlternateToPenaltyBox,flags:Ki.MoveAllAlternatesMatchingHDCP,hdcpLevel:f}:this.keySystemError(e)}return;case K.BUFFER_ADD_CODEC_ERROR:case K.REMUX_ALLOC_ERROR:case K.BUFFER_APPEND_ERROR:if(!e.errorAction){var c;e.errorAction=this.getLevelSwitchAction(e,(c=e.level)!=null?c:s.loadLevel)}return;case K.INTERNAL_EXCEPTION:case K.BUFFER_APPENDING_ERROR:case K.BUFFER_FULL_ERROR:case K.LEVEL_SWITCH_ERROR:case K.BUFFER_STALLED_ERROR:case K.BUFFER_SEEK_OVER_HOLE:case K.BUFFER_NUDGE_ON_STALL:e.errorAction=zl();return}e.type===pt.KEY_SYSTEM_ERROR&&this.keySystemError(e)}keySystemError(t){const e=this.getVariantLevelIndex(t.frag);t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e)}getPlaylistRetryOrSwitchAction(t,e){const i=this.hls,s=wv(i.config.playlistLoadPolicy,t),r=this.playlistError++;if(ac(s,r,rc(t),t.response))return{action:Be.RetryRequest,flags:Ki.None,retryConfig:s,retryCount:r};const c=this.getLevelSwitchAction(t,e);return s&&(c.retryConfig=s,c.retryCount=r),c}getFragRetryOrSwitchAction(t){const e=this.hls,i=this.getVariantLevelIndex(t.frag),s=e.levels[i],{fragLoadPolicy:r,keyLoadPolicy:o}=e.config,c=wv(t.details.startsWith("key")?o:r,t),h=e.levels.reduce((g,m)=>g+m.fragmentError,0);if(s&&(t.details!==K.FRAG_GAP&&s.fragmentError++,ac(c,h,rc(t),t.response)))return{action:Be.RetryRequest,flags:Ki.None,retryConfig:c,retryCount:h};const f=this.getLevelSwitchAction(t,i);return c&&(f.retryConfig=c,f.retryCount=h),f}getLevelSwitchAction(t,e){const i=this.hls;e==null&&(e=i.loadLevel);const s=this.hls.levels[e];if(s){var r,o;const f=t.details;s.loadError++,f===K.BUFFER_APPEND_ERROR&&s.fragmentError++;let g=-1;const{levels:m,loadLevel:y,minAutoLevel:v,maxAutoLevel:T}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const S=(r=t.frag)==null?void 0:r.type,_=(S===mt.AUDIO&&f===K.FRAG_PARSING_ERROR||t.sourceBufferName==="audio"&&(f===K.BUFFER_ADD_CODEC_ERROR||f===K.BUFFER_APPEND_ERROR))&&m.some(({audioCodec:U})=>s.audioCodec!==U),R=t.sourceBufferName==="video"&&(f===K.BUFFER_ADD_CODEC_ERROR||f===K.BUFFER_APPEND_ERROR)&&m.some(({codecSet:U,audioCodec:O})=>s.codecSet!==U&&s.audioCodec===O),{type:C,groupId:I}=(o=t.context)!=null?o:{};for(let U=m.length;U--;){const O=(U+y)%m.length;if(O!==y&&O>=v&&O<=T&&m[O].loadError===0){var c,h;const M=m[O];if(f===K.FRAG_GAP&&S===mt.MAIN&&t.frag){const w=m[O].details;if(w){const N=ur(t.frag,w.fragments,t.frag.start);if(N!=null&&N.gap)continue}}else{if(C===Dt.AUDIO_TRACK&&M.hasAudioGroup(I)||C===Dt.SUBTITLE_TRACK&&M.hasSubtitleGroup(I))continue;if(S===mt.AUDIO&&(c=s.audioGroups)!=null&&c.some(w=>M.hasAudioGroup(w))||S===mt.SUBTITLE&&(h=s.subtitleGroups)!=null&&h.some(w=>M.hasSubtitleGroup(w))||_&&s.audioCodec===M.audioCodec||R&&s.codecSet===M.codecSet||!_&&s.codecSet!==M.codecSet)continue}g=O;break}}if(g>-1&&i.loadLevel!==g)return t.levelRetry=!0,this.playlistError=0,{action:Be.SendAlternateToPenaltyBox,flags:Ki.None,nextAutoLevel:g}}return{action:Be.SendAlternateToPenaltyBox,flags:Ki.MoveAllAlternatesMatchingHost}}onErrorOut(t,e){var i;switch((i=e.errorAction)==null?void 0:i.action){case Be.DoNothing:break;case Be.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(e),!e.errorAction.resolved&&e.details!==K.FRAG_GAP?e.fatal=!0:/MediaSource readyState: ended/.test(e.error.message)&&(this.warn(`MediaSource ended after "${e.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(e.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(t){const e=this.hls,i=t.errorAction;if(!i)return;const{flags:s,hdcpLevel:r,nextAutoLevel:o}=i;switch(s){case Ki.None:this.switchLevel(t,o);break;case Ki.MoveAllAlternatesMatchingHDCP:r&&(e.maxHdcpLevel=Fd[Fd.indexOf(r)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${e.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(t,o)}switchLevel(t,e){if(e!==void 0&&t.errorAction&&(this.warn(`switching to level ${e} after ${t.details}`),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,t.details===K.BUFFER_ADD_CODEC_ERROR&&t.mimeType&&t.sourceBufferName!=="audiovideo")){const i=Bd(t.mimeType),s=this.hls.levels;for(let r=s.length;r--;)s[r][`${t.sourceBufferName}Codec`]===i&&this.hls.removeLevel(r)}}}function zl(l){const t={action:Be.DoNothing,flags:Ki.None};return l&&(t.resolved=!0),t}var xe={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class OL{constructor(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}_registerListeners(){const{hls:t}=this;t&&(t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.BUFFER_APPENDED,this.onBufferAppended,this),t.on(A.FRAG_BUFFERED,this.onFragBuffered,this),t.on(A.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:t}=this;t&&(t.off(A.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.BUFFER_APPENDED,this.onBufferAppended,this),t.off(A.FRAG_BUFFERED,this.onFragBuffered,this),t.off(A.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(t,e){const i=this.activePartLists[e];if(i)for(let s=i.length;s--;){const r=i[s];if(!r)break;if(r.start<=t&&t<=r.end&&r.loaded)return r}return this.getBufferedFrag(t,e)}getBufferedFrag(t,e){return this.getFragAtPos(t,e,!0)}getFragAtPos(t,e,i){const{fragments:s}=this,r=Object.keys(s);for(let o=r.length;o--;){const c=s[r[o]];if(c?.body.type===e&&(!i||c.buffered)){const h=c.body;if(h.start<=t&&t<=h.end)return h}}return null}detectEvictedFragments(t,e,i,s,r){this.timeRanges&&(this.timeRanges[t]=e);const o=s?.fragment.sn||-1;Object.keys(this.fragments).forEach(c=>{const h=this.fragments[c];if(!h||o>=h.body.sn)return;if(!h.buffered&&(!h.loaded||r)){h.body.type===i&&this.removeFragment(h.body);return}const f=h.range[t];if(f){if(f.time.length===0){this.removeFragment(h.body);return}f.time.some(g=>{const m=!this.isTimeBuffered(g.startPTS,g.endPTS,e);return m&&this.removeFragment(h.body),m})}})}detectPartialFragments(t){const e=this.timeRanges;if(!e||t.frag.sn==="initSegment")return;const i=t.frag,s=ta(i),r=this.fragments[s];if(!r||r.buffered&&i.gap)return;const o=!i.relurl;Object.keys(e).forEach(c=>{const h=i.elementaryStreams[c];if(!h)return;const f=e[c],g=o||h.partial===!0;r.range[c]=this.getBufferedTimes(i,t.part,g,f)}),r.loaded=null,Object.keys(r.range).length?(r.buffered=!0,(r.body.endList=i.endList||r.body.endList)&&(this.endListFragments[r.body.type]=r),xu(r)||this.removeParts(i.sn-1,i.type)):this.removeFragment(r.body)}removeParts(t,e){const i=this.activePartLists[e];i&&(this.activePartLists[e]=Mv(i,s=>s.fragment.sn>=t))}fragBuffered(t,e){const i=ta(t);let s=this.fragments[i];!s&&e&&(s=this.fragments[i]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(t,e,i,s){const r={time:[],partial:i},o=t.start,c=t.end,h=t.minEndPTS||c,f=t.maxStartPTS||o;for(let g=0;g<s.length;g++){const m=s.start(g)-this.bufferPadding,y=s.end(g)+this.bufferPadding;if(f>=m&&h<=y){r.time.push({startPTS:Math.max(o,s.start(g)),endPTS:Math.min(c,s.end(g))});break}else if(o<y&&c>m){const v=Math.max(o,s.start(g)),T=Math.min(c,s.end(g));T>v&&(r.partial=!0,r.time.push({startPTS:v,endPTS:T}))}else if(c<=m)break}return r}getPartialFragment(t){let e=null,i,s,r,o=0;const{bufferPadding:c,fragments:h}=this;return Object.keys(h).forEach(f=>{const g=h[f];g&&xu(g)&&(s=g.body.start-c,r=g.body.end+c,t>=s&&t<=r&&(i=Math.min(t-s,r-t),o<=i&&(e=g.body,o=i)))}),e}isEndListAppended(t){const e=this.endListFragments[t];return e!==void 0&&(e.buffered||xu(e))}getState(t){const e=ta(t),i=this.fragments[e];return i?i.buffered?xu(i)?xe.PARTIAL:xe.OK:xe.APPENDING:xe.NOT_LOADED}isTimeBuffered(t,e,i){let s,r;for(let o=0;o<i.length;o++){if(s=i.start(o)-this.bufferPadding,r=i.end(o)+this.bufferPadding,t>=s&&e<=r)return!0;if(e<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(t,e){if(e.frag.sn==="initSegment"||e.frag.bitrateTest)return;const i=e.frag,s=e.part?null:e,r=ta(i);this.fragments[r]={body:i,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(t,e){const{frag:i,part:s,timeRanges:r,type:o}=e;if(i.sn==="initSegment")return;const c=i.type;if(s){let f=this.activePartLists[c];f||(this.activePartLists[c]=f=[]),f.push(s)}this.timeRanges=r;const h=r[o];this.detectEvictedFragments(o,h,c,s)}onFragBuffered(t,e){this.detectPartialFragments(e)}hasFragment(t){const e=ta(t);return!!this.fragments[e]}hasFragments(t){const{fragments:e}=this,i=Object.keys(e);if(!t)return i.length>0;for(let s=i.length;s--;){const r=e[i[s]];if(r?.body.type===t)return!0}return!1}hasParts(t){var e;return!!((e=this.activePartLists[t])!=null&&e.length)}removeFragmentsInRange(t,e,i,s,r){s&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const c=this.fragments[o];if(!c)return;const h=c.body;h.type!==i||s&&!h.gap||h.start<e&&h.end>t&&(c.buffered||r)&&this.removeFragment(h)})}removeFragment(t){const e=ta(t);t.clearElementaryStreamInfo();const i=this.activePartLists[t.type];if(i){const s=t.sn;this.activePartLists[t.type]=Mv(i,r=>r.fragment.sn!==s)}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]}removeAllFragments(){var t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const e=(t=this.hls)==null||(t=t.latestLevelDetails)==null?void 0:t.partList;e&&e.forEach(i=>i.clearElementaryStreamInfo())}}function xu(l){var t,e,i;return l.buffered&&!!(l.body.gap||(t=l.range.video)!=null&&t.partial||(e=l.range.audio)!=null&&e.partial||(i=l.range.audiovideo)!=null&&i.partial)}function ta(l){return`${l.type}_${l.level}_${l.sn}`}function Mv(l,t){return l.filter(e=>{const i=t(e);return i||e.clearElementaryStreamInfo(),i})}var Rn={cbc:0,ctr:1};class wL{constructor(t,e,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=t,this.aesIV=e,this.aesMode=i}decrypt(t,e){switch(this.aesMode){case Rn.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t);case Rn.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},e,t);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function kL(l){const t=l.byteLength,e=t&&new DataView(l.buffer).getUint8(t-1);return e?l.slice(0,t-e):l}class ML{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(t){const e=new DataView(t),i=new Uint32Array(4);for(let s=0;s<4;s++)i[s]=e.getUint32(s*4);return i}initTable(){const t=this.sBox,e=this.invSBox,i=this.subMix,s=i[0],r=i[1],o=i[2],c=i[3],h=this.invSubMix,f=h[0],g=h[1],m=h[2],y=h[3],v=new Uint32Array(256);let T=0,S=0,x=0;for(x=0;x<256;x++)x<128?v[x]=x<<1:v[x]=x<<1^283;for(x=0;x<256;x++){let _=S^S<<1^S<<2^S<<3^S<<4;_=_>>>8^_&255^99,t[T]=_,e[_]=T;const L=v[T],R=v[L],C=v[R];let I=v[_]*257^_*16843008;s[T]=I<<24|I>>>8,r[T]=I<<16|I>>>16,o[T]=I<<8|I>>>24,c[T]=I,I=C*16843009^R*65537^L*257^T*16843008,f[_]=I<<24|I>>>8,g[_]=I<<16|I>>>16,m[_]=I<<8|I>>>24,y[_]=I,T?(T=L^v[v[v[C^L]]],S^=v[v[S]]):T=S=1}}expandKey(t){const e=this.uint8ArrayToUint32Array_(t);let i=!0,s=0;for(;s<e.length&&i;)i=e[s]===this.key[s],s++;if(i)return;this.key=e;const r=this.keySize=e.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const o=this.ksRows=(r+6+1)*4;let c,h;const f=this.keySchedule=new Uint32Array(o),g=this.invKeySchedule=new Uint32Array(o),m=this.sBox,y=this.rcon,v=this.invSubMix,T=v[0],S=v[1],x=v[2],_=v[3];let L,R;for(c=0;c<o;c++){if(c<r){L=f[c]=e[c];continue}R=L,c%r===0?(R=R<<8|R>>>24,R=m[R>>>24]<<24|m[R>>>16&255]<<16|m[R>>>8&255]<<8|m[R&255],R^=y[c/r|0]<<24):r>6&&c%r===4&&(R=m[R>>>24]<<24|m[R>>>16&255]<<16|m[R>>>8&255]<<8|m[R&255]),f[c]=L=(f[c-r]^R)>>>0}for(h=0;h<o;h++)c=o-h,h&3?R=f[c]:R=f[c-4],h<4||c<=4?g[h]=R:g[h]=T[m[R>>>24]]^S[m[R>>>16&255]]^x[m[R>>>8&255]]^_[m[R&255]],g[h]=g[h]>>>0}networkToHostOrderSwap(t){return t<<24|(t&65280)<<8|(t&16711680)>>8|t>>>24}decrypt(t,e,i){const s=this.keySize+6,r=this.invKeySchedule,o=this.invSBox,c=this.invSubMix,h=c[0],f=c[1],g=c[2],m=c[3],y=this.uint8ArrayToUint32Array_(i);let v=y[0],T=y[1],S=y[2],x=y[3];const _=new Int32Array(t),L=new Int32Array(_.length);let R,C,I,U,O,M,w,N,z,J,lt,ct,at,B;const q=this.networkToHostOrderSwap;for(;e<_.length;){for(z=q(_[e]),J=q(_[e+1]),lt=q(_[e+2]),ct=q(_[e+3]),O=z^r[0],M=ct^r[1],w=lt^r[2],N=J^r[3],at=4,B=1;B<s;B++)R=h[O>>>24]^f[M>>16&255]^g[w>>8&255]^m[N&255]^r[at],C=h[M>>>24]^f[w>>16&255]^g[N>>8&255]^m[O&255]^r[at+1],I=h[w>>>24]^f[N>>16&255]^g[O>>8&255]^m[M&255]^r[at+2],U=h[N>>>24]^f[O>>16&255]^g[M>>8&255]^m[w&255]^r[at+3],O=R,M=C,w=I,N=U,at=at+4;R=o[O>>>24]<<24^o[M>>16&255]<<16^o[w>>8&255]<<8^o[N&255]^r[at],C=o[M>>>24]<<24^o[w>>16&255]<<16^o[N>>8&255]<<8^o[O&255]^r[at+1],I=o[w>>>24]<<24^o[N>>16&255]<<16^o[O>>8&255]<<8^o[M&255]^r[at+2],U=o[N>>>24]<<24^o[O>>16&255]<<16^o[M>>8&255]<<8^o[w&255]^r[at+3],L[e]=q(R^v),L[e+1]=q(U^T),L[e+2]=q(I^S),L[e+3]=q(C^x),v=z,T=J,S=lt,x=ct,e=e+4}return L.buffer}}class PL{constructor(t,e,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=t,this.key=e,this.aesMode=i}expandKey(){const t=NL(this.aesMode);return this.subtle.importKey("raw",this.key,{name:t},!1,["encrypt","decrypt"])}}function NL(l){switch(l){case Rn.cbc:return"AES-CBC";case Rn.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${l}`)}}const UL=16;class Cg{constructor(t,{removePKCS7Padding:e=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=t.enableSoftwareAES,this.removePKCS7Padding=e,e)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:t,remainderData:e}=this;if(!t||e)return this.reset(),null;const i=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?kL(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(t,e,i,s){return this.useSoftware?new Promise((r,o)=>{const c=ArrayBuffer.isView(t)?t:new Uint8Array(t);this.softwareDecrypt(c,e,i,s);const h=this.flush();h?r(h.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(t),e,i,s)}softwareDecrypt(t,e,i,s){const{currentIV:r,currentResult:o,remainderData:c}=this;if(s!==Rn.cbc||e.byteLength!==16)return Ft.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),c&&(t=Ui(c,t),this.remainderData=null);const h=this.getValidChunk(t);if(!h.length)return null;r&&(i=r);let f=this.softwareDecrypter;f||(f=this.softwareDecrypter=new ML),f.expandKey(e);const g=o;return this.currentResult=f.decrypt(h.buffer,0,i),this.currentIV=h.slice(-16).buffer,g||null}webCryptoDecrypt(t,e,i,s){if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(t,e,i,s));this.key=e,this.fastAesKey=new PL(this.subtle,e,s)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new wL(this.subtle,new Uint8Array(i),s).decrypt(t.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(Ft.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(t,e,i,s)))}onWebCryptoError(t,e,i,s){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,i,s);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(t){let e=t;const i=t.length-t.length%UL;return i!==t.length&&(e=t.slice(0,i),this.remainderData=t.slice(i)),e}logOnce(t){this.logEnabled&&(Ft.log(`[decrypter]: ${t}`),this.logEnabled=!1)}}const Pv=Math.pow(2,17);class BL{constructor(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(t,e){const i=t.url;if(!i)return Promise.reject(new Ms({type:pt.NETWORK_ERROR,details:K.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,r=s.fLoader,o=s.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),t.gap)if(t.tagList.some(T=>T[0]==="GAP")){h(Uv(t));return}else t.gap=!1;const f=this.loader=r?new r(s):new o(s),g=Nv(t);t.loader=f;const m=kv(s.fragLoadPolicy.default),y={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:t.sn==="initSegment"?1/0:Pv};t.stats=f.stats;const v={onSuccess:(T,S,x,_)=>{this.resetLoader(t,f);let L=T.data;x.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(L.slice(0,16)),L=L.slice(16)),c({frag:t,part:null,payload:L,networkDetails:_})},onError:(T,S,x,_)=>{this.resetLoader(t,f),h(new Ms({type:pt.NETWORK_ERROR,details:K.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:Vt({url:i,data:void 0},T),error:new Error(`HTTP Error ${T.code} ${T.text}`),networkDetails:x,stats:_}))},onAbort:(T,S,x)=>{this.resetLoader(t,f),h(new Ms({type:pt.NETWORK_ERROR,details:K.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:x,stats:T}))},onTimeout:(T,S,x)=>{this.resetLoader(t,f),h(new Ms({type:pt.NETWORK_ERROR,details:K.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:x,stats:T}))}};e&&(v.onProgress=(T,S,x,_)=>e({frag:t,part:null,payload:x,networkDetails:_})),f.load(g,y,v)})}loadPart(t,e,i){this.abort();const s=this.config,r=s.fLoader,o=s.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),t.gap||e.gap){h(Uv(t,e));return}const f=this.loader=r?new r(s):new o(s),g=Nv(t,e);t.loader=f;const m=kv(s.fragLoadPolicy.default),y={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Pv};e.stats=f.stats,f.load(g,y,{onSuccess:(v,T,S,x)=>{this.resetLoader(t,f),this.updateStatsFromPart(t,e);const _={frag:t,part:e,payload:v.data,networkDetails:x};i(_),c(_)},onError:(v,T,S,x)=>{this.resetLoader(t,f),h(new Ms({type:pt.NETWORK_ERROR,details:K.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:Vt({url:g.url,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:S,stats:x}))},onAbort:(v,T,S)=>{t.stats.aborted=e.stats.aborted,this.resetLoader(t,f),h(new Ms({type:pt.NETWORK_ERROR,details:K.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:S,stats:v}))},onTimeout:(v,T,S)=>{this.resetLoader(t,f),h(new Ms({type:pt.NETWORK_ERROR,details:K.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:S,stats:v}))}})})}updateStatsFromPart(t,e){const i=t.stats,s=e.stats,r=s.total;if(i.loaded+=s.loaded,r){const h=Math.round(t.duration/e.duration),f=Math.min(Math.round(i.loaded/r),h),m=(h-f)*Math.round(i.loaded/f);i.total=i.loaded+m}else i.total=Math.max(i.loaded,i.total);const o=i.loading,c=s.loading;o.start?o.first+=c.first-c.start:(o.start=c.start,o.first=c.first),o.end=c.end}resetLoader(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()}}function Nv(l,t=null){const e=t||l,i={frag:l,part:t,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},s=e.byteRangeStartOffset,r=e.byteRangeEndOffset;if(dt(s)&&dt(r)){var o;let c=s,h=r;if(l.sn==="initSegment"&&FL((o=l.decryptdata)==null?void 0:o.method)){const f=r-s;f%16&&(h=r+(16-f%16)),s!==0&&(i.resetIV=!0,c=s-16)}i.rangeStart=c,i.rangeEnd=h}return i}function Uv(l,t){const e=new Error(`GAP ${l.gap?"tag":"attribute"} found`),i={type:pt.MEDIA_ERROR,details:K.FRAG_GAP,fatal:!1,frag:l,error:e,networkDetails:null};return t&&(i.part=t),(t||l).stats.aborted=!0,new Ms(i)}function FL(l){return l==="AES-128"||l==="AES-256"}class Ms extends Error{constructor(t){super(t.error.message),this.data=void 0,this.data=t}}class hS extends zi{constructor(t,e){super(t,e),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(t){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Og{constructor(t,e,i,s=0,r=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=_u(),this.buffering={audio:_u(),video:_u(),audiovideo:_u()},this.level=t,this.sn=e,this.id=i,this.size=s,this.part=r,this.partial=o}}function _u(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Bv={length:0,start:()=>0,end:()=>0};class xt{static isBuffered(t,e){if(t){const i=xt.getBuffered(t);for(let s=i.length;s--;)if(e>=i.start(s)&&e<=i.end(s))return!0}return!1}static bufferedRanges(t){if(t){const e=xt.getBuffered(t);return xt.timeRangesToArray(e)}return[]}static timeRangesToArray(t){const e=[];for(let i=0;i<t.length;i++)e.push({start:t.start(i),end:t.end(i)});return e}static bufferInfo(t,e,i){if(t){const s=xt.bufferedRanges(t);if(s.length)return xt.bufferedInfo(s,e,i)}return{len:0,start:e,end:e,bufferedIndex:-1}}static bufferedInfo(t,e,i){e=Math.max(0,e),t.length>1&&t.sort((g,m)=>g.start-m.start||m.end-g.end);let s=-1,r=[];if(i)for(let g=0;g<t.length;g++){e>=t[g].start&&e<=t[g].end&&(s=g);const m=r.length;if(m){const y=r[m-1].end;t[g].start-y<i?t[g].end>y&&(r[m-1].end=t[g].end):r.push(t[g])}else r.push(t[g])}else r=t;let o=0,c,h=e,f=e;for(let g=0;g<r.length;g++){const m=r[g].start,y=r[g].end;if(s===-1&&e>=m&&e<=y&&(s=g),e+i>=m&&e<y)h=m,f=y,o=f-e;else if(e+i<m){c=m;break}}return{len:o,start:h||0,end:f||0,nextStart:c,buffered:t,bufferedIndex:s}}static getBuffered(t){try{return t.buffered||Bv}catch(e){return Ft.log("failed to get media.buffered",e),Bv}}}const dS=/\{\$([a-zA-Z0-9-_]+)\}/g;function Fv(l){return dS.test(l)}function $d(l,t){if(l.variableList!==null||l.hasVariableRefs){const e=l.variableList;return t.replace(dS,i=>{const s=i.substring(2,i.length-1),r=e?.[s];return r===void 0?(l.playlistParsingError||(l.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),i):r})}return t}function $v(l,t,e){let i=l.variableList;i||(l.variableList=i={});let s,r;if("QUERYPARAM"in t){s=t.QUERYPARAM;try{const o=new self.URL(e).searchParams;if(o.has(s))r=o.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${e}"`)}catch(o){l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else s=t.NAME,r=t.VALUE;s in i?l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):i[s]=r||""}function $L(l,t,e){const i=t.IMPORT;if(e&&i in e){let s=l.variableList;s||(l.variableList=s={}),s[i]=e[i]}else l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const GL=/^(\d+)x(\d+)$/,Gv=/(.+?)=(".*?"|.*?)(?:,|$)/g;class ee{constructor(t,e){typeof t=="string"&&(t=ee.parseAttrList(t,e)),Kt(this,t)}get clientAttrs(){return Object.keys(this).filter(t=>t.substring(0,2)==="X-")}decimalInteger(t){const e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(t){if(this[t]){let e=(this[t]||"0x").slice(2);e=(e.length&1?"0":"")+e;const i=new Uint8Array(e.length/2);for(let s=0;s<e.length/2;s++)i[s]=parseInt(e.slice(s*2,s*2+2),16);return i}return null}hexadecimalIntegerAsNumber(t){const e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(t){return parseFloat(this[t])}optionalFloat(t,e){const i=this[t];return i?parseFloat(i):e}enumeratedString(t){return this[t]}enumeratedStringList(t,e){const i=this[t];return(i?i.split(/[ ,]+/):[]).reduce((s,r)=>(s[r.toLowerCase()]=!0,s),e)}bool(t){return this[t]==="YES"}decimalResolution(t){const e=GL.exec(this[t]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(t,e){let i;const s={};for(Gv.lastIndex=0;(i=Gv.exec(t))!==null;){const o=i[1].trim();let c=i[2];const h=c.indexOf('"')===0&&c.lastIndexOf('"')===c.length-1;let f=!1;if(h)c=c.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":f=!0}if(e&&(h||f))c=$d(e,c);else if(!f&&!h)switch(o){case"CLOSED-CAPTIONS":if(c==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ft.warn(`${t}: attribute ${o} is missing quotes`)}s[o]=c}return s}}const HL="com.apple.hls.interstitial";function VL(l){return l!=="ID"&&l!=="CLASS"&&l!=="CUE"&&l!=="START-DATE"&&l!=="DURATION"&&l!=="END-DATE"&&l!=="END-ON-NEXT"}function KL(l){return l==="SCTE35-OUT"||l==="SCTE35-IN"||l==="SCTE35-CMD"}class gS{constructor(t,e,i=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=e?.tagAnchor||null,this.tagOrder=(s=e?.tagOrder)!=null?s:i,e){const r=e.attr;for(const o in r)if(Object.prototype.hasOwnProperty.call(t,o)&&t[o]!==r[o]){Ft.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${t.ID}"`),this._badValueForSameId=o;break}t=Kt(new ee({}),r,t)}if(this.attr=t,e?(this._startDate=e._startDate,this._cue=e._cue,this._endDate=e._endDate,this._dateAtEnd=e._dateAtEnd):this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){const r=e?.endDate||new Date(this.attr["END-DATE"]);dt(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const t=this._cue;return t===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):t}get startTime(){const{tagAnchor:t}=this;return t===null||t.programDateTime===null?(Ft.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${t}`),NaN):t.start+(this.startDate.getTime()-t.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const t=this._endDate||this._dateAtEnd;if(t)return t;const e=this.duration;return e!==null?this._dateAtEnd=new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const t=this.attr.decimalFloatingPoint("DURATION");if(dt(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===HL}get isValid(){return!!this.id&&!this._badValueForSameId&&dt(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const zL=10;class YL{constructor(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}reloaded(t){if(!t){this.advanced=!0,this.updated=!0;return}const e=this.lastPartSn-t.lastPartSn,i=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!i||!!e||!this.live,this.advanced=this.endSN>t.endSN||e>0||e===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(t.misses*.6):this.misses=t.misses+1}get hasProgramDateTime(){return this.fragments.length?dt(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||zL}get drift(){const t=this.driftEndTime-this.driftStartTime;return t>0?(this.driftEnd-this.driftStart)*1e3/t:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const t=this.partList;if(t){const e=this.lastPartIndex;if(e!==-1){for(let i=t.length;i--;)if(t[i].index>e)return t[i].index;return e}}return 0}get lastPartSn(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const t=this.partEnd-this.fragmentStart;return this.age>Math.max(t,this.totalduration)+this.levelTargetDuration}return!1}}function ca(l){return l==="AES-128"||l==="AES-256"||l==="AES-256-CTR"}function wg(l){switch(l){case"AES-128":case"AES-256":return Rn.cbc;case"AES-256-CTR":return Rn.ctr;default:throw new Error(`invalid full segment method ${l}`)}}function kg(l){return Uint8Array.from(atob(l),t=>t.charCodeAt(0))}function Gd(l){return Uint8Array.from(unescape(encodeURIComponent(l)),t=>t.charCodeAt(0))}function jL(l){const t=Gd(l).subarray(0,16),e=new Uint8Array(16);return e.set(t,16-t.length),e}function qL(l){const t=function(i,s,r){const o=i[s];i[s]=i[r],i[r]=o};t(l,0,3),t(l,1,2),t(l,4,5),t(l,6,7)}function XL(l){const t=l.split(":");let e=null;if(t[0]==="data"&&t.length===2){const i=t[1].split(";"),s=i[i.length-1].split(",");if(s.length===2){const r=s[0]==="base64",o=s[1];r?(i.splice(-1,1),e=kg(o)):e=jL(o)}}return e}const lc=typeof self<"u"?self:void 0;var oe={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ze={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Gu(l){switch(l){case Ze.FAIRPLAY:return oe.FAIRPLAY;case Ze.PLAYREADY:return oe.PLAYREADY;case Ze.WIDEVINE:return oe.WIDEVINE;case Ze.CLEARKEY:return oe.CLEARKEY}}function Jh(l){switch(l){case oe.FAIRPLAY:return Ze.FAIRPLAY;case oe.PLAYREADY:return Ze.PLAYREADY;case oe.WIDEVINE:return Ze.WIDEVINE;case oe.CLEARKEY:return Ze.CLEARKEY}}function Dl(l){const{drmSystems:t,widevineLicenseUrl:e}=l,i=t?[oe.FAIRPLAY,oe.WIDEVINE,oe.PLAYREADY,oe.CLEARKEY].filter(s=>!!t[s]):[];return!i[oe.WIDEVINE]&&e&&i.push(oe.WIDEVINE),i}const mS=function(l){return lc!=null&&(l=lc.navigator)!=null&&l.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function QL(l,t,e,i){let s;switch(l){case oe.FAIRPLAY:s=["cenc","sinf"];break;case oe.WIDEVINE:case oe.PLAYREADY:s=["cenc"];break;case oe.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${l}`)}return WL(s,t,e,i)}function WL(l,t,e,i){return[{initDataTypes:l,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map(r=>({contentType:`audio/mp4; codecs=${r}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:e.map(r=>({contentType:`video/mp4; codecs=${r}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function ZL(l){var t;return l.sessionType==="persistent-license"||!!((t=l.sessionTypes)!=null&&t.some(e=>e==="persistent-license"))}function JL(l){const t=new Uint16Array(l.buffer,l.byteOffset,l.byteLength/2),e=String.fromCharCode.apply(null,Array.from(t)),i=e.substring(e.indexOf("<"),e.length),o=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(o){const c=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(c){const h=kg(c).subarray(0,16);return qL(h),h}}return null}let Au={};class yc{static clearKeyUriToKeyIdMap(){Au={}}constructor(t,e,i,s=[1],r=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=i,this.keyFormatVersions=s,this.iv=r,this.encrypted=t?t!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!ca(t),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(XT(o)))}matches(t){var e,i;return t.uri===this.uri&&t.method===this.method&&t.encrypted===this.encrypted&&t.keyFormat===this.keyFormat&&t.keyFormatVersions.join(",")===this.keyFormatVersions.join(",")&&((e=t.iv)==null?void 0:e.join(","))===((i=this.iv)==null?void 0:i.join(","))}isSupported(){if(this.method){if(ca(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ze.FAIRPLAY:case Ze.WIDEVINE:case Ze.PLAYREADY:case Ze.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(t){if(!this.encrypted||!this.uri)return null;if(ca(this.method)&&this.uri&&!this.iv){typeof t!="number"&&(Ft.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),t=0);const i=tD(t);return new yc(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.pssh&&this.keyId)return this;const e=XL(this.uri);if(e)switch(this.keyFormat){case Ze.WIDEVINE:if(this.pssh=e,!this.keyId&&e.length>=22){const i=e.length-22;this.keyId=e.subarray(i,i+16)}break;case Ze.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=nL(i,null,e),this.keyId=JL(e);break}default:{let i=e.subarray(0,16);if(i.length!==16){const s=new Uint8Array(16);s.set(i,16-i.length),i=s}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=Au[this.uri];if(!i){const s=Object.keys(Au).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,s),Au[this.uri]=i}this.keyId=i}return this}}function tD(l){const t=new Uint8Array(16);for(let e=12;e<16;e++)t[e]=l>>8*(15-e)&255;return t}const Hv=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Vv=/#EXT-X-MEDIA:(.*)/g,eD=/^#EXT(?:INF|-X-TARGETDURATION):/m,td=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),iD=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class ls{static findGroup(t,e){for(let i=0;i<t.length;i++){const s=t[i];if(s.id===e)return s}}static resolve(t,e){return Ag.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}static isMediaPlaylist(t){return eD.test(t)}static parseMasterPlaylist(t,e){const i=Fv(t),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},r=[];Hv.lastIndex=0;let o;for(;(o=Hv.exec(t))!=null;)if(o[1]){var c;const f=new ee(o[1],s),g=$d(s,o[2]),m={attrs:f,bitrate:f.decimalInteger("BANDWIDTH")||f.decimalInteger("AVERAGE-BANDWIDTH"),name:f.NAME,url:ls.resolve(g,e)},y=f.decimalResolution("RESOLUTION");y&&(m.width=y.width,m.height=y.height),Yv(f.CODECS,m);const v=f["SUPPLEMENTAL-CODECS"];v&&(m.supplemental={},Yv(v,m.supplemental)),(c=m.unknownCodecs)!=null&&c.length||r.push(m),s.levels.push(m)}else if(o[3]){const f=o[3],g=o[4];switch(f){case"SESSION-DATA":{const m=new ee(g,s),y=m["DATA-ID"];y&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[y]=m);break}case"SESSION-KEY":{const m=Kv(g,e,s);m.encrypted&&m.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(m)):Ft.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${g}"`);break}case"DEFINE":{{const m=new ee(g,s);$v(s,m,e)}break}case"CONTENT-STEERING":{const m=new ee(g,s);s.contentSteering={uri:ls.resolve(m["SERVER-URI"],e),pathwayId:m["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=zv(g);break}}}const h=r.length>0&&r.length<s.levels.length;return s.levels=h?r:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(t,e,i){let s;const r={},o=i.levels,c={AUDIO:o.map(f=>({id:f.attrs.AUDIO,audioCodec:f.audioCodec})),SUBTITLES:o.map(f=>({id:f.attrs.SUBTITLES,textCodec:f.textCodec})),"CLOSED-CAPTIONS":[]};let h=0;for(Vv.lastIndex=0;(s=Vv.exec(t))!==null;){const f=new ee(s[1],i),g=f.TYPE;if(g){const m=c[g],y=r[g]||[];r[g]=y;const v=f.LANGUAGE,T=f["ASSOC-LANGUAGE"],S=f.CHANNELS,x=f.CHARACTERISTICS,_=f["INSTREAM-ID"],L={attrs:f,bitrate:0,id:h++,groupId:f["GROUP-ID"]||"",name:f.NAME||v||"",type:g,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:v,url:f.URI?ls.resolve(f.URI,e):""};if(T&&(L.assocLang=T),S&&(L.channels=S),x&&(L.characteristics=x),_&&(L.instreamId=_),m!=null&&m.length){const R=ls.findGroup(m,L.groupId)||m[0];jv(L,R,"audioCodec"),jv(L,R,"textCodec")}y.push(L)}}return r}static parseLevelPlaylist(t,e,i,s,r,o){var c;const h={url:e},f=new YL(e),g=f.fragments,m=[];let y=null,v=0,T=0,S=0,x=0,_=0,L=null,R=new Qh(s,h),C,I,U,O=-1,M=!1,w=null,N;if(td.lastIndex=0,f.m3u8=t,f.hasVariableRefs=Fv(t),((c=td.exec(t))==null?void 0:c[0])!=="#EXTM3U")return f.playlistParsingError=new Error("Missing format identifier #EXTM3U"),f;for(;(C=td.exec(t))!==null;){M&&(M=!1,R=new Qh(s,h),R.playlistOffset=S,R.setStart(S),R.sn=v,R.cc=x,_&&(R.bitrate=_),R.level=i,y&&(R.initSegment=y,y.rawProgramDateTime&&(R.rawProgramDateTime=y.rawProgramDateTime,y.rawProgramDateTime=null),w&&(R.setByteRange(w),w=null)));const ct=C[1];if(ct){R.duration=parseFloat(ct);const at=(" "+C[2]).slice(1);R.title=at||null,R.tagList.push(at?["INF",ct,at]:["INF",ct])}else if(C[3]){if(dt(R.duration)){R.playlistOffset=S,R.setStart(S),U&&Xv(R,U,f),R.sn=v,R.level=i,R.cc=x,g.push(R);const at=(" "+C[3]).slice(1);R.relurl=$d(f,at),Hd(R,L,m),L=R,S+=R.duration,v++,T=0,M=!0}}else{if(C=C[0].match(iD),!C){Ft.warn("No matches on slow regex match for level playlist!");continue}for(I=1;I<C.length&&C[I]===void 0;I++);const at=(" "+C[I]).slice(1),B=(" "+C[I+1]).slice(1),q=C[I+2]?(" "+C[I+2]).slice(1):null;switch(at){case"BYTERANGE":L?R.setByteRange(B,L):R.setByteRange(B);break;case"PROGRAM-DATE-TIME":R.rawProgramDateTime=B,R.tagList.push(["PROGRAM-DATE-TIME",B]),O===-1&&(O=g.length);break;case"PLAYLIST-TYPE":f.type&&Is(f,at,C),f.type=B.toUpperCase();break;case"MEDIA-SEQUENCE":f.startSN!==0?Is(f,at,C):g.length>0&&Qv(f,at,C),v=f.startSN=parseInt(B);break;case"SKIP":{f.skippedSegments&&Is(f,at,C);const W=new ee(B,f),ot=W.decimalInteger("SKIPPED-SEGMENTS");if(dt(ot)){f.skippedSegments+=ot;for(let $=ot;$--;)g.push(null);v+=ot}const k=W.enumeratedString("RECENTLY-REMOVED-DATERANGES");k&&(f.recentlyRemovedDateranges=(f.recentlyRemovedDateranges||[]).concat(k.split("	")));break}case"TARGETDURATION":f.targetduration!==0&&Is(f,at,C),f.targetduration=Math.max(parseInt(B),1);break;case"VERSION":f.version!==null&&Is(f,at,C),f.version=parseInt(B);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":f.live||Is(f,at,C),f.live=!1;break;case"#":(B||q)&&R.tagList.push(q?[B,q]:[B]);break;case"DISCONTINUITY":x++,R.tagList.push(["DIS"]);break;case"GAP":R.gap=!0,R.tagList.push([at]);break;case"BITRATE":R.tagList.push([at,B]),_=parseInt(B)*1e3,dt(_)?R.bitrate=_:_=0;break;case"DATERANGE":{const W=new ee(B,f),ot=new gS(W,f.dateRanges[W.ID],f.dateRangeTagCount);f.dateRangeTagCount++,ot.isValid||f.skippedSegments?f.dateRanges[ot.id]=ot:Ft.warn(`Ignoring invalid DATERANGE tag: "${B}"`),R.tagList.push(["EXT-X-DATERANGE",B]);break}case"DEFINE":{{const W=new ee(B,f);"IMPORT"in W?$L(f,W,o):$v(f,W,e)}break}case"DISCONTINUITY-SEQUENCE":f.startCC!==0?Is(f,at,C):g.length>0&&Qv(f,at,C),f.startCC=x=parseInt(B);break;case"KEY":{const W=Kv(B,e,f);if(W.isSupported()){if(W.method==="NONE"){U=void 0;break}U||(U={});const ot=U[W.keyFormat];ot!=null&&ot.matches(W)||(ot&&(U=Kt({},U)),U[W.keyFormat]=W)}else Ft.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${B}"`);break}case"START":f.startTimeOffset=zv(B);break;case"MAP":{const W=new ee(B,f);if(R.duration){const ot=new Qh(s,h);qv(ot,W,i,U),y=ot,R.initSegment=y,y.rawProgramDateTime&&!R.rawProgramDateTime&&(R.rawProgramDateTime=y.rawProgramDateTime)}else{const ot=R.byteRangeEndOffset;if(ot){const k=R.byteRangeStartOffset;w=`${ot-k}@${k}`}else w=null;qv(R,W,i,U),y=R,M=!0}y.cc=x;break}case"SERVER-CONTROL":{N&&Is(f,at,C),N=new ee(B),f.canBlockReload=N.bool("CAN-BLOCK-RELOAD"),f.canSkipUntil=N.optionalFloat("CAN-SKIP-UNTIL",0),f.canSkipDateRanges=f.canSkipUntil>0&&N.bool("CAN-SKIP-DATERANGES"),f.partHoldBack=N.optionalFloat("PART-HOLD-BACK",0),f.holdBack=N.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{f.partTarget&&Is(f,at,C);const W=new ee(B);f.partTarget=W.decimalFloatingPoint("PART-TARGET");break}case"PART":{let W=f.partList;W||(W=f.partList=[]);const ot=T>0?W[W.length-1]:void 0,k=T++,$=new ee(B,f),j=new zR($,R,h,k,ot);W.push(j),R.duration+=j.duration;break}case"PRELOAD-HINT":{const W=new ee(B,f);f.preloadHint=W;break}case"RENDITION-REPORT":{const W=new ee(B,f);f.renditionReports=f.renditionReports||[],f.renditionReports.push(W);break}default:Ft.warn(`line parsed but not handled: ${C}`);break}}}L&&!L.relurl?(g.pop(),S-=L.duration,f.partList&&(f.fragmentHint=L)):f.partList&&(Hd(R,L,m),R.cc=x,f.fragmentHint=R,U&&Xv(R,U,f)),f.targetduration||(f.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const z=g.length,J=g[0],lt=g[z-1];if(S+=f.skippedSegments*f.targetduration,S>0&&z&&lt){f.averagetargetduration=S/z;const ct=lt.sn;f.endSN=ct!=="initSegment"?ct:0,f.live||(lt.endList=!0),O>0&&(nD(g,O),J&&m.unshift(J))}return f.fragmentHint&&(S+=f.fragmentHint.duration),f.totalduration=S,m.length&&f.dateRangeTagCount&&J&&pS(m,f),f.endCC=x,f}}function pS(l,t){const e=l.length;if(!e)return;const i=l[e-1],s=t.live?1/0:t.totalduration,r=Object.keys(t.dateRanges);for(let c=r.length;c--;){const h=t.dateRanges[r[c]],f=h.startDate.getTime();h.tagAnchor=i.ref;for(let g=e;g--;){var o;if(((o=l[g])==null?void 0:o.sn)<t.startSN)break;const m=sD(t,f,l,g,s);if(m!==-1){h.tagAnchor=t.fragments[m].ref;break}}}}function sD(l,t,e,i,s){const r=e[i];if(r){const c=r.programDateTime;if(t>=c||i===0){var o;const h=(((o=e[i+1])==null?void 0:o.start)||s)-r.start;if(t<=c+h*1e3){const f=e[i].sn-l.startSN;if(f<0)return-1;const g=l.fragments;if(g.length>e.length){const y=(e[i+1]||g[g.length-1]).sn-l.startSN;for(let v=y;v>f;v--){const T=g[v].programDateTime;if(t>=T&&t<T+g[v].duration*1e3)return v}}return f}}}return-1}function Kv(l,t,e){var i,s;const r=new ee(l,e),o=(i=r.METHOD)!=null?i:"",c=r.URI,h=r.hexadecimalInteger("IV"),f=r.KEYFORMATVERSIONS,g=(s=r.KEYFORMAT)!=null?s:"identity";c&&r.IV&&!h&&Ft.error(`Invalid IV: ${r.IV}`);const m=c?ls.resolve(c,t):"",y=(f||"1").split("/").map(Number).filter(Number.isFinite);return new yc(o,m,g,y,h,r.KEYID)}function zv(l){const e=new ee(l).decimalFloatingPoint("TIME-OFFSET");return dt(e)?e:null}function Yv(l,t){let e=(l||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const s=e.filter(r=>Lg(r,i));s.length&&(t[`${i}Codec`]=s.map(r=>r.split("/")[0]).join(","),e=e.filter(r=>s.indexOf(r)===-1))}),t.unknownCodecs=e}function jv(l,t,e){const i=t[e];i&&(l[e]=i)}function nD(l,t){let e=l[t];for(let i=t;i--;){const s=l[i];if(!s)return;s.programDateTime=e.programDateTime-s.duration*1e3,e=s}}function Hd(l,t,e){l.rawProgramDateTime?e.push(l):t!=null&&t.programDateTime&&(l.programDateTime=t.endProgramDateTime)}function qv(l,t,e,i){l.relurl=t.URI,t.BYTERANGE&&l.setByteRange(t.BYTERANGE),l.level=e,l.sn="initSegment",i&&(l.levelkeys=i),l.initSegment=null}function Xv(l,t,e){l.levelkeys=t;const{encryptedFragments:i}=e;(!i.length||i[i.length-1].levelkeys!==t)&&Object.keys(t).some(s=>t[s].isCommonEncryption)&&i.push(l)}function Is(l,t,e){l.playlistParsingError=new Error(`#EXT-X-${t} must not appear more than once (${e[0]})`)}function Qv(l,t,e){l.playlistParsingError=new Error(`#EXT-X-${t} must appear before the first Media Segment (${e[0]})`)}function ed(l,t){const e=t.startPTS;if(dt(e)){let i=0,s;t.sn>l.sn?(i=e-l.start,s=l):(i=l.start-e,s=t),s.duration!==i&&s.setDuration(i)}else t.sn>l.sn?l.cc===t.cc&&l.minEndPTS?t.setStart(l.start+(l.minEndPTS-l.start)):t.setStart(l.start+l.duration):t.setStart(Math.max(l.start-t.duration,0))}function yS(l,t,e,i,s,r,o){i-e<=0&&(o.warn("Fragment should have a positive duration",t),i=e+t.duration,r=s+t.duration);let h=e,f=i;const g=t.startPTS,m=t.endPTS;if(dt(g)){const _=Math.abs(g-e);l&&_>l.totalduration?o.warn(`media timestamps and playlist times differ by ${_}s for level ${t.level} ${l.url}`):dt(t.deltaPTS)?t.deltaPTS=Math.max(_,t.deltaPTS):t.deltaPTS=_,h=Math.max(e,g),e=Math.min(e,g),s=t.startDTS!==void 0?Math.min(s,t.startDTS):s,f=Math.min(i,m),i=Math.max(i,m),r=t.endDTS!==void 0?Math.max(r,t.endDTS):r}const y=e-t.start;t.start!==0&&t.setStart(e),t.setDuration(i-t.start),t.startPTS=e,t.maxStartPTS=h,t.startDTS=s,t.endPTS=i,t.minEndPTS=f,t.endDTS=r;const v=t.sn;if(!l||v<l.startSN||v>l.endSN)return 0;let T;const S=v-l.startSN,x=l.fragments;for(x[S]=t,T=S;T>0;T--)ed(x[T],x[T-1]);for(T=S;T<x.length-1;T++)ed(x[T],x[T+1]);return l.fragmentHint&&ed(x[x.length-1],l.fragmentHint),l.PTSKnown=l.alignedSliding=!0,y}function rD(l,t,e){if(l===t)return;let i=null;const s=l.fragments;for(let g=s.length-1;g>=0;g--){const m=s[g].initSegment;if(m){i=m;break}}l.fragmentHint&&delete l.fragmentHint.endPTS;let r;oD(l,t,(g,m,y,v)=>{if((!t.startCC||t.skippedSegments)&&m.cc!==g.cc){const T=g.cc-m.cc;for(let S=y;S<v.length;S++)v[S].cc+=T;t.endCC=v[v.length-1].cc}dt(g.startPTS)&&dt(g.endPTS)&&(m.setStart(m.startPTS=g.startPTS),m.startDTS=g.startDTS,m.maxStartPTS=g.maxStartPTS,m.endPTS=g.endPTS,m.endDTS=g.endDTS,m.minEndPTS=g.minEndPTS,m.setDuration(g.endPTS-g.startPTS),m.duration&&(r=m),t.PTSKnown=t.alignedSliding=!0),g.hasStreams&&(m.elementaryStreams=g.elementaryStreams),m.loader=g.loader,g.hasStats&&(m.stats=g.stats),g.initSegment&&(m.initSegment=g.initSegment,i=g.initSegment)});const o=t.fragments,c=t.fragmentHint?o.concat(t.fragmentHint):o;if(i&&c.forEach(g=>{var m;g&&(!g.initSegment||g.initSegment.relurl===((m=i)==null?void 0:m.relurl))&&(g.initSegment=i)}),t.skippedSegments){if(t.deltaUpdateFailed=o.some(g=>!g),t.deltaUpdateFailed){e.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let g=t.skippedSegments;g--;)o.shift();t.startSN=o[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=aD(l.dateRanges,t,e));const g=l.fragments.filter(m=>m.rawProgramDateTime);if(l.hasProgramDateTime&&!t.hasProgramDateTime)for(let m=1;m<c.length;m++)c[m].programDateTime===null&&Hd(c[m],c[m-1],g);pS(g,t)}t.endCC=o[o.length-1].cc}if(!t.startCC){var h;const g=TS(l,t.startSN-1);t.startCC=(h=g?.cc)!=null?h:o[0].cc}lD(l.partList,t.partList,(g,m)=>{m.elementaryStreams=g.elementaryStreams,m.stats=g.stats}),r?yS(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS,e):vS(l,t),o.length&&(t.totalduration=t.edge-o[0].start),t.driftStartTime=l.driftStartTime,t.driftStart=l.driftStart;const f=t.advancedDateTime;if(t.advanced&&f){const g=t.edge;t.driftStart||(t.driftStartTime=f,t.driftStart=g),t.driftEndTime=f,t.driftEnd=g}else t.driftEndTime=l.driftEndTime,t.driftEnd=l.driftEnd,t.advancedDateTime=l.advancedDateTime;t.requestScheduled===-1&&(t.requestScheduled=l.requestScheduled)}function aD(l,t,e){const{dateRanges:i,recentlyRemovedDateranges:s}=t,r=Kt({},l);s&&s.forEach(h=>{delete r[h]});const c=Object.keys(r).length;return c&&Object.keys(i).forEach(h=>{const f=r[h],g=new gS(i[h].attr,f);g.isValid?(r[h]=g,f||(g.tagOrder+=c)):e.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Wt(i[h].attr)}"`)}),r}function lD(l,t,e){if(l&&t){let i=0;for(let s=0,r=l.length;s<=r;s++){const o=l[s],c=t[s+i];o&&c&&o.index===c.index&&o.fragment.sn===c.fragment.sn?e(o,c):i--}}}function oD(l,t,e){const i=t.skippedSegments,s=Math.max(l.startSN,t.startSN)-t.startSN,r=(l.fragmentHint?1:0)+(i?t.endSN:Math.min(l.endSN,t.endSN))-t.startSN,o=t.startSN-l.startSN,c=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,h=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments;for(let f=s;f<=r;f++){const g=h[o+f];let m=c[f];if(i&&!m&&g&&(m=t.fragments[f]=g),g&&m){if(e(g,m,f,c),g.url&&g.url!==m.url){t.playlistParsingError=Wv(`media sequence mismatch ${m.sn}:`,l,t,g,m);return}else if(g.cc!==m.cc){t.playlistParsingError=Wv(`discontinuity sequence mismatch (${g.cc}!=${m.cc})`,l,t,g,m);return}}}}function Wv(l,t,e,i,s){return new Error(`${l} ${s.url}
Playlist starting @${t.startSN}
${t.m3u8}

Playlist starting @${e.startSN}
${e.m3u8}`)}function vS(l,t,e=!0){const i=t.startSN+t.skippedSegments-l.startSN,s=l.fragments,r=i>=0;let o=0;if(r&&i<s.length)o=s[i].start;else if(r&&t.startSN===l.endSN+1)o=l.fragmentEnd;else if(r&&e)o=l.fragmentStart+i*t.levelTargetDuration;else if(!t.skippedSegments&&t.fragmentStart===0)o=l.fragmentStart;else return;Vd(t,o)}function Vd(l,t){if(t){const e=l.fragments;for(let i=l.skippedSegments;i<e.length;i++)e[i].addStart(t);l.fragmentHint&&l.fragmentHint.addStart(t)}}function ES(l,t=1/0){let e=1e3*l.targetduration;if(l.updated){const i=l.fragments;if(i.length&&e*4>t){const r=i[i.length-1].duration*1e3;r<e&&(e=r)}}else e/=2;return Math.round(e)}function TS(l,t,e){if(!l)return null;let i=l.fragments[t-l.startSN];return i||(i=l.fragmentHint,i&&i.sn===t)?i:t<l.startSN&&e&&e.sn===t?e:null}function Zv(l,t,e){return l?SS(l.partList,t,e):null}function SS(l,t,e){if(l)for(let i=l.length;i--;){const s=l[i];if(s.index===e&&s.fragment.sn===t)return s}return null}function xS(l){l.forEach((t,e)=>{var i;(i=t.details)==null||i.fragments.forEach(s=>{s.level=e,s.initSegment&&(s.initSegment.level=e)})})}function wl(l,t){for(let i=0,s=l.length;i<s;i++){var e;if(((e=l[i])==null?void 0:e.cc)===t)return l[i]}return null}function uD(l,t){return!!(l&&t.startCC<l.endCC&&t.endCC>l.startCC)}function Jv(l,t){const e=l.start+t;l.startPTS=e,l.setStart(e),l.endPTS=e+l.duration}function _S(l,t){const e=t.fragments;for(let i=0,s=e.length;i<s;i++)Jv(e[i],l);t.fragmentHint&&Jv(t.fragmentHint,l),t.alignedSliding=!0}function cD(l,t){l&&(AS(t,l),t.alignedSliding||oc(t,l),!t.alignedSliding&&!t.skippedSegments&&vS(l,t,!1))}function AS(l,t){if(!uD(t,l))return;const e=Math.min(t.endCC,l.endCC),i=wl(t.fragments,e),s=wl(l.fragments,e);if(!i||!s)return;Ft.log(`Aligning playlist at start of dicontinuity sequence ${e}`);const r=i.start-s.start;_S(r,l)}function oc(l,t){if(!l.hasProgramDateTime||!t.hasProgramDateTime)return;const e=l.fragments,i=t.fragments;if(!e.length||!i.length)return;let s,r;const o=Math.min(t.endCC,l.endCC);t.startCC<o&&l.startCC<o&&(s=wl(i,o),r=wl(e,o)),(!s||!r)&&(s=i[Math.floor(i.length/2)],r=wl(e,s.cc)||e[Math.floor(e.length/2)]);const c=s.programDateTime,h=r.programDateTime;if(!c||!h)return;const f=(h-c)/1e3-(r.start-s.start);_S(f,l)}const fD={toString:function(l){let t="";const e=l.length;for(let i=0;i<e;i++)t+=`[${l.start(i).toFixed(3)}-${l.end(i).toFixed(3)}]`;return t}},et={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Mg extends hS{constructor(t,e,i,s,r){super(s,t.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=et.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:c,media:h,mediaBuffer:f,state:g}=this,m=h?h.currentTime:0,y=xt.bufferInfo(f||h,m,o.maxBufferHole),v=!y.len;if(this.log(`Media seeking to ${dt(m)?m.toFixed(3):m}, state: ${g}, ${v?"out of":"in"} buffer`),this.state===et.ENDED)this.resetLoadingState();else if(c){const T=o.maxFragLookUpTolerance,S=c.start-T,x=c.start+c.duration+T;if(v||x<y.start||S>y.end){const _=m>x;(m<S||_)&&(_&&c.loader&&(this.log(`Cancelling fragment load for seek (sn: ${c.sn})`),c.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(h){this.fragmentTracker.removeFragmentsInRange(m,1/0,this.playlistType,!0);const T=this.lastCurrentTime;if(m>T&&(this.lastCurrentTime=m),!this.loadingParts){const S=Math.max(y.end,m),x=this.shouldLoadParts(this.getLevelDetails(),S);x&&(this.log(`LL-Part loading ON after seeking to ${m.toFixed(2)} with buffer @${S.toFixed(2)}`),this.loadingParts=x)}}this.hls.hasEnoughToStart||(this.log(`Setting ${v?"startPosition":"nextLoadPosition"} to ${m} for seek without enough to start`),this.nextLoadPosition=m,v&&(this.startPosition=m)),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=t,this.fragmentLoader=new BL(t.config),this.keyLoader=i,this.fragmentTracker=e,this.config=t.config,this.decrypter=new Cg(t.config)}registerListeners(){const{hls:t}=this;t.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(A.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(A.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(t){}stopLoad(){if(this.state===et.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=et.STOPPED}get startPositionValue(){const{nextLoadPosition:t,startPosition:e}=this;return e===-1&&t?t:e}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(t,e){if(e.live||!this.media)return!1;const i=t.end||0,s=this.config.timelineOffset||0;if(i<=s)return!1;const r=t.buffered;this.config.maxBufferHole&&r&&r.length>1&&(t=xt.bufferedInfo(r,t.start,0));const o=t.nextStart;if(o&&o>s&&o<e.edge||this.media.currentTime<t.start)return!1;const h=e.partList;if(h!=null&&h.length){const g=h[h.length-1];return xt.isBuffered(this.media,g.start+g.duration/2)}const f=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(f)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const t=this.config.timelineOffset;if(t){var e;return((e=this.getLevelDetails())==null?void 0:e.appliedTimelineOffset)||t}return 0}onMediaAttached(t,e){const i=this.media=this.mediaBuffer=e.media;i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),i.addEventListener("seeking",this.onMediaSeeking),i.addEventListener("ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===et.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(t,e){const i=!!e.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),s.removeEventListener("seeking",this.onMediaSeeking),s.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(t,e){}onManifestLoaded(t,e){this.startTimeOffset=e.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=et.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(t,e,i){this.startFragRequested=!0,this._loadFragForPlayback(t,e,i)}_loadFragForPlayback(t,e,i){const s=r=>{const o=r.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${r.part?" part: "+r.part.index:""} of ${this.fragInfo(o,!1,r.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(t,e,i,s).then(r=>{if(!r)return;const o=this.state,c=r.frag;if(this.fragContextChanged(c)){(o===et.FRAG_LOADING||!this.fragCurrent&&o===et.PARSING)&&(this.fragmentTracker.removeFragment(c),this.state=et.IDLE);return}"payload"in r&&(this.log(`Loaded ${c.type} sn: ${c.sn} of ${this.playlistLabel()} ${c.level}`),this.hls.trigger(A.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===et.STOPPED||this.state===et.ERROR||(this.warn(`Frag error: ${r?.message||r}`),this.resetFragmentLoading(t))})}clearTrackerIfNeeded(t){var e;const{fragmentTracker:i}=this;if(i.getState(t)===xe.APPENDING){const r=t.type,o=this.getFwdBufferInfo(this.mediaBuffer,r),c=Math.max(t.duration,o?o.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?t.sn-h.sn:0)===1||this.reduceMaxBufferLength(c,t.duration))&&i.removeFragment(t)}else((e=this.mediaBuffer)==null?void 0:e.buffered.length)===0?i.removeAllFragments():i.hasParts(t.type)&&(i.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),i.getState(t)===xe.PARTIAL&&i.removeFragment(t))}checkLiveUpdate(t){if(t.updated&&!t.live){const e=t.fragments[t.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type})}t.fragments[0]||(t.deltaUpdateFailed=!0)}waitForLive(t){const e=t.details;return e?.live&&e.type!=="EVENT"&&(this.levelLastLoaded!==t||e.expired)}flushMainBuffer(t,e,i=null){if(!(t-e))return;const s={startOffset:t,endOffset:e,type:i};this.hls.trigger(A.BUFFER_FLUSHING,s)}_loadInitSegment(t,e){this._doFragLoad(t,e).then(i=>{const s=i?.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:s}=this,{frag:r,payload:o}=i,c=r.decryptdata;if(o&&o.byteLength>0&&c!=null&&c.key&&c.iv&&ca(c.method)){const h=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),c.key.buffer,c.iv.buffer,wg(c.method)).catch(f=>{throw s.trigger(A.ERROR,{type:pt.MEDIA_ERROR,details:K.FRAG_DECRYPT_ERROR,fatal:!1,error:f,reason:f.message,frag:r}),f}).then(f=>{const g=self.performance.now();return s.trigger(A.FRAG_DECRYPTED,{frag:r,payload:f,stats:{tstart:h,tdecrypt:g}}),i.payload=f,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===et.STOPPED||this.state===et.ERROR||(this.warn(i),this.resetFragmentLoading(t))})}completeInitSegmentLoad(t){const{levels:e}=this;if(!e)throw new Error("init load aborted, missing levels");const i=t.frag.stats;this.state!==et.STOPPED&&(this.state=et.IDLE),t.frag.data=new Uint8Array(t.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(t,e){var i,s;const r=t.tracks;if(r&&!e.encrypted&&((i=r.audio)!=null&&i.encrypted||(s=r.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,c=new Error(`Encrypted track with no key in ${this.fragInfo(e)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(c.message),!o||o.mediaKeys?!1:(this.hls.trigger(A.ERROR,{type:pt.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_KEYS,fatal:!1,error:c,frag:e}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(t){const{fragCurrent:e}=this;return!t||!e||t.sn!==e.sn||t.level!==e.level}fragBufferedComplete(t,e){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.fragInfo(t,!1,e)} > buffer:${i?fD.toString(xt.getBuffered(i)):"(detached)"})`),ve(t)){var s;if(t.type!==mt.SUBTITLE){const o=t.elementaryStreams;if(!Object.keys(o).some(c=>!!o[c])){this.state=et.IDLE;return}}const r=(s=this.levels)==null?void 0:s[t.level];r!=null&&r.fragmentError&&(this.log(`Resetting level fragment error count of ${r.fragmentError} on frag buffered`),r.fragmentError=0)}this.state=et.IDLE}_handleFragmentLoadComplete(t){const{transmuxer:e}=this;if(!e)return;const{frag:i,part:s,partsLoaded:r}=t,o=!r||r.length===0||r.some(h=>!h),c=new Og(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!o);e.flush(c)}_handleFragmentLoadProgress(t){}_doFragLoad(t,e,i=null,s){var r;this.fragCurrent=t;const o=e.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let c=null;t.encrypted&&!((r=t.decryptdata)!=null&&r.key)?(this.log(`Loading key for ${t.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${t.level}`),this.state=et.KEY_LOADING,this.fragCurrent=t,c=this.keyLoader.load(t).then(y=>{if(!this.fragContextChanged(y.frag))return this.hls.trigger(A.KEY_LOADED,y),this.state===et.KEY_LOADING&&(this.state=et.IDLE),y}),this.hls.trigger(A.KEY_LOADING,{frag:t}),this.fragCurrent===null&&(c=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):t.encrypted||(c=this.keyLoader.loadClear(t,o.encryptedFragments,this.startFragRequested),c&&this.log("[eme] blocking frag load until media-keys acquired"));const h=this.fragPrevious;if(ve(t)&&(!h||t.sn!==h.sn)){const y=this.shouldLoadParts(e.details,t.end);y!==this.loadingParts&&(this.log(`LL-Part loading ${y?"ON":"OFF"} loading sn ${h?.sn}->${t.sn}`),this.loadingParts=y)}if(i=Math.max(t.start,i||0),this.loadingParts&&ve(t)){const y=o.partList;if(y&&s){i>t.end&&o.fragmentHint&&(t=o.fragmentHint);const v=this.getNextPart(y,t,i);if(v>-1){const T=y[v];t=this.fragCurrent=T.fragment,this.log(`Loading ${t.type} sn: ${t.sn} part: ${T.index} (${v}/${y.length-1}) of ${this.fragInfo(t,!1,T)}) cc: ${t.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=T.start+T.duration,this.state=et.FRAG_LOADING;let S;return c?S=c.then(x=>!x||this.fragContextChanged(x.frag)?null:this.doFragPartsLoad(t,T,e,s)).catch(x=>this.handleFragLoadError(x)):S=this.doFragPartsLoad(t,T,e,s).catch(x=>this.handleFragLoadError(x)),this.hls.trigger(A.FRAG_LOADING,{frag:t,part:T,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):S}else if(!t.url||this.loadedEndOfParts(y,i))return Promise.resolve(null)}}if(ve(t)&&this.loadingParts){var f;this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)} Check buffer at sn: ${t.sn} loaded parts: ${(f=o.partList)==null?void 0:f.filter(y=>y.loaded).map(y=>`[${y.start}-${y.end}]`)}`),this.loadingParts=!1}else if(!t.url)return Promise.resolve(null);this.log(`Loading ${t.type} sn: ${t.sn} of ${this.fragInfo(t,!1)}) cc: ${t.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(i.toFixed(3))}`),dt(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=et.FRAG_LOADING;const g=this.config.progressive;let m;return g&&c?m=c.then(y=>!y||this.fragContextChanged(y.frag)?null:this.fragmentLoader.load(t,s)).catch(y=>this.handleFragLoadError(y)):m=Promise.all([this.fragmentLoader.load(t,g?s:void 0),c]).then(([y])=>(!g&&s&&s(y),y)).catch(y=>this.handleFragLoadError(y)),this.hls.trigger(A.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):m}doFragPartsLoad(t,e,i,s){return new Promise((r,o)=>{var c;const h=[],f=(c=i.details)==null?void 0:c.partList,g=m=>{this.fragmentLoader.loadPart(t,m,s).then(y=>{h[m.index]=y;const v=y.part;this.hls.trigger(A.FRAG_LOADED,y);const T=Zv(i.details,t.sn,m.index+1)||SS(f,t.sn,m.index+1);if(T)g(T);else return r({frag:t,part:v,partsLoaded:h})}).catch(o)};g(e)})}handleFragLoadError(t){if("data"in t){const e=t.data;e&&e.details===K.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(A.ERROR,e)}else this.hls.trigger(A.ERROR,{type:pt.OTHER_ERROR,details:K.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null}_handleTransmuxerFlush(t){const e=this.getCurrentContext(t);if(!e||this.state!==et.PARSING){!this.fragCurrent&&this.state!==et.STOPPED&&this.state!==et.ERROR&&(this.state=et.IDLE);return}const{frag:i,part:s,level:r}=e,o=self.performance.now();i.stats.parsing.end=o,s&&(s.stats.parsing.end=o);const c=this.getLevelDetails(),f=c&&i.sn>c.endSN||this.shouldLoadParts(c,i.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=f),this.updateLevelTiming(i,s,r,t.partial)}shouldLoadParts(t,e){if(this.config.lowLatencyMode){if(!t)return this.loadingParts;if(t.partList){var i;const r=t.partList[0],o=r.end+(((i=t.fragmentHint)==null?void 0:i.duration)||0);if(e>=o){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(t){const{levels:e,fragCurrent:i}=this,{level:s,sn:r,part:o}=t;if(!(e!=null&&e[s]))return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const c=e[s],h=c.details,f=o>-1?Zv(h,r,o):null,g=f?f.fragment:TS(h,r,i);return g?(i&&i!==g&&(g.stats=i.stats),{frag:g,part:f,level:c}):null}bufferFragmentData(t,e,i,s,r){if(this.state!==et.PARSING)return;const{data1:o,data2:c}=t;let h=o;if(c&&(h=Ui(o,c)),!h.length)return;const f=this.initPTS[e.cc],g=f?-f.baseTime/f.timescale:void 0,m={type:t.type,frag:e,part:i,chunkMeta:s,offset:g,parent:e.type,data:h};if(this.hls.trigger(A.BUFFER_APPENDING,m),t.dropped&&t.independent&&!i){if(r)return;this.flushBufferGap(e)}}flushBufferGap(t){const e=this.media;if(!e)return;if(!xt.isBuffered(e,e.currentTime)){this.flushMainBuffer(0,t.start);return}const i=e.currentTime,s=xt.bufferInfo(e,i,0),r=t.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),c=Math.max(Math.min(t.start-o,s.end-o),i+o);t.start-c>o&&this.flushMainBuffer(c,t.start)}getFwdBufferInfo(t,e){var i;const s=this.getLoadPosition();if(!dt(s))return null;const o=this.lastCurrentTime>s||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(t,s,e,o)}getFwdBufferInfoAtPos(t,e,i,s){const r=xt.bufferInfo(t,e,s);if(r.len===0&&r.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(e,i);if(o&&(r.nextStart<=o.end||o.gap)){const c=Math.max(Math.min(r.nextStart,o.end)-e,s);return xt.bufferInfo(t,e,c)}}return r}getMaxBufferLength(t){const{config:e}=this;let i;return t?i=Math.max(8*e.maxBufferSize/t,e.maxBufferLength):i=e.maxBufferLength,Math.min(i,e.maxMaxBufferLength)}reduceMaxBufferLength(t,e){const i=this.config,s=Math.max(Math.min(t-e,i.maxBufferLength),e),r=Math.max(t-e*3,i.maxMaxBufferLength/2,s);return r>=s?(i.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(t,e=mt.MAIN){const i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(t,e):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(t,e){const i=e.fragments,s=i.length;if(!s)return null;const{config:r}=this,o=i[0].start,c=r.lowLatencyMode&&!!e.partList;let h=null;if(e.live){const m=r.initialLiveManifestSize;if(s<m)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${m})`),null;if(!e.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||t<o){var f;c&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),h=this.getInitialLiveFragment(e);const y=this.hls.startPosition,v=this.hls.liveSyncPosition,T=h?(y!==-1&&y>=o?y:v)||h.start:t;this.log(`Setting startPosition to ${T} to match start frag at live edge. mainStart: ${y} liveSyncPosition: ${v} frag.start: ${(f=h)==null?void 0:f.start}`),this.startPosition=this.nextLoadPosition=T}}else t<=o&&(h=i[0]);if(!h){const m=this.loadingParts?e.partEnd:e.fragmentEnd;h=this.getFragmentAtPosition(t,m,e)}let g=this.filterReplacedPrimary(h,e);if(!g&&h){const m=h.sn-e.startSN;g=this.filterReplacedPrimary(i[m+1]||null,e)}return this.mapToInitFragWhenRequired(g)}isLoopLoading(t,e){const i=this.fragmentTracker.getState(t);return(i===xe.OK||i===xe.PARTIAL&&!!t.gap)&&this.nextLoadPosition>e}getNextFragmentLoopLoading(t,e,i,s,r){let o=null;if(t.gap&&(o=this.getNextFragment(this.nextLoadPosition,e),o&&!o.gap&&i.nextStart)){const c=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s,0);if(c!==null&&i.len+c.len>=r){const h=o.sn;return this.loopSn!==h&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${h}`),this.loopSn=h),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(tE(this.config)){var t;if((t=this.hls.interstitialsManager)==null||(t=t.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(t,e){if(!t)return t;if(tE(this.config)&&t.type!==mt.SUBTITLE){const i=this.hls.interstitialsManager,s=i?.bufferingItem;if(s){const o=s.event;if(o){if(o.appendInPlace||Math.abs(t.start-s.start)>1||s.start===0)return null}else if(t.end<=s.start&&e?.live===!1||t.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||t.start-s.end>1))return null}const r=i?.playerQueue;if(r)for(let o=r.length;o--;){const c=r[o].interstitial;if(c.appendInPlace&&t.start>=c.startTime&&t.end<=c.resumeTime)return null}}return t}mapToInitFragWhenRequired(t){return t!=null&&t.initSegment&&!t.initSegment.data&&!this.bitrateTest?t.initSegment:t}getNextPart(t,e,i){let s=-1,r=!1,o=!0;for(let c=0,h=t.length;c<h;c++){const f=t[c];if(o=o&&!f.independent,s>-1&&i<f.start)break;const g=f.loaded;g?s=-1:(r||(f.independent||o)&&f.fragment===e)&&(f.fragment!==e&&this.warn(`Need buffer at ${i} but next unloaded part starts at ${f.start}`),s=c),r=g}return s}loadedEndOfParts(t,e){let i;for(let s=t.length;s--;){if(i=t[s],!i.loaded)return!1;if(e>i.start)return!0}return!1}getInitialLiveFragment(t){const e=t.fragments,i=this.fragPrevious;let s=null;if(i){if(t.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),s=RL(e,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const r=i.sn+1;if(r>=t.startSN&&r<=t.endSN){const o=e[r-t.startSN];i.cc===o.cc&&(s=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=fS(t,i.cc,i.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(s=this.getFragmentAtPosition(r,this.bitrateTest?t.fragmentEnd:t.edge,t))}return s}getFragmentAtPosition(t,e,i){const{config:s}=this;let{fragPrevious:r}=this,{fragments:o,endSN:c}=i;const{fragmentHint:h}=i,{maxFragLookUpTolerance:f}=s,g=i.partList,m=!!(this.loadingParts&&g!=null&&g.length&&h);m&&!this.bitrateTest&&g[g.length-1].fragment.sn===h.sn&&(o=o.concat(h),c=h.sn);let y;if(t<e){var v;const S=t<this.lastCurrentTime||t>e-f||(v=this.media)!=null&&v.paused||!this.startFragRequested?0:f;y=ur(r,o,t,S)}else y=o[o.length-1];if(y){const T=y.sn-i.startSN,S=this.fragmentTracker.getState(y);if((S===xe.OK||S===xe.PARTIAL&&y.gap)&&(r=y),r&&y.sn===r.sn&&(!m||g[0].fragment.sn>y.sn||!i.live)&&y.level===r.level){const _=o[T+1];y.sn<c&&this.fragmentTracker.getState(_)!==xe.OK?y=_:y=null}}return y}alignPlaylists(t,e,i){const s=t.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const r=t.fragmentStart,o=!e,c=t.alignedSliding&&dt(r);if(o||!c&&!r){cD(i,t);const h=t.fragmentStart;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${e?e.startSN:"na"}->${t.startSN} fragments: ${s}`),h}return r}waitForCdnTuneIn(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,t.partTarget*3)}setStartPosition(t,e){let i=this.startPosition;i<e&&(i=-1);const s=this.timelineOffset;if(i===-1){const r=this.startTimeOffset!==null,o=r?this.startTimeOffset:t.startTimeOffset;o!==null&&dt(o)?(i=e+o,o<0&&(i+=t.edge),i=Math.min(Math.max(e,i),e+t.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${o} found in ${r?"multivariant":"media"} playlist`),this.startPosition=i):t.live?(i=this.hls.liveSyncPosition||e,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+s}this.nextLoadPosition=i+s}getLoadPosition(){var t;const{media:e}=this;let i=0;return(t=this.hls)!=null&&t.hasEnoughToStart&&e?i=e.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(t,e){this.transmuxer&&t.type===this.playlistType&&ve(t)&&t.stats.aborted&&(this.log(`Fragment ${t.sn}${e?" part "+e.index:""} of ${this.playlistLabel()} ${t.level} was aborted`),this.resetFragmentLoading(t))}resetFragmentLoading(t){(!this.fragCurrent||!this.fragContextChanged(t)&&this.state!==et.FRAG_LOADING_WAITING_RETRY)&&(this.state=et.IDLE)}onFragmentOrKeyLoadError(t,e){if(e.chunkMeta&&!e.frag){const T=this.getCurrentContext(e.chunkMeta);T&&(e.frag=T.frag)}const i=e.frag;if(!i||i.type!==t||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const r=e.details===K.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(i,!0);const o=e.errorAction,{action:c,flags:h,retryCount:f=0,retryConfig:g}=o||{},m=!!o&&!!g,y=m&&c===Be.RetryRequest,v=m&&!o.resolved&&h===Ki.MoveAllAlternatesMatchingHost;if(!y&&v&&ve(i)&&!i.endList)this.resetFragmentErrors(t),this.treatAsGap(i),o.resolved=!0;else if((y||v)&&f<g.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const T=Ig(g,f);this.warn(`Fragment ${i.sn} of ${t} ${i.level} errored with ${e.details}, retrying loading ${f+1}/${g.maxNumRetry} in ${T}ms`),o.resolved=!0,this.retryDate=self.performance.now()+T,this.state=et.FRAG_LOADING_WAITING_RETRY}else if(g&&o)if(this.resetFragmentErrors(t),f<g.maxNumRetry)!r&&c!==Be.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${e.details} reached or exceeded max retry (${f})`);return}else c===Be.SendAlternateToPenaltyBox?this.state=et.WAITING_LEVEL:this.state=et.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(t){if(this.state===et.PARSING||this.state===et.PARSED){const e=t.frag,i=t.parent,s=this.getFwdBufferInfo(this.mediaBuffer,i),r=s&&s.len>.5;r&&this.reduceMaxBufferLength(s.len,e?.duration||10);const o=!r;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${i} buffer`),e&&(this.fragmentTracker.removeFragment(e),this.nextLoadPosition=e.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(t){t===mt.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==et.STOPPED&&(this.state=et.IDLE)}afterBufferFlushed(t,e,i){if(!t)return;const s=xt.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,s,i),this.state===et.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==et.STOPPED&&(this.state=et.IDLE)}resetStartWhenNotLoaded(t){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=t?t.details:null;e!=null&&e.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(e,e.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(t){this.warn(`The loading context changed while buffering fragment ${t.sn} of ${this.playlistLabel()} ${t.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(t=0){this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)}updateLevelTiming(t,e,i,s){const r=i.details;if(!r){this.warn("level.details undefined");return}if(!Object.keys(t.elementaryStreams).reduce((h,f)=>{const g=t.elementaryStreams[f];if(g){const m=g.endPTS-g.startPTS;if(m<=0)return this.warn(`Could not parse fragment ${t.sn} ${f} duration reliably (${m})`),h||!1;const y=s?0:yS(r,t,g.startPTS,g.endPTS,g.startDTS,g.endDTS,this);return this.hls.trigger(A.LEVEL_PTS_UPDATED,{details:r,level:i,drift:y,type:f,frag:t,start:g.startPTS,end:g.endPTS}),!0}return h},!1)){var c;if(i.fragmentError===0&&this.treatAsGap(t,i),((c=this.transmuxer)==null?void 0:c.error)===null){const h=new Error(`Found no media in fragment ${t.sn} of ${this.playlistLabel()} ${t.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(h.message),this.hls.trigger(A.ERROR,{type:pt.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!1,error:h,frag:t,reason:`Found no media in msn ${t.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=et.PARSED,this.log(`Parsed ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.fragInfo(t,!1,e)})`),this.hls.trigger(A.FRAG_PARSED,{frag:t,part:e})}playlistLabel(){return this.playlistType===mt.MAIN?"level":"track"}fragInfo(t,e=!0,i){var s,r;return`${this.playlistLabel()} ${t.level} (${i?"part":"frag"}:[${((s=e&&!i?t.startPTS:(i||t).start)!=null?s:NaN).toFixed(3)}-${((r=e&&!i?t.endPTS:(i||t).end)!=null?r:NaN).toFixed(3)}]${i&&t.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(t,e){e&&e.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)}resetTransmuxer(){var t;(t=this.transmuxer)==null||t.reset()}recoverWorkerError(t){t.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(t){const e=this._state;e!==t&&(this._state=t,this.log(`${e}->${t}`))}get state(){return this._state}}function tE(l){return!!l.interstitialsController&&l.enableInterstitialPlayback!==!1}class bS{constructor(){this.chunks=[],this.dataLength=0}push(t){this.chunks.push(t),this.dataLength+=t.length}flush(){const{chunks:t,dataLength:e}=this;let i;if(t.length)t.length===1?i=t[0]:i=hD(t,e);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function hD(l,t){const e=new Uint8Array(t);let i=0;for(let s=0;s<l.length;s++){const r=l[s];e.set(r,i),i+=r.length}return e}var id={exports:{}},eE;function dD(){return eE||(eE=1,function(l){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function s(h,f,g){this.fn=h,this.context=f,this.once=g||!1}function r(h,f,g,m,y){if(typeof g!="function")throw new TypeError("The listener must be a function");var v=new s(g,m||h,y),T=e?e+f:f;return h._events[T]?h._events[T].fn?h._events[T]=[h._events[T],v]:h._events[T].push(v):(h._events[T]=v,h._eventsCount++),h}function o(h,f){--h._eventsCount===0?h._events=new i:delete h._events[f]}function c(){this._events=new i,this._eventsCount=0}c.prototype.eventNames=function(){var f=[],g,m;if(this._eventsCount===0)return f;for(m in g=this._events)t.call(g,m)&&f.push(e?m.slice(1):m);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(g)):f},c.prototype.listeners=function(f){var g=e?e+f:f,m=this._events[g];if(!m)return[];if(m.fn)return[m.fn];for(var y=0,v=m.length,T=new Array(v);y<v;y++)T[y]=m[y].fn;return T},c.prototype.listenerCount=function(f){var g=e?e+f:f,m=this._events[g];return m?m.fn?1:m.length:0},c.prototype.emit=function(f,g,m,y,v,T){var S=e?e+f:f;if(!this._events[S])return!1;var x=this._events[S],_=arguments.length,L,R;if(x.fn){switch(x.once&&this.removeListener(f,x.fn,void 0,!0),_){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,g),!0;case 3:return x.fn.call(x.context,g,m),!0;case 4:return x.fn.call(x.context,g,m,y),!0;case 5:return x.fn.call(x.context,g,m,y,v),!0;case 6:return x.fn.call(x.context,g,m,y,v,T),!0}for(R=1,L=new Array(_-1);R<_;R++)L[R-1]=arguments[R];x.fn.apply(x.context,L)}else{var C=x.length,I;for(R=0;R<C;R++)switch(x[R].once&&this.removeListener(f,x[R].fn,void 0,!0),_){case 1:x[R].fn.call(x[R].context);break;case 2:x[R].fn.call(x[R].context,g);break;case 3:x[R].fn.call(x[R].context,g,m);break;case 4:x[R].fn.call(x[R].context,g,m,y);break;default:if(!L)for(I=1,L=new Array(_-1);I<_;I++)L[I-1]=arguments[I];x[R].fn.apply(x[R].context,L)}}return!0},c.prototype.on=function(f,g,m){return r(this,f,g,m,!1)},c.prototype.once=function(f,g,m){return r(this,f,g,m,!0)},c.prototype.removeListener=function(f,g,m,y){var v=e?e+f:f;if(!this._events[v])return this;if(!g)return o(this,v),this;var T=this._events[v];if(T.fn)T.fn===g&&(!y||T.once)&&(!m||T.context===m)&&o(this,v);else{for(var S=0,x=[],_=T.length;S<_;S++)(T[S].fn!==g||y&&!T[S].once||m&&T[S].context!==m)&&x.push(T[S]);x.length?this._events[v]=x.length===1?x[0]:x:o(this,v)}return this},c.prototype.removeAllListeners=function(f){var g;return f?(g=e?e+f:f,this._events[g]&&o(this,g)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=e,c.EventEmitter=c,l.exports=c}(id)),id.exports}var gD=dD(),Pg=VR(gD);const Yl="1.6.9",Ta={};function mD(){return typeof __HLS_WORKER_BUNDLE__=="function"}function pD(){const l=Ta[Yl];if(l)return l.clientCount++,l;const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(t),s={worker:new self.Worker(e),objectURL:e,clientCount:1};return Ta[Yl]=s,s}function yD(l){const t=Ta[l];if(t)return t.clientCount++,t;const e=new self.URL(l,self.location.href).href,s={worker:new self.Worker(e),scriptURL:e,clientCount:1};return Ta[l]=s,s}function vD(l){const t=Ta[l||Yl];if(t&&t.clientCount--===1){const{worker:i,objectURL:s}=t;delete Ta[l||Yl],s&&self.URL.revokeObjectURL(s),i.terminate()}}function RS(l,t){return t+10<=l.length&&l[t]===51&&l[t+1]===68&&l[t+2]===73&&l[t+3]<255&&l[t+4]<255&&l[t+6]<128&&l[t+7]<128&&l[t+8]<128&&l[t+9]<128}function Ng(l,t){return t+10<=l.length&&l[t]===73&&l[t+1]===68&&l[t+2]===51&&l[t+3]<255&&l[t+4]<255&&l[t+6]<128&&l[t+7]<128&&l[t+8]<128&&l[t+9]<128}function vc(l,t){let e=0;return e=(l[t]&127)<<21,e|=(l[t+1]&127)<<14,e|=(l[t+2]&127)<<7,e|=l[t+3]&127,e}function jl(l,t){const e=t;let i=0;for(;Ng(l,t);){i+=10;const s=vc(l,t+6);i+=s,RS(l,t+10)&&(i+=10),t+=i}if(i>0)return l.subarray(e,e+i)}function ED(l,t,e,i){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=t[e+2],o=r>>2&15;if(o>12){const v=new Error(`invalid ADTS sampling index:${o}`);l.emit(A.ERROR,A.ERROR,{type:pt.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!0,error:v,reason:v.message});return}const c=(r>>6&3)+1,h=t[e+3]>>6&3|(r&1)<<2,f="mp4a.40."+c,g=s[o];let m=o;(c===5||c===29)&&(m-=3);const y=[c<<3|(m&14)>>1,(m&1)<<7|h<<3];return Ft.log(`manifest codec:${i}, parsed codec:${f}, channels:${h}, rate:${g} (ADTS object type:${c} sampling index:${o})`),{config:y,samplerate:g,channelCount:h,codec:f,parsedCodec:f,manifestCodec:i}}function LS(l,t){return l[t]===255&&(l[t+1]&246)===240}function DS(l,t){return l[t+1]&1?7:9}function Ug(l,t){return(l[t+3]&3)<<11|l[t+4]<<3|(l[t+5]&224)>>>5}function TD(l,t){return t+5<l.length}function uc(l,t){return t+1<l.length&&LS(l,t)}function SD(l,t){return TD(l,t)&&LS(l,t)&&Ug(l,t)<=l.length-t}function xD(l,t){if(uc(l,t)){const e=DS(l,t);if(t+e>=l.length)return!1;const i=Ug(l,t);if(i<=e)return!1;const s=t+i;return s===l.length||uc(l,s)}return!1}function IS(l,t,e,i,s){if(!l.samplerate){const r=ED(t,e,i,s);if(!r)return;Kt(l,r)}}function CS(l){return 1024*9e4/l}function _D(l,t){const e=DS(l,t);if(t+e<=l.length){const i=Ug(l,t)-e;if(i>0)return{headerLength:e,frameLength:i}}}function OS(l,t,e,i,s){const r=CS(l.samplerate),o=i+s*r,c=_D(t,e);let h;if(c){const{frameLength:m,headerLength:y}=c,v=y+m,T=Math.max(0,e+v-t.length);T?(h=new Uint8Array(v-y),h.set(t.subarray(e+y,t.length),0)):h=t.subarray(e+y,e+v);const S={unit:h,pts:o};return T||l.samples.push(S),{sample:S,length:v,missing:T}}const f=t.length-e;return h=new Uint8Array(f),h.set(t.subarray(e,t.length),0),{sample:{unit:h,pts:o},length:f,missing:-1}}function AD(l,t){return Ng(l,t)&&vc(l,t+6)+10<=l.length-t}function bD(l){return l instanceof ArrayBuffer?l:l.byteOffset==0&&l.byteLength==l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer}function sd(l,t=0,e=1/0){return RD(l,t,e,Uint8Array)}function RD(l,t,e,i){const s=LD(l);let r=1;"BYTES_PER_ELEMENT"in i&&(r=i.BYTES_PER_ELEMENT);const o=DD(l)?l.byteOffset:0,c=(o+l.byteLength)/r,h=(o+t)/r,f=Math.floor(Math.max(0,Math.min(h,c))),g=Math.floor(Math.min(f+Math.max(e,0),c));return new i(s,f,g-f)}function LD(l){return l instanceof ArrayBuffer?l:l.buffer}function DD(l){return l&&l.buffer instanceof ArrayBuffer&&l.byteLength!==void 0&&l.byteOffset!==void 0}function ID(l){const t={key:l.type,description:"",data:"",mimeType:null,pictureType:null},e=3;if(l.size<2)return;if(l.data[0]!==e){console.log("Ignore frame with unrecognized character encoding");return}const i=l.data.subarray(1).indexOf(0);if(i===-1)return;const s=yi(sd(l.data,1,i)),r=l.data[2+i],o=l.data.subarray(3+i).indexOf(0);if(o===-1)return;const c=yi(sd(l.data,3+i,o));let h;return s==="-->"?h=yi(sd(l.data,4+i+o)):h=bD(l.data.subarray(4+i+o)),t.mimeType=s,t.pictureType=r,t.description=c,t.data=h,t}function CD(l){if(l.size<2)return;const t=yi(l.data,!0),e=new Uint8Array(l.data.subarray(t.length+1));return{key:l.type,info:t,data:e.buffer}}function OD(l){if(l.size<2)return;if(l.type==="TXXX"){let e=1;const i=yi(l.data.subarray(e),!0);e+=i.length+1;const s=yi(l.data.subarray(e));return{key:l.type,info:i,data:s}}const t=yi(l.data.subarray(1));return{key:l.type,info:"",data:t}}function wD(l){if(l.type==="WXXX"){if(l.size<2)return;let e=1;const i=yi(l.data.subarray(e),!0);e+=i.length+1;const s=yi(l.data.subarray(e));return{key:l.type,info:i,data:s}}const t=yi(l.data);return{key:l.type,info:"",data:t}}function kD(l){return l.type==="PRIV"?CD(l):l.type[0]==="W"?wD(l):l.type==="APIC"?ID(l):OD(l)}function MD(l){const t=String.fromCharCode(l[0],l[1],l[2],l[3]),e=vc(l,4),i=10;return{type:t,size:e,data:l.subarray(i,i+e)}}const bu=10,PD=10;function wS(l){let t=0;const e=[];for(;Ng(l,t);){const i=vc(l,t+6);l[t+5]>>6&1&&(t+=bu),t+=bu;const s=t+i;for(;t+PD<s;){const r=MD(l.subarray(t)),o=kD(r);o&&e.push(o),t+=r.size+bu}RS(l,t)&&(t+=bu)}return e}function kS(l){return l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp"}function ND(l){if(l.data.byteLength===8){const t=new Uint8Array(l.data),e=t[3]&1;let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,e&&(i+=4772185884e-2),Math.round(i)}}function Bg(l){const t=wS(l);for(let e=0;e<t.length;e++){const i=t[e];if(kS(i))return ND(i)}}let hi=function(l){return l.audioId3="org.id3",l.dateRange="com.apple.quicktime.HLS",l.emsg="https://aomedia.org/emsg/ID3",l.misbklv="urn:misb:KLV:bin:1910.1",l}({});function ss(l="",t=9e4){return{type:l,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class Fg{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(t,e,i,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(t){this.initPTS=t,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(t,e){return!1}appendFrame(t,e,i){}demux(t,e){this.cachedData&&(t=Ui(this.cachedData,t),this.cachedData=null);let i=jl(t,0),s=i?i.length:0,r;const o=this._audioTrack,c=this._id3Track,h=i?Bg(i):void 0,f=t.length;for((this.basePTS===null||this.frameIndex===0&&dt(h))&&(this.basePTS=UD(h,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:hi.audioId3,duration:Number.POSITIVE_INFINITY});s<f;){if(this.canParse(t,s)){const g=this.appendFrame(o,t,s);g?(this.frameIndex++,this.lastPTS=g.sample.pts,s+=g.length,r=s):s=f}else AD(t,s)?(i=jl(t,s),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:hi.audioId3,duration:Number.POSITIVE_INFINITY}),s+=i.length,r=s):s++;if(s===f&&r!==f){const g=t.slice(r);this.cachedData?this.cachedData=Ui(this.cachedData,g):this.cachedData=g}}return{audioTrack:o,videoTrack:ss(),id3Track:c,textTrack:ss()}}demuxSampleAes(t,e,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(t){const e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:ss(),id3Track:this._id3Track,textTrack:ss()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const UD=(l,t,e)=>{if(dt(l))return l*90;const i=e?e.baseTime*9e4/e.timescale:0;return t*9e4+i};let Ru=null;const BD=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],FD=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],$D=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],GD=[0,1,1,4];function MS(l,t,e,i,s){if(e+24>t.length)return;const r=PS(t,e);if(r&&e+r.frameLength<=t.length){const o=r.samplesPerFrame*9e4/r.sampleRate,c=i+s*o,h={unit:t.subarray(e,e+r.frameLength),pts:c,dts:c};return l.config=[],l.channelCount=r.channelCount,l.samplerate=r.sampleRate,l.samples.push(h),{sample:h,length:r.frameLength,missing:0}}}function PS(l,t){const e=l[t+1]>>3&3,i=l[t+1]>>1&3,s=l[t+2]>>4&15,r=l[t+2]>>2&3;if(e!==1&&s!==0&&s!==15&&r!==3){const o=l[t+2]>>1&1,c=l[t+3]>>6,h=e===3?3-i:i===3?3:4,f=BD[h*14+s-1]*1e3,m=FD[(e===3?0:e===2?1:2)*3+r],y=c===3?1:2,v=$D[e][i],T=GD[i],S=v*8*T,x=Math.floor(v*f/m+o)*T;if(Ru===null){const R=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ru=R?parseInt(R[1]):0}return!!Ru&&Ru<=87&&i===2&&f>=224e3&&c===0&&(l[t+3]=l[t+3]|128),{sampleRate:m,channelCount:y,frameLength:x,samplesPerFrame:S}}}function $g(l,t){return l[t]===255&&(l[t+1]&224)===224&&(l[t+1]&6)!==0}function NS(l,t){return t+1<l.length&&$g(l,t)}function HD(l,t){return $g(l,t)&&4<=l.length-t}function US(l,t){if(t+1<l.length&&$g(l,t)){const i=PS(l,t);let s=4;i!=null&&i.frameLength&&(s=i.frameLength);const r=t+s;return r===l.length||NS(l,r)}return!1}class VD extends Fg{constructor(t,e){super(),this.observer=void 0,this.config=void 0,this.observer=t,this.config=e}resetInitSegment(t,e,i,s){super.resetInitSegment(t,e,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:s,inputTimeScale:9e4,dropped:0}}static probe(t,e){if(!t)return!1;const i=jl(t,0);let s=i?.length||0;if(US(t,s))return!1;for(let r=t.length;s<r;s++)if(xD(t,s))return e.log("ADTS sync word found !"),!0;return!1}canParse(t,e){return SD(t,e)}appendFrame(t,e,i){IS(t,this.observer,e,i,t.manifestCodec);const s=OS(t,e,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const BS=(l,t)=>{let e=0,i=5;t+=i;const s=new Uint32Array(1),r=new Uint32Array(1),o=new Uint8Array(1);for(;i>0;){o[0]=l[t];const c=Math.min(i,8),h=8-c;r[0]=4278190080>>>24+h<<h,s[0]=(o[0]&r[0])>>h,e=e?e<<c|s[0]:s[0],t+=1,i-=c}return e};class KD extends Fg{constructor(t){super(),this.observer=void 0,this.observer=t}resetInitSegment(t,e,i,s){super.resetInitSegment(t,e,i,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:e,duration:s,inputTimeScale:9e4,dropped:0}}canParse(t,e){return e+64<t.length}appendFrame(t,e,i){const s=FS(t,e,i,this.basePTS,this.frameIndex);if(s!==-1)return{sample:t.samples[t.samples.length-1],length:s,missing:0}}static probe(t){if(!t)return!1;const e=jl(t,0);if(!e)return!1;const i=e.length;return t[i]===11&&t[i+1]===119&&Bg(e)!==void 0&&BS(t,i)<16}}function FS(l,t,e,i,s){if(e+8>t.length||t[e]!==11||t[e+1]!==119)return-1;const r=t[e+4]>>6;if(r>=3)return-1;const c=[48e3,44100,32e3][r],h=t[e+4]&63,g=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][h*3+r]*2;if(e+g>t.length)return-1;const m=t[e+6]>>5;let y=0;m===2?y+=2:(m&1&&m!==1&&(y+=2),m&4&&(y+=2));const v=(t[e+6]<<8|t[e+7])>>12-y&1,S=[2,1,2,3,3,4,4,5][m]+v,x=t[e+5]>>3,_=t[e+5]&7,L=new Uint8Array([r<<6|x<<1|_>>2,(_&3)<<6|m<<3|v<<2|h>>4,h<<4&224]),R=1536/c*9e4,C=i+s*R,I=t.subarray(e,e+g);return l.config=L,l.channelCount=S,l.samplerate=c,l.samples.push({unit:I,pts:C}),g}class zD extends Fg{resetInitSegment(t,e,i,s){super.resetInitSegment(t,e,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:s,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;const e=jl(t,0);let i=e?.length||0;if(e&&t[i]===11&&t[i+1]===119&&Bg(e)!==void 0&&BS(t,i)<=16)return!1;for(let s=t.length;i<s;i++)if(US(t,i))return Ft.log("MPEG Audio sync word found !"),!0;return!1}canParse(t,e){return HD(t,e)}appendFrame(t,e,i){if(this.basePTS!==null)return MS(t,e,i,this.basePTS,this.frameIndex)}}const YD=/\/emsg[-/]ID3/i;class jD{constructor(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}resetTimeStamp(){}resetInitSegment(t,e,i,s){const r=this.videoTrack=ss("video",1),o=this.audioTrack=ss("audio",1),c=this.txtTrack=ss("text",1);if(this.id3Track=ss("id3",1),this.timeOffset=0,!(t!=null&&t.byteLength))return;const h=eS(t);if(h.video){const{id:f,timescale:g,codec:m,supplemental:y}=h.video;r.id=f,r.timescale=c.timescale=g,r.codec=m,r.supplemental=y}if(h.audio){const{id:f,timescale:g,codec:m}=h.audio;o.id=f,o.timescale=g,o.codec=m}c.id=ZT.text,r.sampleDuration=0,r.duration=o.duration=s}resetContiguity(){this.remainderData=null}static probe(t){return qR(t)}demux(t,e){this.timeOffset=e;let i=t;const s=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=Ui(this.remainderData,t));const c=tL(i);this.remainderData=c.remainder,s.samples=c.valid||new Uint8Array}else s.samples=i;const o=this.extractID3Track(s,e);return r.samples=xv(e,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const t=this.timeOffset,e=this.videoTrack,i=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(e,this.timeOffset);return i.samples=xv(t,e),{videoTrack:e,audioTrack:ss(),id3Track:s,textTrack:ss()}}extractID3Track(t,e){const i=this.id3Track;if(t.samples.length){const s=Rt(t.samples,["emsg"]);s&&s.forEach(r=>{const o=iL(r);if(YD.test(o.schemeIdUri)){const c=iE(o,e);let h=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);const f=o.payload;i.samples.push({data:f,len:f.byteLength,dts:c,pts:c,type:hi.emsg,duration:h})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const c=iE(o,e);i.samples.push({data:o.payload,len:o.payload.byteLength,dts:c,pts:c,type:hi.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(t,e,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function iE(l,t){return dt(l.presentationTime)?l.presentationTime/l.timeScale:t+l.presentationTimeDelta/l.timeScale}class qD{constructor(t,e,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Cg(e,{removePKCS7Padding:!1})}decryptBuffer(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,Rn.cbc)}decryptAacSample(t,e,i){const s=t[e].unit;if(s.length<=16)return;const r=s.subarray(16,s.length-s.length%16),o=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(o).then(c=>{const h=new Uint8Array(c);s.set(h,16),this.decrypter.isSync()||this.decryptAacSamples(t,e+1,i)})}decryptAacSamples(t,e,i){for(;;e++){if(e>=t.length){i();return}if(!(t[e].unit.length<32)&&(this.decryptAacSample(t,e,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(t){const e=Math.floor((t.length-48)/160)*16+16,i=new Int8Array(e);let s=0;for(let r=32;r<t.length-16;r+=160,s+=16)i.set(t.subarray(r,r+16),s);return i}getAvcDecryptedUnit(t,e){const i=new Uint8Array(e);let s=0;for(let r=32;r<t.length-16;r+=160,s+=16)t.set(i.subarray(s,s+16),r);return t}decryptAvcSample(t,e,i,s,r){const o=sS(r.data),c=this.getAvcEncryptedData(o);this.decryptBuffer(c.buffer).then(h=>{r.data=this.getAvcDecryptedUnit(o,h),this.decrypter.isSync()||this.decryptAvcSamples(t,e,i+1,s)})}decryptAvcSamples(t,e,i,s){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,i=0){if(e>=t.length){s();return}const r=t[e].units;for(;!(i>=r.length);i++){const o=r[i];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(t,e,i,s,o),!this.decrypter.isSync()))return}}}}class $S{constructor(){this.VideoSample=null}createVideoSample(t,e,i){return{key:t,frame:!1,pts:e,dts:i,units:[],length:0}}getLastNalUnit(t){var e;let i=this.VideoSample,s;if((!i||i.units.length===0)&&(i=t[t.length-1]),(e=i)!=null&&e.units){const r=i.units;s=r[r.length-1]}return s}pushAccessUnit(t,e){if(t.units.length&&t.frame){if(t.pts===void 0){const i=e.samples,s=i.length;if(s){const r=i[s-1];t.pts=r.pts,t.dts=r.dts}else{e.dropped++;return}}e.samples.push(t)}}parseNALu(t,e,i){const s=e.byteLength;let r=t.naluState||0;const o=r,c=[];let h=0,f,g,m,y=-1,v=0;for(r===-1&&(y=0,v=this.getNALuType(e,0),r=0,h=1);h<s;){if(f=e[h++],!r){r=f?0:1;continue}if(r===1){r=f?0:2;continue}if(!f)r=3;else if(f===1){if(g=h-r-1,y>=0){const T={data:e.subarray(y,g),type:v};c.push(T)}else{const T=this.getLastNalUnit(t.samples);T&&(o&&h<=4-o&&T.state&&(T.data=T.data.subarray(0,T.data.byteLength-o)),g>0&&(T.data=Ui(T.data,e.subarray(0,g)),T.state=0))}h<s?(m=this.getNALuType(e,h),y=h,v=m,r=0):r=-1}else r=0}if(y>=0&&r>=0){const T={data:e.subarray(y,s),type:v,state:r};c.push(T)}if(c.length===0){const T=this.getLastNalUnit(t.samples);T&&(T.data=Ui(T.data,e))}return t.naluState=r,c}}class kl{constructor(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const t=this.data,e=this.bytesAvailable,i=t.byteLength-e,s=new Uint8Array(4),r=Math.min(4,e);if(r===0)throw new Error("no bytes available");s.set(t.subarray(i,i+r)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(t){let e;t=Math.min(t,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t);const i=this.word>>>32-e;if(t>32&&Ft.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return e=t-e,e>0&&this.bitsAvailable?i<<e|this.readBits(e):i}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if((this.word&2147483648>>>t)!==0)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const t=this.skipLZ();return this.readBits(t+1)-1}readEG(){const t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class XD extends $S{parsePES(t,e,i,s){const r=this.parseNALu(t,i.data,s);let o=this.VideoSample,c,h=!1;i.data=null,o&&r.length&&!t.audFound&&(this.pushAccessUnit(o,t),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),r.forEach(f=>{var g,m;switch(f.type){case 1:{let S=!1;c=!0;const x=f.data;if(h&&x.length>4){const _=this.readSliceType(x);(_===2||_===4||_===7||_===9)&&(S=!0)}if(S){var y;(y=o)!=null&&y.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.frame=!0,o.key=S;break}case 5:c=!0,(g=o)!=null&&g.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 6:{c=!0,Rg(f.data,1,i.pts,e.samples);break}case 7:{var v,T;c=!0,h=!0;const S=f.data,x=this.readSPS(S);if(!t.sps||t.width!==x.width||t.height!==x.height||((v=t.pixelRatio)==null?void 0:v[0])!==x.pixelRatio[0]||((T=t.pixelRatio)==null?void 0:T[1])!==x.pixelRatio[1]){t.width=x.width,t.height=x.height,t.pixelRatio=x.pixelRatio,t.sps=[S];const _=S.subarray(1,4);let L="avc1.";for(let R=0;R<3;R++){let C=_[R].toString(16);C.length<2&&(C="0"+C),L+=C}t.codec=L}break}case 8:c=!0,t.pps=[f.data];break;case 9:c=!0,t.audFound=!0,(m=o)!=null&&m.frame&&(this.pushAccessUnit(o,t),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:c=!0;break;default:c=!1;break}o&&c&&o.units.push(f)}),s&&o&&(this.pushAccessUnit(o,t),this.VideoSample=null)}getNALuType(t,e){return t[e]&31}readSliceType(t){const e=new kl(t);return e.readUByte(),e.readUEG(),e.readUEG()}skipScalingList(t,e){let i=8,s=8,r;for(let o=0;o<t;o++)s!==0&&(r=e.readEG(),s=(i+r+256)%256),i=s===0?i:s}readSPS(t){const e=new kl(t);let i=0,s=0,r=0,o=0,c,h,f;const g=e.readUByte.bind(e),m=e.readBits.bind(e),y=e.readUEG.bind(e),v=e.readBoolean.bind(e),T=e.skipBits.bind(e),S=e.skipEG.bind(e),x=e.skipUEG.bind(e),_=this.skipScalingList.bind(this);g();const L=g();if(m(5),T(3),g(),x(),L===100||L===110||L===122||L===244||L===44||L===83||L===86||L===118||L===128){const M=y();if(M===3&&T(1),x(),x(),T(1),v())for(h=M!==3?8:12,f=0;f<h;f++)v()&&(f<6?_(16,e):_(64,e))}x();const R=y();if(R===0)y();else if(R===1)for(T(1),S(),S(),c=y(),f=0;f<c;f++)S();x(),T(1);const C=y(),I=y(),U=m(1);U===0&&T(1),T(1),v()&&(i=y(),s=y(),r=y(),o=y());let O=[1,1];if(v()&&v())switch(g()){case 1:O=[1,1];break;case 2:O=[12,11];break;case 3:O=[10,11];break;case 4:O=[16,11];break;case 5:O=[40,33];break;case 6:O=[24,11];break;case 7:O=[20,11];break;case 8:O=[32,11];break;case 9:O=[80,33];break;case 10:O=[18,11];break;case 11:O=[15,11];break;case 12:O=[64,33];break;case 13:O=[160,99];break;case 14:O=[4,3];break;case 15:O=[3,2];break;case 16:O=[2,1];break;case 255:{O=[g()<<8|g(),g()<<8|g()];break}}return{width:Math.ceil((C+1)*16-i*2-s*2),height:(2-U)*(I+1)*16-(U?2:4)*(r+o),pixelRatio:O}}}class QD extends $S{constructor(...t){super(...t),this.initVPS=null}parsePES(t,e,i,s){const r=this.parseNALu(t,i.data,s);let o=this.VideoSample,c,h=!1;i.data=null,o&&r.length&&!t.audFound&&(this.pushAccessUnit(o,t),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),r.forEach(f=>{var g,m;switch(f.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),o.frame=!0,c=!0;break;case 16:case 17:case 18:case 21:if(c=!0,h){var y;(y=o)!=null&&y.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:c=!0,(g=o)!=null&&g.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 39:c=!0,Rg(f.data,2,i.pts,e.samples);break;case 32:c=!0,t.vps||(typeof t.params!="object"&&(t.params={}),t.params=Kt(t.params,this.readVPS(f.data)),this.initVPS=f.data),t.vps=[f.data];break;case 33:if(c=!0,h=!0,t.vps!==void 0&&t.vps[0]!==this.initVPS&&t.sps!==void 0&&!this.matchSPS(t.sps[0],f.data)&&(this.initVPS=t.vps[0],t.sps=t.pps=void 0),!t.sps){const v=this.readSPS(f.data);t.width=v.width,t.height=v.height,t.pixelRatio=v.pixelRatio,t.codec=v.codecString,t.sps=[],typeof t.params!="object"&&(t.params={});for(const T in v.params)t.params[T]=v.params[T]}this.pushParameterSet(t.sps,f.data,t.vps),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0;break;case 34:if(c=!0,typeof t.params=="object"){if(!t.pps){t.pps=[];const v=this.readPPS(f.data);for(const T in v)t.params[T]=v[T]}this.pushParameterSet(t.pps,f.data,t.vps)}break;case 35:c=!0,t.audFound=!0,(m=o)!=null&&m.frame&&(this.pushAccessUnit(o,t),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:c=!1;break}o&&c&&o.units.push(f)}),s&&o&&(this.pushAccessUnit(o,t),this.VideoSample=null)}pushParameterSet(t,e,i){(i&&i[0]===this.initVPS||!i&&!t.length)&&t.push(e)}getNALuType(t,e){return(t[e]&126)>>>1}ebsp2rbsp(t){const e=new Uint8Array(t.byteLength);let i=0;for(let s=0;s<t.byteLength;s++)s>=2&&t[s]===3&&t[s-1]===0&&t[s-2]===0||(e[i]=t[s],i++);return new Uint8Array(e.buffer,0,i)}pushAccessUnit(t,e){super.pushAccessUnit(t,e),this.initVPS&&(this.initVPS=null)}readVPS(t){const e=new kl(t);e.readUByte(),e.readUByte(),e.readBits(4),e.skipBits(2),e.readBits(6);const i=e.readBits(3),s=e.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:s}}readSPS(t){const e=new kl(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.readBits(4);const i=e.readBits(3);e.readBoolean();const s=e.readBits(2),r=e.readBoolean(),o=e.readBits(5),c=e.readUByte(),h=e.readUByte(),f=e.readUByte(),g=e.readUByte(),m=e.readUByte(),y=e.readUByte(),v=e.readUByte(),T=e.readUByte(),S=e.readUByte(),x=e.readUByte(),_=e.readUByte(),L=[],R=[];for(let wt=0;wt<i;wt++)L.push(e.readBoolean()),R.push(e.readBoolean());if(i>0)for(let wt=i;wt<8;wt++)e.readBits(2);for(let wt=0;wt<i;wt++)L[wt]&&(e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte()),R[wt]&&e.readUByte();e.readUEG();const C=e.readUEG();C==3&&e.skipBits(1);const I=e.readUEG(),U=e.readUEG(),O=e.readBoolean();let M=0,w=0,N=0,z=0;O&&(M+=e.readUEG(),w+=e.readUEG(),N+=e.readUEG(),z+=e.readUEG());const J=e.readUEG(),lt=e.readUEG(),ct=e.readUEG(),at=e.readBoolean();for(let wt=at?0:i;wt<=i;wt++)e.skipUEG(),e.skipUEG(),e.skipUEG();if(e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.readBoolean()&&e.readBoolean())for(let zt=0;zt<4;zt++)for(let Ke=0;Ke<(zt===3?2:6);Ke++)if(!e.readBoolean())e.readUEG();else{const ze=Math.min(64,1<<4+(zt<<1));zt>1&&e.readEG();for(let Bi=0;Bi<ze;Bi++)e.readEG()}e.readBoolean(),e.readBoolean(),e.readBoolean()&&(e.readUByte(),e.skipUEG(),e.skipUEG(),e.readBoolean());const W=e.readUEG();let ot=0;for(let wt=0;wt<W;wt++){let zt=!1;if(wt!==0&&(zt=e.readBoolean()),zt){wt===W&&e.readUEG(),e.readBoolean(),e.readUEG();let Ke=0;for(let Yi=0;Yi<=ot;Yi++){const ze=e.readBoolean();let Bi=!1;ze||(Bi=e.readBoolean()),(ze||Bi)&&Ke++}ot=Ke}else{const Ke=e.readUEG(),Yi=e.readUEG();ot=Ke+Yi;for(let ze=0;ze<Ke;ze++)e.readUEG(),e.readBoolean();for(let ze=0;ze<Yi;ze++)e.readUEG(),e.readBoolean()}}if(e.readBoolean()){const wt=e.readUEG();for(let zt=0;zt<wt;zt++){for(let Ke=0;Ke<ct+4;Ke++)e.readBits(1);e.readBits(1)}}let $=0,j=1,st=1,ut=!0,ft=1,ht=0;e.readBoolean(),e.readBoolean();let Nt=!1;if(e.readBoolean()){if(e.readBoolean()){const ds=e.readUByte(),Aa=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],hr=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];ds>0&&ds<16?(j=Aa[ds-1],st=hr[ds-1]):ds===255&&(j=e.readBits(16),st=e.readBits(16))}if(e.readBoolean()&&e.readBoolean(),e.readBoolean()&&(e.readBits(3),e.readBoolean(),e.readBoolean()&&(e.readUByte(),e.readUByte(),e.readUByte())),e.readBoolean()&&(e.readUEG(),e.readUEG()),e.readBoolean(),e.readBoolean(),e.readBoolean(),Nt=e.readBoolean(),Nt&&(e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG()),e.readBoolean()&&(ft=e.readBits(32),ht=e.readBits(32),e.readBoolean()&&e.readUEG(),e.readBoolean())){const hr=e.readBoolean(),to=e.readBoolean();let Fi=!1;(hr||to)&&(Fi=e.readBoolean(),Fi&&(e.readUByte(),e.readBits(5),e.readBoolean(),e.readBits(5)),e.readBits(4),e.readBits(4),Fi&&e.readBits(4),e.readBits(5),e.readBits(5),e.readBits(5));for(let ke=0;ke<=i;ke++){ut=e.readBoolean();const ji=ut||e.readBoolean();let Me=!1;ji?e.readEG():Me=e.readBoolean();const eo=Me?1:e.readUEG()+1;if(hr)for(let Cn=0;Cn<eo;Cn++)e.readUEG(),e.readUEG(),Fi&&(e.readUEG(),e.readUEG()),e.skipBits(1);if(to)for(let Cn=0;Cn<eo;Cn++)e.readUEG(),e.readUEG(),Fi&&(e.readUEG(),e.readUEG()),e.skipBits(1)}}e.readBoolean()&&(e.readBoolean(),e.readBoolean(),e.readBoolean(),$=e.readUEG())}let ce=I,Ve=U;if(O){let wt=1,zt=1;C===1?wt=zt=2:C==2&&(wt=2),ce=I-wt*w-wt*M,Ve=U-zt*z-zt*N}const Ti=s?["A","B","C"][s]:"",_a=c<<24|h<<16|f<<8|g;let Dn=0;for(let wt=0;wt<32;wt++)Dn=(Dn|(_a>>wt&1)<<31-wt)>>>0;let In=Dn.toString(16);return o===1&&In==="2"&&(In="6"),{codecString:`hvc1.${Ti}${o}.${In}.${r?"H":"L"}${_}.B0`,params:{general_tier_flag:r,general_profile_idc:o,general_profile_space:s,general_profile_compatibility_flags:[c,h,f,g],general_constraint_indicator_flags:[m,y,v,T,S,x],general_level_idc:_,bit_depth:J+8,bit_depth_luma_minus8:J,bit_depth_chroma_minus8:lt,min_spatial_segmentation_idc:$,chroma_format_idc:C,frame_rate:{fixed:ut,fps:ht/ft}},width:ce,height:Ve,pixelRatio:[j,st]}}readPPS(t){const e=new kl(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.skipUEG(),e.skipUEG(),e.skipBits(2),e.skipBits(3),e.skipBits(2),e.skipUEG(),e.skipUEG(),e.skipEG(),e.skipBits(2),e.readBoolean()&&e.skipUEG(),e.skipEG(),e.skipEG(),e.skipBits(4);const s=e.readBoolean(),r=e.readBoolean();let o=1;return r&&s?o=0:r?o=3:s&&(o=2),{parallelismType:o}}matchSPS(t,e){return String.fromCharCode.apply(null,t).substr(3)===String.fromCharCode.apply(null,e).substr(3)}}const Le=188;class pn{constructor(t,e,i,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=t,this.config=e,this.typeSupported=i,this.logger=s,this.videoParser=null}static probe(t,e){const i=pn.syncOffset(t);return i>0&&e.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(t){const e=t.length;let i=Math.min(Le*5,e-Le)+1,s=0;for(;s<i;){let r=!1,o=-1,c=0;for(let h=s;h<e;h+=Le)if(t[h]===71&&(e-h===Le||t[h+Le]===71)){if(c++,o===-1&&(o=h,o!==0&&(i=Math.min(o+Le*99,t.length-Le)+1)),r||(r=Kd(t,h)===0),r&&c>1&&(o===0&&c>2||h+Le>i))return o}else{if(c)return-1;break}s++}return-1}static createTrack(t,e){return{container:t==="video"||t==="audio"?"video/mp2t":void 0,type:t,id:ZT[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:t==="audio"?e:void 0}}resetInitSegment(t,e,i,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=pn.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=pn.createTrack("audio",s),this._id3Track=pn.createTrack("id3"),this._txtTrack=pn.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:t,_videoTrack:e,_id3Track:i}=this;t&&(t.pesData=null),e&&(e.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(t,e,i=!1,s=!1){i||(this.sampleAes=null);let r;const o=this._videoTrack,c=this._audioTrack,h=this._id3Track,f=this._txtTrack;let g=o.pid,m=o.pesData,y=c.pid,v=h.pid,T=c.pesData,S=h.pesData,x=null,_=this.pmtParsed,L=this._pmtId,R=t.length;if(this.remainderData&&(t=Ui(this.remainderData,t),R=t.length,this.remainderData=null),R<Le&&!s)return this.remainderData=t,{audioTrack:c,videoTrack:o,id3Track:h,textTrack:f};const C=Math.max(0,pn.syncOffset(t));R-=(R-C)%Le,R<t.byteLength&&!s&&(this.remainderData=new Uint8Array(t.buffer,R,t.buffer.byteLength-R));let I=0;for(let O=C;O<R;O+=Le)if(t[O]===71){const M=!!(t[O+1]&64),w=Kd(t,O),N=(t[O+3]&48)>>4;let z;if(N>1){if(z=O+5+t[O+4],z===O+Le)continue}else z=O+4;switch(w){case g:M&&(m&&(r=ea(m,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,f,r,!1)),m={data:[],size:0}),m&&(m.data.push(t.subarray(z,O+Le)),m.size+=O+Le-z);break;case y:if(M){if(T&&(r=ea(T,this.logger)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,r);break;case"mp3":this.parseMPEGPES(c,r);break;case"ac3":this.parseAC3PES(c,r);break}T={data:[],size:0}}T&&(T.data.push(t.subarray(z,O+Le)),T.size+=O+Le-z);break;case v:M&&(S&&(r=ea(S,this.logger))&&this.parseID3PES(h,r),S={data:[],size:0}),S&&(S.data.push(t.subarray(z,O+Le)),S.size+=O+Le-z);break;case 0:M&&(z+=t[z]+1),L=this._pmtId=WD(t,z);break;case L:{M&&(z+=t[z]+1);const J=ZD(t,z,this.typeSupported,i,this.observer,this.logger);g=J.videoPid,g>0&&(o.pid=g,o.segmentCodec=J.segmentVideoCodec),y=J.audioPid,y>0&&(c.pid=y,c.segmentCodec=J.segmentAudioCodec),v=J.id3Pid,v>0&&(h.pid=v),x!==null&&!_&&(this.logger.warn(`MPEG-TS PMT found at ${O} after unknown PID '${x}'. Backtracking to sync byte @${C} to parse all TS packets.`),x=null,O=C-188),_=this.pmtParsed=!0;break}case 17:case 8191:break;default:x=w;break}}else I++;I>0&&zd(this.observer,new Error(`Found ${I} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=m,c.pesData=T,h.pesData=S;const U={audioTrack:c,videoTrack:o,id3Track:h,textTrack:f};return s&&this.extractRemainingSamples(U),U}flush(){const{remainderData:t}=this;this.remainderData=null;let e;return t?e=this.demux(t,-1,!1,!0):e={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(t){const{audioTrack:e,videoTrack:i,id3Track:s,textTrack:r}=t,o=i.pesData,c=e.pesData,h=s.pesData;let f;if(o&&(f=ea(o,this.logger))?(this.readyVideoParser(i.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(i,r,f,!0),i.pesData=null)):i.pesData=o,c&&(f=ea(c,this.logger))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,f);break;case"mp3":this.parseMPEGPES(e,f);break;case"ac3":this.parseAC3PES(e,f);break}e.pesData=null}else c!=null&&c.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=c;h&&(f=ea(h,this.logger))?(this.parseID3PES(s,f),s.pesData=null):s.pesData=h}demuxSampleAes(t,e,i){const s=this.demux(t,i,!0,!this.config.progressive),r=this.sampleAes=new qD(this.observer,this.config,e);return this.decrypt(s,r)}readyVideoParser(t){this.videoParser===null&&(t==="avc"?this.videoParser=new XD:t==="hevc"&&(this.videoParser=new QD))}decrypt(t,e){return new Promise(i=>{const{audioTrack:s,videoTrack:r}=t;s.samples&&s.segmentCodec==="aac"?e.decryptAacSamples(s.samples,0,()=>{r.samples?e.decryptAvcSamples(r.samples,0,0,()=>{i(t)}):i(t)}):r.samples&&e.decryptAvcSamples(r.samples,0,0,()=>{i(t)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(t,e){let i=0;const s=this.aacOverFlow;let r=e.data;if(s){this.aacOverFlow=null;const m=s.missing,y=s.sample.unit.byteLength;if(m===-1)r=Ui(s.sample.unit,r);else{const v=y-m;s.sample.unit.set(r.subarray(0,m),v),t.samples.push(s.sample),i=s.missing}}let o,c;for(o=i,c=r.length;o<c-1&&!uc(r,o);o++);if(o!==i){let m;const y=o<c-1;if(y?m=`AAC PES did not start with ADTS header,offset:${o}`:m="No ADTS header found in AAC PES",zd(this.observer,new Error(m),y,this.logger),!y)return}IS(t,this.observer,r,o,this.audioCodec);let h;if(e.pts!==void 0)h=e.pts;else if(s){const m=CS(t.samplerate);h=s.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let f=0,g;for(;o<c;)if(g=OS(t,r,o,h,f),o+=g.length,g.missing){this.aacOverFlow=g;break}else for(f++;o<c-1&&!uc(r,o);o++);}parseMPEGPES(t,e){const i=e.data,s=i.length;let r=0,o=0;const c=e.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<s;)if(NS(i,o)){const h=MS(t,i,o,c,r);if(h)o+=h.length,r++;else break}else o++}parseAC3PES(t,e){{const i=e.data,s=e.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const r=i.length;let o=0,c=0,h;for(;c<r&&(h=FS(t,i,c,s,o++))>0;)c+=h}}parseID3PES(t,e){if(e.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=Kt({},e,{type:this._videoTrack?hi.emsg:hi.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(i)}}function Kd(l,t){return((l[t+1]&31)<<8)+l[t+2]}function WD(l,t){return(l[t+10]&31)<<8|l[t+11]}function ZD(l,t,e,i,s,r){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(l[t+1]&15)<<8|l[t+2],h=t+3+c-4,f=(l[t+10]&15)<<8|l[t+11];for(t+=12+f;t<h;){const g=Kd(l,t),m=(l[t+3]&15)<<8|l[t+4];switch(l[t]){case 207:if(!i){nd("ADTS AAC",r);break}case 15:o.audioPid===-1&&(o.audioPid=g);break;case 21:o.id3Pid===-1&&(o.id3Pid=g);break;case 219:if(!i){nd("H.264",r);break}case 27:o.videoPid===-1&&(o.videoPid=g);break;case 3:case 4:!e.mpeg&&!e.mp3?r.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=g,o.segmentAudioCodec="mp3");break;case 193:if(!i){nd("AC-3",r);break}case 129:e.ac3?o.audioPid===-1&&(o.audioPid=g,o.segmentAudioCodec="ac3"):r.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&m>0){let y=t+5,v=m;for(;v>2;){switch(l[y]){case 106:e.ac3!==!0?r.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=g,o.segmentAudioCodec="ac3");break}const S=l[y+1]+2;y+=S,v-=S}}break;case 194:case 135:return zd(s,new Error("Unsupported EC-3 in M2TS found"),void 0,r),o;case 36:o.videoPid===-1&&(o.videoPid=g,o.segmentVideoCodec="hevc",r.log("HEVC in M2TS found"));break}t+=m+5}return o}function zd(l,t,e,i){i.warn(`parsing error: ${t.message}`),l.emit(A.ERROR,A.ERROR,{type:pt.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!1,levelRetry:e,error:t,reason:t.message})}function nd(l,t){t.log(`${l} with AES-128-CBC encryption found in unencrypted stream`)}function ea(l,t){let e=0,i,s,r,o,c;const h=l.data;if(!l||l.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=Ui(h[0],h[1]),h.splice(1,1);if(i=h[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(s=(i[4]<<8)+i[5],s&&s>l.size-6)return null;const g=i[7];g&192&&(o=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,g&64?(c=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,o-c>60*9e4&&(t.warn(`${Math.round((o-c)/9e4)}s delta between PTS and DTS, align them`),o=c)):c=o),r=i[8];let m=r+9;if(l.size<=m)return null;l.size-=m;const y=new Uint8Array(l.size);for(let v=0,T=h.length;v<T;v++){i=h[v];let S=i.byteLength;if(m)if(m>S){m-=S;continue}else i=i.subarray(m),S-=m,m=0;y.set(i,e),e+=S}return s&&(s-=r+3),{data:y,pts:o,dts:c,len:s}}return null}class JD{static getSilentFrame(t,e){switch(t){case"mp4a.40.2":if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const dn=Math.pow(2,32)-1;class H{static init(){H.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let t;for(t in H.types)H.types.hasOwnProperty(t)&&(H.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);const e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);H.HDLR_TYPES={video:e,audio:i};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);H.STTS=H.STSC=H.STCO=r,H.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),H.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),H.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),H.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);H.FTYP=H.box(H.types.ftyp,o,h,o,c),H.DINF=H.box(H.types.dinf,H.box(H.types.dref,s))}static box(t,...e){let i=8,s=e.length;const r=s;for(;s--;)i+=e[s].byteLength;const o=new Uint8Array(i);for(o[0]=i>>24&255,o[1]=i>>16&255,o[2]=i>>8&255,o[3]=i&255,o.set(t,4),s=0,i=8;s<r;s++)o.set(e[s],i),i+=e[s].byteLength;return o}static hdlr(t){return H.box(H.types.hdlr,H.HDLR_TYPES[t])}static mdat(t){return H.box(H.types.mdat,t)}static mdhd(t,e){e*=t;const i=Math.floor(e/(dn+1)),s=Math.floor(e%(dn+1));return H.box(H.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(t){return H.box(H.types.mdia,H.mdhd(t.timescale||0,t.duration||0),H.hdlr(t.type),H.minf(t))}static mfhd(t){return H.box(H.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}static minf(t){return t.type==="audio"?H.box(H.types.minf,H.box(H.types.smhd,H.SMHD),H.DINF,H.stbl(t)):H.box(H.types.minf,H.box(H.types.vmhd,H.VMHD),H.DINF,H.stbl(t))}static moof(t,e,i){return H.box(H.types.moof,H.mfhd(t),H.traf(i,e))}static moov(t){let e=t.length;const i=[];for(;e--;)i[e]=H.trak(t[e]);return H.box.apply(null,[H.types.moov,H.mvhd(t[0].timescale||0,t[0].duration||0)].concat(i).concat(H.mvex(t)))}static mvex(t){let e=t.length;const i=[];for(;e--;)i[e]=H.trex(t[e]);return H.box.apply(null,[H.types.mvex,...i])}static mvhd(t,e){e*=t;const i=Math.floor(e/(dn+1)),s=Math.floor(e%(dn+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return H.box(H.types.mvhd,r)}static sdtp(t){const e=t.samples||[],i=new Uint8Array(4+e.length);let s,r;for(s=0;s<e.length;s++)r=e[s].flags,i[s+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return H.box(H.types.sdtp,i)}static stbl(t){return H.box(H.types.stbl,H.stsd(t),H.box(H.types.stts,H.STTS),H.box(H.types.stsc,H.STSC),H.box(H.types.stsz,H.STSZ),H.box(H.types.stco,H.STCO))}static avc1(t){let e=[],i=[],s,r,o;for(s=0;s<t.sps.length;s++)r=t.sps[s],o=r.byteLength,e.push(o>>>8&255),e.push(o&255),e=e.concat(Array.prototype.slice.call(r));for(s=0;s<t.pps.length;s++)r=t.pps[s],o=r.byteLength,i.push(o>>>8&255),i.push(o&255),i=i.concat(Array.prototype.slice.call(r));const c=H.box(H.types.avcC,new Uint8Array([1,e[3],e[4],e[5],255,224|t.sps.length].concat(e).concat([t.pps.length]).concat(i))),h=t.width,f=t.height,g=t.pixelRatio[0],m=t.pixelRatio[1];return H.box(H.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,H.box(H.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),H.box(H.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,m>>24,m>>16&255,m>>8&255,m&255])))}static esds(t){const e=t.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...e,6,1,2])}static audioStsd(t){const e=t.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount||0,0,16,0,0,0,0,e>>8&255,e&255,0,0])}static mp4a(t){return H.box(H.types.mp4a,H.audioStsd(t),H.box(H.types.esds,H.esds(t)))}static mp3(t){return H.box(H.types[".mp3"],H.audioStsd(t))}static ac3(t){return H.box(H.types["ac-3"],H.audioStsd(t),H.box(H.types.dac3,t.config))}static stsd(t){const{segmentCodec:e}=t;if(t.type==="audio"){if(e==="aac")return H.box(H.types.stsd,H.STSD,H.mp4a(t));if(e==="ac3"&&t.config)return H.box(H.types.stsd,H.STSD,H.ac3(t));if(e==="mp3"&&t.codec==="mp3")return H.box(H.types.stsd,H.STSD,H.mp3(t))}else if(t.pps&&t.sps){if(e==="avc")return H.box(H.types.stsd,H.STSD,H.avc1(t));if(e==="hevc"&&t.vps)return H.box(H.types.stsd,H.STSD,H.hvc1(t))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${t.type} segment codec (${e}/${t.codec})`)}static tkhd(t){const e=t.id,i=(t.duration||0)*(t.timescale||0),s=t.width||0,r=t.height||0,o=Math.floor(i/(dn+1)),c=Math.floor(i%(dn+1));return H.box(H.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,r>>8&255,r&255,0,0]))}static traf(t,e){const i=H.sdtp(t),s=t.id,r=Math.floor(e/(dn+1)),o=Math.floor(e%(dn+1));return H.box(H.types.traf,H.box(H.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),H.box(H.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,o>>24,o>>16&255,o>>8&255,o&255])),H.trun(t,i.length+16+20+8+16+8+8),i)}static trak(t){return t.duration=t.duration||4294967295,H.box(H.types.trak,H.tkhd(t),H.mdia(t))}static trex(t){const e=t.id;return H.box(H.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,e){const i=t.samples||[],s=i.length,r=12+16*s,o=new Uint8Array(r);let c,h,f,g,m,y;for(e+=8+r,o.set([t.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255],0),c=0;c<s;c++)h=i[c],f=h.duration,g=h.size,m=h.flags,y=h.cts,o.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&61440,m.degradPrio&15,y>>>24&255,y>>>16&255,y>>>8&255,y&255],12+16*c);return H.box(H.types.trun,o)}static initSegment(t){H.types||H.init();const e=H.moov(t);return Ui(H.FTYP,e)}static hvc1(t){const e=t.params,i=[t.vps,t.sps,t.pps],s=4,r=new Uint8Array([1,e.general_profile_space<<6|(e.general_tier_flag?32:0)|e.general_profile_idc,e.general_profile_compatibility_flags[0],e.general_profile_compatibility_flags[1],e.general_profile_compatibility_flags[2],e.general_profile_compatibility_flags[3],e.general_constraint_indicator_flags[0],e.general_constraint_indicator_flags[1],e.general_constraint_indicator_flags[2],e.general_constraint_indicator_flags[3],e.general_constraint_indicator_flags[4],e.general_constraint_indicator_flags[5],e.general_level_idc,240|e.min_spatial_segmentation_idc>>8,255&e.min_spatial_segmentation_idc,252|e.parallelismType,252|e.chroma_format_idc,248|e.bit_depth_luma_minus8,248|e.bit_depth_chroma_minus8,0,parseInt(e.frame_rate.fps),s-1|e.temporal_id_nested<<2|e.num_temporal_layers<<3|(e.frame_rate.fixed?64:0),i.length]);let o=r.length;for(let T=0;T<i.length;T+=1){o+=3;for(let S=0;S<i[T].length;S+=1)o+=2+i[T][S].length}const c=new Uint8Array(o);c.set(r,0),o=r.length;const h=i.length-1;for(let T=0;T<i.length;T+=1){c.set(new Uint8Array([32+T|(T===h?128:0),0,i[T].length]),o),o+=3;for(let S=0;S<i[T].length;S+=1)c.set(new Uint8Array([i[T][S].length>>8,i[T][S].length&255]),o),o+=2,c.set(i[T][S],o),o+=i[T][S].length}const f=H.box(H.types.hvcC,c),g=t.width,m=t.height,y=t.pixelRatio[0],v=t.pixelRatio[1];return H.box(H.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,g>>8&255,g&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f,H.box(H.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),H.box(H.types.pasp,new Uint8Array([y>>24,y>>16&255,y>>8&255,y&255,v>>24,v>>16&255,v>>8&255,v&255])))}}H.types=void 0;H.HDLR_TYPES=void 0;H.STTS=void 0;H.STSC=void 0;H.STCO=void 0;H.STSZ=void 0;H.VMHD=void 0;H.SMHD=void 0;H.STSD=void 0;H.FTYP=void 0;H.DINF=void 0;const GS=9e4;function Gg(l,t,e=1,i=!1){const s=l*t*e;return i?Math.round(s):s}function tI(l,t,e=1,i=!1){return Gg(l,t,1/e,i)}function bl(l,t=!1){return Gg(l,1e3,1/GS,t)}function eI(l,t=1){return Gg(l,GS,1/t)}const iI=10*1e3,sI=1024,nI=1152,rI=1536;let ia=null,rd=null;function sE(l,t,e,i){return{duration:t,size:e,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:l?2:1,isNonSync:l?0:1}}}class Hu extends zi{constructor(t,e,i,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=t,this.config=e,this.typeSupported=i,this.ISGenerated=!1,ia===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ia=o?parseInt(o[1]):0}if(rd===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);rd=r?parseInt(r[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(t){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=t}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(t){let e=!1;const i=t[0].pts,s=t.reduce((r,o)=>{let c=o.pts,h=c-r;return h<-4294967296&&(e=!0,c=wi(c,i),h=c-r),h>0?r:c},i);return e&&this.debug("PTS rollover detected"),s}remux(t,e,i,s,r,o,c,h){let f,g,m,y,v,T,S=r,x=r;const _=t.pid>-1,L=e.pid>-1,R=e.samples.length,C=t.samples.length>0,I=c&&R>0||R>1;if((!_||C)&&(!L||I)||this.ISGenerated||c){if(this.ISGenerated){var O,M,w,N;const ct=this.videoTrackConfig;(ct&&(e.width!==ct.width||e.height!==ct.height||((O=e.pixelRatio)==null?void 0:O[0])!==((M=ct.pixelRatio)==null?void 0:M[0])||((w=e.pixelRatio)==null?void 0:w[1])!==((N=ct.pixelRatio)==null?void 0:N[1]))||!ct&&I||this.nextAudioTs===null&&C)&&this.resetInitSegment()}this.ISGenerated||(m=this.generateIS(t,e,r,o));const z=this.isVideoContiguous;let J=-1,lt;if(I&&(J=aI(e.samples),!z&&this.config.forceKeyFrameOnDiscontinuity))if(T=!0,J>0){this.warn(`Dropped ${J} out of ${R} video samples due to a missing keyframe`);const ct=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(J),e.dropped+=J,x+=(e.samples[0].pts-ct)/e.inputTimeScale,lt=x}else J===-1&&(this.warn(`No keyframe found out of ${R} video samples`),T=!1);if(this.ISGenerated){if(C&&I){const ct=this.getVideoStartPts(e.samples),B=(wi(t.samples[0].pts,ct)-ct)/e.inputTimeScale;S+=Math.max(0,B),x+=Math.max(0,-B)}if(C){if(t.samplerate||(this.warn("regenerate InitSegment as audio detected"),m=this.generateIS(t,e,r,o)),g=this.remuxAudio(t,S,this.isAudioContiguous,o,L||I||h===mt.AUDIO?x:void 0),I){const ct=g?g.endPTS-g.startPTS:0;e.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),m=this.generateIS(t,e,r,o)),f=this.remuxVideo(e,x,z,ct)}}else I&&(f=this.remuxVideo(e,x,z,0));f&&(f.firstKeyFrame=J,f.independent=J!==-1,f.firstKeyFramePTS=lt)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(v=HS(i,r,this._initPTS,this._initDTS)),s.samples.length&&(y=VS(s,r,this._initPTS))),{audio:g,video:f,initSegment:m,independent:T,text:y,id3:v}}generateIS(t,e,i,s){const r=t.samples,o=e.samples,c=this.typeSupported,h={},f=this._initPTS;let g=!f||s,m="audio/mp4",y,v,T,S=-1;if(g&&(y=v=1/0),t.config&&r.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":c.mpeg?(m="audio/mpeg",t.codec=""):c.mp3&&(t.codec="mp3");break;case"ac3":t.codec="ac-3";break}h.audio={id:"audio",container:m,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):H.initSegment([t]),metadata:{channelCount:t.channelCount}},g&&(S=t.id,T=t.inputTimeScale,!f||T!==f.timescale?y=v=r[0].pts-Math.round(T*i):g=!1)}if(e.sps&&e.pps&&o.length){if(e.timescale=e.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:H.initSegment([e]),metadata:{width:e.width,height:e.height}},g)if(S=e.id,T=e.inputTimeScale,!f||T!==f.timescale){const x=this.getVideoStartPts(o),_=Math.round(T*i);v=Math.min(v,wi(o[0].dts,x)-_),y=Math.min(y,x-_)}else g=!1;this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,g?(f&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${i} ${y/T} != initPTS: ${f.baseTime/f.timescale} (${f.baseTime}/${f.timescale}) trackId: ${f.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${y/T} (${y}/${T}) trackId: ${S}`),this._initPTS={baseTime:y,timescale:T,trackId:S},this._initDTS={baseTime:v,timescale:T,trackId:S}):y=T=void 0,{tracks:h,initPTS:y,timescale:T,trackId:S}}remuxVideo(t,e,i,s){const r=t.inputTimeScale,o=t.samples,c=[],h=o.length,f=this._initPTS,g=f.baseTime*r/f.timescale;let m=this.nextVideoTs,y=8,v=this.videoSampleDuration,T,S,x=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,L=!1;if(!i||m===null){const $=g+e*r,j=o[0].pts-wi(o[0].dts,o[0].pts);ia&&m!==null&&Math.abs($-j-(m+g))<15e3?i=!0:m=$-j-g}const R=m+g;for(let $=0;$<h;$++){const j=o[$];j.pts=wi(j.pts,R),j.dts=wi(j.dts,R),j.dts<o[$>0?$-1:$].dts&&(L=!0)}L&&o.sort(function($,j){const st=$.dts-j.dts,ut=$.pts-j.pts;return st||ut}),T=o[0].dts,S=o[o.length-1].dts;const C=S-T,I=C?Math.round(C/(h-1)):v||t.inputTimeScale/30;if(i){const $=T-R,j=$>I,st=$<-1;if((j||st)&&(j?this.warn(`${(t.segmentCodec||"").toUpperCase()}: ${bl($,!0)} ms (${$}dts) hole between fragments detected at ${e.toFixed(3)}`):this.warn(`${(t.segmentCodec||"").toUpperCase()}: ${bl(-$,!0)} ms (${$}dts) overlapping between fragments detected at ${e.toFixed(3)}`),!st||R>=o[0].pts||ia)){T=R;const ut=o[0].pts-$;if(j)o[0].dts=T,o[0].pts=ut;else{let ft=!0;for(let ht=0;ht<o.length&&!(o[ht].dts>ut&&ft);ht++){const Nt=o[ht].pts;if(o[ht].dts-=$,o[ht].pts-=$,ht<o.length-1){const _t=o[ht+1].pts,ce=o[ht].pts,Ve=_t<=ce,Ti=_t<=Nt;ft=Ve==Ti}}}this.log(`Video: Initial PTS/DTS adjusted: ${bl(ut,!0)}/${bl(T,!0)}, delta: ${bl($,!0)} ms`)}}T=Math.max(0,T);let U=0,O=0,M=T;for(let $=0;$<h;$++){const j=o[$],st=j.units,ut=st.length;let ft=0;for(let ht=0;ht<ut;ht++)ft+=st[ht].data.length;O+=ft,U+=ut,j.length=ft,j.dts<M?(j.dts=M,M+=I/4|0||1):M=j.dts,x=Math.min(j.pts,x),_=Math.max(j.pts,_)}S=o[h-1].dts;const w=O+4*U+8;let N;try{N=new Uint8Array(w)}catch($){this.observer.emit(A.ERROR,A.ERROR,{type:pt.MUX_ERROR,details:K.REMUX_ALLOC_ERROR,fatal:!1,error:$,bytes:w,reason:`fail allocating video mdat ${w}`});return}const z=new DataView(N.buffer);z.setUint32(0,w),N.set(H.types.mdat,4);let J=!1,lt=Number.POSITIVE_INFINITY,ct=Number.POSITIVE_INFINITY,at=Number.NEGATIVE_INFINITY,B=Number.NEGATIVE_INFINITY;for(let $=0;$<h;$++){const j=o[$],st=j.units;let ut=0;for(let Nt=0,_t=st.length;Nt<_t;Nt++){const ce=st[Nt],Ve=ce.data,Ti=ce.data.byteLength;z.setUint32(y,Ti),y+=4,N.set(Ve,y),y+=Ti,ut+=4+Ti}let ft;if($<h-1)v=o[$+1].dts-j.dts,ft=o[$+1].pts-j.pts;else{const Nt=this.config,_t=$>0?j.dts-o[$-1].dts:I;if(ft=$>0?j.pts-o[$-1].pts:I,Nt.stretchShortVideoTrack&&this.nextAudioTs!==null){const ce=Math.floor(Nt.maxBufferHole*r),Ve=(s?x+s*r:this.nextAudioTs+g)-j.pts;Ve>ce?(v=Ve-_t,v<0?v=_t:J=!0,this.log(`It is approximately ${Ve/90} ms to the next segment; using duration ${v/90} ms for the last video frame.`)):v=_t}else v=_t}const ht=Math.round(j.pts-j.dts);lt=Math.min(lt,v),at=Math.max(at,v),ct=Math.min(ct,ft),B=Math.max(B,ft),c.push(sE(j.key,v,ut,ht))}if(c.length){if(ia){if(ia<70){const $=c[0].flags;$.dependsOn=2,$.isNonSync=0}}else if(rd&&B-ct<at-lt&&I/at<.025&&c[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let $=T;for(let j=0,st=c.length;j<st;j++){const ut=$+c[j].duration,ft=$+c[j].cts;if(j<st-1){const ht=ut+c[j+1].cts;c[j].duration=ht-ft}else c[j].duration=j?c[j-1].duration:I;c[j].cts=0,$=ut}}}v=J||!v?I:v;const q=S+v;this.nextVideoTs=m=q-g,this.videoSampleDuration=v,this.isVideoContiguous=!0;const k={data1:H.moof(t.sequenceNumber++,T,Kt(t,{samples:c})),data2:N,startPTS:(x-g)/r,endPTS:(_+v-g)/r,startDTS:(T-g)/r,endDTS:m/r,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:t.dropped};return t.samples=[],t.dropped=0,k}getSamplesPerFrame(t){switch(t.segmentCodec){case"mp3":return nI;case"ac3":return rI;default:return sI}}remuxAudio(t,e,i,s,r){const o=t.inputTimeScale,c=t.samplerate?t.samplerate:o,h=o/c,f=this.getSamplesPerFrame(t),g=f*h,m=this._initPTS,y=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,v=[],T=r!==void 0;let S=t.samples,x=y?0:8,_=this.nextAudioTs||-1;const L=m.baseTime*o/m.timescale,R=L+e*o;if(this.isAudioContiguous=i=i||S.length&&_>0&&(s&&Math.abs(R-(_+L))<9e3||Math.abs(wi(S[0].pts,R)-(_+L))<20*g),S.forEach(function(B){B.pts=wi(B.pts,R)}),!i||_<0){if(S=S.filter(B=>B.pts>=0),!S.length)return;r===0?_=0:s&&!T?_=Math.max(0,R-L):_=S[0].pts-L}if(t.segmentCodec==="aac"){const B=this.config.maxAudioFramesDrift;for(let q=0,W=_+L;q<S.length;q++){const ot=S[q],k=ot.pts,$=k-W,j=Math.abs(1e3*$/o);if($<=-B*g&&T)q===0&&(this.warn(`Audio frame @ ${(k/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*$/o)} ms.`),this.nextAudioTs=_=k-L,W=k);else if($>=B*g&&j<iI&&T){let st=Math.round($/g);for(W=k-st*g;W<0&&st&&g;)st--,W+=g;q===0&&(this.nextAudioTs=_=W-L),this.warn(`Injecting ${st} audio frames @ ${((W-L)/o).toFixed(3)}s due to ${Math.round(1e3*$/o)} ms gap.`);for(let ut=0;ut<st;ut++){let ft=JD.getSilentFrame(t.parsedCodec||t.manifestCodec||t.codec,t.channelCount);ft||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ft=ot.unit.subarray()),S.splice(q,0,{unit:ft,pts:W}),W+=g,q++}}ot.pts=W,W+=g}}let C=null,I=null,U,O=0,M=S.length;for(;M--;)O+=S[M].unit.byteLength;for(let B=0,q=S.length;B<q;B++){const W=S[B],ot=W.unit;let k=W.pts;if(I!==null){const j=v[B-1];j.duration=Math.round((k-I)/h)}else if(i&&t.segmentCodec==="aac"&&(k=_+L),C=k,O>0){O+=x;try{U=new Uint8Array(O)}catch(j){this.observer.emit(A.ERROR,A.ERROR,{type:pt.MUX_ERROR,details:K.REMUX_ALLOC_ERROR,fatal:!1,error:j,bytes:O,reason:`fail allocating audio mdat ${O}`});return}y||(new DataView(U.buffer).setUint32(0,O),U.set(H.types.mdat,4))}else return;U.set(ot,x);const $=ot.byteLength;x+=$,v.push(sE(!0,f,$,0)),I=k}const w=v.length;if(!w)return;const N=v[v.length-1];_=I-L,this.nextAudioTs=_+h*N.duration;const z=y?new Uint8Array(0):H.moof(t.sequenceNumber++,C/h,Kt({},t,{samples:v}));t.samples=[];const J=(C-L)/o,lt=_/o,at={data1:z,data2:U,startPTS:J,endPTS:lt,startDTS:J,endDTS:lt,type:"audio",hasAudio:!0,hasVideo:!1,nb:w};return this.isAudioContiguous=!0,at}}function wi(l,t){let e;if(t===null)return l;for(t<l?e=-8589934592:e=8589934592;Math.abs(l-t)>4294967296;)l+=e;return l}function aI(l){for(let t=0;t<l.length;t++)if(l[t].key)return t;return-1}function HS(l,t,e,i){const s=l.samples.length;if(!s)return;const r=l.inputTimeScale;for(let c=0;c<s;c++){const h=l.samples[c];h.pts=wi(h.pts-e.baseTime*r/e.timescale,t*r)/r,h.dts=wi(h.dts-i.baseTime*r/i.timescale,t*r)/r}const o=l.samples;return l.samples=[],{samples:o}}function VS(l,t,e){const i=l.samples.length;if(!i)return;const s=l.inputTimeScale;for(let o=0;o<i;o++){const c=l.samples[o];c.pts=wi(c.pts-e.baseTime*s/e.timescale,t*s)/s}l.samples.sort((o,c)=>o.pts-c.pts);const r=l.samples;return l.samples=[],{samples:r}}class lI extends zi{constructor(t,e,i,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(t){this.lastEndTime=null;const e=this.initPTS;e&&t&&e.baseTime===t.baseTime&&e.timescale===t.timescale||(this.initPTS=t)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(t,e,i,s){this.audioCodec=e,this.videoCodec=i,this.generateInitSegment(t,s),this.emitInitSegment=!0}generateInitSegment(t,e){let{audioCodec:i,videoCodec:s}=this;if(!(t!=null&&t.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:r,video:o}=this.initData=eS(t);if(e)ZR(t,e);else{const h=r||o;h!=null&&h.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${h.codec}")!`)}r&&(i=nE(r,Xt.AUDIO,this)),o&&(s=nE(o,Xt.VIDEO,this));const c={};r&&o?c.audiovideo={container:"video/mp4",codec:i+","+s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:t,id:"main"}:r?c.audio={container:"audio/mp4",codec:i,encrypted:r.encrypted,initSegment:t,id:"audio"}:o?c.video={container:"video/mp4",codec:s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:t,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=c}remux(t,e,i,s,r,o){var c,h;let{initPTS:f,lastEndTime:g}=this;const m={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};dt(g)||(g=this.lastEndTime=r||0);const y=e.samples;if(!y.length)return m;const v={initPTS:void 0,timescale:void 0,trackId:void 0};let T=this.initData;if((c=T)!=null&&c.length||(this.generateInitSegment(y),T=this.initData),!((h=T)!=null&&h.length))return this.warn("Failed to generate initSegment."),m;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);const S=JR(y,T,this),x=T.audio?S[T.audio.id]:null,_=T.video?S[T.video.id]:null,L=Lu(_,1/0),R=Lu(x,1/0),C=Lu(_,0,!0),I=Lu(x,0,!0);let U=r,O=0;const M=x&&(!_||!f&&R<L||f&&f.trackId===T.audio.id),w=M?x:_;if(w){const W=w.timescale,ot=w.start-r*W,k=M?T.audio.id:T.video.id;U=w.start/W,O=M?I-R:C-L,(o||!f)&&(oI(f,U,r,O)||W!==f.timescale)&&(f&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${r} ${ot/W} != initPTS: ${f.baseTime/f.timescale} (${f.baseTime}/${f.timescale}) trackId: ${f.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${U-r} (${ot}/${W}) trackId: ${k}`),f=null,v.initPTS=ot,v.timescale=W,v.trackId=k)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${r}`);f?(v.initPTS=f.baseTime,v.timescale=f.timescale,v.trackId=f.trackId):((!v.timescale||v.trackId===void 0||v.initPTS===void 0)&&(this.warn("Could not set initPTS"),v.initPTS=U,v.timescale=1,v.trackId=-1),this.initPTS=f={baseTime:v.initPTS,timescale:v.timescale,trackId:v.trackId});const N=U-f.baseTime/f.timescale,z=N+O;O>0?this.lastEndTime=z:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const J=!!T.audio,lt=!!T.video;let ct="";J&&(ct+="audio"),lt&&(ct+="video");const at=(T.audio?T.audio.encrypted:!1)||(T.video?T.video.encrypted:!1),B={data1:y,startPTS:N,startDTS:N,endPTS:z,endDTS:z,type:ct,hasAudio:J,hasVideo:lt,nb:1,dropped:0,encrypted:at};m.audio=J&&!lt?B:void 0,m.video=lt?B:void 0;const q=_?.sampleCount;if(q){const W=_.keyFrameIndex,ot=W!==-1;B.nb=q,B.dropped=W===0||this.isVideoContiguous?0:ot?W:q,B.independent=ot,B.firstKeyFrame=W,ot&&_.keyFrameStart&&(B.firstKeyFramePTS=(_.keyFrameStart-f.baseTime)/f.timescale),this.isVideoContiguous||(m.independent=ot),this.isVideoContiguous||(this.isVideoContiguous=ot),B.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${W}/${q} dropped: ${B.dropped} start: ${B.firstKeyFramePTS||"NA"}`)}return m.initSegment=v,m.id3=HS(i,r,f,f),s.samples.length&&(m.text=VS(s,r,f)),m}}function Lu(l,t,e=!1){return l?.start!==void 0?(l.start+(e?l.duration:0))/l.timescale:t}function oI(l,t,e,i){if(l===null)return!0;const s=Math.max(i,1),r=t-l.baseTime/l.timescale;return Math.abs(r-e)>s}function nE(l,t,e){const i=l.codec;return i&&i.length>4?i:t===Xt.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?ic(i,!1):(e.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(e.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let Ps;try{Ps=self.performance.now.bind(self.performance)}catch{Ps=Date.now}const Vu=[{demux:jD,remux:lI},{demux:pn,remux:Hu},{demux:VD,remux:Hu},{demux:zD,remux:Hu}];Vu.splice(2,0,{demux:KD,remux:Hu});class rE{constructor(t,e,i,s,r,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=i,this.id=r,this.logger=o}configure(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()}push(t,e,i,s){const r=i.transmuxing;r.executeStart=Ps();let o=new Uint8Array(t);const{currentTransmuxState:c,transmuxConfig:h}=this;s&&(this.currentTransmuxState=s);const{contiguous:f,discontinuity:g,trackSwitch:m,accurateTimeOffset:y,timeOffset:v,initSegmentChange:T}=s||c,{audioCodec:S,videoCodec:x,defaultInitPts:_,duration:L,initSegmentData:R}=h,C=uI(o,e);if(C&&ca(C.method)){const M=this.getDecrypter(),w=wg(C.method);if(M.isSync()){let N=M.softwareDecrypt(o,C.key.buffer,C.iv.buffer,w);if(i.part>-1){const J=M.flush();N=J&&J.buffer}if(!N)return r.executeEnd=Ps(),ad(i);o=new Uint8Array(N)}else return this.asyncResult=!0,this.decryptionPromise=M.webCryptoDecrypt(o,C.key.buffer,C.iv.buffer,w).then(N=>{const z=this.push(N,null,i);return this.decryptionPromise=null,z}),this.decryptionPromise}const I=this.needsProbing(g,m);if(I){const M=this.configureTransmuxer(o);if(M)return this.logger.warn(`[transmuxer] ${M.message}`),this.observer.emit(A.ERROR,A.ERROR,{type:pt.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!1,error:M,reason:M.message}),r.executeEnd=Ps(),ad(i)}(g||m||T||I)&&this.resetInitSegment(R,S,x,L,e),(g||T||I)&&this.resetInitialTimestamp(_),f||this.resetContiguity();const U=this.transmux(o,C,v,y,i);this.asyncResult=ql(U);const O=this.currentTransmuxState;return O.contiguous=!0,O.discontinuity=!1,O.trackSwitch=!1,r.executeEnd=Ps(),U}flush(t){const e=t.transmuxing;e.executeStart=Ps();const{decrypter:i,currentTransmuxState:s,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(t));const o=[],{timeOffset:c}=s;if(i){const m=i.flush();m&&o.push(this.push(m.buffer,null,t))}const{demuxer:h,remuxer:f}=this;if(!h||!f){e.executeEnd=Ps();const m=[ad(t)];return this.asyncResult?Promise.resolve(m):m}const g=h.flush(c);return ql(g)?(this.asyncResult=!0,g.then(m=>(this.flushRemux(o,m,t),o))):(this.flushRemux(o,g,t),this.asyncResult?Promise.resolve(o):o)}flushRemux(t,e,i){const{audioTrack:s,videoTrack:r,id3Track:o,textTrack:c}=e,{accurateTimeOffset:h,timeOffset:f}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===mt.MAIN?"level":"track"} ${i.level}`);const g=this.remuxer.remux(s,r,o,c,f,h,!0,this.id);t.push({remuxResult:g,chunkMeta:i}),i.transmuxing.executeEnd=Ps()}resetInitialTimestamp(t){const{demuxer:e,remuxer:i}=this;!e||!i||(e.resetTimeStamp(t),i.resetTimeStamp(t))}resetContiguity(){const{demuxer:t,remuxer:e}=this;!t||!e||(t.resetContiguity(),e.resetNextTimestamp())}resetInitSegment(t,e,i,s,r){const{demuxer:o,remuxer:c}=this;!o||!c||(o.resetInitSegment(t,e,i,s),c.resetInitSegment(t,e,i,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(t,e,i,s,r){let o;return e&&e.method==="SAMPLE-AES"?o=this.transmuxSampleAes(t,e,i,s,r):o=this.transmuxUnencrypted(t,i,s,r),o}transmuxUnencrypted(t,e,i,s){const{audioTrack:r,videoTrack:o,id3Track:c,textTrack:h}=this.demuxer.demux(t,e,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,o,c,h,e,i,!1,this.id),chunkMeta:s}}transmuxSampleAes(t,e,i,s,r){return this.demuxer.demuxSampleAes(t,e,i).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,i,s,!1,this.id),chunkMeta:r}))}configureTransmuxer(t){const{config:e,observer:i,typeSupported:s}=this;let r;for(let m=0,y=Vu.length;m<y;m++){var o;if((o=Vu[m].demux)!=null&&o.probe(t,this.logger)){r=Vu[m];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,h=this.remuxer,f=r.remux,g=r.demux;(!h||!(h instanceof f))&&(this.remuxer=new f(i,e,s,this.logger)),(!c||!(c instanceof g))&&(this.demuxer=new g(i,e,s,this.logger),this.probe=g.probe)}needsProbing(t,e){return!this.demuxer||!this.remuxer||t||e}getDecrypter(){let t=this.decrypter;return t||(t=this.decrypter=new Cg(this.config)),t}}function uI(l,t){let e=null;return l.byteLength>0&&t?.key!=null&&t.iv!==null&&t.method!=null&&(e=t),e}const ad=l=>({remuxResult:{},chunkMeta:l});function ql(l){return"then"in l&&l.then instanceof Function}class cI{constructor(t,e,i,s,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=i,this.duration=s,this.defaultInitPts=r||null}}class fI{constructor(t,e,i,s,r,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=i,this.trackSwitch=s,this.timeOffset=r,this.initSegmentChange=o}}let aE=0;class KS{constructor(t,e,i,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=aE++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=h=>{const f=h.data,g=this.hls;if(!(!g||!(f!=null&&f.event)||f.instanceNo!==this.instanceNo))switch(f.event){case"init":{var m;const y=(m=this.workerContext)==null?void 0:m.objectURL;y&&self.URL.revokeObjectURL(y);break}case"transmuxComplete":{this.handleTransmuxComplete(f.data);break}case"flush":{this.onFlush(f.data);break}case"workerLog":{g.logger[f.data.logType]&&g.logger[f.data.logType](f.data.message);break}default:{f.data=f.data||{},f.data.frag=this.frag,f.data.part=this.part,f.data.id=this.id,g.trigger(f.event,f.data);break}}},this.onWorkerError=h=>{if(!this.hls)return;const f=new Error(`${h.message}  (${h.filename}:${h.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(A.ERROR,{type:pt.OTHER_ERROR,details:K.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:f})};const r=t.config;this.hls=t,this.id=e,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=i,this.onFlush=s;const o=(h,f)=>{f=f||{},f.frag=this.frag||void 0,h===A.ERROR&&(f=f,f.parent=this.id,f.part=this.part,this.error=f.error),this.hls.trigger(h,f)};this.observer=new Pg,this.observer.on(A.FRAG_DECRYPTED,o),this.observer.on(A.ERROR,o);const c=bv(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const h=this.hls.logger;if(r.workerPath||mD()){try{r.workerPath?(h.log(`loading Web Worker ${r.workerPath} for "${e}"`),this.workerContext=yD(r.workerPath)):(h.log(`injecting Web Worker for "${e}"`),this.workerContext=pD());const{worker:g}=this.workerContext;g.addEventListener("message",this.onWorkerMessage),g.addEventListener("error",this.onWorkerError),g.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:e,config:Wt(r)})}catch(g){h.warn(`Error setting up "${e}" Web Worker, fallback to inline`,g),this.terminateWorker(),this.error=null,this.transmuxer=new rE(this.observer,c,r,"",e,t.logger)}return}}this.transmuxer=new rE(this.observer,c,r,"",e,t.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const t=this.instanceNo;this.instanceNo=aE++;const e=this.hls.config,i=bv(e.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:t,typeSupported:i,id:this.id,config:Wt(e)})}}terminateWorker(){if(this.workerContext){const{worker:t}=this.workerContext;this.workerContext=null,t.removeEventListener("message",this.onWorkerMessage),t.removeEventListener("error",this.onWorkerError),vD(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(t,e,i,s,r,o,c,h,f,g){var m,y;f.transmuxing.start=self.performance.now();const{instanceNo:v,transmuxer:T}=this,S=o?o.start:r.start,x=r.decryptdata,_=this.frag,L=!(_&&r.cc===_.cc),R=!(_&&f.level===_.level),C=_?f.sn-_.sn:-1,I=this.part?f.part-this.part.index:-1,U=C===0&&f.id>1&&f.id===_?.stats.chunkCount,O=!R&&(C===1||C===0&&(I===1||U&&I<=0)),M=self.performance.now();(R||C||r.stats.parsing.start===0)&&(r.stats.parsing.start=M),o&&(I||!O)&&(o.stats.parsing.start=M);const w=!(_&&((m=r.initSegment)==null?void 0:m.url)===((y=_.initSegment)==null?void 0:y.url)),N=new fI(L,O,h,R,S,w);if(!O||L||w){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${f.sn}${f.part>-1?" part: "+f.part:""} ${this.id===mt.MAIN?"level":"track"}: ${f.level} id: ${f.id}
        discontinuity: ${L}
        trackSwitch: ${R}
        contiguous: ${O}
        accurateTimeOffset: ${h}
        timeOffset: ${S}
        initSegmentChange: ${w}`);const z=new cI(i,s,e,c,g);this.configureTransmuxer(z)}if(this.frag=r,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:v,cmd:"demux",data:t,decryptdata:x,chunkMeta:f,state:N},t instanceof ArrayBuffer?[t]:[]);else if(T){const z=T.push(t,x,f,N);ql(z)?z.then(J=>{this.handleTransmuxComplete(J)}).catch(J=>{this.transmuxerError(J,f,"transmuxer-interface push error")}):this.handleTransmuxComplete(z)}}flush(t){t.transmuxing.start=self.performance.now();const{instanceNo:e,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:e,cmd:"flush",chunkMeta:t});else if(i){const s=i.flush(t);ql(s)?s.then(r=>{this.handleFlushResult(r,t)}).catch(r=>{this.transmuxerError(r,t,"transmuxer-interface flush error")}):this.handleFlushResult(s,t)}}transmuxerError(t,e,i){this.hls&&(this.error=t,this.hls.trigger(A.ERROR,{type:pt.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:t,err:t,reason:i}))}handleFlushResult(t,e){t.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(e)}configureTransmuxer(t){const{instanceNo:e,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:e,cmd:"configure",config:t}):i&&i.configure(t)}handleTransmuxComplete(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)}}const lE=100;class hI extends Mg{constructor(t,e,i){super(t,e,i,"audio-stream-controller",mt.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(A.LEVEL_LOADED,this.onLevelLoaded,this),t.on(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(A.BUFFER_RESET,this.onBufferReset,this),t.on(A.BUFFER_CREATED,this.onBufferCreated,this),t.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(A.FRAG_LOADING,this.onFragLoading,this),t.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:t}=this;t&&(super.unregisterListeners(),t.off(A.LEVEL_LOADED,this.onLevelLoaded,this),t.off(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(A.BUFFER_RESET,this.onBufferReset,this),t.off(A.BUFFER_CREATED,this.onBufferCreated,this),t.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(A.FRAG_LOADING,this.onFragLoading,this),t.off(A.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(t,{frag:e,id:i,initPTS:s,timescale:r,trackId:o}){if(i===mt.MAIN){const c=e.cc,h=this.fragCurrent;if(this.initPTS[c]={baseTime:s,timescale:r,trackId:o},this.log(`InitPTS for cc: ${c} found from main: ${s/r} (${s}/${r}) trackId: ${o}`),this.mainAnchor=e,this.state===et.WAITING_INIT_PTS){const f=this.waitingData;(!f&&!this.loadingParts||f&&f.frag.cc!==c)&&this.syncWithAnchor(e,f?.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==c?(h.abortRequests(),this.syncWithAnchor(e,h)):this.state===et.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(t,e){var i;const s=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(e&&s?.cc===e.cc)return;const r=(s||t).cc,o=this.getLevelDetails(),c=this.getLoadPosition(),h=fS(o,r,c);h&&(this.log(`Syncing with main frag at ${h.start} cc ${h.cc}`),this.startFragRequested=!1,this.nextLoadPosition=h.start,this.resetLoadingState(),this.state===et.IDLE&&this.doTickIdle())}startLoad(t,e){if(!this.levels){this.startPosition=t,this.state=et.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(lE),i>0&&t===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),t=i,this.state=et.IDLE):this.state=et.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}doTick(){switch(this.state){case et.IDLE:this.doTickIdle();break;case et.WAITING_TRACK:{const{levels:e,trackId:i}=this,s=e?.[i],r=s?.details;if(r&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(r))break;this.state=et.WAITING_INIT_PTS}break}case et.FRAG_LOADING_WAITING_RETRY:{var t;const e=performance.now(),i=this.retryDate;if(!i||e>=i||(t=this.media)!=null&&t.seeking){const{levels:s,trackId:r}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(s?.[r]||null),this.state=et.IDLE}break}case et.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:i,part:s,cache:r,complete:o}=e,c=this.mainAnchor;if(this.initPTS[i.cc]!==void 0){this.waitingData=null,this.state=et.FRAG_LOADING;const h=r.flush().buffer,f={frag:i,part:s,payload:h,networkDetails:null};this._handleFragmentLoadProgress(f),o&&super._handleFragmentLoadComplete(f)}else c&&c.cc!==e.frag.cc&&this.syncWithAnchor(c,e.frag)}else this.state=et.IDLE}}this.onTickEnd()}resetLoadingState(){const t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:t}=this;t!=null&&t.readyState&&(this.lastCurrentTime=t.currentTime)}doTickIdle(){var t;const{hls:e,levels:i,media:s,trackId:r}=this,o=e.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(i!=null&&i[r]))return;const c=i[r],h=c.details;if(!h||this.waitForLive(c)||this.waitForCdnTuneIn(h)){this.state=et.WAITING_TRACK,this.startFragRequested=!1;return}const f=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&f&&(this.bufferFlushed=!1,this.afterBufferFlushed(f,Xt.AUDIO,mt.AUDIO));const g=this.getFwdBufferInfo(f,mt.AUDIO);if(g===null)return;if(!this.switchingTrack&&this._streamEnded(g,h)){e.trigger(A.BUFFER_EOS,{type:"audio"}),this.state=et.ENDED;return}const m=g.len,y=e.maxBufferLength,v=h.fragments,T=v[0].start,S=this.getLoadPosition(),x=this.flushing?S:g.end;if(this.switchingTrack&&s){const R=S;h.PTSKnown&&R<T&&(g.end>T||g.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=T+.05)}if(m>=y&&!this.switchingTrack&&x<v[v.length-1].start)return;let _=this.getNextFragment(x,h);if(_&&this.isLoopLoading(_,x)&&(_=this.getNextFragmentLoopLoading(_,h,g,mt.MAIN,y)),!_){this.bufferFlushed=!0;return}let L=((t=this.mainFragLoading)==null?void 0:t.frag)||null;if(!this.audioOnly&&this.startFragRequested&&L&&ve(_)&&!_.endList&&(!h.live||!this.loadingParts&&x<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(L)===xe.OK&&(this.mainFragLoading=L=null),L&&ve(L))){if(_.start>L.end){const C=this.fragmentTracker.getFragAtPos(x,mt.MAIN);C&&C.end>L.end&&(L=C,this.mainFragLoading={frag:C,targetBufferTime:null})}if(_.start>L.end)return}this.loadFragment(_,c,x)}onMediaDetaching(t,e){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(t,e)}onAudioTracksUpdated(t,{audioTracks:e}){this.resetTransmuxer(),this.levels=e.map(i=>new Kl(i))}onAudioTrackSwitching(t,e){const i=!!e.url;this.trackId=e.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?(this.switchingTrack=e,this.flushAudioIfNeeded(e),this.state!==et.STOPPED&&(this.setInterval(lE),this.state=et.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=e,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(t,e){this.mainDetails=e.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(A.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(t,e){var i;const{levels:s}=this,{details:r,id:o,groupId:c,track:h}=e;if(!s){this.warn(`Audio tracks reset while loading track ${o} "${h.name}" of "${c}"`);return}const f=this.mainDetails;if(!f||r.endCC>f.endCC||f.expired){this.cachedTrackLoadedData=e,this.state!==et.STOPPED&&(this.state=et.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${h.name}" of "${c}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const g=s[o];let m=0;if(r.live||(i=g.details)!=null&&i.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;if(g.details){var y;m=this.alignPlaylists(r,g.details,(y=this.levelLastLoaded)==null?void 0:y.details)}r.alignedSliding||(AS(r,f),r.alignedSliding||oc(r,f),m=r.fragmentStart)}g.details=r,this.levelLastLoaded=g,this.startFragRequested||this.setStartPosition(f,m),this.hls.trigger(A.AUDIO_TRACK_UPDATED,{details:r,id:o,groupId:e.groupId}),this.state===et.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=et.IDLE),this.tick()}_handleFragmentLoadProgress(t){var e;const i=t.frag,{part:s,payload:r}=t,{config:o,trackId:c,levels:h}=this;if(!h){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const f=h[c];if(!f){this.warn("Audio track is undefined on fragment load progress");return}const g=f.details;if(!g){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const m=o.defaultAudioCodec||f.audioCodec||"mp4a.40.2";let y=this.transmuxer;y||(y=this.transmuxer=new KS(this.hls,mt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const v=this.initPTS[i.cc],T=(e=i.initSegment)==null?void 0:e.data;if(v!==void 0){const x=s?s.index:-1,_=x!==-1,L=new Og(i.level,i.sn,i.stats.chunkCount,r.byteLength,x,_);y.push(r,T,m,"",i,s,g.totalduration,!1,L,v)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${g.startSN} ,${g.endSN}],track ${c}`);const{cache:S}=this.waitingData=this.waitingData||{frag:i,part:s,cache:new bS,complete:!1};S.push(new Uint8Array(r)),this.state!==et.STOPPED&&(this.state=et.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(t){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(t)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(t,e){this.bufferFlushed=this.flushing=!1;const i=e.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(t,e){!this.audioOnly&&e.frag.type===mt.MAIN&&ve(e.frag)&&(this.mainFragLoading=e,this.state===et.IDLE&&this.tick())}onFragBuffered(t,e){const{frag:i,part:s}=e;if(i.type!==mt.AUDIO){!this.audioOnly&&i.type===mt.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(ve(i)){this.fragPrevious=i;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(A.AUDIO_TRACK_SWITCHED,Vt({},r)))}this.fragBufferedComplete(i,s),this.media&&this.tick()}onError(t,e){var i;if(e.fatal){this.state=et.ERROR;return}switch(e.details){case K.FRAG_GAP:case K.FRAG_PARSING_ERROR:case K.FRAG_DECRYPT_ERROR:case K.FRAG_LOAD_ERROR:case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_ERROR:case K.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(mt.AUDIO,e);break;case K.AUDIO_TRACK_LOAD_ERROR:case K.AUDIO_TRACK_LOAD_TIMEOUT:case K.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===et.WAITING_TRACK&&((i=e.context)==null?void 0:i.type)===Dt.AUDIO_TRACK&&(this.state=et.IDLE);break;case K.BUFFER_ADD_CODEC_ERROR:case K.BUFFER_APPEND_ERROR:if(e.parent!=="audio")return;this.reduceLengthAndFlushBuffer(e)||this.resetLoadingState();break;case K.BUFFER_FULL_ERROR:if(e.parent!=="audio")return;this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case K.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}onBufferFlushing(t,{type:e}){e!==Xt.VIDEO&&(this.flushing=!0)}onBufferFlushed(t,{type:e}){if(e!==Xt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===et.ENDED&&(this.state=et.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,e,mt.AUDIO),this.tick())}}_handleTransmuxComplete(t){var e;const i="audio",{hls:s}=this,{remuxResult:r,chunkMeta:o}=t,c=this.getCurrentContext(o);if(!c){this.resetWhenMissingContext(o);return}const{frag:h,part:f,level:g}=c,{details:m}=g,{audio:y,text:v,id3:T,initSegment:S}=r;if(this.fragContextChanged(h)||!m){this.fragmentTracker.removeFragment(h);return}if(this.state=et.PARSING,this.switchingTrack&&y&&this.completeAudioSwitch(this.switchingTrack),S!=null&&S.tracks){const x=h.initSegment||h;if(this.unhandledEncryptionError(S,h))return;this._bufferInitSegment(g,S.tracks,x,o),s.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:x,id:i,tracks:S.tracks})}if(y){const{startPTS:x,endPTS:_,startDTS:L,endDTS:R}=y;f&&(f.elementaryStreams[Xt.AUDIO]={startPTS:x,endPTS:_,startDTS:L,endDTS:R}),h.setElementaryStreamInfo(Xt.AUDIO,x,_,L,R),this.bufferFragmentData(y,h,f,o)}if(T!=null&&(e=T.samples)!=null&&e.length){const x=Kt({id:i,frag:h,details:m},T);s.trigger(A.FRAG_PARSING_METADATA,x)}if(v){const x=Kt({id:i,frag:h,details:m},v);s.trigger(A.FRAG_PARSING_USERDATA,x)}}_bufferInitSegment(t,e,i,s){if(this.state!==et.PARSING||(e.video&&delete e.video,e.audiovideo&&delete e.audiovideo,!e.audio))return;const r=e.audio;r.id=mt.AUDIO;const o=t.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${o}/${r.codec}]`),o&&o.split(",").length===1&&(r.levelCodec=o),this.hls.trigger(A.BUFFER_CODECS,e);const c=r.initSegment;if(c!=null&&c.byteLength){const h={type:"audio",frag:i,part:null,chunkMeta:s,parent:i.type,data:c};this.hls.trigger(A.BUFFER_APPENDING,h)}this.tickImmediate()}loadFragment(t,e,i){const s=this.fragmentTracker.getState(t);if(this.switchingTrack||s===xe.NOT_LOADED||s===xe.PARTIAL){var r;if(!ve(t))this._loadInitSegment(t,e);else if((r=e.details)!=null&&r.live&&!this.initPTS[t.cc]){this.log(`Waiting for video PTS in continuity counter ${t.cc} of live stream before loading audio fragment ${t.sn} of level ${this.trackId}`),this.state=et.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==e.details.fragmentStart&&oc(e.details,o)}else super.loadFragment(t,e,i)}else this.clearTrackerIfNeeded(t)}flushAudioIfNeeded(t){if(this.media&&this.bufferedTrack){const{name:e,lang:i,assocLang:s,characteristics:r,audioCodec:o,channels:c}=this.bufferedTrack;lr({name:e,lang:i,assocLang:s,characteristics:r,audioCodec:o,channels:c},t,er)||(nc(t.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=t)}}completeAudioSwitch(t){const{hls:e}=this;this.flushAudioIfNeeded(t),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(A.AUDIO_TRACK_SWITCHED,Vt({},t))}}class Hg extends zi{constructor(t,e){super(e,t.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=t}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(t,e,i){const s=e?.renditionReports;if(s){let r=-1;for(let o=0;o<s.length;o++){const c=s[o];let h;try{h=new self.URL(c.URI,e.url).href}catch(f){this.warn(`Could not construct new URL for Rendition Report: ${f}`),h=c.URI||""}if(h===t){r=o;break}else h===t.substring(0,h.length)&&(r=o)}if(r!==-1){const o=s[r],c=parseInt(o["LAST-MSN"])||e.lastPartSn;let h=parseInt(o["LAST-PART"])||e.lastPartIndex;if(this.hls.config.lowLatencyMode){const g=Math.min(e.age-e.partTarget,e.targetduration);h>=0&&g>e.partTarget&&(h+=1)}const f=i&&Rv(i);return new Lv(c,h>=0?h:void 0,f)}}}loadPlaylist(t){this.clearTimer()}loadingPlaylist(t,e){this.clearTimer()}shouldLoadPlaylist(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)}getUrlWithDirectives(t,e){if(e)try{return e.addDirectives(t)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return t}playlistLoaded(t,e,i){const{details:s,stats:r}=e,o=self.performance.now(),c=r.loading.first?Math.max(0,o-r.loading.first):0;s.advancedDateTime=Date.now()-c;const h=this.hls.config.timelineOffset;if(h!==s.appliedTimelineOffset){const g=Math.max(h||0,0);s.appliedTimelineOffset=g,s.fragments.forEach(m=>{m.setStart(m.playlistOffset+g)})}if(s.live||i!=null&&i.live){const g="levelInfo"in e?e.levelInfo:e.track;if(s.reloaded(i),i&&s.fragments.length>0){rD(i,s,this);const L=s.playlistParsingError;if(L){this.warn(L);const R=this.hls;if(!R.config.ignorePlaylistParsingErrors){var f;const{networkDetails:C}=e;R.trigger(A.ERROR,{type:pt.NETWORK_ERROR,details:K.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:L,reason:L.message,level:e.level||void 0,parent:(f=s.fragments[0])==null?void 0:f.type,networkDetails:C,stats:r});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=r.loading.start);const m=this.hls.mainForwardBufferInfo,y=m?m.end-m.len:0,v=(s.edge-y)*1e3,T=ES(s,v);if(s.requestScheduled+T<o?s.requestScheduled=o:s.requestScheduled+=T,this.log(`live playlist ${t} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let S,x,_;if(s.canBlockReload&&s.endSN&&s.advanced){const L=this.hls.config.lowLatencyMode,R=s.lastPartSn,C=s.endSN,I=s.lastPartIndex,U=I!==-1,O=R===C;U?O?(x=C+1,_=L?0:I):(x=R,_=L?I+1:s.maxPartIndex):x=C+1;const M=s.age,w=M+s.ageHeader;let N=Math.min(w-s.partTarget,s.targetduration*1.5);if(N>0){if(w>s.targetduration*3)this.log(`Playlist last advanced ${M.toFixed(2)}s ago. Omitting segment and part directives.`),x=void 0,_=void 0;else if(i!=null&&i.tuneInGoal&&w-s.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${N} with playlist age: ${s.age}`),N=0;else{const z=Math.floor(N/s.targetduration);if(x+=z,_!==void 0){const J=Math.round(N%s.targetduration/s.partTarget);_+=J}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${M.toFixed(2)}s goal: ${N} skip sn ${z} to part ${_}`)}s.tuneInGoal=N}if(S=this.getDeliveryDirectives(s,e.deliveryDirectives,x,_),L||!O){s.requestScheduled=o,this.loadingPlaylist(g,S);return}}else(s.canBlockReload||s.canSkipUntil)&&(S=this.getDeliveryDirectives(s,e.deliveryDirectives,x,_));S&&x!==void 0&&s.canBlockReload&&(s.requestScheduled=r.loading.first+Math.max(T-c*2,T/2)),this.scheduleLoading(g,S,s)}else this.clearTimer()}scheduleLoading(t,e,i){const s=i||t.details;if(!s){this.loadingPlaylist(t,e);return}const r=self.performance.now(),o=s.requestScheduled;if(r>=o){this.loadingPlaylist(t,e);return}const c=o-r;this.log(`reload live playlist ${t.name||t.bitrate+"bps"} in ${Math.round(c)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(t,e),c)}getDeliveryDirectives(t,e,i,s){let r=Rv(t);return e!=null&&e.skip&&t.deltaUpdateFailed&&(i=e.msn,s=e.part,r=$u.No),new Lv(i,s,r)}checkRetry(t){const e=t.details,i=rc(t),s=t.errorAction,{action:r,retryCount:o=0,retryConfig:c}=s||{},h=!!s&&!!c&&(r===Be.RetryRequest||!s.resolved&&r===Be.SendAlternateToPenaltyBox);if(h){var f;if(o>=c.maxNumRetry)return!1;if(i&&(f=t.context)!=null&&f.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${c.maxNumRetry} after "${e}" without delivery-directives`),this.loadPlaylist();else{const g=Ig(c,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),g),this.warn(`Retrying playlist loading ${o+1}/${c.maxNumRetry} after "${e}" in ${g}ms`)}t.levelRetry=!0,s.resolved=!0}return h}}function zS(l,t){if(l.length!==t.length)return!1;for(let e=0;e<l.length;e++)if(!Xl(l[e].attrs,t[e].attrs))return!1;return!0}function Xl(l,t,e){const i=l["STABLE-RENDITION-ID"];return i&&!e?i===t["STABLE-RENDITION-ID"]:!(e||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>l[s]!==t[s])}function Yd(l,t){return t.label.toLowerCase()===l.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(l.lang||"").toLowerCase())}class dI extends Hg{constructor(t){super(t,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.MANIFEST_PARSED,this.onManifestParsed,this),t.on(A.LEVEL_LOADING,this.onLevelLoading,this),t.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(A.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.MANIFEST_PARSED,this.onManifestParsed,this),t.off(A.LEVEL_LOADING,this.onLevelLoading,this),t.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(A.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.audioTracks||[]}onAudioTrackLoaded(t,e){const{id:i,groupId:s,details:r}=e,o=this.tracksInGroup[i];if(!o||o.groupId!==s){this.warn(`Audio track with id:${i} and group:${s} not found in active group ${o?.groupId}`);return}const c=o.details;o.details=e.details,this.log(`Audio track ${i} "${o.name}" lang:${o.lang} group:${s} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,e,c)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const i=e.audioGroups||null,s=this.groupIds;let r=this.currentTrack;if(!i||s?.length!==i?.length||i!=null&&i.some(c=>s?.indexOf(c)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(y=>!i||i.indexOf(y.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(y=>y.default)&&(this.selectDefaultTrack=!1),c.forEach((y,v)=>{y.id=v});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const h=this.hls.config.audioPreference;if(!r&&h){const y=as(h,c,er);if(y>-1)r=c[y];else{const v=as(h,this.tracks);r=this.tracks[v]}}let f=this.findTrackId(r);f===-1&&r&&(f=this.findTrackId(null));const g={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${i?.join(",")}`),this.hls.trigger(A.AUDIO_TRACKS_UPDATED,g);const m=this.trackId;if(f!==-1&&m===-1)this.setAudioTrack(f);else if(c.length&&m===-1){var o;const y=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${c.length}`);this.warn(y.message),this.hls.trigger(A.ERROR,{type:pt.MEDIA_ERROR,details:K.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:y})}}}onError(t,e){e.fatal||!e.context||e.context.type===Dt.AUDIO_TRACK&&e.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(e.context.groupId)!==-1)&&this.checkRetry(e)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}setAudioOption(t){const e=this.hls;if(e.config.audioPreference=t,t){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const s=this.currentTrack;if(s&&lr(t,s,er))return s;const r=as(t,this.tracksInGroup,er);if(r>-1){const o=this.tracksInGroup[r];return this.setAudioTrack(r),o}else if(s){let o=e.loadLevel;o===-1&&(o=e.firstAutoLevel);const c=AL(t,e.levels,i,o,er);if(c===-1)return null;e.nextLoadLevel=c}if(t.channels||t.audioCodec){const o=as(t,i);if(o>-1)return i[o]}}}return null}setAudioTrack(t){const e=this.tracksInGroup;if(t<0||t>=e.length){this.warn(`Invalid audio track id: ${t}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,s=e[t],r=s.details&&!s.details.live;if(t===this.trackId&&s===i&&r||(this.log(`Switching to audio-track ${t} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=t,this.currentTrack=s,this.hls.trigger(A.AUDIO_TRACK_SWITCHING,Vt({},s)),r))return;const o=this.switchParams(s.url,i?.details,s.details);this.loadPlaylist(o)}findTrackId(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){const s=e[i];if(!(this.selectDefaultTrack&&!s.default)&&(!t||lr(t,s,er)))return i}if(t){const{name:i,lang:s,assocLang:r,characteristics:o,audioCodec:c,channels:h}=t;for(let f=0;f<e.length;f++){const g=e[f];if(lr({name:i,lang:s,assocLang:r,characteristics:o,audioCodec:c,channels:h},g,er))return f}for(let f=0;f<e.length;f++){const g=e[f];if(Xl(t.attrs,g.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return f}for(let f=0;f<e.length;f++){const g=e[f];if(Xl(t.attrs,g.attrs,["LANGUAGE"]))return f}}return-1}loadPlaylist(t){super.loadPlaylist();const e=this.currentTrack;this.shouldLoadPlaylist(e)&&nc(e.url,this.hls)&&this.scheduleLoading(e,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const i=t.id,s=t.groupId,r=this.getUrlWithDirectives(t.url,e),o=t.details,c=o?.age;this.log(`Loading audio-track ${i} "${t.name}" lang:${t.lang} group:${s}${e?.msn!==void 0?" at sn "+e.msn+" part "+e.part:""}${c&&o.live?" age "+c.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(A.AUDIO_TRACK_LOADING,{url:r,id:i,groupId:s,deliveryDirectives:e||null,track:t})}}class gI{constructor(t){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=t}destroy(){this.tracks=this.queues=null}append(t,e,i){if(this.queues===null||this.tracks===null)return;const s=this.queues[e];s.push(t),s.length===1&&!i&&this.executeNext(e)}appendBlocker(t){return new Promise(e=>{const i={label:"async-blocker",execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,t)})}prependBlocker(t){return new Promise(e=>{if(this.queues){const i={label:"async-blocker-prepend",execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[t].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(t=>{var e;const i=(e=t[0])==null?void 0:e.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(t[0].execute(),t.splice(0,1))})}unblockAudio(t){if(this.queues===null)return;this.queues.audio[0]===t&&this.shiftAndExecuteNext("audio")}executeNext(t){if(this.queues===null||this.tracks===null)return;const e=this.queues[t];if(e.length){const s=e[0];try{s.execute()}catch(r){var i;if(s.onError(r),this.queues===null||this.tracks===null)return;const o=(i=this.tracks[t])==null?void 0:i.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(t)}}}shiftAndExecuteNext(t){this.queues!==null&&(this.queues[t].shift(),this.executeNext(t))}current(t){var e;return((e=this.queues)==null?void 0:e[t][0])||null}toString(){const{queues:t,tracks:e}=this;return t===null||e===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(t){var e,i;return(e=this.queues)!=null&&e[t]||(i=this.tracks)!=null&&i[t]?`${t}: (${this.listSbInfo(t)}) ${this.listOps(t)}`:""}listSbInfo(t){var e;const i=(e=this.tracks)==null?void 0:e[t],s=i?.buffer;return s?`SourceBuffer${s.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(t){var e;return((e=this.queues)==null?void 0:e[t].map(i=>i.label).join(", "))||""}}const oE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,YS="HlsJsTrackRemovedError";class mI extends Error{constructor(t){super(t),this.name=YS}}class pI extends zi{constructor(t,e){super("buffer-controller",t.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:s,mediaSource:r}=this;i&&this.log("Media source opened"),!(!s||!r)&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(A.MEDIA_ATTACHED,{media:s,mediaSource:r}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:s}=this;i!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${i})`)},this.hls=t,this.fragmentTracker=e,this.appendSource=HR(bn(t.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:t}=this;t.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.MANIFEST_PARSED,this.onManifestParsed,this),t.on(A.BUFFER_RESET,this.onBufferReset,this),t.on(A.BUFFER_APPENDING,this.onBufferAppending,this),t.on(A.BUFFER_CODECS,this.onBufferCodecs,this),t.on(A.BUFFER_EOS,this.onBufferEos,this),t.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(A.FRAG_PARSED,this.onFragParsed,this),t.on(A.FRAG_CHANGED,this.onFragChanged,this),t.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(A.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.MANIFEST_PARSED,this.onManifestParsed,this),t.off(A.BUFFER_RESET,this.onBufferReset,this),t.off(A.BUFFER_APPENDING,this.onBufferAppending,this),t.off(A.BUFFER_CODECS,this.onBufferCodecs,this),t.off(A.BUFFER_EOS,this.onBufferEos,this),t.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(A.FRAG_PARSED,this.onFragParsed,this),t.off(A.FRAG_CHANGED,this.onFragChanged,this),t.off(A.ERROR,this.onError,this)}transferMedia(){const{media:t,mediaSource:e}=this;if(!t)return null;const i={};if(this.operationQueue){const r=this.isUpdating();r||this.operationQueue.removeBlockers();const o=this.isQueued();(r||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${r?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===e?Kt(i,s.tracks):this.sourceBuffers.forEach(r=>{const[o]=r;o&&(i[o]=Kt({},this.tracks[o]),this.removeBuffer(o)),r[0]=r[1]=null}),{media:t,mediaSource:e,tracks:i}}initTracks(){const t={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=t,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(t,e){var i;let s=2;(e.audio&&!e.video||!e.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(t,e){const i=this.media=e.media;this.transferData=this.overrides=void 0;const s=bn(this.appendSource);if(s){const r=!!e.mediaSource;(r||e.overrides)&&(this.transferData=e,this.overrides=e.overrides);const o=this.mediaSource=e.mediaSource||new s;if(this.assignMediaSource(o),r)this._objectUrl=i.src,this.attachTransferred();else{const c=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{i.removeAttribute("src");const h=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||h&&o instanceof h,uE(i),yI(i,c),i.load()}catch{i.src=c}else i.src=c}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(t){var e,i;this.log(`${((e=this.transferData)==null?void 0:e.mediaSource)===t?"transferred":"created"} media source: ${(i=t.constructor)==null?void 0:i.name}`),t.addEventListener("sourceopen",this._onMediaSourceOpen),t.addEventListener("sourceended",this._onMediaSourceEnded),t.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.addEventListener("startstreaming",this._onStartStreaming),t.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const t=this.media,e=this.transferData;if(!e||!t)return;const i=this.tracks,s=e.tracks,r=s?Object.keys(s):null,o=r?r.length:0,c=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&r&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Wt(i,(h,f)=>h==="initSegment"?void 0:f)};
transfer tracks: ${Wt(s,(h,f)=>h==="initSegment"?void 0:f)}}`),!qT(s,i)){e.mediaSource=null,e.tracks=void 0;const h=t.currentTime,f=this.details,g=Math.max(h,f?.fragments[0].start||0);if(g-h>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${h} -> ${g}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(i)}") start time: ${g} currentTime: ${h}`),this.onMediaDetaching(A.MEDIA_DETACHING,{}),this.onMediaAttaching(A.MEDIA_ATTACHING,e),t.currentTime=g;return}this.transferData=void 0,r.forEach(h=>{const f=h,g=s[f];if(g){const m=g.buffer;if(m){const y=this.fragmentTracker,v=g.id;if(y.hasFragments(v)||y.hasParts(v)){const x=xt.getBuffered(m);y.detectEvictedFragments(f,x,v,null,!0)}const T=ld(f),S=[f,m];this.sourceBuffers[T]=S,m.updating&&this.operationQueue&&this.operationQueue.prependBlocker(f),this.trackSourceBuffer(f,g)}}}),c(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),c()}get mediaSourceOpenOrEnded(){var t;const e=(t=this.mediaSource)==null?void 0:t.readyState;return e==="open"||e==="ended"}onMediaDetaching(t,e){const i=!!e.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:r,_objectUrl:o}=this;if(r){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([c])=>{c&&this.removeBuffer(c)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const c=r.readyState==="open";try{const h=r.sourceBuffers;for(let f=h.length;f--;)c&&h[f].abort(),r.removeSourceBuffer(h[f]);c&&r.endOfStream()}catch(h){this.warn(`onMediaDetaching: ${h.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),i||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(s.removeAttribute("src"),this.appendSource&&uE(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(A.MEDIA_DETACHED,e)}onBufferReset(){this.sourceBuffers.forEach(([t])=>{t&&this.resetBuffer(t)}),this.initTracks()}resetBuffer(t){var e;const i=(e=this.tracks[t])==null?void 0:e.buffer;if(this.removeBuffer(t),i)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(r){this.warn(`onBufferReset ${t}`,r)}delete this.tracks[t]}removeBuffer(t){this.removeBufferListeners(t),this.sourceBuffers[ld(t)]=[null,null];const e=this.tracks[t];e&&(e.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new gI(this.tracks)}onBufferCodecs(t,e){const i=this.tracks,s=Object.keys(e);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const r="audiovideo"in e&&(i.audio||i.video)||i.audiovideo&&("audio"in e||"video"in e),o=!r&&this.sourceBufferCount&&this.media&&s.some(c=>!i[c]);if(r||o){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${s}" SourceBuffers`);return}s.forEach(c=>{var h,f;const g=e[c],{id:m,codec:y,levelCodec:v,container:T,metadata:S,supplemental:x}=g;let _=i[c];const L=(h=this.transferData)==null||(h=h.tracks)==null?void 0:h[c],R=L!=null&&L.buffer?L:_,C=R?.pendingCodec||R?.codec,I=R?.levelCodec;_||(_=i[c]={buffer:void 0,listeners:[],codec:y,supplemental:x,container:T,levelCodec:v,metadata:S,id:m});const U=Fu(C,I),O=U?.replace(oE,"$1");let M=Fu(y,v);const w=(f=M)==null?void 0:f.replace(oE,"$1");M&&U&&O!==w&&(c.slice(0,5)==="audio"&&(M=ic(M,this.appendSource)),this.log(`switching codec ${C} to ${M}`),M!==(_.pendingCodec||_.codec)&&(_.pendingCodec=M),_.container=T,this.appendChangeType(c,T,M))}),(this.tracksReady||this.sourceBufferCount)&&(e.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((t,e)=>{const i=this.tracks[e];return t[e]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},t},{})}appendChangeType(t,e,i){const s=`${e};codecs=${i}`,r={label:`change-type=${s}`,execute:()=>{const o=this.tracks[t];if(o){const c=o.buffer;c!=null&&c.changeType&&(this.log(`changing ${t} sourceBuffer type to ${s}`),c.changeType(s),o.codec=i,o.container=e)}this.shiftAndExecuteNext(t)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${t} SourceBuffer type`,o)}};this.append(r,t,this.isPending(this.tracks[t]))}blockAudio(t){var e;const i=t.start,s=i+t.duration*.05;if(((e=this.fragmentTracker.getAppendedFrag(i,mt.MAIN))==null?void 0:e.gap)===!0)return;const o={label:"block-audio",execute:()=>{var c;const h=this.tracks.video;(this.lastVideoAppendEnd>s||h!=null&&h.buffer&&xt.isBuffered(h.buffer,s)||((c=this.fragmentTracker.getAppendedFrag(s,mt.MAIN))==null?void 0:c.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn("Error executing block-audio operation",c)}};this.blockedAudioAppend={op:o,frag:t},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:t,operationQueue:e}=this;t&&e&&(this.blockedAudioAppend=null,e.unblockAudio(t.op))}onBufferAppending(t,e){const{tracks:i}=this,{data:s,type:r,parent:o,frag:c,part:h,chunkMeta:f,offset:g}=e,m=f.buffering[r],{sn:y,cc:v}=c,T=self.performance.now();m.start=T;const S=c.stats.buffering,x=h?h.stats.buffering:null;S.start===0&&(S.start=T),x&&x.start===0&&(x.start=T);const _=i.audio;let L=!1;r==="audio"&&_?.container==="audio/mpeg"&&(L=!this.lastMpegAudioChunk||f.id===1||this.lastMpegAudioChunk.sn!==f.sn,this.lastMpegAudioChunk=f);const R=i.video,C=R?.buffer;if(C&&y!=="initSegment"){const O=h||c,M=this.blockedAudioAppend;if(r==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(R.ending||R.ended)){const N=O.start+O.duration*.05,z=C.buffered,J=this.currentOp("video");!z.length&&!J?this.blockAudio(O):!J&&!xt.isBuffered(C,N)&&this.lastVideoAppendEnd<N&&this.blockAudio(O)}else if(r==="video"){const w=O.end;if(M){const N=M.frag.start;(w>N||w<this.lastVideoAppendEnd||xt.isBuffered(C,N))&&this.unblockAudio()}this.lastVideoAppendEnd=w}}const I=(h||c).start,U={label:`append-${r}`,execute:()=>{var O;m.executeStart=self.performance.now();const M=(O=this.tracks[r])==null?void 0:O.buffer;M&&(L?this.updateTimestampOffset(M,I,.1,r,y,v):g!==void 0&&dt(g)&&this.updateTimestampOffset(M,g,1e-6,r,y,v)),this.appendExecutor(s,r)},onStart:()=>{},onComplete:()=>{const O=self.performance.now();m.executeEnd=m.end=O,S.first===0&&(S.first=O),x&&x.first===0&&(x.first=O);const M={};this.sourceBuffers.forEach(([w,N])=>{w&&(M[w]=xt.getBuffered(N))}),this.appendErrors[r]=0,r==="audio"||r==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(A.BUFFER_APPENDED,{type:r,frag:c,part:h,chunkMeta:f,parent:c.type,timeRanges:M})},onError:O=>{var M;const w={type:pt.MEDIA_ERROR,parent:c.type,details:K.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:c,part:h,chunkMeta:f,error:O,err:O,fatal:!1},N=(M=this.media)==null?void 0:M.error;if(O.code===DOMException.QUOTA_EXCEEDED_ERR||O.name=="QuotaExceededError"||"quota"in O)w.details=K.BUFFER_FULL_ERROR;else if(O.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!N)w.errorAction=zl(!0);else if(O.name===YS&&this.sourceBufferCount===0)w.errorAction=zl(!0);else{const z=++this.appendErrors[r];this.warn(`Failed ${z}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${N||"no media error"})`),(z>=this.hls.config.appendErrorMaxRetry||N)&&(w.fatal=!0)}this.hls.trigger(A.ERROR,w)}};this.append(U,r,this.isPending(this.tracks[r]))}getFlushOp(t,e,i){return this.log(`queuing "${t}" remove ${e}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(t,e,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(A.BUFFER_FLUSHED,{type:t})},onError:s=>{this.warn(`Failed to remove ${e}-${i} from "${t}" SourceBuffer`,s)}}}onBufferFlushing(t,e){const{type:i,startOffset:s,endOffset:r}=e;i?this.append(this.getFlushOp(i,s,r),i):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,s,r),o)})}onFragParsed(t,e){const{frag:i,part:s}=e,r=[],o=s?s.elementaryStreams:i.elementaryStreams;o[Xt.AUDIOVIDEO]?r.push("audiovideo"):(o[Xt.AUDIO]&&r.push("audio"),o[Xt.VIDEO]&&r.push("video"));const c=()=>{const h=self.performance.now();i.stats.buffering.end=h,s&&(s.stats.buffering.end=h);const f=s?s.stats:i.stats;this.hls.trigger(A.FRAG_BUFFERED,{frag:i,part:s,stats:f,id:i.type})};r.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(c,r).catch(h=>{this.warn(`Fragment buffered callback ${h}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(t,e){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([t])=>{if(t){const e=this.tracks[t];if(e)return!e.ended||e.ending}return!1})}onBufferEos(t,e){var i;this.sourceBuffers.forEach(([o])=>{if(o){const c=this.tracks[o];(!e.type||e.type===o)&&(c.ending=!0,c.ended||(c.ended=!0,this.log(`${o} buffer reached EOS`)))}});const s=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var c;return o&&!((c=this.tracks[o])!=null&&c.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(A.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(A.BUFFERED_TO_END,void 0)):e.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([t])=>{if(t!==null){const e=this.tracks[t];e&&(e.ending=!1)}})}onLevelUpdated(t,{details:e}){e.fragments.length&&(this.details=e,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const t=this.getDurationAndRange();t&&this.updateMediaSource(t)})}onError(t,e){if(e.details===K.BUFFER_APPEND_ERROR&&e.frag){var i;const s=(i=e.errorAction)==null?void 0:i.nextAutoLevel;dt(s)&&s!==e.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:t,details:e,media:i}=this;if(!i||e===null||!this.sourceBufferCount)return;const s=t.config,r=i.currentTime,o=e.levelTargetDuration,c=e.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(dt(c)&&c>=0){const f=Math.max(c,o),g=Math.floor(r/o)*o-f;this.flushBackBuffer(r,o,g)}const h=s.frontBufferFlushThreshold;if(dt(h)&&h>0){const f=Math.max(s.maxBufferLength,h),g=Math.max(f,o),m=Math.floor(r/o)*o+g;this.flushFrontBuffer(r,o,m)}}flushBackBuffer(t,e,i){this.sourceBuffers.forEach(([s,r])=>{if(r){const c=xt.getBuffered(r);if(c.length>0&&i>c.start(0)){var o;this.hls.trigger(A.BACK_BUFFER_REACHED,{bufferEnd:i});const h=this.tracks[s];if((o=this.details)!=null&&o.live)this.hls.trigger(A.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(h!=null&&h.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:s})}}})}flushFrontBuffer(t,e,i){this.sourceBuffers.forEach(([s,r])=>{if(r){const o=xt.getBuffered(r),c=o.length;if(c<2)return;const h=o.start(c-1),f=o.end(c-1);if(i>h||t>=h&&t<=f)return;this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:s})}})}getDurationAndRange(){var t;const{details:e,mediaSource:i}=this;if(!e||!this.media||i?.readyState!=="open")return null;const s=e.edge;if(e.live&&this.hls.config.liveDurationInfinity){if(e.fragments.length&&i.setLiveSeekableRange){const f=Math.max(0,e.fragmentStart),g=Math.max(f,s);return{duration:1/0,start:f,end:g}}return{duration:1/0}}const r=(t=this.overrides)==null?void 0:t.duration;if(r)return dt(r)?{duration:r}:null;const o=this.media.duration,c=dt(i.duration)?i.duration:0;return s>c&&s>o||!dt(o)?{duration:s}:null}updateMediaSource({duration:t,start:e,end:i}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==t&&(dt(t)&&this.log(`Updating MediaSource duration to ${t.toFixed(3)}`),s.duration=t),e!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${e}-${i}.`),s.setLiveSeekableRange(e,i)))}get tracksReady(){const t=this.pendingTrackCount;return t>0&&(t>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:t,pendingTrackCount:e,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${e} codec events expected: ${t}) ${Wt(i)}`),this.tracksReady){var s;const r=(s=this.transferData)==null?void 0:s.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const t={};this.sourceBuffers.forEach(([e,i])=>{if(e){const s=this.tracks[e];t[e]={buffer:i,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(A.BUFFER_CREATED,{tracks:t}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([e])=>{this.executeNext(e)})}else{const t=new Error("could not create source buffer for media codec(s)");this.hls.trigger(A.ERROR,{type:pt.MEDIA_ERROR,details:K.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:t,reason:t.message})}}createSourceBuffers(){const{tracks:t,sourceBuffers:e,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in t){const o=r,c=t[o];if(this.isPending(c)){const h=this.getTrackCodec(c,o),f=`${c.container};codecs=${h}`;c.codec=h,this.log(`creating sourceBuffer(${f})${this.currentOp(o)?" Queued":""} ${Wt(c)}`);try{const g=i.addSourceBuffer(f),m=ld(o),y=[o,g];e[m]=y,c.buffer=g}catch(g){var s;this.error(`error while trying to add sourceBuffer: ${g.message}`),this.shiftAndExecuteNext(o),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[o],this.hls.trigger(A.ERROR,{type:pt.MEDIA_ERROR,details:K.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:g,sourceBufferName:o,mimeType:f,parent:c.id});return}this.trackSourceBuffer(o,c)}}this.bufferCreated()}getTrackCodec(t,e){const i=t.supplemental;let s=t.codec;i&&(e==="video"||e==="audiovideo")&&Ud(i,"video")&&(s=lL(s,i));const r=Fu(s,t.levelCodec);return r?e.slice(0,5)==="audio"?ic(r,this.appendSource):r:""}trackSourceBuffer(t,e){const i=e.buffer;if(!i)return;const s=this.getTrackCodec(e,t);this.tracks[t]={buffer:i,codec:s,container:e.container,levelCodec:e.levelCodec,supplemental:e.supplemental,metadata:e.metadata,id:e.id,listeners:[]},this.removeBufferListeners(t),this.addBufferListener(t,"updatestart",this.onSBUpdateStart),this.addBufferListener(t,"updateend",this.onSBUpdateEnd),this.addBufferListener(t,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(t,"bufferedchange",(r,o)=>{const c=o.removedRanges;c!=null&&c.length&&this.hls.trigger(A.BUFFER_FLUSHED,{type:r})})}get mediaSrc(){var t,e;const i=((t=this.media)==null||(e=t.querySelector)==null?void 0:e.call(t,"source"))||this.media;return i?.src}onSBUpdateStart(t){const e=this.currentOp(t);e&&e.onStart()}onSBUpdateEnd(t){var e;if(((e=this.mediaSource)==null?void 0:e.readyState)==="closed"){this.resetBuffer(t);return}const i=this.currentOp(t);i&&(i.onComplete(),this.shiftAndExecuteNext(t))}onSBUpdateError(t,e){var i;const s=new Error(`${t} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${s}`,e),this.hls.trigger(A.ERROR,{type:pt.MEDIA_ERROR,details:K.BUFFER_APPENDING_ERROR,sourceBufferName:t,error:s,fatal:!1});const r=this.currentOp(t);r&&r.onError(s)}updateTimestampOffset(t,e,i,s,r,o){const c=e-t.timestampOffset;Math.abs(c)>=i&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${e} (sn: ${r} cc: ${o})`),t.timestampOffset=e)}removeExecutor(t,e,i){const{media:s,mediaSource:r}=this,o=this.tracks[t],c=o?.buffer;if(!s||!r||!c){this.warn(`Attempting to remove from the ${t} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(t);return}const h=dt(s.duration)?s.duration:1/0,f=dt(r.duration)?r.duration:1/0,g=Math.max(0,e),m=Math.min(i,h,f);m>g&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${g},${m}] from the ${t} SourceBuffer`),c.remove(g,m)):this.shiftAndExecuteNext(t)}appendExecutor(t,e){const i=this.tracks[e],s=i?.buffer;if(!s)throw new mI(`Attempting to append to the ${e} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,s.appendBuffer(t)}blockUntilOpen(t){if(this.isUpdating()||this.isQueued())this.blockBuffers(t).catch(e=>{this.warn(`SourceBuffer blocked callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{t()}catch(e){this.warn(`Callback run without blocking ${this.operationQueue} ${e}`)}}isUpdating(){return this.sourceBuffers.some(([t,e])=>t&&e.updating)}isQueued(){return this.sourceBuffers.some(([t])=>t&&!!this.currentOp(t))}isPending(t){return!!t&&!t.buffer}blockBuffers(t,e=this.sourceBufferTypes){if(!e.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);const{operationQueue:i}=this,s=e.map(o=>this.appendBlocker(o));return e.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(o=>{i===this.operationQueue&&(t(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(t){t.forEach(e=>{var i;const s=(i=this.tracks[e])==null?void 0:i.buffer;!s||s.updating||this.shiftAndExecuteNext(e)})}append(t,e,i){this.operationQueue&&this.operationQueue.append(t,e,i)}appendBlocker(t){if(this.operationQueue)return this.operationQueue.appendBlocker(t)}currentOp(t){return this.operationQueue?this.operationQueue.current(t):null}executeNext(t){t&&this.operationQueue&&this.operationQueue.executeNext(t)}shiftAndExecuteNext(t){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(t)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((t,e)=>t+(this.isPending(this.tracks[e])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((t,[e])=>t+(e?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([t])=>t).filter(t=>!!t)}addBufferListener(t,e,i){const s=this.tracks[t];if(!s)return;const r=s.buffer;if(!r)return;const o=i.bind(this,t);s.listeners.push({event:e,listener:o}),r.addEventListener(e,o)}removeBufferListeners(t){const e=this.tracks[t];if(!e)return;const i=e.buffer;i&&(e.listeners.forEach(s=>{i.removeEventListener(s.event,s.listener)}),e.listeners.length=0)}}function uE(l){const t=l.querySelectorAll("source");[].slice.call(t).forEach(e=>{l.removeChild(e)})}function yI(l,t){const e=self.document.createElement("source");e.type="video/mp4",e.src=t,l.appendChild(e)}function ld(l){return l==="audio"?1:0}class Vg{constructor(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(t){this.streamController=t}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:t}=this;t.on(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(A.MANIFEST_PARSED,this.onManifestParsed,this),t.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(A.BUFFER_CODECS,this.onBufferCodecs,this),t.on(A.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:t}=this;t.off(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(A.MANIFEST_PARSED,this.onManifestParsed,this),t.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(A.BUFFER_CODECS,this.onBufferCodecs,this),t.off(A.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(t,e){const i=this.hls.levels[e.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(t,e){const i=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,i.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onLevelsUpdated(t,e){this.timer&&dt(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const t=this.hls.levels;if(t.length){const e=this.hls,i=this.getMaxLevel(t.length-1);i!==this.autoLevelCapping&&e.logger.log(`Setting autoLevelCapping to ${i}: ${t[i].height}p@${t[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),e.autoLevelCapping=i,e.autoLevelEnabled&&e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}getMaxLevel(t){const e=this.hls.levels;if(!e.length)return-1;const i=e.filter((s,r)=>this.isLevelAllowed(s)&&r<=t);return this.clientRect=null,Vg.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const t=this.media,e={width:0,height:0};if(t){const i=t.getBoundingClientRect();e.width=i.width,e.height=i.height,!e.width&&!e.height&&(e.width=i.right-i.left||t.width||0,e.height=i.bottom-i.top||t.height||0)}return this.clientRect=e,e}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch{}return Math.min(t,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(t){return!this.restrictedLevels.some(i=>t.bitrate===i.bitrate&&t.width===i.width&&t.height===i.height)}static getMaxLevelByMediaSize(t,e,i){if(!(t!=null&&t.length))return-1;const s=(c,h)=>h?c.width!==h.width||c.height!==h.height:!0;let r=t.length-1;const o=Math.max(e,i);for(let c=0;c<t.length;c+=1){const h=t[c];if((h.width>=o||h.height>=o)&&s(h,t[c+1])){r=c;break}}return r}}const vI={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},We=vI,EI={HLS:"h"},TI=EI;class cs{constructor(t,e){Array.isArray(t)&&(t=t.map(i=>i instanceof cs?i:new cs(i))),this.value=t,this.params=e}}const SI="Dict";function xI(l){return Array.isArray(l)?JSON.stringify(l):l instanceof Map?"Map{}":l instanceof Set?"Set{}":typeof l=="object"?JSON.stringify(l):String(l)}function _I(l,t,e,i){return new Error(`failed to ${l} "${xI(t)}" as ${e}`,{cause:i})}function fs(l,t,e){return _I("serialize",l,t,e)}class jS{constructor(t){this.description=t}}const cE="Bare Item",AI="Boolean";function bI(l){if(typeof l!="boolean")throw fs(l,AI);return l?"?1":"?0"}function RI(l){return btoa(String.fromCharCode(...l))}const LI="Byte Sequence";function DI(l){if(ArrayBuffer.isView(l)===!1)throw fs(l,LI);return`:${RI(l)}:`}const II="Integer";function CI(l){return l<-999999999999999||999999999999999<l}function qS(l){if(CI(l))throw fs(l,II);return l.toString()}function OI(l){return`@${qS(l.getTime()/1e3)}`}function XS(l,t){if(l<0)return-XS(-l,t);const e=Math.pow(10,t);if(Math.abs(l*e%1-.5)<Number.EPSILON){const s=Math.floor(l*e);return(s%2===0?s:s+1)/e}else return Math.round(l*e)/e}const wI="Decimal";function kI(l){const t=XS(l,3);if(Math.floor(Math.abs(t)).toString().length>12)throw fs(l,wI);const e=t.toString();return e.includes(".")?e:`${e}.0`}const MI="String",PI=/[\x00-\x1f\x7f]+/;function NI(l){if(PI.test(l))throw fs(l,MI);return`"${l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function UI(l){return l.description||l.toString().slice(7,-1)}const BI="Token";function fE(l){const t=UI(l);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t)===!1)throw fs(t,BI);return t}function jd(l){switch(typeof l){case"number":if(!dt(l))throw fs(l,cE);return Number.isInteger(l)?qS(l):kI(l);case"string":return NI(l);case"symbol":return fE(l);case"boolean":return bI(l);case"object":if(l instanceof Date)return OI(l);if(l instanceof Uint8Array)return DI(l);if(l instanceof jS)return fE(l);default:throw fs(l,cE)}}const FI="Key";function qd(l){if(/^[a-z*][a-z0-9\-_.*]*$/.test(l)===!1)throw fs(l,FI);return l}function Kg(l){return l==null?"":Object.entries(l).map(([t,e])=>e===!0?`;${qd(t)}`:`;${qd(t)}=${jd(e)}`).join("")}function QS(l){return l instanceof cs?`${jd(l.value)}${Kg(l.params)}`:jd(l)}function $I(l){return`(${l.value.map(QS).join(" ")})${Kg(l.params)}`}function GI(l,t={whitespace:!0}){if(typeof l!="object"||l==null)throw fs(l,SI);const e=l instanceof Map?l.entries():Object.entries(l),i=t?.whitespace?" ":"";return Array.from(e).map(([s,r])=>{r instanceof cs||(r=new cs(r));let o=qd(s);return r.value===!0?o+=Kg(r.params):(o+="=",Array.isArray(r.value)?o+=$I(r):o+=QS(r)),o}).join(`,${i}`)}function WS(l,t){return GI(l,t)}const ts="CMCD-Object",le="CMCD-Request",Wn="CMCD-Session",gn="CMCD-Status",HI={br:ts,ab:ts,d:ts,ot:ts,tb:ts,tpb:ts,lb:ts,tab:ts,lab:ts,url:ts,pb:le,bl:le,tbl:le,dl:le,ltc:le,mtp:le,nor:le,nrr:le,rc:le,sn:le,sta:le,su:le,ttfb:le,ttfbb:le,ttlb:le,cmsdd:le,cmsds:le,smrt:le,df:le,cs:le,ts:le,cid:Wn,pr:Wn,sf:Wn,sid:Wn,st:Wn,v:Wn,msd:Wn,bs:gn,bsd:gn,cdn:gn,rtp:gn,bg:gn,pt:gn,ec:gn,e:gn},VI={REQUEST:le};function KI(l){return Object.keys(l).reduce((t,e)=>{var i;return(i=l[e])===null||i===void 0||i.forEach(s=>t[s]=e),t},{})}function zI(l,t){const e={};if(!l)return e;const i=Object.keys(l),s=t?KI(t):{};return i.reduce((r,o)=>{var c;const h=HI[o]||s[o]||VI.REQUEST,f=(c=r[h])!==null&&c!==void 0?c:r[h]={};return f[o]=l[o],r},e)}function YI(l){return["ot","sf","st","e","sta"].includes(l)}function jI(l){return typeof l=="number"?dt(l):l!=null&&l!==""&&l!==!1}const ZS="event";function qI(l,t){const e=new URL(l),i=new URL(t);if(e.origin!==i.origin)return l;const s=e.pathname.split("/").slice(1),r=i.pathname.split("/").slice(1,-1);for(;s[0]===r[0];)s.shift(),r.shift();for(;r.length;)r.shift(),s.unshift("..");return s.join("/")+e.search+e.hash}const Ku=l=>Math.round(l),Xd=(l,t)=>Array.isArray(l)?l.map(e=>Xd(e,t)):l instanceof cs&&typeof l.value=="string"?new cs(Xd(l.value,t),l.params):(t.baseUrl&&(l=qI(l,t.baseUrl)),t.version===1?encodeURIComponent(l):l),Du=l=>Ku(l/100)*100,XI=(l,t)=>{let e=l;return t.version>=2&&(l instanceof cs&&typeof l.value=="string"?e=new cs([l]):typeof l=="string"&&(e=[l])),Xd(e,t)},QI={br:Ku,d:Ku,bl:Du,dl:Du,mtp:Du,nor:XI,rtp:Du,tb:Ku},JS="request",tx="response",zg=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],WI=["e"],ZI=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Ec(l){return ZI.test(l)}function JI(l){return zg.includes(l)||WI.includes(l)||Ec(l)}const ex=["d","dl","nor","ot","rtp","su"];function tC(l){return zg.includes(l)||ex.includes(l)||Ec(l)}const eC=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function iC(l){return zg.includes(l)||ex.includes(l)||eC.includes(l)||Ec(l)}const sC=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function nC(l){return sC.includes(l)||Ec(l)}const rC={[tx]:iC,[ZS]:JI,[JS]:tC};function ix(l,t={}){const e={};if(l==null||typeof l!="object")return e;const i=t.version||l.v||1,s=t.reportingMode||JS,r=i===1?nC:rC[s];let o=Object.keys(l).filter(r);const c=t.filter;typeof c=="function"&&(o=o.filter(c));const h=s===tx||s===ZS;h&&!o.includes("ts")&&o.push("ts"),i>1&&!o.includes("v")&&o.push("v");const f=Kt({},QI,t.formatters),g={version:i,reportingMode:s,baseUrl:t.baseUrl};return o.sort().forEach(m=>{let y=l[m];const v=f[m];if(typeof v=="function"&&(y=v(y,g)),m==="v"){if(i===1)return;y=i}m=="pr"&&y===1||(h&&m==="ts"&&!dt(y)&&(y=Date.now()),jI(y)&&(YI(m)&&typeof y=="string"&&(y=new jS(y)),e[m]=y))}),e}function aC(l,t={}){const e={};if(!l)return e;const i=ix(l,t),s=zI(i,t?.customHeaderMap);return Object.entries(s).reduce((r,[o,c])=>{const h=WS(c,{whitespace:!1});return h&&(r[o]=h),r},e)}function lC(l,t,e){return Kt(l,aC(t,e))}const oC="CMCD";function uC(l,t={}){return l?WS(ix(l,t),{whitespace:!1}):""}function cC(l,t={}){if(!l)return"";const e=uC(l,t);return encodeURIComponent(e)}function fC(l,t={}){if(!l)return"";const e=cC(l,t);return`${oC}=${e}`}const hE=/CMCD=[^&#]+/;function hC(l,t,e){const i=fC(t,e);if(!i)return l;if(hE.test(l))return l.replace(hE,i);const s=l.includes("?")?"&":"?";return`${l}${s}${i}`}class dC{constructor(t){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:We.MANIFEST,su:!this.initialized})}catch(r){this.hls.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=s=>{try{const{frag:r,part:o}=s,c=this.hls.levels[r.level],h=this.getObjectType(r),f={d:(o||r).duration*1e3,ot:h};(h===We.VIDEO||h===We.AUDIO||h==We.MUXED)&&(f.br=c.bitrate/1e3,f.tb=this.getTopBandwidth(h)/1e3,f.bl=this.getBufferLength(h));const g=o?this.getNextPart(o):this.getNextFrag(r);g!=null&&g.url&&g.url!==r.url&&(f.nor=g.url),this.apply(s,f)}catch(r){this.hls.logger.warn("Could not generate segment CMCD data.",r)}},this.hls=t;const e=this.config=t.config,{cmcd:i}=e;i!=null&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||t.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const t=this.hls;t.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(A.MEDIA_DETACHED,this.onMediaDetached,this),t.on(A.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const t=this.hls;t.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(A.MEDIA_DETACHED,this.onMediaDetached,this),t.off(A.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(t,e){var i,s;this.audioBuffer=(i=e.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(s=e.tracks.video)==null?void 0:s.buffer}createData(){var t;return{v:1,sf:TI.HLS,sid:this.sid,cid:this.cid,pr:(t=this.media)==null?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(t,e={}){Kt(e,this.createData());const i=e.ot===We.INIT||e.ot===We.VIDEO||e.ot===We.MUXED;this.starved&&i&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering);const{includeKeys:s}=this;s&&(e=Object.keys(e).reduce((o,c)=>(s.includes(c)&&(o[c]=e[c]),o),{}));const r={baseUrl:t.url};this.useHeaders?(t.headers||(t.headers={}),lC(t.headers,e,r)):t.url=hC(t.url,e,r)}getNextFrag(t){var e;const i=(e=this.hls.levels[t.level])==null?void 0:e.details;if(i){const s=t.sn-i.startSN;return i.fragments[s+1]}}getNextPart(t){var e;const{index:i,fragment:s}=t,r=(e=this.hls.levels[s.level])==null||(e=e.details)==null?void 0:e.partList;if(r){const{sn:o}=s;for(let c=r.length-1;c>=0;c--){const h=r[c];if(h.index===i&&h.fragment.sn===o)return r[c+1]}}}getObjectType(t){const{type:e}=t;if(e==="subtitle")return We.TIMED_TEXT;if(t.sn==="initSegment")return We.INIT;if(e==="audio")return We.AUDIO;if(e==="main")return this.hls.audioTracks.length?We.VIDEO:We.MUXED}getTopBandwidth(t){let e=0,i;const s=this.hls;if(t===We.AUDIO)i=s.audioTracks;else{const r=s.maxAutoLevel,o=r>-1?r+1:s.levels.length;i=s.levels.slice(0,o)}return i.forEach(r=>{r.bitrate>e&&(e=r.bitrate)}),e>0?e:NaN}getBufferLength(t){const e=this.media,i=t===We.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!e?NaN:xt.bufferInfo(i,e.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:t}=this.config,e=this.applyPlaylistData,i=t||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new i(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,o,c){e(r),this.loader.load(r,o,c)}}}createFragmentLoader(){const{fLoader:t}=this.config,e=this.applyFragmentData,i=t||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new i(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,o,c){e(r),this.loader.load(r,o,c)}}}}const gC=3e5;class mC extends zi{constructor(t){super("content-steering",t.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.registerListeners()}registerListeners(){const t=this.hls;t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(A.MANIFEST_PARSED,this.onManifestParsed,this),t.on(A.ERROR,this.onError,this)}unregisterListeners(){const t=this.hls;t&&(t.off(A.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(A.MANIFEST_PARSED,this.onManifestParsed,this),t.off(A.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((t,e)=>(t.indexOf(e.pathwayId)===-1&&t.push(e.pathwayId),t),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(t){this.updatePathwayPriority(t)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const t=this.timeToLoad*1e3-(performance.now()-this.updated);if(t>0){this.scheduleRefresh(this.uri,t);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(t){const e=this.levels;e&&(this.levels=e.filter(i=>i!==t))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(t,e){const{contentSteering:i}=e;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks}onError(t,e){const{errorAction:i}=e;if(i?.action===Be.SendAlternateToPenaltyBox&&i.flags===Ki.MoveAllAlternatesMatchingHost){const s=this.levels;let r=this._pathwayPriority,o=this.pathwayId;if(e.context){const{groupId:c,pathwayId:h,type:f}=e.context;c&&s?o=this.getPathwayForGroupId(c,f,o):h&&(o=h)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!r&&s&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),i.resolved=this.pathwayId!==o),e.details===K.BUFFER_APPEND_ERROR&&!e.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${e.details} ("${e.error.message}") with content-steering for Pathway: ${o} levels: ${s&&s.length} priorities: ${Wt(r)} penalized: ${Wt(this.penalizedPathways)}`)}}filterParsedLevels(t){this.levels=t;let e=this.getLevelsForPathway(this.pathwayId);if(e.length===0){const i=t[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),e=this.getLevelsForPathway(i),this.pathwayId=i}return e.length!==t.length&&this.log(`Found ${e.length}/${t.length} levels in Pathway "${this.pathwayId}"`),e}getLevelsForPathway(t){return this.levels===null?[]:this.levels.filter(e=>t===e.pathwayId)}updatePathwayPriority(t){this._pathwayPriority=t;let e;const i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(r=>{s-i[r]>gC&&delete i[r]});for(let r=0;r<t.length;r++){const o=t[r];if(o in i)continue;if(o===this.pathwayId)return;const c=this.hls.nextLoadLevel,h=this.hls.levels[c];if(e=this.getLevelsForPathway(o),e.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,xS(e),this.hls.trigger(A.LEVELS_UPDATED,{levels:e});const f=this.hls.levels[c];h&&f&&this.levels&&(f.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&f.bitrate!==h.bitrate&&this.log(`Unstable Pathways change from bitrate ${h.bitrate} to ${f.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(t,e,i){const s=this.getLevelsForPathway(i).concat(this.levels||[]);for(let r=0;r<s.length;r++)if(e===Dt.AUDIO_TRACK&&s[r].hasAudioGroup(t)||e===Dt.SUBTITLE_TRACK&&s[r].hasSubtitleGroup(t))return s[r].pathwayId;return i}clonePathways(t){const e=this.levels;if(!e)return;const i={},s={};t.forEach(r=>{const{ID:o,"BASE-ID":c,"URI-REPLACEMENT":h}=r;if(e.some(g=>g.pathwayId===o))return;const f=this.getLevelsForPathway(c).map(g=>{const m=new ee(g.attrs);m["PATHWAY-ID"]=o;const y=m.AUDIO&&`${m.AUDIO}_clone_${o}`,v=m.SUBTITLES&&`${m.SUBTITLES}_clone_${o}`;y&&(i[m.AUDIO]=y,m.AUDIO=y),v&&(s[m.SUBTITLES]=v,m.SUBTITLES=v);const T=sx(g.uri,m["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),S=new Kl({attrs:m,audioCodec:g.audioCodec,bitrate:g.bitrate,height:g.height,name:g.name,url:T,videoCodec:g.videoCodec,width:g.width});if(g.audioGroups)for(let x=1;x<g.audioGroups.length;x++)S.addGroupId("audio",`${g.audioGroups[x]}_clone_${o}`);if(g.subtitleGroups)for(let x=1;x<g.subtitleGroups.length;x++)S.addGroupId("text",`${g.subtitleGroups[x]}_clone_${o}`);return S});e.push(...f),dE(this.audioTracks,i,h,o),dE(this.subtitleTracks,s,h,o)})}loadSteeringManifest(t){const e=this.hls.config,i=e.loader;this.loader&&this.loader.destroy(),this.loader=new i(e);let s;try{s=new self.URL(t)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${t}`);return}if(s.protocol!=="data:"){const g=(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+g)}const r={responseType:"json",url:s.href},o=e.steeringManifestLoadPolicy.default,c=o.errorRetry||o.timeoutRetry||{},h={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},f={onSuccess:(g,m,y,v)=>{this.log(`Loaded steering manifest: "${s}"`);const T=g.data;if(T?.VERSION!==1){this.log(`Steering VERSION ${T.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=T.TTL;const{"RELOAD-URI":S,"PATHWAY-CLONES":x,"PATHWAY-PRIORITY":_}=T;if(S)try{this.uri=new self.URL(S,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${S}`);return}this.scheduleRefresh(this.uri||y.url),x&&this.clonePathways(x);const L={steeringManifest:T,url:s.toString()};this.hls.trigger(A.STEERING_MANIFEST_LOADED,L),_&&this.updatePathwayPriority(_)},onError:(g,m,y,v)=>{if(this.log(`Error loading steering manifest: ${g.code} ${g.text} (${m.url})`),this.stopLoad(),g.code===410){this.enabled=!1,this.log(`Steering manifest ${m.url} no longer available`);return}let T=this.timeToLoad*1e3;if(g.code===429){const S=this.loader;if(typeof S?.getResponseHeader=="function"){const x=S.getResponseHeader("Retry-After");x&&(T=parseFloat(x)*1e3)}this.log(`Steering manifest ${m.url} rate limited`);return}this.scheduleRefresh(this.uri||m.url,T)},onTimeout:(g,m,y)=>{this.log(`Timeout loading steering manifest (${m.url})`),this.scheduleRefresh(this.uri||m.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(r,h,f)}scheduleRefresh(t,e=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const s=(i=this.hls)==null?void 0:i.media;if(s&&!s.ended){this.loadSteeringManifest(t);return}this.scheduleRefresh(t,this.timeToLoad*1e3)},e)}}function dE(l,t,e,i){l&&Object.keys(t).forEach(s=>{const r=l.filter(o=>o.groupId===s).map(o=>{const c=Kt({},o);return c.details=void 0,c.attrs=new ee(c.attrs),c.url=c.attrs.URI=sx(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",e),c.groupId=c.attrs["GROUP-ID"]=t[s],c.attrs["PATHWAY-ID"]=i,c});l.push(...r)})}function sx(l,t,e,i){const{HOST:s,PARAMS:r,[e]:o}=i;let c;t&&(c=o?.[t],c&&(l=c));const h=new self.URL(l);return s&&!c&&(h.host=s),r&&Object.keys(r).sort().forEach(f=>{f&&h.searchParams.set(f,r[f])}),h.href}function mi(l,t,e){Ni(l,t,e),l.addEventListener(t,e)}function Ni(l,t,e){l.removeEventListener(t,e)}class fa extends zi{constructor(t){super("eme",t.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=fa.CDMCleanupPromise?[fa.CDMCleanupPromise]:[],this.onMediaEncrypted=e=>{const{initDataType:i,initData:s}=e,r=`"${e.type}" event: init data type: "${i}"`;if(this.debug(r),s!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=Dl(this.config));const c=o.map(Jh).filter(h=>!!h);this.keyFormatPromise=this.getKeyFormatPromise(c)}this.keyFormatPromise.then(o=>{const c=Gu(o);if(i!=="sinf"||c!==oe.FAIRPLAY){this.log(`Ignoring "${e.type}" event with init data type: "${i}" for selected key-system ${c}`);return}let h;try{const v=Se(new Uint8Array(s)),T=kg(JSON.parse(v).sinf),S=iS(T);if(!S)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");h=new Uint8Array(S.subarray(8,24))}catch(v){this.warn(`${r} Failed to parse sinf: ${v}`);return}const f=ks.hexDump(h),{keyIdToKeySessionPromise:g,mediaKeySessions:m}=this;let y=g[f];for(let v=0;v<m.length;v++){const T=m[v],S=T.decryptdata;if(!S.keyId)continue;const x=ks.hexDump(S.keyId);if(f===x||S.uri.replace(/-/g,"").indexOf(f)!==-1){if(y=g[x],!y)continue;if(S.pssh)break;delete g[x],S.pssh=new Uint8Array(s),S.keyId=h,y=g[f]=y.then(()=>this.generateRequestWithPreferredKeySession(T,i,s,"encrypted-event-key-match")),y.catch(_=>this.handleError(_));break}}y||this.handleError(new Error(`Key ID ${f} not encountered in playlist. Key-system sessions ${m.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=e=>{this.log(`"${e.type}" event`)},this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onWaitingForKey=null}registerListeners(){this.hls.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(A.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(A.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(t){const{drmSystems:e,widevineLicenseUrl:i}=this.config,s=e[t];if(s)return s.licenseUrl;if(t===oe.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(t){const e=this.getLicenseServerUrl(t);if(e===void 0)throw new Error(`no license server URL configured for key-system "${t}"`);return e}getServerCertificateUrl(t){const{drmSystems:e}=this.config,i=e[t];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){const e=this.hls.levels,i=(o,c,h)=>!!o&&h.indexOf(o)===c,s=e.map(o=>o.audioCodec).filter(i),r=e.map(o=>o.videoCodec).filter(i);return s.length+r.length===0&&r.push("avc1.42e01e"),new Promise((o,c)=>{const h=f=>{const g=f.shift();this.getMediaKeysPromise(g,s,r).then(m=>o({keySystem:g,mediaKeys:m})).catch(m=>{f.length?h(f):m instanceof Ci?c(m):c(new Ci({type:pt.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};h(t)})}requestMediaKeySystemAccess(t,e){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${i}`;return mS===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return i(t,e)}getMediaKeysPromise(t,e,i){const s=QL(t,e,i,this.config.drmSystemOptions),r=this.keySystemAccessPromises[t];let o=r?.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${t}" key-system access with config: ${Wt(s)}`),o=this.requestMediaKeySystemAccess(t,s);const c=this.keySystemAccessPromises[t]={keySystemAccess:o};return o.catch(h=>{this.log(`Failed to obtain access to key-system "${t}": ${h}`)}),o.then(h=>{this.log(`Access for key-system "${h.keySystem}" obtained`);const f=this.fetchServerCertificate(t);return this.log(`Create media-keys for "${t}"`),c.mediaKeys=h.createMediaKeys().then(g=>(this.log(`Media-keys created for "${t}"`),c.hasMediaKeys=!0,f.then(m=>m?this.setMediaKeysServerCertificate(g,t,m):g))),c.mediaKeys.catch(g=>{this.error(`Failed to create media-keys for "${t}"}: ${g}`)}),c.mediaKeys})}return o.then(()=>r.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:e,mediaKeys:i}){this.log(`Creating key-system session "${e}" keyId: ${ks.hexDump(t.keyId||[])}`);const s=i.createSession(),r={decryptdata:t,keySystem:e,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(t){const e=t.decryptdata;if(e.pssh){const i=this.createMediaKeySessionContext(t),s=this.getKeyIdString(e),r="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,r,e.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}getKeyIdString(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(t.keyId===null)throw new Error("keyId is null");return ks.hexDump(t.keyId)}updateKeySession(t,e){var i;const s=t.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${ks.hexDump(((i=t.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${e&&e.byteLength})`),s.update(e)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(t=>({keySystem:t,hasMediaKeys:this.keySystemAccessPromises[t].hasMediaKeys})).filter(({hasMediaKeys:t})=>!!t).map(({keySystem:t})=>Jh(t)).filter(t=>!!t)}getKeySystemAccess(t){return this.getKeySystemSelectionPromise(t).then(({keySystem:e,mediaKeys:i})=>this.attemptSetMediaKeys(e,i))}selectKeySystem(t){return new Promise((e,i)=>this.getKeySystemSelectionPromise(t).then(({keySystem:s})=>{const r=Jh(s);r?e(r):i(new Error(`Unable to find format for key-system "${s}"`))}).catch(i))}selectKeySystemFormat(t){const e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise}getKeyFormatPromise(t){const e=Dl(this.config),i=t.map(Gu).filter(s=>!!s&&e.indexOf(s)!==-1);return this.selectKeySystem(i)}loadKey(t){const e=t.keyInfo.decryptdata,i=this.getKeyIdString(e),s=`(keyId: ${i} format: "${e.keyFormat}" method: ${e.method} uri: ${e.uri})`;this.log(`Starting session for key ${s}`);let r=this.keyIdToKeySessionPromise[i];return r||(r=this.getKeySystemForKeyPromise(e).then(({keySystem:c,mediaKeys:h})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${s}`),this.attemptSetMediaKeys(c,h).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:c,mediaKeys:h,decryptdata:e}))))),(this.keyIdToKeySessionPromise[i]=r.then(c=>{const h="cenc",f=e.pssh?e.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(c,h,f,"playlist-key")})).catch(c=>this.handleError(c))),r}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t){this.hls&&(this.error(t.message),t instanceof Ci?this.hls.trigger(A.ERROR,t.data):this.hls.trigger(A.ERROR,{type:pt.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))}getKeySystemForKeyPromise(t){const e=this.getKeyIdString(t),i=this.keyIdToKeySessionPromise[e];if(!i){const s=Gu(t.keyFormat),r=s?[s]:Dl(this.config);return this.attemptKeySystemAccess(r)}return i}getKeySystemSelectionPromise(t){if(t.length||(t=Dl(this.config)),t.length===0)throw new Ci({type:pt.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Wt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}attemptSetMediaKeys(t,e){if(this.mediaKeys===e)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);const s=Promise.all(i).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(e)});return this.mediaKeys=e,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${t}"`),i.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>i.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(t,e,i,s){var r;const o=(r=this.config.drmSystems)==null||(r=r[t.keySystem])==null?void 0:r.generateRequest;if(o)try{const v=o.call(this.hls,e,i,t);if(!v)throw new Error("Invalid response from configured generateRequest filter");e=v.initDataType,i=v.initData?v.initData:null,t.decryptdata.pssh=i?new Uint8Array(i):null}catch(v){var c;if(this.warn(v.message),(c=this.hls)!=null&&c.config.debug)throw v}if(i===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(t);const h=this.getKeyIdString(t.decryptdata);this.log(`Generating key-session request for "${s}": ${h} (init data type: ${e} length: ${i?i.byteLength:null})`);const f=new Pg,g=t._onmessage=v=>{const T=t.mediaKeysSession;if(!T){f.emit("error",new Error("invalid state"));return}const{messageType:S,message:x}=v;this.log(`"${S}" message event for session "${T.sessionId}" message size: ${x.byteLength}`),S==="license-request"||S==="license-renewal"?this.renewLicense(t,x).catch(_=>{f.eventNames().length?f.emit("error",_):this.handleError(_)}):S==="license-release"?t.keySystem===oe.FAIRPLAY&&(this.updateKeySession(t,Gd("acknowledged")),this.removeSession(t)):this.warn(`unhandled media key message type "${S}"`)},m=t._onkeystatuseschange=v=>{if(!t.mediaKeysSession){f.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(t);const S=t.keyStatus;f.emit("keyStatus",S),S==="expired"&&(this.warn(`${t.keySystem} expired for key ${h}`),this.renewKeySession(t))};mi(t.mediaKeysSession,"message",g),mi(t.mediaKeysSession,"keystatuseschange",m);const y=new Promise((v,T)=>{f.on("error",T),f.on("keyStatus",S=>{S.startsWith("usable")?v():S==="output-restricted"?T(new Ci({type:pt.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):S==="internal-error"?T(new Ci({type:pt.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${S}"`)):S==="expired"?T(new Error("key expired while generating request")):this.warn(`unhandled key status change "${S}"`)})});return t.mediaKeysSession.generateRequest(e,i).then(()=>{var v;this.log(`Request generated for key-session "${(v=t.mediaKeysSession)==null?void 0:v.sessionId}" keyId: ${h}`)}).catch(v=>{throw new Ci({type:pt.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_SESSION,error:v,fatal:!1},`Error generating key-session request: ${v}`)}).then(()=>y).catch(v=>{throw f.removeAllListeners(),this.removeSession(t),v}).then(()=>(f.removeAllListeners(),t))}onKeyStatusChange(t){t.mediaKeysSession.keyStatuses.forEach((e,i)=>{if(typeof i=="string"&&typeof e=="object"){const s=i;i=e,e=s}this.log(`key status change "${e}" for keyStatuses keyId: ${ks.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${ks.hexDump(new Uint8Array(t.decryptdata.keyId||[]))} uri: ${t.decryptdata.uri}`),t.keyStatus=e})}fetchServerCertificate(t){const e=this.config,i=e.loader,s=new i(e),r=this.getServerCertificateUrl(t);return r?(this.log(`Fetching server certificate for "${t}"`),new Promise((o,c)=>{const h={responseType:"arraybuffer",url:r},f=e.certLoadPolicy.default,g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(y,v,T,S)=>{o(y.data)},onError:(y,v,T,S)=>{c(new Ci({type:pt.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:T,response:Vt({url:h.url,data:void 0},y)},`"${t}" certificate request failed (${r}). Status: ${y.code} (${y.text})`))},onTimeout:(y,v,T)=>{c(new Ci({type:pt.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:T,response:{url:h.url,data:void 0}},`"${t}" certificate request timed out (${r})`))},onAbort:(y,v,T)=>{c(new Error("aborted"))}};s.load(h,g,m)})):Promise.resolve()}setMediaKeysServerCertificate(t,e,i){return new Promise((s,r)=>{t.setServerCertificate(i).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${i?.byteLength}) on "${e}"`),s(t)}).catch(o=>{r(new Ci({type:pt.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(t,e){return this.requestLicense(t,new Uint8Array(e)).then(i=>this.updateKeySession(t,new Uint8Array(i)).catch(s=>{throw new Ci({type:pt.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)}))}unpackPlayReadyKeyMessage(t,e){const i=String.fromCharCode.apply(null,new Uint16Array(e.buffer));if(!i.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),e;const s=new DOMParser().parseFromString(i,"application/xml"),r=s.querySelectorAll("HttpHeader");if(r.length>0){let g;for(let m=0,y=r.length;m<y;m++){var o,c;g=r[m];const v=(o=g.querySelector("name"))==null?void 0:o.textContent,T=(c=g.querySelector("value"))==null?void 0:c.textContent;v&&T&&t.setRequestHeader(v,T)}}const h=s.querySelector("Challenge"),f=h?.textContent;if(!f)throw new Error("Cannot find <Challenge> in key message");return Gd(atob(f))}setupLicenseXHR(t,e,i,s){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return r.call(this.hls,t,e,i,s)}).catch(o=>{if(!i.decryptdata)throw o;return t.open("POST",e,!0),r.call(this.hls,t,e,i,s)}).then(o=>(t.readyState||t.open("POST",e,!0),{xhr:t,licenseChallenge:o||s})):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:s}))}requestLicense(t,e){const i=this.config.keyLoadPolicy.default;return new Promise((s,r)=>{const o=this.getLicenseServerUrlOrThrow(t.keySystem);this.log(`Sending license request to URL: ${o}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return r(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let h=c.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);const f=this.config.licenseResponseCallback;if(f)try{h=f.call(this.hls,c,o,t)}catch(g){this.error(g)}s(h)}else{const h=i.errorRetry,f=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>f||c.status>=400&&c.status<500)r(new Ci({type:pt.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:c,response:{url:o,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${o}). Status: ${c.status} (${c.statusText})`));else{const g=f-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${g} attempts left`),this.requestLicense(t,e).then(s,r)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=c,this.setupLicenseXHR(c,o,t,e).then(({xhr:h,licenseChallenge:f})=>{t.keySystem==oe.PLAYREADY&&(f=this.unpackPlayReadyKeyMessage(h,f)),h.send(f)})})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(t,e){if(!this.config.emeEnabled)return;const i=e.media;this.media=i,mi(i,"encrypted",this.onMediaEncrypted),mi(i,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const t=this.media;t&&(Ni(t,"encrypted",this.onMediaEncrypted),Ni(t,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var t;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const e=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,yc.clearKeyUriToKeyIdMap();const s=i.length;fa.CDMCleanupPromise=Promise.all(i.map(r=>this.removeSession(r)).concat(e==null||(t=e.setMediaKeys(null))==null?void 0:t.catch(r=>{var o;this.log(`Could not clear media keys: ${r}`),(o=this.hls)==null||o.trigger(A.ERROR,{type:pt.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${r}`)})}))).catch(r=>{var o;this.log(`Could not close sessions and clear media keys: ${r}`),(o=this.hls)==null||o.trigger(A.ERROR,{type:pt.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${r}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(t,{sessionKeys:e}){if(!(!e||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=e.reduce((s,r)=>(s.indexOf(r.keyFormat)===-1&&s.push(r.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(t){const{mediaKeysSession:e,licenseXhr:i}=t;if(e){this.log(`Remove licenses and keys and close session ${e.sessionId}`),t._onmessage&&(e.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(e.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(t);s>-1&&this.mediaKeySessions.splice(s,1);const{drmSystemOptions:r}=this.config;return(ZL(r)?new Promise((c,h)=>{self.setTimeout(()=>h(new Error("MediaKeySession.remove() timeout")),8e3),e.remove().then(c)}):Promise.resolve()).catch(c=>{var h;this.log(`Could not remove session: ${c}`),(h=this.hls)==null||h.trigger(A.ERROR,{type:pt.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>e.close()).catch(c=>{var h;this.log(`Could not close session: ${c}`),(h=this.hls)==null||h.trigger(A.ERROR,{type:pt.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}}}fa.CDMCleanupPromise=void 0;class Ci extends Error{constructor(t,e){super(e),this.data=void 0,t.error||(t.error=new Error(e)),this.data=t,t.err=t.error}}class pC{constructor(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}setStreamController(t){this.streamController=t}registerListeners(){this.hls.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(A.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(A.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(t,e){const i=this.hls.config;if(i.capLevelOnFPSDrop){const s=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(t,e,i){const s=performance.now();if(e){if(this.lastTime){const r=s-this.lastTime,o=i-this.lastDroppedFrames,c=e-this.lastDecodedFrames,h=1e3*o/r,f=this.hls;if(f.trigger(A.FPS_DROP,{currentDropped:o,currentDecoded:c,totalDroppedFrames:i}),h>0&&o>f.config.fpsDroppedMonitoringThreshold*c){let g=f.currentLevel;f.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+g),g>0&&(f.autoLevelCapping===-1||f.autoLevelCapping>=g)&&(g=g-1,f.trigger(A.FPS_DROP_LEVEL_CAPPING,{level:g,droppedLevel:f.currentLevel}),f.autoLevelCapping=g,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=e}}checkFPSInterval(){const t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){const e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}}function nx(l,t){let e;try{e=new Event("addtrack")}catch{e=document.createEvent("Event"),e.initEvent("addtrack",!1,!1)}e.track=l,t.dispatchEvent(e)}function rx(l,t){const e=l.mode;if(e==="disabled"&&(l.mode="hidden"),l.cues&&!l.cues.getCueById(t.id))try{if(l.addCue(t),!l.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(i){Ft.debug(`[texttrack-utils]: ${i}`);try{const s=new self.TextTrackCue(t.startTime,t.endTime,t.text);s.id=t.id,l.addCue(s)}catch(s){Ft.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}e==="disabled"&&(l.mode=e)}function aa(l,t){const e=l.mode;if(e==="disabled"&&(l.mode="hidden"),l.cues)for(let i=l.cues.length;i--;)t&&l.cues[i].removeEventListener("enter",t),l.removeCue(l.cues[i]);e==="disabled"&&(l.mode=e)}function Qd(l,t,e,i){const s=l.mode;if(s==="disabled"&&(l.mode="hidden"),l.cues&&l.cues.length>0){const r=vC(l.cues,t,e);for(let o=0;o<r.length;o++)(!i||i(r[o]))&&l.removeCue(r[o])}s==="disabled"&&(l.mode=s)}function yC(l,t){if(t<=l[0].startTime)return 0;const e=l.length-1;if(t>l[e].endTime)return-1;let i=0,s=e,r;for(;i<=s;)if(r=Math.floor((s+i)/2),t<l[r].startTime)s=r-1;else if(t>l[r].startTime&&i<e)i=r+1;else return r;return l[i].startTime-t<t-l[s].startTime?i:s}function vC(l,t,e){const i=[],s=yC(l,t);if(s>-1)for(let r=s,o=l.length;r<o;r++){const c=l[r];if(c.startTime>=t&&c.endTime<=e)i.push(c);else if(c.startTime>e)return i}return i}function zu(l){const t=[];for(let e=0;e<l.length;e++){const i=l[e];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&t.push(l[e])}return t}class EC extends Hg{constructor(t){super(t,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const i=zu(this.media.textTracks);for(let r=0;r<i.length;r++)if(i[r].mode==="hidden")e=i[r];else if(i[r].mode==="showing"){e=i[r];break}const s=this.findTrackForTextTrack(e);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:t}=this;t.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.MANIFEST_PARSED,this.onManifestParsed,this),t.on(A.LEVEL_LOADING,this.onLevelLoading,this),t.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(A.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.MANIFEST_PARSED,this.onManifestParsed,this),t.off(A.LEVEL_LOADING,this.onLevelLoading,this),t.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(A.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,t)}onMediaDetaching(t,e){const i=this.media;if(!i)return;const s=!!e.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;zu(i.textTracks).forEach(o=>{aa(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.subtitleTracks}onSubtitleTrackLoaded(t,e){const{id:i,groupId:s,details:r}=e,o=this.tracksInGroup[i];if(!o||o.groupId!==s){this.warn(`Subtitle track with id:${i} and group:${s} not found in active group ${o?.groupId}`);return}const c=o.details;o.details=e.details,this.log(`Subtitle track ${i} "${o.name}" lang:${o.lang} group:${s} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,e,c)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const i=e.subtitleGroups||null,s=this.groupIds;let r=this.currentTrack;if(!i||s?.length!==i?.length||i!=null&&i.some(o=>s?.indexOf(o)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(g=>!i||i.indexOf(g.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(g=>g.default)&&(this.selectDefaultTrack=!1),o.forEach((g,m)=>{g.id=m});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const c=this.hls.config.subtitlePreference;if(!r&&c){this.selectDefaultTrack=!1;const g=as(c,o);if(g>-1)r=o[g];else{const m=as(c,this.tracks);r=this.tracks[m]}}let h=this.findTrackId(r);h===-1&&r&&(h=this.findTrackId(null));const f={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${i?.join(",")}" group-id`),this.hls.trigger(A.SUBTITLE_TRACKS_UPDATED,f),h!==-1&&this.trackId===-1&&this.setSubtitleTrack(h)}}findTrackId(t){const e=this.tracksInGroup,i=this.selectDefaultTrack;for(let s=0;s<e.length;s++){const r=e[s];if(!(i&&!r.default||!i&&!t)&&(!t||lr(r,t)))return s}if(t){for(let s=0;s<e.length;s++){const r=e[s];if(Xl(t.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<e.length;s++){const r=e[s];if(Xl(t.attrs,r.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(t){if(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){const s=e[i];if(Yd(s,t))return i}}return-1}onError(t,e){e.fatal||!e.context||e.context.type===Dt.SUBTITLE_TRACK&&e.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(e.context.groupId)!==-1)&&this.checkRetry(e)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(t){this.selectDefaultTrack=!1,this.setSubtitleTrack(t)}setSubtitleOption(t){if(this.hls.config.subtitlePreference=t,t){if(t.id===-1)return this.setSubtitleTrack(-1),null;const e=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,e.length){const i=this.currentTrack;if(i&&lr(t,i))return i;const s=as(t,this.tracksInGroup);if(s>-1){const r=this.tracksInGroup[s];return this.setSubtitleTrack(s),r}else{if(i)return null;{const r=as(t,e);if(r>-1)return e[r]}}}}return null}loadPlaylist(t){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const i=t.id,s=t.groupId,r=this.getUrlWithDirectives(t.url,e),o=t.details,c=o?.age;this.log(`Loading subtitle ${i} "${t.name}" lang:${t.lang} group:${s}${e?.msn!==void 0?" at sn "+e.msn+" part "+e.part:""}${c&&o.live?" age "+c.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(A.SUBTITLE_TRACK_LOADING,{url:r,id:i,groupId:s,deliveryDirectives:e||null,track:t})}toggleTrackModes(){const{media:t}=this;if(!t)return;const e=zu(t.textTracks),i=this.currentTrack;let s;if(i&&(s=e.filter(r=>Yd(i,r))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(e).forEach(r=>{r.mode!=="disabled"&&r!==s&&(r.mode="disabled")}),s){const r=this.subtitleDisplay?"showing":"hidden";s.mode!==r&&(s.mode=r)}}setSubtitleTrack(t){const e=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(t<-1||t>=e.length||!dt(t)){this.warn(`Invalid subtitle track id: ${t}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,s=e[t]||null;if(this.trackId=t,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:t});return}const r=!!s.details&&!s.details.live;if(t===this.trackId&&s===i&&r)return;this.log(`Switching to subtitle-track ${t}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:o,groupId:c="",name:h,type:f,url:g}=s;this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:o,groupId:c,name:h,type:f,url:g});const m=this.switchParams(s.url,i?.details,s.details);this.loadPlaylist(m)}}function TC(){try{return crypto.randomUUID()}catch{try{const t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}catch{let e=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const r=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(s=="x"?r:r&3|8).toString(16)})}}}function Ml(l){let t=5381,e=l.length;for(;e;)t=t*33^l.charCodeAt(--e);return(t>>>0).toString()}const ha=.025;let cc=function(l){return l[l.Point=0]="Point",l[l.Range=1]="Range",l}({});function SC(l,t,e){return`${l.identifier}-${e+1}-${Ml(t)}`}class xC{constructor(t,e){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=e,this.dateRange=t,this.setDateRange(t)}setDateRange(t){this.dateRange=t,this.resumeOffset=t.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=t.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=t.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=t.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var t;this.appendInPlaceStarted=!1,(t=this.assetListLoader)==null||t.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(t){var e;if(t>0&&t>=this.assetList.length)return!0;const i=this.playoutLimit;return t<=0||isNaN(i)?!1:i===0?!0:(((e=this.assetList[t])==null?void 0:e.startOffset)||0)>i}findAssetIndex(t){return this.assetList.indexOf(t)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const t=this.dateRange.startTime;if(this.snapOptions.out){const e=this.dateRange.tagAnchor;if(e)return od(t,e)}return t}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const t=this.dateRange.tagAnchor;if(t){const e=this.dateRange.startTime,i=od(e,t);return e-i<.1}return!1}get resumptionOffset(){const t=this.resumeOffset,e=dt(t)?t:this.duration;return this.cumulativeDuration+e}get resumeTime(){const t=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const e=this.resumeAnchor;if(e)return od(t,e)}return t}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ha))}set appendInPlace(t){if(this.appendInPlaceStarted){this.resetOnResume=!t;return}this.appendInPlaceDisabled=!t}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(t){this._timelineStart=t}get duration(){const t=this.playoutLimit;let e;return this._duration!==null?e=this._duration:this.dateRange.duration?e=this.dateRange.duration:e=this.dateRange.plannedDuration||0,!isNaN(t)&&t<e&&(e=t),e}set duration(t){this._duration=t}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?cc.Range:cc.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return _C(this)}}function od(l,t){return l-t.start<t.duration/2&&!(Math.abs(l-(t.start+t.duration))<ha)?t.start:t.start+t.duration}function ax(l,t,e){const i=new self.URL(l,e);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",t),i}function ud(l,t){for(;(e=l.assetList[++t])!=null&&e.error;)var e;return t}function _C(l){return`["${l.identifier}" ${l.cue.pre?"<pre>":l.cue.post?"<post>":""}${l.timelineStart.toFixed(2)}-${l.resumeTime.toFixed(2)}]`}function sa(l){const t=l.timelineStart,e=l.duration||0;return`["${l.identifier}" ${t.toFixed(2)}-${(t+e).toFixed(2)}]`}class AC{constructor(t,e,i,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(A.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new t(e);this.interstitial=i,this.assetItem=s;const o=()=>{this.hasDetails=!0};r.once(A.LEVEL_LOADED,o),r.once(A.AUDIO_TRACK_LOADED,o),r.once(A.SUBTITLE_TRACK_LOADED,o),r.on(A.MEDIA_ATTACHING,(c,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(A.BUFFER_APPENDED,()=>{const g=this.bufferedEnd;this.reachedPlayout(g)&&(this._bufferedEosTime=g,r.trigger(A.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const t=this.hls;if(t)if(t.url)t.levels.length&&!t.started&&t.startLoad(-1,!0);else{let e=this.assetItem.uri;try{e=ax(e,t.config.primarySessionId||"").href}catch{}t.loadSource(e)}}bufferedInPlaceToEnd(t){var e;if(!this.appendInPlace)return!1;if((e=this.hls)!=null&&e.bufferedToEnd)return!0;if(!t)return!1;const i=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,r=xt.bufferInfo(t,s,0);return this.getAssetTime(r.end)>=i-.02}reachedPlayout(t){const i=this.interstitial.playoutLimit;return this.startOffset+t>=i}get destroyed(){var t;return!((t=this.hls)!=null&&t.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var t;return((t=this.hls)==null?void 0:t.media)||null}get bufferedEnd(){const t=this.media||this.mediaAttached;if(!t)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const e=xt.bufferInfo(t,t.currentTime,.001);return this.getAssetTime(e.end)}get currentTime(){const t=this.media||this.mediaAttached;return t?this.getAssetTime(t.currentTime):this._currentTime||0}get duration(){const t=this.assetItem.duration;if(!t)return 0;const e=this.interstitial.playoutLimit;if(e){const i=e-this.startOffset;if(i>0&&i<t)return i}return t}get remaining(){const t=this.duration;return t?Math.max(0,t-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var t;return((t=this.hls)==null?void 0:t.config.timelineOffset)||0}set timelineOffset(t){const e=this.timelineOffset;if(t!==e){const i=t-e;if(Math.abs(i)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=t}}}getAssetTime(t){const e=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,t-e),i)}removeMediaListeners(){const t=this.mediaAttached;t&&(this._currentTime=t.currentTime,this.bufferSnapShot(),t.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var t;(t=this.hls)!=null&&t.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(t){var e;this.loadSource(),(e=this.hls)==null||e.attachMedia(t)}detachMedia(){var t;this.removeMediaListeners(),this.mediaAttached=null,(t=this.hls)==null||t.detachMedia()}resumeBuffering(){var t;(t=this.hls)==null||t.resumeBuffering()}pauseBuffering(){var t;(t=this.hls)==null||t.pauseBuffering()}transferMedia(){var t;return this.bufferSnapShot(),((t=this.hls)==null?void 0:t.transferMedia())||null}resetDetails(){const t=this.hls;if(t&&this.hasDetails){t.stopLoad();const e=i=>delete i.details;t.levels.forEach(e),t.allAudioTracks.forEach(e),t.allSubtitleTracks.forEach(e),this.hasDetails=!1}}on(t,e,i){var s;(s=this.hls)==null||s.on(t,e)}once(t,e,i){var s;(s=this.hls)==null||s.once(t,e)}off(t,e,i){var s;(s=this.hls)==null||s.off(t,e)}toString(){var t;return`HlsAssetPlayer: ${sa(this.assetItem)} ${(t=this.hls)==null?void 0:t.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const gE=.033;class bC extends zi{constructor(t,e){super("interstitials-sched",e),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=t}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(t=>t.reset()),this.events=this.items=null}resetErrorsInRange(t,e){return this.events?this.events.reduce((i,s)=>t<=s.startOffset&&e>s.startOffset?(delete s.error,i+1):i,0):0}get duration(){const t=this.items;return t?t[t.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(t){return t&&this.eventMap[t]||null}hasEvent(t){return t in this.eventMap}findItemIndex(t,e){if(t.event)return this.findEventIndex(t.event.identifier);let i=-1;t.nextEvent?i=this.findEventIndex(t.nextEvent.identifier)-1:t.previousEvent&&(i=this.findEventIndex(t.previousEvent.identifier)+1);const s=this.items;if(s)for(s[i]||(e===void 0&&(e=t.start),i=this.findItemIndexAtTime(e));i>=0&&(r=s[i])!=null&&r.event;){var r;i--}return i}findItemIndexAtTime(t,e){const i=this.items;if(i)for(let s=0;s<i.length;s++){let r=i[s];if(e&&e!=="primary"&&(r=r[e]),t===r.start||t>r.start&&t<r.end)return s}return-1}findJumpRestrictedIndex(t,e){const i=this.items;if(i)for(let s=t;s<=e&&i[s];s++){const r=i[s].event;if(r!=null&&r.restrictions.jump&&!r.appendInPlace)return s}return-1}findEventIndex(t){const e=this.items;if(e)for(let s=e.length;s--;){var i;if(((i=e[s].event)==null?void 0:i.identifier)===t)return s}return-1}findAssetIndex(t,e){const i=t.assetList,s=i.length;if(s>1)for(let r=0;r<s;r++){const o=i[r];if(!o.error){const c=o.timelineStart;if(e===c||e>c&&(e<c+(o.duration||0)||r===s-1))return r}}return 0}get assetIdAtEnd(){var t;const e=(t=this.items)==null||(t=t[this.length-1])==null?void 0:t.event;if(e){const i=e.assetList,s=i[i.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(t,e){const i=t.main.details,{dateRanges:s}=i,r=this.events,o=this.parseDateRanges(s,{url:i.url},e),c=Object.keys(s),h=r?r.filter(f=>!c.includes(f.identifier)):[];o.length&&o.sort((f,g)=>{const m=f.cue.pre,y=f.cue.post,v=g.cue.pre,T=g.cue.post;if(m&&!v)return-1;if(v&&!m||y&&!T)return 1;if(T&&!y)return-1;if(!m&&!v&&!y&&!T){const S=f.startTime,x=g.startTime;if(S!==x)return S-x}return f.dateRange.tagOrder-g.dateRange.tagOrder}),this.events=o,h.forEach(f=>{this.removeEvent(f)}),this.updateSchedule(t,h)}updateSchedule(t,e=[],i=!1){const s=this.events||[];if(s.length||e.length||this.length<2){const r=this.items,o=this.parseSchedule(s,t);(i||e.length||r?.length!==o.length||o.some((h,f)=>Math.abs(h.playout.start-r[f].playout.start)>.005||Math.abs(h.playout.end-r[f].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(e,r))}}parseDateRanges(t,e,i){const s=[],r=Object.keys(t);for(let o=0;o<r.length;o++){const c=r[o],h=t[c];if(h.isInterstitial){let f=this.eventMap[c];f?f.setDateRange(h):(f=new xC(h,e),this.eventMap[c]=f,i===!1&&(f.appendInPlace=i)),s.push(f)}}return s}parseSchedule(t,e){const i=[],s=e.main.details,r=s.live?1/0:s.edge;let o=0;if(t=t.filter(h=>!h.error&&!(h.cue.once&&h.hasPlayed)),t.length){this.resolveOffsets(t,e);let h=0,f=0;if(t.forEach((g,m)=>{const y=g.cue.pre,v=g.cue.post,T=t[m-1]||null,S=g.appendInPlace,x=v?r:g.startOffset,_=g.duration,L=g.timelineOccupancy===cc.Range?_:0,R=g.resumptionOffset,C=T?.startTime===x,I=x+g.cumulativeDuration;let U=S?I+_:x+R;if(y||!v&&x<=0){const M=f;f+=L,g.timelineStart=I;const w=o;o+=_,i.push({event:g,start:I,end:U,playout:{start:w,end:o},integrated:{start:M,end:f}})}else if(x<=r){if(!C){const N=x-h;if(N>gE){const z=h,J=f;f+=N;const lt=o;o+=N;const ct={previousEvent:t[m-1]||null,nextEvent:g,start:z,end:z+N,playout:{start:lt,end:o},integrated:{start:J,end:f}};i.push(ct)}else N>0&&T&&(T.cumulativeDuration+=N,i[i.length-1].end=x)}v&&(U=I),g.timelineStart=I;const M=f;f+=L;const w=o;o+=_,i.push({event:g,start:I,end:U,playout:{start:w,end:o},integrated:{start:M,end:f}})}else return;const O=g.resumeTime;v||O>r?h=r:h=O}),h<r){var c;const g=h,m=f,y=r-h;f+=y;const v=o;o+=y,i.push({previousEvent:((c=i[i.length-1])==null?void 0:c.event)||null,nextEvent:null,start:h,end:g+y,playout:{start:v,end:o},integrated:{start:m,end:f}})}this.setDurations(r,o,f)}else i.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return i}setDurations(t,e,i){this.durations={primary:t,playout:e,integrated:i}}resolveOffsets(t,e){const i=e.main.details,s=i.live?1/0:i.edge;let r=0,o=-1;t.forEach((c,h)=>{const f=c.cue.pre,g=c.cue.post,m=f?0:g?s:c.startTime;this.updateAssetDurations(c),o===m?c.cumulativeDuration=r:(r=0,o=m),!g&&c.snapOptions.in&&(c.resumeAnchor=ur(null,i.fragments,c.startOffset+c.resumptionOffset,0,0)||void 0),c.appendInPlace&&!c.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(c,e)||(c.appendInPlace=!1)),!c.appendInPlace&&h+1<t.length&&t[h+1].startTime-t[h].resumeTime<gE&&(t[h+1].appendInPlace=!1,t[h+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${c}`));const v=dt(c.resumeOffset)?c.resumeOffset:c.duration;r+=v})}primaryCanResumeInPlaceAt(t,e){const i=t.resumeTime,s=t.startTime+t.resumptionOffset;return Math.abs(i-s)>ha?(this.log(`"${t.identifier}" resumption ${i} not aligned with estimated timeline end ${s}`),!1):!Object.keys(e).some(o=>{const c=e[o].details,h=c.edge;if(i>=h)return this.log(`"${t.identifier}" resumption ${i} past ${o} playlist end ${h}`),!1;const f=ur(null,c.fragments,i);if(!f)return this.log(`"${t.identifier}" resumption ${i} does not align with any fragments in ${o} playlist (${c.fragStart}-${c.fragmentEnd})`),!0;const g=o==="audio"?.175:0;return Math.abs(f.start-i)<ha+g||Math.abs(f.end-i)<ha+g?!1:(this.log(`"${t.identifier}" resumption ${i} not aligned with ${o} fragment bounds (${f.start}-${f.end} sn: ${f.sn} cc: ${f.cc})`),!0)})}updateAssetDurations(t){if(!t.assetListLoaded)return;const e=t.timelineStart;let i=0,s=!1,r=!1;for(let o=0;o<t.assetList.length;o++){const c=t.assetList[o],h=e+i;c.startOffset=i,c.timelineStart=h,s||(s=c.duration===null),r||(r=!!c.error);const f=c.error?0:c.duration||0;i+=f}s&&!r?t.duration=Math.max(i,t.duration):t.duration=i}removeEvent(t){t.reset(),delete this.eventMap[t.identifier]}}function Cs(l){return`[${l.event?'"'+l.event.identifier+'"':"primary"}: ${l.start.toFixed(2)}-${l.end.toFixed(2)}]`}class RC{constructor(t){this.hls=void 0,this.hls=t}destroy(){this.hls=null}loadAssetList(t,e){const i=t.assetListUrl;let s;try{s=ax(i,this.hls.sessionId,t.baseUrl)}catch(y){const v=this.assignAssetListError(t,K.ASSET_LIST_LOAD_ERROR,y,i);this.hls.trigger(A.ERROR,v);return}e&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+e);const r=this.hls.config,o=r.loader,c=new o(r),h={responseType:"json",url:s.href},f=r.interstitialAssetListLoadPolicy.default,g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(y,v,T,S)=>{const x=y.data,_=x?.ASSETS;if(!Array.isArray(_)){const L=this.assignAssetListError(t,K.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),T.url,v,S);this.hls.trigger(A.ERROR,L);return}t.assetListResponse=x,this.hls.trigger(A.ASSET_LIST_LOADED,{event:t,assetListResponse:x,networkDetails:S})},onError:(y,v,T,S)=>{const x=this.assignAssetListError(t,K.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${y.code} ${y.text} (${v.url})`),v.url,S,T);this.hls.trigger(A.ERROR,x)},onTimeout:(y,v,T)=>{const S=this.assignAssetListError(t,K.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${v.url})`),v.url,y,T);this.hls.trigger(A.ERROR,S)}};return c.load(h,g,m),this.hls.trigger(A.ASSET_LIST_LOADING,{event:t}),c}assignAssetListError(t,e,i,s,r,o){return t.error=i,{type:pt.NETWORK_ERROR,details:e,fatal:!1,interstitial:t,url:s,error:i,networkDetails:o,stats:r}}}function mE(l){l?.play().catch(()=>{})}class LC extends zi{constructor(t,e){super("interstitials",t.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled||!this.schedule)return;const s=i-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const o=s<=-.01;this.timelinePos=i,this.bufferedPos=i;const c=this.playingItem;if(!c){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(i,i-s)&&this.updateSchedule(!0),this.checkBuffer(),o&&i<c.start||i>=c.end){var h;const v=this.findItemIndex(c);let T=this.schedule.findItemIndexAtTime(i);if(T===-1&&(T=v+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${i} (resolving from ${v} to ${T})`)),!this.isInterstitial(c)&&(h=this.media)!=null&&h.paused&&(this.shouldPlay=!1),!o&&T>v){const S=this.schedule.findJumpRestrictedIndex(v+1,T);if(S>v){this.setSchedulePosition(S);return}}this.setSchedulePosition(T);return}const f=this.playingAsset;if(!f){if(this.playingLastItem&&this.isInterstitial(c)){const v=c.event.assetList[0];v&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,v))}return}const g=f.timelineStart,m=f.duration||0;if(o&&i<g||i>=g+m){var y;(y=c.event)!=null&&y.appendInPlace&&(this.clearInterstitial(c.event,c),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,f)}},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(i>=s.end){this.timelinePos=s.end;const c=this.findItemIndex(s);this.setSchedulePosition(c+1)}const r=this.playingAsset;if(!r)return;const o=r.timelineStart+(r.duration||0);i>=o&&this.setScheduleToAssetAtTime(i,r)},this.onScheduleUpdate=(i,s)=>{const r=this.schedule;if(!r)return;const o=this.playingItem,c=r.events||[],h=r.items||[],f=r.durations,g=i.map(S=>S.identifier),m=!!(c.length||g.length);(m||s)&&this.log(`INTERSTITIALS_UPDATED (${c.length}): ${c}
Schedule: ${h.map(S=>Cs(S))} pos: ${this.timelinePos}`),g.length&&this.log(`Removed events ${g}`);let y=null,v=null;o&&(y=this.updateItem(o,this.timelinePos),this.itemsMatch(o,y)?this.playingItem=y:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const T=this.bufferingItem;if(T&&(v=this.updateItem(T,this.bufferedPos),this.itemsMatch(T,v)?this.bufferingItem=v:T.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(T.event,null))),i.forEach(S=>{S.assetList.forEach(x=>{this.clearAssetPlayer(x.identifier,null)})}),this.playerQueue.forEach(S=>{if(S.interstitial.appendInPlace){const x=S.assetItem.timelineStart,_=S.timelineOffset-x;if(_)try{S.timelineOffset=x}catch(L){Math.abs(_)>ha&&this.warn(`${L} ("${S.assetId}" ${S.timelineOffset}->${x})`)}}}),m||s){if(this.hls.trigger(A.INTERSTITIALS_UPDATED,{events:c.slice(0),schedule:h.slice(0),durations:f,removedIds:g}),this.isInterstitial(o)&&g.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(y,o),T&&this.trimInPlace(v,T),this.checkBuffer()}},this.hls=t,this.HlsPlayerClass=e,this.assetListLoader=new RC(t),this.schedule=new bC(this.onScheduleUpdate,t.logger),this.registerListeners()}registerListeners(){const t=this.hls;t&&(t.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(A.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.on(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(A.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.on(A.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.on(A.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.on(A.BUFFER_APPENDED,this.onBufferAppended,this),t.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(A.BUFFERED_TO_END,this.onBufferedToEnd,this),t.on(A.MEDIA_ENDED,this.onMediaEnded,this),t.on(A.ERROR,this.onError,this),t.on(A.DESTROYING,this.onDestroying,this))}unregisterListeners(){const t=this.hls;t&&(t.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(A.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(A.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.off(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(A.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.off(A.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.off(A.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.off(A.BUFFER_CODECS,this.onBufferCodecs,this),t.off(A.BUFFER_APPENDED,this.onBufferAppended,this),t.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(A.BUFFERED_TO_END,this.onBufferedToEnd,this),t.off(A.MEDIA_ENDED,this.onMediaEnded,this),t.off(A.ERROR,this.onError,this),t.off(A.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var t;(t=this.getBufferingPlayer())==null||t.resumeBuffering()}pauseBuffering(){var t;(t=this.getBufferingPlayer())==null||t.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const t=this.primaryMedia||this.media;t&&this.removeMediaListeners(t)}removeMediaListeners(t){Ni(t,"play",this.onPlay),Ni(t,"pause",this.onPause),Ni(t,"seeking",this.onSeeking),Ni(t,"timeupdate",this.onTimeupdate)}onMediaAttaching(t,e){const i=this.media=e.media;mi(i,"seeking",this.onSeeking),mi(i,"timeupdate",this.onTimeupdate),mi(i,"play",this.onPlay),mi(i,"pause",this.onPause)}onMediaAttached(t,e){const i=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!s){this.clearScheduleState();const r=this.findItemIndex(i);this.setSchedulePosition(r)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(t,e){const i=!!e.transferMedia,s=this.media;if(this.media=null,!i&&(s&&this.removeMediaListeners(s),this.detachedData)){const r=this.getBufferingPlayer();r&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const t=this,e=()=>t.bufferingItem||t.waitingItem,i=m=>m&&t.getAssetPlayer(m.identifier),s=(m,y,v,T,S)=>{if(m){let x=m[y].start;const _=m.event;if(_){if(y==="playout"||_.timelineOccupancy!==cc.Point){const L=i(v);L?.interstitial===_&&(x+=L.assetItem.startOffset+L[S])}}else{const L=T==="bufferedPos"?o():t[T];x+=L-m.start}return x}return 0},r=(m,y)=>{var v;if(m!==0&&y!=="primary"&&(v=t.schedule)!=null&&v.length){var T;const S=t.schedule.findItemIndexAtTime(m),x=(T=t.schedule.items)==null?void 0:T[S];if(x){const _=x[y].start-x.start;return m+_}}return m},o=()=>{const m=t.bufferedPos;return m===Number.MAX_VALUE?c("primary"):Math.max(m,0)},c=m=>{var y,v;return(y=t.primaryDetails)!=null&&y.live?t.primaryDetails.edge:((v=t.schedule)==null?void 0:v.durations[m])||0},h=(m,y)=>{var v,T;const S=t.effectivePlayingItem;if(S!=null&&(v=S.event)!=null&&v.restrictions.skip||!t.schedule)return;t.log(`seek to ${m} "${y}"`);const x=t.effectivePlayingItem,_=t.schedule.findItemIndexAtTime(m,y),L=(T=t.schedule.items)==null?void 0:T[_],R=t.getBufferingPlayer(),C=R?.interstitial,I=C?.appendInPlace,U=x&&t.itemsMatch(x,L);if(x&&(I||U)){const O=i(t.playingAsset),M=O?.media||t.primaryMedia;if(M){const w=y==="primary"?M.currentTime:s(x,y,t.playingAsset,"timelinePos","currentTime"),N=m-w,z=(I?w:M.currentTime)+N;if(z>=0&&(!O||I||z<=O.duration)){M.currentTime=z;return}}}if(L){let O=m;if(y!=="primary"){const w=L[y].start,N=m-w;O=L.start+N}const M=!t.isInterstitial(L);if((!t.isInterstitial(x)||x.event.appendInPlace)&&(M||L.event.appendInPlace)){const w=t.media||(I?R?.media:null);w&&(w.currentTime=O)}else if(x){const w=t.findItemIndex(x);if(_>w){const z=t.schedule.findJumpRestrictedIndex(w+1,_);if(z>w){t.setSchedulePosition(z);return}}let N=0;if(M)t.timelinePos=O,t.checkBuffer();else{const z=L.event.assetList,J=m-(L[y]||L).start;for(let lt=z.length;lt--;){const ct=z[lt];if(ct.duration&&J>=ct.startOffset&&J<ct.startOffset+ct.duration){N=lt;break}}}t.setSchedulePosition(_,N)}}},f=()=>{const m=t.effectivePlayingItem;if(t.isInterstitial(m))return m;const y=e();return t.isInterstitial(y)?y:null},g={get bufferedEnd(){const m=e(),y=t.bufferingItem;if(y&&y===m){var v;return s(y,"playout",t.bufferingAsset,"bufferedPos","bufferedEnd")-y.playout.start||((v=t.bufferingAsset)==null?void 0:v.startOffset)||0}return 0},get currentTime(){const m=f(),y=t.effectivePlayingItem;return y&&y===m?s(y,"playout",t.effectivePlayingAsset,"timelinePos","currentTime")-y.playout.start:0},set currentTime(m){const y=f(),v=t.effectivePlayingItem;v&&v===y&&h(m+v.playout.start,"playout")},get duration(){const m=f();return m?m.playout.end-m.playout.start:0},get assetPlayers(){var m;const y=(m=f())==null?void 0:m.event.assetList;return y?y.map(v=>t.getAssetPlayer(v.identifier)):[]},get playingIndex(){var m;const y=(m=f())==null?void 0:m.event;return y&&t.effectivePlayingAsset?y.findAssetIndex(t.effectivePlayingAsset):-1},get scheduleItem(){return f()}};return this.manager={get events(){var m;return((m=t.schedule)==null||(m=m.events)==null?void 0:m.slice(0))||[]},get schedule(){var m;return((m=t.schedule)==null||(m=m.items)==null?void 0:m.slice(0))||[]},get interstitialPlayer(){return f()?g:null},get playerQueue(){return t.playerQueue.slice(0)},get bufferingAsset(){return t.bufferingAsset},get bufferingItem(){return e()},get bufferingIndex(){const m=e();return t.findItemIndex(m)},get playingAsset(){return t.effectivePlayingAsset},get playingItem(){return t.effectivePlayingItem},get playingIndex(){const m=t.effectivePlayingItem;return t.findItemIndex(m)},primary:{get bufferedEnd(){return o()},get currentTime(){const m=t.timelinePos;return m>0?m:0},set currentTime(m){h(m,"primary")},get duration(){return c("primary")},get seekableStart(){var m;return((m=t.primaryDetails)==null?void 0:m.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(e(),"integrated",t.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(t.effectivePlayingItem,"integrated",t.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(m){h(m,"integrated")},get duration(){return c("integrated")},get seekableStart(){var m;return r(((m=t.primaryDetails)==null?void 0:m.fragmentStart)||0,"integrated")}},skip:()=>{const m=t.effectivePlayingItem,y=m?.event;if(y&&!y.restrictions.skip){const v=t.findItemIndex(m);if(y.appendInPlace){const T=m.playout.start+m.event.duration;h(T+.001,"playout")}else t.advanceAfterAssetEnded(y,v,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var t;const e=this.playingItem,i=(t=this.schedule)==null?void 0:t.items;return!this.playbackStarted||!e||!i?!1:this.findItemIndex(e)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var t,e;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let s=this.media;!s&&(t=this.bufferingItem)!=null&&(t=t.event)!=null&&t.appendInPlace&&(s=this.primaryMedia);const r=(e=s)==null?void 0:e.currentTime;if(!(r===void 0||!dt(r)))return r}get primaryMedia(){var t;return this.media||((t=this.detachedData)==null?void 0:t.media)||null}isInterstitial(t){return!!(t!=null&&t.event)}retreiveMediaSource(t,e){const i=this.getAssetPlayer(t);i&&this.transferMediaFromPlayer(i,e)}transferMediaFromPlayer(t,e){const i=t.interstitial.appendInPlace,s=t.media;if(i&&s===this.primaryMedia){if(this.bufferingAsset=null,(!e||this.isInterstitial(e)&&!e.event.appendInPlace)&&e&&s){this.detachedData={media:s};return}const r=t.transferMedia();this.log(`transfer MediaSource from ${t} ${Wt(r)}`),this.detachedData=r}else e&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(t,e){var i,s;if(t.media===e)return;let r=null;const o=this.hls,c=t!==o,h=c&&t.interstitial.appendInPlace,f=(i=this.detachedData)==null?void 0:i.mediaSource;let g;if(o.media)h&&(r=o.transferMedia(),this.detachedData=r),g="Primary";else if(f){const T=this.getBufferingPlayer();T?(r=T.transferMedia(),g=`${T}`):g="detached MediaSource"}else g="detached media";if(!r){if(f)r=this.detachedData,this.log(`using detachedData: MediaSource ${Wt(r)}`);else if(!this.detachedData||o.media===e){const T=this.playerQueue;T.length>1&&T.forEach(S=>{if(c&&S.interstitial.appendInPlace!==h){const x=S.interstitial;this.clearInterstitial(S.interstitial,null),x.appendInPlace=!1,x.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${x}`)}}),this.hls.detachMedia(),this.detachedData={media:e}}}const m=r&&"mediaSource"in r&&((s=r.mediaSource)==null?void 0:s.readyState)!=="closed",y=m&&r?r:e;this.log(`${m?"transfering MediaSource":"attaching media"} to ${c?t:"Primary"} from ${g} (media.currentTime: ${e.currentTime})`);const v=this.schedule;if(y===r&&v){const T=c&&t.assetId===v.assetIdAtEnd;y.overrides={duration:v.duration,endOfStream:!c||T,cueRemoval:!c}}t.attachMedia(y)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const t=this.schedule,e=t?.events;if(!e||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,s=this.effectivePlayingItem;if(i===-1){const r=this.hls.startPosition;if(this.timelinePos=r,e.length&&e[0].cue.pre){const o=t.findEventIndex(e[0].identifier);this.setSchedulePosition(o)}else if(r>=0||!this.primaryLive){const o=this.timelinePos=r>0?r:0,c=t.findItemIndexAtTime(o);this.setSchedulePosition(c)}}else if(s&&!this.playingItem){const r=t.findItemIndex(s);this.setSchedulePosition(r)}}advanceAssetBuffering(t,e){const i=t.event,s=i.findAssetIndex(e),r=ud(i,s);if(!i.isAssetPastPlayoutLimit(r))this.bufferedToEvent(t,r);else if(this.schedule){var o;const c=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(t)+1];c&&this.bufferedToItem(c)}}advanceAfterAssetEnded(t,e,i){const s=ud(t,i);if(t.isAssetPastPlayoutLimit(s)){if(this.schedule){const r=this.schedule.items;if(r){const o=e+1,c=r.length;if(o>=c){this.setSchedulePosition(-1);return}const h=t.resumeTime;this.timelinePos<h&&(this.timelinePos=h,t.appendInPlace&&this.advanceInPlace(h),this.checkBuffer(this.bufferedPos<h)),this.setSchedulePosition(o)}}}else{if(t.appendInPlace){const r=t.assetList[s];r&&this.advanceInPlace(r.timelineStart)}this.setSchedulePosition(e,s)}}setScheduleToAssetAtTime(t,e){const i=this.schedule;if(!i)return;const s=e.parentIdentifier,r=i.getEvent(s);if(r){const o=i.findEventIndex(s),c=i.findAssetIndex(r,t);this.advanceAfterAssetEnded(r,o,c-1)}}setSchedulePosition(t,e){var i;const s=(i=this.schedule)==null?void 0:i.items;if(!s||this.playbackDisabled)return;const r=t>=0?s[t]:null;this.log(`setSchedulePosition ${t}, ${e} (${r&&Cs(r)})`);const o=this.waitingItem||this.playingItem,c=this.playingLastItem;if(this.isInterstitial(o)){const g=o.event,m=this.playingAsset,y=m?.identifier,v=y?this.getAssetPlayer(y):null;if(v&&y&&(!this.eventItemsMatch(o,r)||e!==void 0&&y!==g.assetList[e].identifier)){var h;const T=g.findAssetIndex(m);if(this.log(`INTERSTITIAL_ASSET_ENDED ${T+1}/${g.assetList.length} ${sa(m)}`),this.endedAsset=m,this.playingAsset=null,this.hls.trigger(A.INTERSTITIAL_ASSET_ENDED,{asset:m,assetListIndex:T,event:g,schedule:s.slice(0),scheduleIndex:t,player:v}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(g,this.findItemIndex(this.playingItem),T);return}this.retreiveMediaSource(y,r),v.media&&!((h=this.detachedData)!=null&&h.mediaSource)&&v.detachMedia()}if(!this.eventItemsMatch(o,r)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${g} ${Cs(o)}`),g.hasPlayed=!0,this.hls.trigger(A.INTERSTITIAL_ENDED,{event:g,schedule:s.slice(0),scheduleIndex:t}),g.cue.once)){var f;this.updateSchedule();const T=(f=this.schedule)==null?void 0:f.items;if(r&&T){const S=this.findItemIndex(r);this.advanceSchedule(S,T,e,o,c)}return}}this.advanceSchedule(t,s,e,o,c)}advanceSchedule(t,e,i,s,r){const o=this.schedule;if(!o)return;const c=t>=0?e[t]:null,h=this.primaryMedia,f=this.playerQueue;if(f.length&&f.forEach(g=>{const m=g.interstitial,y=o.findEventIndex(m.identifier);(y<t||y>t+1)&&this.clearInterstitial(m,c)}),this.isInterstitial(c)){this.timelinePos=Math.min(Math.max(this.timelinePos,c.start),c.end);const g=c.event;if(i===void 0){i=o.findAssetIndex(g,this.timelinePos);const T=ud(g,i-1);if(g.isAssetPastPlayoutLimit(T)||g.appendInPlace&&this.timelinePos===c.end){this.advanceAfterAssetEnded(g,t,i);return}i=T}const m=this.waitingItem;this.assetsBuffered(c,h)||this.setBufferingItem(c);let y=this.preloadAssets(g,i);if(this.eventItemsMatch(c,m||s)||(this.waitingItem=c,this.log(`INTERSTITIAL_STARTED ${Cs(c)} ${g.appendInPlace?"append in place":""}`),this.hls.trigger(A.INTERSTITIAL_STARTED,{event:g,schedule:e.slice(0),scheduleIndex:t})),!g.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${g}`);return}if(g.assetListLoader&&(g.assetListLoader.destroy(),g.assetListLoader=void 0),!h){this.log(`Waiting for attachMedia to start Interstitial ${g}`);return}this.waitingItem=this.endedItem=null,this.playingItem=c;const v=g.assetList[i];if(!v){this.advanceAfterAssetEnded(g,t,i||0);return}if(y||(y=this.getAssetPlayer(v.identifier)),y===null||y.destroyed){const T=g.assetList.length;this.warn(`asset ${i+1}/${T} player destroyed ${g}`),y=this.createAssetPlayer(g,v,i),y.loadSource()}if(!this.eventItemsMatch(c,this.bufferingItem)&&g.appendInPlace&&this.isAssetBuffered(v))return;this.startAssetPlayer(y,i,e,t,h),this.shouldPlay&&mE(y.media)}else c!==null?(this.resumePrimary(c,t,s),this.shouldPlay&&mE(this.hls.media)):r&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var t;return(t=this.mediaSelection)==null?void 0:t.main.details}get primaryLive(){var t;return!!((t=this.primaryDetails)!=null&&t.live)}resumePrimary(t,e,i){var s,r;if(this.playingItem=t,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(t),this.log(`resuming ${Cs(t)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let c=this.timelinePos;(c<t.start||c>=t.end)&&(c=this.getPrimaryResumption(t,e),this.timelinePos=c),this.attachPrimary(c,t)}if(!i)return;const o=(r=this.schedule)==null?void 0:r.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Cs(t)}`),this.hls.trigger(A.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:e}),this.checkBuffer())}getPrimaryResumption(t,e){const i=t.start;if(this.primaryLive){const s=this.primaryDetails;if(e===0)return this.hls.startPosition;if(s&&(i<s.fragmentStart||i>s.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(t){const e=this.getAssetPlayer(t.identifier);return e!=null&&e.hls?e.hls.bufferedToEnd:xt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=t.timelineStart+(t.duration||0)}attachPrimary(t,e,i){e?this.setBufferingItem(e):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,s),i&&this.startLoadingPrimaryAt(t,i)),i||(this.timelinePos=t,this.startLoadingPrimaryAt(t,i))}startLoadingPrimaryAt(t,e){var i;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((i=s.mainForwardBufferInfo)==null?void 0:i.start)||s.media.currentTime)-t)>.5?s.startLoad(t,e):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var t;this.stopLoad(),(t=this.schedule)==null||t.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(A.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(A.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(t,e){if(e.level===-1||!this.schedule)return;const i=this.hls.levels[e.level],s=Vt(Vt({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(t,e){const i=this.hls.audioTracks[e.id],s=this.mediaSelection;if(!s){this.altSelection=Vt(Vt({},this.altSelection),{},{audio:i});return}const r=Vt(Vt({},s),{},{audio:i});this.mediaSelection=r}onSubtitleTrackUpdated(t,e){const i=this.hls.subtitleTracks[e.id],s=this.mediaSelection;if(!s){this.altSelection=Vt(Vt({},this.altSelection),{},{subtitles:i});return}const r=Vt(Vt({},s),{},{subtitles:i});this.mediaSelection=r}onAudioTrackSwitching(t,e){const i=Iv(e);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(e)||s.setAudioOption(i)))}onSubtitleTrackSwitch(t,e){const i=Iv(e);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(e)||e.id!==-1&&s.setSubtitleOption(i)))}onBufferCodecs(t,e){const i=e.tracks;i&&(this.requiredTracks=i)}onBufferAppended(t,e){this.checkBuffer()}onBufferFlushed(t,e){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(t){if(!this.schedule)return;const e=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&e){for(let s=0;s<e.length;s++){const r=e[s];if(r.cue.post){var i;const o=this.schedule.findEventIndex(r.identifier),c=(i=this.schedule.items)==null?void 0:i[o];this.isInterstitial(c)&&this.eventItemsMatch(c,this.bufferingItem)&&this.bufferedToItem(c,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(t){const e=this.playingItem;if(!this.playingLastItem&&e){const i=this.findItemIndex(e);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(t,e){var i;const s=(i=this.schedule)==null?void 0:i.items;if(t&&s){const r=this.findItemIndex(t,e);return s[r]||null}return null}trimInPlace(t,e){if(this.isInterstitial(t)&&t.event.appendInPlace&&e.end-t.end>.25){t.event.assetList.forEach((r,o)=>{t.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(r.identifier,null)});const i=t.end+.25,s=xt.bufferInfo(this.primaryMedia,i,0);(s.end>i||(s.nextStart||0)>i)&&(this.attachPrimary(i,null),this.flushFrontBuffer(i))}}itemsMatch(t,e){return!!e&&(t===e||t.event&&e.event&&this.eventItemsMatch(t,e)||!t.event&&!e.event&&this.findItemIndex(t)===this.findItemIndex(e))}eventItemsMatch(t,e){var i;return!!e&&(t===e||t.event.identifier===((i=e.event)==null?void 0:i.identifier))}findItemIndex(t,e){return t&&this.schedule?this.schedule.findItemIndex(t,e):-1}updateSchedule(t=!1){var e;const i=this.mediaSelection;i&&((e=this.schedule)==null||e.updateSchedule(i,[],t))}checkBuffer(t){var e;const i=(e=this.schedule)==null?void 0:e.items;if(!i)return;const s=xt.bufferInfo(this.primaryMedia,this.timelinePos,0);t&&(this.bufferedPos=this.timelinePos),t||(t=s.len<1),this.updateBufferedPos(s.end,i,t)}updateBufferedPos(t,e,i){const s=this.schedule,r=this.bufferingItem;if(this.bufferedPos>t||!s)return;if(e.length===1&&this.itemsMatch(e[0],r)){this.bufferedPos=t;return}const o=this.playingItem,c=this.findItemIndex(o);let h=s.findItemIndexAtTime(t);if(this.bufferedPos<t){var f;const g=this.findItemIndex(r),m=Math.min(g+1,e.length-1),y=e[m];if((h===-1&&r&&t>=r.end||(f=y.event)!=null&&f.appendInPlace&&t+.01>=y.start)&&(h=m),this.isInterstitial(r)){const v=r.event;if(m-c>1&&v.appendInPlace===!1||v.assetList.length===0&&v.assetListLoader)return}if(this.bufferedPos=t,h>g&&h>c)this.bufferedToItem(y);else{const v=this.primaryDetails;this.primaryLive&&v&&t>v.edge-v.targetduration&&y.start<v.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(y)&&this.preloadAssets(y.event,0)}}else i&&o&&!this.itemsMatch(o,r)&&(h===c?this.bufferedToItem(o):h===c+1&&this.bufferedToItem(e[h]))}assetsBuffered(t,e){return t.event.assetList.length===0?!1:!t.event.assetList.some(s=>{const r=this.getAssetPlayer(s.identifier);return!(r!=null&&r.bufferedInPlaceToEnd(e))})}setBufferingItem(t){const e=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(t,e)&&i){const{items:s,events:r}=i;if(!s||!r)return e;const o=this.isInterstitial(t),c=this.getBufferingPlayer();this.bufferingItem=t,this.bufferedPos=Math.max(t.start,Math.min(t.end,this.timelinePos));const h=c?c.remaining:e?e.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Cs(t)}`+(e?` (${h.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const f=i.findAssetIndex(t.event,this.bufferedPos);t.event.assetList.forEach((g,m)=>{const y=this.getAssetPlayer(g.identifier);y&&(m===f&&y.loadSource(),y.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(f=>f.pauseBuffering());this.hls.trigger(A.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(t),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==t&&(this.bufferingItem=t);return e}bufferedToItem(t,e=0){const i=this.setBufferingItem(t);if(!this.playbackDisabled){if(this.isInterstitial(t))this.bufferedToEvent(t,e);else if(i!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(t.start,t,!0):this.preloadPrimary(t):this.preloadPrimary(t)}}}preloadPrimary(t){const e=this.findItemIndex(t),i=this.getPrimaryResumption(t,e);this.startLoadingPrimaryAt(i)}bufferedToEvent(t,e){const i=t.event,s=i.assetList.length===0&&!i.assetListLoader,r=i.cue.once;if(s||!r){const o=this.preloadAssets(i,e);if(o!=null&&o.interstitial.appendInPlace){const c=this.primaryMedia;c&&this.bufferAssetPlayer(o,c)}}}preloadAssets(t,e){const i=t.assetUrl,s=t.assetList.length,r=s===0&&!t.assetListLoader,o=t.cue.once;if(r){const h=t.timelineStart;if(t.appendInPlace){var c;const y=this.playingItem;!this.isInterstitial(y)&&(y==null||(c=y.nextEvent)==null?void 0:c.identifier)===t.identifier&&this.flushFrontBuffer(h+.25)}let f,g=0;if(!this.playingItem&&this.primaryLive&&(g=this.hls.startPosition,g===-1&&(g=this.hls.liveSyncPosition||0)),g&&!(t.cue.pre||t.cue.post)){const y=g-h;y>0&&(f=Math.round(y*1e3)/1e3)}if(this.log(`Load interstitial asset ${e+1}/${i?1:s} ${t}${f?` live-start: ${g} start-offset: ${f}`:""}`),i)return this.createAsset(t,0,0,h,t.duration,i);const m=this.assetListLoader.loadAssetList(t,f);m&&(t.assetListLoader=m)}else if(!o&&s){for(let f=e;f<s;f++){const g=t.assetList[f],m=this.getAssetPlayerQueueIndex(g.identifier);(m===-1||this.playerQueue[m].destroyed)&&!g.error&&this.createAssetPlayer(t,g,f)}const h=t.assetList[e];if(h){const f=this.getAssetPlayer(h.identifier);return f&&f.loadSource(),f}}return null}flushFrontBuffer(t){const e=this.requiredTracks;if(!e)return;this.log(`Removing front buffer starting at ${t}`),Object.keys(e).forEach(s=>{this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:t,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(t){const e=this.playerQueue;for(let i=0;i<e.length;i++)if(t===e[i].assetId)return i;return-1}getAssetPlayer(t){const e=this.getAssetPlayerQueueIndex(t);return this.playerQueue[e]||null}getBufferingPlayer(){const{playerQueue:t,primaryMedia:e}=this;if(e){for(let i=0;i<t.length;i++)if(t[i].media===e)return t[i]}return null}createAsset(t,e,i,s,r,o){const c={parentIdentifier:t.identifier,identifier:SC(t,o,e),duration:r,startOffset:i,timelineStart:s,uri:o};return this.createAssetPlayer(t,c,e)}createAssetPlayer(t,e,i){const s=this.hls,r=s.userConfig;let o=r.videoPreference;const c=s.loadLevelObj||s.levels[s.currentLevel];(o||c)&&(o=Kt({},o),c.videoCodec&&(o.videoCodec=c.videoCodec),c.videoRange&&(o.allowedVideoRanges=[c.videoRange]));const h=s.audioTracks[s.audioTrack],f=s.subtitleTracks[s.subtitleTrack];let g=0;if(this.primaryLive||t.appendInPlace){const C=this.timelinePos-e.timelineStart;if(C>1){const I=e.duration;I&&C<I&&(g=C)}}const m=e.identifier,y=Vt(Vt({},r),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:m,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:g,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:h||r.audioPreference,subtitlePreference:f||r.subtitlePreference});t.appendInPlace&&(t.appendInPlaceStarted=!0,e.timelineStart&&(y.timelineOffset=e.timelineStart));const v=y.cmcd;v!=null&&v.sessionId&&v.contentId&&(y.cmcd=Kt({},v,{contentId:Ml(e.uri)})),this.getAssetPlayer(m)&&this.warn(`Duplicate date range identifier ${t} and asset ${m}`);const T=new AC(this.HlsPlayerClass,y,t,e);this.playerQueue.push(T),t.assetList[i]=e;let S=!0;const x=C=>{if(C.live){var I;const M=new Error(`Interstitials MUST be VOD assets ${t}`),w={fatal:!0,type:pt.OTHER_ERROR,details:K.INTERSTITIAL_ASSET_ITEM_ERROR,error:M},N=((I=this.schedule)==null?void 0:I.findEventIndex(t.identifier))||-1;this.handleAssetItemError(w,t,N,i,M.message);return}const U=C.edge-C.fragmentStart,O=e.duration;(S||O===null||U>O)&&(S=!1,this.log(`Interstitial asset "${m}" duration change ${O} > ${U}`),e.duration=U,this.updateSchedule())};T.on(A.LEVEL_UPDATED,(C,{details:I})=>x(I)),T.on(A.LEVEL_PTS_UPDATED,(C,{details:I})=>x(I)),T.on(A.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const _=(C,I)=>{const U=this.getAssetPlayer(m);if(U&&I.tracks){U.off(A.BUFFER_CODECS,_),U.tracks=I.tracks;const O=this.primaryMedia;this.bufferingAsset===U.assetItem&&O&&!U.media&&this.bufferAssetPlayer(U,O)}};T.on(A.BUFFER_CODECS,_);const L=()=>{var C;const I=this.getAssetPlayer(m);if(this.log(`buffered to end of asset ${I}`),!I||!this.schedule)return;const U=this.schedule.findEventIndex(t.identifier),O=(C=this.schedule.items)==null?void 0:C[U];this.isInterstitial(O)&&this.advanceAssetBuffering(O,e)};T.on(A.BUFFERED_TO_END,L);const R=C=>()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;this.shouldPlay=!0;const U=this.schedule.findEventIndex(t.identifier);this.advanceAfterAssetEnded(t,U,C)};return T.once(A.MEDIA_ENDED,R(i)),T.once(A.PLAYOUT_LIMIT_REACHED,R(1/0)),T.on(A.ERROR,(C,I)=>{if(!this.schedule)return;const U=this.getAssetPlayer(m);if(I.details===K.BUFFER_STALLED_ERROR){if(U!=null&&U.appendInPlace){this.handleInPlaceStall(t);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(I,t,this.schedule.findEventIndex(t.identifier),i,`Asset player error ${I.error} ${t}`)}),T.on(A.DESTROYING,()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;const I=new Error(`Asset player destroyed unexpectedly ${m}`),U={fatal:!0,type:pt.OTHER_ERROR,details:K.INTERSTITIAL_ASSET_ITEM_ERROR,error:I};this.handleAssetItemError(U,t,this.schedule.findEventIndex(t.identifier),i,I.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${sa(e)}`),this.hls.trigger(A.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:e,assetListIndex:i,event:t,player:T}),T}clearInterstitial(t,e){t.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,e)}),t.reset()}resetAssetPlayer(t){const e=this.getAssetPlayerQueueIndex(t);if(e!==-1){this.log(`reset asset player "${t}" after error`);const i=this.playerQueue[e];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(t,e){const i=this.getAssetPlayerQueueIndex(t);if(i!==-1){this.log(`clear asset player "${t}" toSegment: ${e&&Cs(e)}`);const s=this.playerQueue[i];this.transferMediaFromPlayer(s,e),this.playerQueue.splice(i,1),s.destroy()}}emptyPlayerQueue(){let t;for(;t=this.playerQueue.pop();)t.destroy();this.playerQueue=[]}startAssetPlayer(t,e,i,s,r){const{interstitial:o,assetItem:c,assetId:h}=t,f=o.assetList.length,g=this.playingAsset;this.endedAsset=null,this.playingAsset=c,(!g||g.identifier!==h)&&(g&&(this.clearAssetPlayer(g.identifier,i[s]),delete g.error),this.log(`INTERSTITIAL_ASSET_STARTED ${e+1}/${f} ${sa(c)}`),this.hls.trigger(A.INTERSTITIAL_ASSET_STARTED,{asset:c,assetListIndex:e,event:o,schedule:i.slice(0),scheduleIndex:s,player:t})),this.bufferAssetPlayer(t,r)}bufferAssetPlayer(t,e){var i,s;if(!this.schedule)return;const{interstitial:r,assetItem:o}=t,c=this.schedule.findEventIndex(r.identifier),h=(i=this.schedule.items)==null?void 0:i[c];if(!h)return;t.loadSource(),this.setBufferingItem(h),this.bufferingAsset=o;const f=this.getBufferingPlayer();if(f===t)return;const g=r.appendInPlace;if(g&&f?.interstitial.appendInPlace===!1)return;const m=f?.tracks||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(g&&o!==this.playingAsset){if(!t.tracks){this.log(`Waiting for track info before buffering ${t}`);return}if(m&&!qT(m,t.tracks)){const y=new Error(`Asset ${sa(o)} SourceBuffer tracks ('${Object.keys(t.tracks)}') are not compatible with primary content tracks ('${Object.keys(m)}')`),v={fatal:!0,type:pt.OTHER_ERROR,details:K.INTERSTITIAL_ASSET_ITEM_ERROR,error:y},T=r.findAssetIndex(o);this.handleAssetItemError(v,r,c,T,y.message);return}}this.transferMediaTo(t,e)}handleInPlaceStall(t){const e=this.schedule,i=this.primaryMedia;if(!e||!i)return;const s=i.currentTime,r=e.findAssetIndex(t,s),o=t.assetList[r];if(o){const c=this.getAssetPlayer(o.identifier);if(c){const h=c.currentTime||s-o.timelineStart,f=c.duration-h;if(this.warn(`Stalled at ${h} of ${h+f} in ${c} ${t} (media.currentTime: ${s})`),h&&(f/i.playbackRate<.5||c.bufferedInPlaceToEnd(i))&&c.hls){const g=e.findEventIndex(t.identifier);this.advanceAfterAssetEnded(t,g,r)}}}}advanceInPlace(t){const e=this.primaryMedia;e&&e.currentTime<t&&(e.currentTime=t)}handleAssetItemError(t,e,i,s,r){if(t.details===K.BUFFER_STALLED_ERROR)return;const o=e.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&sa(o)} ${t.error}`),!this.schedule)return;const c=o?.identifier||"",h=this.getAssetPlayerQueueIndex(c),f=this.playerQueue[h]||null,g=this.schedule.items,m=Kt({},t,{fatal:!1,errorAction:zl(!0),asset:o,assetListIndex:s,event:e,schedule:g,scheduleIndex:i,player:f});if(this.hls.trigger(A.INTERSTITIAL_ASSET_ERROR,m),!t.fatal)return;const y=this.playingAsset,v=this.bufferingAsset,T=new Error(r);if(o&&(this.clearAssetPlayer(c,null),o.error=T),!e.assetList.some(S=>!S.error))e.error=T;else for(let S=s;S<e.assetList.length;S++)this.resetAssetPlayer(e.assetList[S].identifier);this.updateSchedule(!0),e.error?this.primaryFallback(e):y&&y.identifier===c?this.advanceAfterAssetEnded(e,i,s):v&&v.identifier===c&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,v)}primaryFallback(t){const e=t.timelineStart,i=this.effectivePlayingItem;if(i){this.log(`Fallback to primary from event "${t.identifier}" start: ${e} pos: ${this.timelinePos} playing: ${Cs(i)} error: ${t.error}`);let s=this.timelinePos;s===-1&&(s=this.hls.startPosition);const r=this.updateItem(i,s);if(this.itemsMatch(i,r)&&this.clearInterstitial(t,null),t.appendInPlace&&(this.attachPrimary(e,null),this.flushFrontBuffer(e)),!this.schedule)return;const o=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(o)}else this.checkStart()}onAssetListLoaded(t,e){var i,s;const r=e.event,o=r.identifier,c=e.assetListResponse.ASSETS;if(!((i=this.schedule)!=null&&i.hasEvent(o)))return;const h=r.timelineStart,f=r.duration;let g=0;c.forEach((S,x)=>{const _=parseFloat(S.DURATION);this.createAsset(r,x,g,h+g,_,S.URI),g+=_}),r.duration=g,this.log(`Loaded asset-list with duration: ${g} (was: ${f}) ${r}`);const m=this.waitingItem,y=m?.event.identifier===o;this.updateSchedule();const v=(s=this.bufferingItem)==null?void 0:s.event;if(y){var T;const S=this.schedule.findEventIndex(o),x=(T=this.schedule.items)==null?void 0:T[S];if(x){if(!this.playingItem&&this.timelinePos>x.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==S){r.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${r}`),this.updateSchedule(!0),this.primaryFallback(r);return}this.setBufferingItem(x)}this.setSchedulePosition(S)}else if(v?.identifier===o){const S=r.assetList[0];if(S){const x=this.getAssetPlayer(S.identifier);if(v.appendInPlace){const _=this.primaryMedia;x&&_&&this.bufferAssetPlayer(x,_)}else x&&x.loadSource()}}}onError(t,e){if(this.schedule)switch(e.details){case K.ASSET_LIST_PARSING_ERROR:case K.ASSET_LIST_LOAD_ERROR:case K.ASSET_LIST_LOAD_TIMEOUT:{const i=e.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case K.BUFFER_STALLED_ERROR:{const i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace){this.handleInPlaceStall(i.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const pE=500;class DC extends Mg{constructor(t,e,i){super(t,e,i,"subtitle-stream-controller",mt.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(A.LEVEL_LOADED,this.onLevelLoaded,this),t.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:t}=this;t.off(A.LEVEL_LOADED,this.onLevelLoaded,this),t.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(t,e){this.stopLoad(),this.state=et.IDLE,this.setInterval(pE),this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(t,e){this.tracksBuffered=[],super.onMediaDetaching(t,e)}onLevelLoaded(t,e){this.mainDetails=e.details}onSubtitleFragProcessed(t,e){const{frag:i,success:s}=e;if(this.fragContextChanged(i)||(ve(i)&&(this.fragPrevious=i),this.state=et.IDLE),!s)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let o;const c=i.start;for(let f=0;f<r.length;f++)if(c>=r[f].start&&c<=r[f].end){o=r[f];break}const h=i.start+i.duration;o?o.end=h:(o={start:c,end:h},r.push(o)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(t,e){const{startOffset:i,endOffset:s}=e;if(i===0&&s!==Number.POSITIVE_INFINITY){const r=s-1;if(r<=0)return;e.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(o=>{for(let c=0;c<o.length;){if(o[c].end<=r){o.shift();continue}else if(o[c].start<r)o[c].start=r;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(i,r,mt.SUBTITLE)}}onError(t,e){const i=e.frag;i?.type===mt.SUBTITLE&&(e.details===K.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==et.STOPPED&&(this.state=et.IDLE))}onSubtitleTracksUpdated(t,{subtitleTracks:e}){if(this.levels&&zS(this.levels,e)){this.levels=e.map(i=>new Kl(i));return}this.tracksBuffered=[],this.levels=e.map(i=>{const s=new Kl(i);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,mt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(t,e){var i;if(this.currentTrackId=e.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==et.STOPPED&&this.setInterval(pE)}onSubtitleTrackLoaded(t,e){var i;const{currentTrackId:s,levels:r}=this,{details:o,id:c}=e;if(!r){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const h=r[c];if(c>=r.length||!h)return;this.log(`Subtitle track ${c} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let f=0;if(o.live||(i=h.details)!=null&&i.live){if(o.deltaUpdateFailed)return;const m=this.mainDetails;if(!m){this.startFragRequested=!1;return}const y=m.fragments[0];if(!h.details)o.hasProgramDateTime&&m.hasProgramDateTime?(oc(o,m),f=o.fragmentStart):y&&(f=y.start,Vd(o,f));else{var g;f=this.alignPlaylists(o,h.details,(g=this.levelLastLoaded)==null?void 0:g.details),f===0&&y&&(f=y.start,Vd(o,f))}m&&!this.startFragRequested&&this.setStartPosition(m,f)}h.details=o,this.levelLastLoaded=h,c===s&&(this.hls.trigger(A.SUBTITLE_TRACK_UPDATED,{details:o,id:c,groupId:e.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===et.IDLE&&(ur(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)))}_handleFragmentLoadComplete(t){const{frag:e,payload:i}=t,s=e.decryptdata,r=this.hls;if(!this.fragContextChanged(e)&&i&&i.byteLength>0&&s!=null&&s.key&&s.iv&&ca(s.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(i),s.key.buffer,s.iv.buffer,wg(s.method)).catch(c=>{throw r.trigger(A.ERROR,{type:pt.MEDIA_ERROR,details:K.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:e}),c}).then(c=>{const h=performance.now();r.trigger(A.FRAG_DECRYPTED,{frag:e,payload:c,stats:{tstart:o,tdecrypt:h}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=et.IDLE})}}doTick(){if(!this.media){this.state=et.IDLE;return}if(this.state===et.IDLE){const{currentTrackId:t,levels:e}=this,i=e?.[t];if(!i||!e.length||!i.details||this.waitForLive(i))return;const{config:s}=this,r=this.getLoadPosition(),o=xt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,s.maxBufferHole),{end:c,len:h}=o,f=i.details,g=this.hls.maxBufferLength+f.levelTargetDuration;if(h>g)return;const m=f.fragments,y=m.length,v=f.edge;let T=null;const S=this.fragPrevious;if(c<v){const L=s.maxFragLookUpTolerance,R=c>v-L?0:L;T=ur(S,m,Math.max(m[0].start,c),R),!T&&S&&S.start<m[0].start&&(T=m[0])}else T=m[y-1];if(T=this.filterReplacedPrimary(T,i.details),!T)return;const x=T.sn-f.startSN,_=m[x-1];if(_&&_.cc===T.cc&&this.fragmentTracker.getState(_)===xe.NOT_LOADED&&(T=_),this.fragmentTracker.getState(T)===xe.NOT_LOADED){const L=this.mapToInitFragWhenRequired(T);L&&this.loadFragment(L,i,c)}}}loadFragment(t,e,i){ve(t)?super.loadFragment(t,e,i):this._loadInitSegment(t,e)}get mediaBufferTimeRanges(){return new IC(this.tracksBuffered[this.currentTrackId]||[])}}class IC{constructor(t){this.buffered=void 0;const e=(i,s,r)=>{if(s=s>>>0,s>r-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${r})`);return t[s][i]};this.buffered={get length(){return t.length},end(i){return e("end",i,t.length)},start(i){return e("start",i,t.length)}}}}const CC={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},lx=l=>String.fromCharCode(CC[l]||l),Vi=15,Os=100,OC={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},wC={17:2,18:4,21:6,22:8,23:10,19:13,20:15},kC={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},MC={25:2,26:4,29:6,30:8,31:10,27:13,28:15},PC=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class NC{constructor(){this.time=null,this.verboseLevel=0}log(t,e){if(this.verboseLevel>=t){const i=typeof e=="function"?e():e;Ft.log(`${this.time} [${t}] ${i}`)}}}const Zn=function(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].toString(16));return e};class ox{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(t){const e=["foreground","underline","italics","background","flash"];for(let i=0;i<e.length;i++){const s=e[i];t.hasOwnProperty(s)&&(this[s]=t[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}copy(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class UC{constructor(){this.uchar=" ",this.penState=new ox}reset(){this.uchar=" ",this.penState.reset()}setChar(t,e){this.uchar=t,this.penState.copy(e)}setPenState(t){this.penState.copy(t)}equals(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}copy(t){this.uchar=t.uchar,this.penState.copy(t.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class BC{constructor(t){this.chars=[],this.pos=0,this.currPenState=new ox,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<Os;e++)this.chars.push(new UC);this.logger=t}equals(t){for(let e=0;e<Os;e++)if(!this.chars[e].equals(t.chars[e]))return!1;return!0}copy(t){for(let e=0;e<Os;e++)this.chars[e].copy(t.chars[e])}isEmpty(){let t=!0;for(let e=0;e<Os;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}setCursor(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Os&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Os)}moveCursor(t){const e=this.pos+t;if(t>1)for(let i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(t){t>=144&&this.backSpace();const e=lx(t);if(this.pos>=Os){this.logger.log(0,()=>"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)}clearFromPos(t){let e;for(e=t;e<Os;e++)this.chars[e].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const t=[];let e=!0;for(let i=0;i<Os;i++){const s=this.chars[i].uchar;s!==" "&&(e=!1),t.push(s)}return e?"":t.join("")}setPenStyles(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)}}class cd{constructor(t){this.rows=[],this.currRow=Vi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let e=0;e<Vi;e++)this.rows.push(new BC(t));this.logger=t}reset(){for(let t=0;t<Vi;t++)this.rows[t].clear();this.currRow=Vi-1}equals(t){let e=!0;for(let i=0;i<Vi;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e}copy(t){for(let e=0;e<Vi;e++)this.rows[e].copy(t.rows[e])}isEmpty(){let t=!0;for(let e=0;e<Vi;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(t){this.rows[this.currRow].insertChar(t)}setPen(t){this.rows[this.currRow].setPenStyles(t)}moveCursor(t){this.rows[this.currRow].moveCursor(t)}setCursor(t){this.logger.log(2,"setCursor: "+t),this.rows[this.currRow].setCursor(t)}setPAC(t){this.logger.log(2,()=>"pacData = "+Wt(t));let e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(let c=0;c<Vi;c++)this.rows[c].clear();const r=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const c=o.rows[r].cueStartTime,h=this.logger.time;if(c!==null&&h!==null&&c<h)for(let f=0;f<this.nrRollUpRows;f++)this.rows[e-this.nrRollUpRows+f+1].copy(o.rows[r+f])}}this.currRow=e;const i=this.rows[this.currRow];if(t.indent!==null){const r=t.indent,o=Math.max(r-1,0);i.setCursor(t.indent),t.color=i.chars[o].penState.foreground}const s={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(t){this.logger.log(2,()=>"bkgData = "+Wt(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}setRollUpRows(t){this.nrRollUpRows=t}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}getDisplayText(t){t=t||!1;const e=[];let i="",s=-1;for(let r=0;r<Vi;r++){const o=this.rows[r].getTextString();o&&(s=r+1,t?e.push("Row "+s+": '"+o+"'"):e.push(o.trim()))}return e.length>0&&(t?i="["+e.join(" | ")+"]":i=e.join(`
`)),i}getTextAndFormat(){return this.rows}}class yE{constructor(t,e,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new cd(i),this.nonDisplayedMemory=new cd(i),this.lastOutputScreen=new cd(i),this.currRollUpRow=this.displayedMemory.rows[Vi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Vi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(t){this.outputFilter=t}setPAC(t){this.writeScreen.setPAC(t)}setBkgData(t){this.writeScreen.setBkgData(t)}setMode(t){t!==this.mode&&(this.mode=t,this.logger.log(2,()=>"MODE="+t),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}insertChars(t){for(let i=0;i<t.length;i++)this.writeScreen.insertChar(t[i]);const e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>e+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}ccMIDROW(t){const e={flash:!1};if(e.underline=t%2===1,e.italics=t>=46,e.italics)e.foreground="white";else{const i=Math.floor(t/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=s[i]}this.logger.log(2,"MIDROW: "+Wt(e)),this.writeScreen.setPen(e)}outputDataUpdate(t=!1){const e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}class vE{constructor(t,e,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=$C(),this.logger=void 0;const s=this.logger=new NC;this.channels=[null,new yE(t,e,s),new yE(t+1,i,s)]}getHandler(t){return this.channels[t].getHandler()}setHandler(t,e){this.channels[t].setHandler(e)}addData(t,e){this.logger.time=t;for(let i=0;i<e.length;i+=2){const s=e[i]&127,r=e[i+1]&127;let o=!1,c=null;if(s===0&&r===0)continue;this.logger.log(3,()=>"["+Zn([e[i],e[i+1]])+"] -> ("+Zn([s,r])+")");const h=this.cmdHistory;if(s>=16&&s<=31){if(FC(s,r,h)){Iu(null,null,h),this.logger.log(3,()=>"Repeated command ("+Zn([s,r])+") is dropped");continue}Iu(s,r,this.cmdHistory),o=this.parseCmd(s,r),o||(o=this.parseMidrow(s,r)),o||(o=this.parsePAC(s,r)),o||(o=this.parseBackgroundAttributes(s,r))}else Iu(null,null,h);if(!o&&(c=this.parseChars(s,r),c)){const g=this.currentChannel;g&&g>0?this.channels[g].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Zn([s,r])+" orig: "+Zn([e[i],e[i+1]]))}}parseCmd(t,e){const i=(t===20||t===28||t===21||t===29)&&e>=32&&e<=47,s=(t===23||t===31)&&e>=33&&e<=35;if(!(i||s))return!1;const r=t===20||t===21||t===23?1:2,o=this.channels[r];return t===20||t===21||t===28||t===29?e===32?o.ccRCL():e===33?o.ccBS():e===34?o.ccAOF():e===35?o.ccAON():e===36?o.ccDER():e===37?o.ccRU(2):e===38?o.ccRU(3):e===39?o.ccRU(4):e===40?o.ccFON():e===41?o.ccRDC():e===42?o.ccTR():e===43?o.ccRTD():e===44?o.ccEDM():e===45?o.ccCR():e===46?o.ccENM():e===47&&o.ccEOC():o.ccTO(e-32),this.currentChannel=r,!0}parseMidrow(t,e){let i=0;if((t===17||t===25)&&e>=32&&e<=47){if(t===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[i];return s?(s.ccMIDROW(e),this.logger.log(3,()=>"MIDROW ("+Zn([t,e])+")"),!0):!1}return!1}parsePAC(t,e){let i;const s=(t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127,r=(t===16||t===24)&&e>=64&&e<=95;if(!(s||r))return!1;const o=t<=23?1:2;e>=64&&e<=95?i=o===1?OC[t]:kC[t]:i=o===1?wC[t]:MC[t];const c=this.channels[o];return c?(c.setPAC(this.interpretPAC(i,e)),this.currentChannel=o,!0):!1}interpretPAC(t,e){let i;const s={color:null,italics:!1,indent:null,underline:!1,row:t};return e>95?i=e-96:i=e-64,s.underline=(i&1)===1,i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((i-16)/2)*4,s}parseChars(t,e){let i,s=null,r=null;if(t>=25?(i=2,r=t-8):(i=1,r=t),r>=17&&r<=19){let o;r===17?o=e+80:r===18?o=e+112:o=e+144,this.logger.log(2,()=>"Special char '"+lx(o)+"' in channel "+i),s=[o]}else t>=32&&t<=127&&(s=e===0?[t]:[t,e]);return s&&this.logger.log(3,()=>"Char codes =  "+Zn(s).join(",")),s}parseBackgroundAttributes(t,e){const i=(t===16||t===24)&&e>=32&&e<=47,s=(t===23||t===31)&&e>=45&&e<=47;if(!(i||s))return!1;let r;const o={};t===16||t===24?(r=Math.floor((e-32)/2),o.background=PC[r],e%2===1&&(o.background=o.background+"_semi")):e===45?o.background="transparent":(o.foreground="black",e===47&&(o.underline=!0));const c=t<=23?1:2;return this.channels[c].setBkgData(o),!0}reset(){for(let t=0;t<Object.keys(this.channels).length;t++){const e=this.channels[t];e&&e.reset()}Iu(null,null,this.cmdHistory)}cueSplitAtTime(t){for(let e=0;e<this.channels.length;e++){const i=this.channels[e];i&&i.cueSplitAtTime(t)}}}function Iu(l,t,e){e.a=l,e.b=t}function FC(l,t,e){return e.a===l&&e.b===t}function $C(){return{a:null,b:null}}var Yg=function(){if(lc!=null&&lc.VTTCue)return self.VTTCue;const l=["","lr","rl"],t=["start","middle","end","left","right"];function e(c,h){if(typeof h!="string"||!Array.isArray(c))return!1;const f=h.toLowerCase();return~c.indexOf(f)?f:!1}function i(c){return e(l,c)}function s(c){return e(t,c)}function r(c,...h){let f=1;for(;f<arguments.length;f++){const g=arguments[f];for(const m in g)c[m]=g[m]}return c}function o(c,h,f){const g=this,m={enumerable:!0};g.hasBeenReset=!1;let y="",v=!1,T=c,S=h,x=f,_=null,L="",R=!0,C="auto",I="start",U=50,O="middle",M=50,w="middle";Object.defineProperty(g,"id",r({},m,{get:function(){return y},set:function(N){y=""+N}})),Object.defineProperty(g,"pauseOnExit",r({},m,{get:function(){return v},set:function(N){v=!!N}})),Object.defineProperty(g,"startTime",r({},m,{get:function(){return T},set:function(N){if(typeof N!="number")throw new TypeError("Start time must be set to a number.");T=N,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",r({},m,{get:function(){return S},set:function(N){if(typeof N!="number")throw new TypeError("End time must be set to a number.");S=N,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",r({},m,{get:function(){return x},set:function(N){x=""+N,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",r({},m,{get:function(){return _},set:function(N){_=N,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",r({},m,{get:function(){return L},set:function(N){const z=i(N);if(z===!1)throw new SyntaxError("An invalid or illegal string was specified.");L=z,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",r({},m,{get:function(){return R},set:function(N){R=!!N,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",r({},m,{get:function(){return C},set:function(N){if(typeof N!="number"&&N!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");C=N,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",r({},m,{get:function(){return I},set:function(N){const z=s(N);if(!z)throw new SyntaxError("An invalid or illegal string was specified.");I=z,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",r({},m,{get:function(){return U},set:function(N){if(N<0||N>100)throw new Error("Position must be between 0 and 100.");U=N,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",r({},m,{get:function(){return O},set:function(N){const z=s(N);if(!z)throw new SyntaxError("An invalid or illegal string was specified.");O=z,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",r({},m,{get:function(){return M},set:function(N){if(N<0||N>100)throw new Error("Size must be between 0 and 100.");M=N,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",r({},m,{get:function(){return w},set:function(N){const z=s(N);if(!z)throw new SyntaxError("An invalid or illegal string was specified.");w=z,this.hasBeenReset=!0}})),g.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class GC{decode(t,e){if(!t)return"";if(typeof t!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}function ux(l){function t(i,s,r,o){return(i|0)*3600+(s|0)*60+(r|0)+parseFloat(o||0)}const e=l.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?t(e[2],e[3],0,e[4]):t(e[1],e[2],e[3],e[4]):null}class HC{constructor(){this.values=Object.create(null)}set(t,e){!this.get(t)&&e!==""&&(this.values[t]=e)}get(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e}has(t){return t in this.values}alt(t,e,i){for(let s=0;s<i.length;++s)if(e===i[s]){this.set(t,e);break}}integer(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))}percent(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){const i=parseFloat(e);if(i>=0&&i<=100)return this.set(t,i),!0}return!1}}function cx(l,t,e,i){const s=i?l.split(i):[l];for(const r in s){if(typeof s[r]!="string")continue;const o=s[r].split(e);if(o.length!==2)continue;const c=o[0],h=o[1];t(c,h)}}const Wd=new Yg(0,0,""),Cu=Wd.align==="middle"?"middle":"center";function VC(l,t,e){const i=l;function s(){const c=ux(l);if(c===null)throw new Error("Malformed timestamp: "+i);return l=l.replace(/^[^\sa-zA-Z-]+/,""),c}function r(c,h){const f=new HC;cx(c,function(y,v){let T;switch(y){case"region":for(let S=e.length-1;S>=0;S--)if(e[S].id===v){f.set(y,e[S].region);break}break;case"vertical":f.alt(y,v,["rl","lr"]);break;case"line":T=v.split(","),f.integer(y,T[0]),f.percent(y,T[0])&&f.set("snapToLines",!1),f.alt(y,T[0],["auto"]),T.length===2&&f.alt("lineAlign",T[1],["start",Cu,"end"]);break;case"position":T=v.split(","),f.percent(y,T[0]),T.length===2&&f.alt("positionAlign",T[1],["start",Cu,"end","line-left","line-right","auto"]);break;case"size":f.percent(y,v);break;case"align":f.alt(y,v,["start",Cu,"end","left","right"]);break}},/:/,/\s/),h.region=f.get("region",null),h.vertical=f.get("vertical","");let g=f.get("line","auto");g==="auto"&&Wd.line===-1&&(g=-1),h.line=g,h.lineAlign=f.get("lineAlign","start"),h.snapToLines=f.get("snapToLines",!0),h.size=f.get("size",100),h.align=f.get("align",Cu);let m=f.get("position","auto");m==="auto"&&Wd.position===50&&(m=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=m}function o(){l=l.replace(/^\s+/,"")}if(o(),t.startTime=s(),o(),l.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);l=l.slice(3),o(),t.endTime=s(),o(),r(l,t)}function fx(l){return l.replace(/<br(?: \/)?>/gi,`
`)}class KC{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new GC,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(t){const e=this;t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));function i(){let r=e.buffer,o=0;for(r=fx(r);o<r.length&&r[o]!=="\r"&&r[o]!==`
`;)++o;const c=r.slice(0,o);return r[o]==="\r"&&++o,r[o]===`
`&&++o,e.buffer=r.slice(o),c}function s(r){cx(r,function(o,c){},/:/)}try{let r="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;r=i();const c=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");e.state="HEADER"}let o=!1;for(;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(o?o=!1:r=i(),e.state){case"HEADER":/:/.test(r)?s(r):r||(e.state="ID");continue;case"NOTE":r||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){e.state="NOTE";break}if(!r)continue;if(e.cue=new Yg(0,0,""),e.state="CUE",r.indexOf("-->")===-1){e.cue.id=r;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{VC(r,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{const c=r.indexOf("-->")!==-1;if(!r||c&&(o=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=r}continue;case"BADCUE":r||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const t=this;try{if((t.cue||t.state==="HEADER")&&(t.buffer+=`

`,t.parse()),t.state==="INITIAL"||t.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this}}const zC=/\r\n|\n\r|\n|\r/g,fd=function(t,e,i=0){return t.slice(i,i+e.length)===e},YC=function(t){let e=parseInt(t.slice(-3));const i=parseInt(t.slice(-6,-4)),s=parseInt(t.slice(-9,-7)),r=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!dt(e)||!dt(i)||!dt(s)||!dt(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${t}`);return e+=1e3*i,e+=60*1e3*s,e+=3600*1e3*r,e};function jg(l,t,e){return Ml(l.toString())+Ml(t.toString())+Ml(e)}const jC=function(t,e,i){let s=t[e],r=t[s.prevCC];if(!r||!r.new&&s.new){t.ccOffset=t.presentationOffset=s.start,s.new=!1;return}for(;(o=r)!=null&&o.new;){var o;t.ccOffset+=s.start-r.start,s.new=!1,s=r,r=t[s.prevCC]}t.presentationOffset=i};function qC(l,t,e,i,s,r,o){const c=new KC,h=yi(new Uint8Array(l)).trim().replace(zC,`
`).split(`
`),f=[],g=t?eI(t.baseTime,t.timescale):0;let m="00:00.000",y=0,v=0,T,S=!0;c.oncue=function(x){const _=e[i];let L=e.ccOffset;const R=(y-g)/9e4;if(_!=null&&_.new&&(v!==void 0?L=e.ccOffset=_.start:jC(e,i,R)),R){if(!t){T=new Error("Missing initPTS for VTT MPEGTS");return}L=R-e.presentationOffset}const C=x.endTime-x.startTime,I=wi((x.startTime+L-v)*9e4,s*9e4)/9e4;x.startTime=Math.max(I,0),x.endTime=Math.max(I+C,0);const U=x.text.trim();x.text=decodeURIComponent(encodeURIComponent(U)),x.id||(x.id=jg(x.startTime,x.endTime,U)),x.endTime>0&&f.push(x)},c.onparsingerror=function(x){T=x},c.onflush=function(){if(T){o(T);return}r(f)},h.forEach(x=>{if(S)if(fd(x,"X-TIMESTAMP-MAP=")){S=!1,x.slice(16).split(",").forEach(_=>{fd(_,"LOCAL:")?m=_.slice(6):fd(_,"MPEGTS:")&&(y=parseInt(_.slice(7)))});try{v=YC(m)/1e3}catch(_){T=_}return}else x===""&&(S=!1);c.parse(x+`
`)}),c.flush()}const hd="stpp.ttml.im1t",hx=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,dx=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,XC={left:"start",center:"center",right:"end",start:"start",end:"end"};function EE(l,t,e,i){const s=Rt(new Uint8Array(l),["mdat"]);if(s.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const r=s.map(c=>yi(c)),o=tI(t.baseTime,1,t.timescale);try{r.forEach(c=>e(QC(c,o)))}catch(c){i(c)}}function QC(l,t){const s=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(r).reduce((m,y)=>(m[y]=s.getAttribute(`ttp:${y}`)||r[y],m),{}),c=s.getAttribute("xml:space")!=="preserve",h=TE(dd(s,"styling","style")),f=TE(dd(s,"layout","region")),g=dd(s,"body","[begin]");return[].map.call(g,m=>{const y=gx(m,c);if(!y||!m.hasAttribute("begin"))return null;const v=md(m.getAttribute("begin"),o),T=md(m.getAttribute("dur"),o);let S=md(m.getAttribute("end"),o);if(v===null)throw SE(m);if(S===null){if(T===null)throw SE(m);S=v+T}const x=new Yg(v-t,S-t,y);x.id=jg(x.startTime,x.endTime,x.text);const _=f[m.getAttribute("region")],L=h[m.getAttribute("style")],R=WC(_,L,h),{textAlign:C}=R;if(C){const I=XC[C];I&&(x.lineAlign=I),x.align=C}return Kt(x,R),x}).filter(m=>m!==null)}function dd(l,t,e){const i=l.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(e)):[]}function TE(l){return l.reduce((t,e)=>{const i=e.getAttribute("xml:id");return i&&(t[i]=e),t},{})}function gx(l,t){return[].slice.call(l.childNodes).reduce((e,i,s)=>{var r;return i.nodeName==="br"&&s?e+`
`:(r=i.childNodes)!=null&&r.length?gx(i,t):t?e+i.textContent.trim().replace(/\s+/g," "):e+i.textContent},"")}function WC(l,t,e){const i="http://www.w3.org/ns/ttml#styling";let s=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=l!=null&&l.hasAttribute("style")?l.getAttribute("style"):null;return o&&e.hasOwnProperty(o)&&(s=e[o]),r.reduce((c,h)=>{const f=gd(t,i,h)||gd(l,i,h)||gd(s,i,h);return f&&(c[h]=f),c},{})}function gd(l,t,e){return l&&l.hasAttributeNS(t,e)?l.getAttributeNS(t,e):null}function SE(l){return new Error(`Could not parse ttml timestamp ${l}`)}function md(l,t){if(!l)return null;let e=ux(l);return e===null&&(hx.test(l)?e=ZC(l,t):dx.test(l)&&(e=JC(l,t))),e}function ZC(l,t){const e=hx.exec(l),i=(e[4]|0)+(e[5]|0)/t.subFrameRate;return(e[1]|0)*3600+(e[2]|0)*60+(e[3]|0)+i/t.frameRate}function JC(l,t){const e=dx.exec(l),i=Number(e[1]);switch(e[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}class Ou{constructor(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(t,e,i){(this.startTime===null||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class tO{constructor(t){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=_E(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},t.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(A.FRAG_LOADING,this.onFragLoading,this),t.on(A.FRAG_LOADED,this.onFragLoaded,this),t.on(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(A.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:t}=this;t.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(A.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(A.FRAG_LOADING,this.onFragLoading,this),t.off(A.FRAG_LOADED,this.onFragLoaded,this),t.off(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(A.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const t=new Ou(this,"textTrack1"),e=new Ou(this,"textTrack2"),i=new Ou(this,"textTrack3"),s=new Ou(this,"textTrack4");this.cea608Parser1=new vE(1,t,e),this.cea608Parser2=new vE(3,i,s)}addCues(t,e,i,s,r){let o=!1;for(let c=r.length;c--;){const h=r[c],f=eO(h[0],h[1],e,i);if(f>=0&&(h[0]=Math.min(h[0],e),h[1]=Math.max(h[1],i),o=!0,f/(i-e)>.5))return}if(o||r.push([e,i]),this.config.renderTextTracksNatively){const c=this.captionsTracks[t];this.Cues.newCue(c,e,i,s)}else{const c=this.Cues.newCue(null,e,i,s);this.hls.trigger(A.CUES_PARSED,{type:"captions",cues:c,track:t})}}onInitPtsFound(t,{frag:e,id:i,initPTS:s,timescale:r,trackId:o}){const{unparsedVttFrags:c}=this;i===mt.MAIN&&(this.initPTS[e.cc]={baseTime:s,timescale:r,trackId:o}),c.length&&(this.unparsedVttFrags=[],c.forEach(h=>{this.initPTS[h.frag.cc]?this.onFragLoaded(A.FRAG_LOADED,h):this.hls.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(t,e){const{media:i}=this;if(i)for(let s=0;s<i.textTracks.length;s++){const r=i.textTracks[s];if(xE(r,{name:t,lang:e,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)}createNativeTrack(t){if(this.captionsTracks[t])return;const{captionsProperties:e,captionsTracks:i,media:s}=this,{label:r,languageCode:o}=e[t],c=this.getExistingTrack(r,o);if(c)i[t]=c,aa(i[t]),nx(i[t],s);else{const h=this.createTextTrack("captions",r,o);h&&(h[t]=!0,i[t]=h)}}createNonNativeTrack(t){if(this.nonNativeCaptionsTracks[t])return;const e=this.captionsProperties[t];if(!e)return;const i=e.label,s={_id:t,label:i,kind:"captions",default:e.media?!!e.media.default:!1,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=s,this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(t,e,i){const s=this.media;if(s)return s.addTextTrack(t,e,i)}onMediaAttaching(t,e){this.media=e.media,e.mediaSource||this._cleanTracks()}onMediaDetaching(t,e){const i=!!e.transferMedia;if(this.media=null,i)return;const{captionsTracks:s}=this;Object.keys(s).forEach(r=>{aa(s[r]),delete s[r]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=_E(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:t}=this;if(!t)return;const e=t.textTracks;if(e)for(let i=0;i<e.length;i++)aa(e[i])}onSubtitleTracksUpdated(t,e){const i=e.subtitleTracks||[],s=i.some(r=>r.textCodec===hd);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(zS(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const o=this.media,c=o?zu(o.textTracks):null;if(this.tracks.forEach((h,f)=>{let g;if(c){let m=null;for(let y=0;y<c.length;y++)if(c[y]&&xE(c[y],h)){m=c[y],c[y]=null;break}m&&(g=m)}if(g)aa(g);else{const m=mx(h);g=this.createTextTrack(m,h.name,h.lang),g&&(g.mode="disabled")}g&&this.textTracks.push(g)}),c!=null&&c.length){const h=c.filter(f=>f!==null).map(f=>f.label);h.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${h.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(t,e){this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(i=>{const s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!s)return;const r=`textTrack${s[1]}`,o=this.captionsProperties[r];o&&(o.label=i.name,i.lang&&(o.languageCode=i.lang),o.media=i)})}closedCaptionsForLevel(t){const e=this.hls.levels[t.level];return e?.attrs["CLOSED-CAPTIONS"]}onFragLoading(t,e){if(this.enabled&&e.frag.type===mt.MAIN){var i,s;const{cea608Parser1:r,cea608Parser2:o,lastSn:c}=this,{cc:h,sn:f}=e.frag,g=(i=(s=e.part)==null?void 0:s.index)!=null?i:-1;r&&o&&(f!==c+1||f===c&&g!==this.lastPartIndex+1||h!==this.lastCc)&&(r.reset(),o.reset()),this.lastCc=h,this.lastSn=f,this.lastPartIndex=g}}onFragLoaded(t,e){const{frag:i,payload:s}=e;if(i.type===mt.SUBTITLE)if(s.byteLength){const r=i.decryptdata,o="stats"in e;if(r==null||!r.encrypted||o){const c=this.tracks[i.level],h=this.vttCCs;h[i.cc]||(h[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),c&&c.textCodec===hd?this._parseIMSC1(i,s):this._parseVTTs(e)}}else this.hls.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(t,e){const i=this.hls;EE(e,this.initPTS[t.cc],s=>{this._appendCues(s,t.level),i.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},s=>{i.logger.log(`Failed to parse IMSC1: ${s}`),i.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:s})})}_parseVTTs(t){var e;const{frag:i,payload:s}=t,{initPTS:r,unparsedVttFrags:o}=this,c=r.length-1;if(!r[i.cc]&&c===-1){o.push(t);return}const h=this.hls,f=(e=i.initSegment)!=null&&e.data?Ui(i.initSegment.data,new Uint8Array(s)).buffer:s;qC(f,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,g=>{this._appendCues(g,i.level),h.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},g=>{const m=g.message==="Missing initPTS for VTT MPEGTS";m?o.push(t):this._fallbackToIMSC1(i,s),h.logger.log(`Failed to parse VTT cue: ${g}`),!(m&&c>i.cc)&&h.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:g})})}_fallbackToIMSC1(t,e){const i=this.tracks[t.level];i.textCodec||EE(e,this.initPTS[t.cc],()=>{i.textCodec=hd,this._parseIMSC1(t,e)},()=>{i.textCodec="wvtt"})}_appendCues(t,e){const i=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[e];if(!s||s.mode==="disabled")return;t.forEach(r=>rx(s,r))}else{const s=this.tracks[e];if(!s)return;const r=s.default?"default":"subtitles"+e;i.trigger(A.CUES_PARSED,{type:"subtitles",cues:t,track:r})}}onFragDecrypted(t,e){const{frag:i}=e;i.type===mt.SUBTITLE&&this.onFragLoaded(A.FRAG_LOADED,e)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(t,e){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:s}=e;if(!(i.type===mt.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let r=0;r<s.length;r++){const o=s[r].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const c=this.extractCea608Data(o);this.cea608Parser1.addData(s[r].pts,c[0]),this.cea608Parser2.addData(s[r].pts,c[1])}}}onBufferFlushing(t,{startOffset:e,endOffset:i,endOffsetSubtitles:s,type:r}){const{media:o}=this;if(!(!o||o.currentTime<i)){if(!r||r==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(h=>Qd(c[h],e,i))}if(this.config.renderTextTracksNatively&&e===0&&s!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(h=>Qd(c[h],e,s))}}}extractCea608Data(t){const e=[[],[]],i=t[0]&31;let s=2;for(let r=0;r<i;r++){const o=t[s++],c=127&t[s++],h=127&t[s++];if(c===0&&h===0)continue;if((4&o)!==0){const g=3&o;(g===0||g===1)&&(e[g].push(c),e[g].push(h))}}return e}}function mx(l){return l.characteristics&&/transcribes-spoken-dialog/gi.test(l.characteristics)&&/describes-music-and-sound/gi.test(l.characteristics)?"captions":"subtitles"}function xE(l,t){return!!l&&l.kind===mx(t)&&Yd(t,l)}function eO(l,t,e,i){return Math.min(t,i)-Math.max(l,e)}function _E(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const iO=/\s/,sO={newCue(l,t,e,i){const s=[];let r,o,c,h,f;const g=self.VTTCue||self.TextTrackCue;for(let y=0;y<i.rows.length;y++)if(r=i.rows[y],c=!0,h=0,f="",!r.isEmpty()){var m;for(let S=0;S<r.chars.length;S++)iO.test(r.chars[S].uchar)&&c?h++:(f+=r.chars[S].uchar,c=!1);r.cueStartTime=t,t===e&&(e+=1e-4),h>=16?h--:h++;const v=fx(f.trim()),T=jg(t,e,v);l!=null&&(m=l.cues)!=null&&m.getCueById(T)||(o=new g(t,e,v),o.id=T,o.line=y+1,o.align="left",o.position=10+Math.min(80,Math.floor(h*8/32)*10),s.push(o))}return l&&s.length&&(s.sort((y,v)=>y.line==="auto"||v.line==="auto"?0:y.line>8&&v.line>8?v.line-y.line:y.line-v.line),s.forEach(y=>rx(l,y))),s}};function nO(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const rO=/(\d+)-(\d+)\/(\d+)/;class AE{constructor(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||uO,this.controller=new self.AbortController,this.stats=new bg}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(t,e,i){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const r=aO(t,this.controller.signal),o=t.responseType==="arraybuffer",c=o?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:f}=e.loadPolicy;this.context=t,this.config=e,this.callbacks=i,this.request=this.fetchSetup(t,r),self.clearTimeout(this.requestTimeout),e.timeout=h&&dt(h)?h:f,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,t,this.response))},e.timeout),(ql(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(m=>{var y;this.response=this.loader=m;const v=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),e.timeout=f,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,t,this.response))},f-(v-s.loading.start)),!m.ok){const{status:S,statusText:x}=m;throw new cO(x||"fetch, bad network response",S,m)}s.loading.first=v,s.total=oO(m.headers)||s.total;const T=(y=this.callbacks)==null?void 0:y.onProgress;return T&&dt(e.highWaterMark)?this.loadProgressively(m,s,t,e.highWaterMark,T):o?m.arrayBuffer():t.responseType==="json"?m.json():m.text()}).then(m=>{var y,v;const T=this.response;if(!T)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const S=m[c];S&&(s.loaded=s.total=S);const x={url:T.url,data:m,code:T.status},_=(y=this.callbacks)==null?void 0:y.onProgress;_&&!dt(e.highWaterMark)&&_(s,t,m,T),(v=this.callbacks)==null||v.onSuccess(x,s,t,T)}).catch(m=>{var y;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const v=m&&m.code||0,T=m?m.message:null;(y=this.callbacks)==null||y.onError({code:v,text:T},t,m?m.details:null,s)})}getCacheAge(){let t=null;if(this.response){const e=this.response.headers.get("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.response?this.response.headers.get(t):null}loadProgressively(t,e,i,s=0,r){const o=new bS,c=t.body.getReader(),h=()=>c.read().then(f=>{if(f.done)return o.dataLength&&r(e,i,o.flush().buffer,t),Promise.resolve(new ArrayBuffer(0));const g=f.value,m=g.length;return e.loaded+=m,m<s||o.dataLength?(o.push(g),o.dataLength>=s&&r(e,i,o.flush().buffer,t)):r(e,i,g.buffer,t),h()}).catch(()=>Promise.reject());return h()}}function aO(l,t){const e={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(Kt({},l.headers))};return l.rangeEnd&&e.headers.set("Range","bytes="+l.rangeStart+"-"+String(l.rangeEnd-1)),e}function lO(l){const t=rO.exec(l);if(t)return parseInt(t[2])-parseInt(t[1])+1}function oO(l){const t=l.get("Content-Range");if(t){const i=lO(t);if(dt(i))return i}const e=l.get("Content-Length");if(e)return parseInt(e)}function uO(l,t){return new self.Request(l.url,t)}class cO extends Error{constructor(t,e,i){super(t),this.code=void 0,this.details=void 0,this.code=e,this.details=i}}const fO=/^age:\s*[\d.]+\s*$/im;class px{constructor(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new bg,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,t.readyState!==4&&(this.stats.aborted=!0,t.abort()))}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(t,e,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:t,context:e}=this;if(!t||!e)return;const i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return r(i,e.url)}).catch(o=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",e.url,!0),r(i,e.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,e,t)}).catch(o=>{var c;(c=this.callbacks)==null||c.onError({code:i.status,text:o.message},e,i,s)}):this.openAndSendXhr(i,e,t)}openAndSendXhr(t,e,i){t.readyState||t.open("GET",e.url,!0);const s=e.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:o}=i.loadPolicy;if(s)for(const c in s)t.setRequestHeader(c,s[c]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),i.timeout=r&&dt(r)?r:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),t.send()}readystatechange(){const{context:t,loader:e,stats:i}=this;if(!t||!e)return;const s=e.readyState,r=this.config;if(!i.aborted&&s>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;const f=e.status,g=e.responseType==="text"?e.responseText:null;if(f>=200&&f<300){const T=g??e.response;if(T!=null){var o,c;i.loading.end=Math.max(self.performance.now(),i.loading.first);const S=e.responseType==="arraybuffer"?T.byteLength:T.length;i.loaded=i.total=S,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const x=(o=this.callbacks)==null?void 0:o.onProgress;x&&x(i,t,T,e);const _={url:e.responseURL,data:T,code:f};(c=this.callbacks)==null||c.onSuccess(_,i,t,e);return}}const m=r.loadPolicy.errorRetry,y=i.retry,v={url:t.url,data:void 0,code:f};if(ac(m,y,!1,v))this.retry(m);else{var h;Ft.error(`${f} while loading ${t.url}`),(h=this.callbacks)==null||h.onError({code:f,text:e.statusText},t,e,i)}}}loadtimeout(){if(!this.config)return;const t=this.config.loadPolicy.timeoutRetry,e=this.stats.retry;if(ac(t,e,!0))this.retry(t);else{var i;Ft.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(t){const{context:e,stats:i}=this;this.retryDelay=Ig(t,i.retry),i.retry++,Ft.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${e?.url}, retrying ${i.retry}/${t.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(t){const e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)}getCacheAge(){let t=null;if(this.loader&&fO.test(this.loader.getAllResponseHeaders())){const e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.loader&&new RegExp(`^${t}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null}}const hO={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},dO=Vt(Vt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:px,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:bL,bufferController:pI,capLevelController:Vg,errorController:CL,fpsController:pC,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:mS,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:hO},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},gO()),{},{subtitleStreamController:DC,subtitleTrackController:EC,timelineController:tO,audioStreamController:hI,audioTrackController:dI,emeController:fa,cmcdController:dC,contentSteeringController:mC,interstitialsController:LC});function gO(){return{cueHandler:sO,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mO(l,t,e){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(t.liveMaxLatencyDurationCount!==void 0&&(t.liveSyncDurationCount===void 0||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(t.liveMaxLatencyDuration!==void 0&&(t.liveSyncDuration===void 0||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=Zd(l),s=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(o=>{const c=`${o==="level"?"playlist":o}LoadPolicy`,h=t[c]===void 0,f=[];r.forEach(g=>{const m=`${o}Loading${g}`,y=t[m];if(y!==void 0&&h){f.push(m);const v=i[c].default;switch(t[c]={default:v},g){case"TimeOut":v.maxLoadTimeMs=y,v.maxTimeToFirstByteMs=y;break;case"MaxRetry":v.errorRetry.maxNumRetry=y,v.timeoutRetry.maxNumRetry=y;break;case"RetryDelay":v.errorRetry.retryDelayMs=y,v.timeoutRetry.retryDelayMs=y;break;case"MaxRetryTimeout":v.errorRetry.maxRetryDelayMs=y,v.timeoutRetry.maxRetryDelayMs=y;break}}}),f.length&&e.warn(`hls.js config: "${f.join('", "')}" setting(s) are deprecated, use "${c}": ${Wt(t[c])}`)}),Vt(Vt({},i),t)}function Zd(l){return l&&typeof l=="object"?Array.isArray(l)?l.map(Zd):Object.keys(l).reduce((t,e)=>(t[e]=Zd(l[e]),t),{}):l}function pO(l,t){const e=l.loader;e!==AE&&e!==px?(t.log("[config]: Custom loader detected, cannot enable progressive streaming"),l.progressive=!1):nO()&&(l.loader=AE,l.progressive=!0,l.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Yu=2,yO=.1,vO=.05,EO=100;class TO extends hS{constructor(t,e){super("gap-controller",t.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!1})}},this.hls=t,this.fragmentTracker=e,this.registerListeners()}registerListeners(){const{hls:t}=this;t&&(t.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(A.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:t}=this;t&&(t.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(A.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(t,e){this.setInterval(EO),this.mediaSource=e.mediaSource;const i=this.media=e.media;mi(i,"playing",this.onMediaPlaying),mi(i,"waiting",this.onMediaWaiting),mi(i,"ended",this.onMediaEnded)}onMediaDetaching(t,e){this.clearInterval();const{media:i}=this;i&&(Ni(i,"playing",this.onMediaPlaying),Ni(i,"waiting",this.onMediaWaiting),Ni(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(t,e){this.buffered=e.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var t;if(!((t=this.media)!=null&&t.readyState)||!this.hasBuffered)return;const e=this.media.currentTime;this.poll(e,this.lastCurrentTime),this.lastCurrentTime=e}poll(t,e){var i,s;const r=(i=this.hls)==null?void 0:i.config;if(!r)return;const o=this.media;if(!o)return;const{seeking:c}=o,h=this.seeking&&!c,f=!this.seeking&&c,g=o.paused&&!c||o.ended||o.playbackRate===0;if(this.seeking=c,t!==e){e&&(this.ended=0),this.moved=!0,c||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!g&&t>e&&this.nudgeOnVideoHole(t,e)),this.waiting===0&&this.stallResolved(t);return}if(f||h){h&&this.stallResolved(t);return}if(g){this.nudgeRetry=0,this.stallResolved(t),!this.ended&&o.ended&&this.hls&&(this.ended=t||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!1}));return}if(!xt.getBuffered(o).length){this.nudgeRetry=0;return}const m=xt.bufferInfo(o,t,0),y=m.nextStart||0,v=this.fragmentTracker;if(c&&v&&this.hls){const U=bE(this.hls.inFlightFragments,t),O=m.len>Yu,M=!y||U||y-t>Yu&&!v.getPartialFragment(t);if(O||M)return;this.moved=!1}const T=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&v){if(!(m.len>0)&&!y)return;const O=Math.max(y,m.start||0)-t,w=!!(T!=null&&T.live)?T.targetduration*2:Yu,N=wu(t,v);if(O>0&&(O<=w||N)){o.paused||this._trySkipBufferHole(N);return}}const S=r.detectStallWithCurrentTimeMs,x=self.performance.now(),_=this.waiting;let L=this.stalled;if(L===null)if(_>0&&x-_<S)L=this.stalled=_;else{this.stalled=x;return}const R=x-L;if(!c&&(R>=S||_)&&this.hls){var C;if(((C=this.mediaSource)==null?void 0:C.readyState)==="ended"&&!(T!=null&&T.live)&&Math.abs(t-(T?.edge||0))<1){if(this.ended)return;this.ended=t||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(m),!this.media||!this.hls)return}const I=xt.bufferInfo(o,t,r.maxBufferHole);this._tryFixBufferStall(I,R,t)}stallResolved(t){const e=this.stalled;if(e&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-e;this.log(`playback not stuck anymore @${t}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(A.STALL_RESOLVED,{})}}nudgeOnVideoHole(t,e){var i;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&s&&s.length>1&&t>s.end(0)){const r=xt.bufferedInfo(xt.timeRangesToArray(this.buffered.audio),t,0);if(r.len>1&&e>=r.start){const o=xt.timeRangesToArray(s),c=xt.bufferedInfo(o,e,0).bufferedIndex;if(c>-1&&c<o.length-1){const h=xt.bufferedInfo(o,t,0).bufferedIndex,f=o[c].end,g=o[c+1].start;if((h===-1||h>c)&&g-f<1&&t-f<2){const m=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${t} hole: ${f} -> ${g} buffered index: ${h}`);this.warn(m.message),this.media.currentTime+=1e-6;let y=wu(t,this.fragmentTracker);y&&"fragment"in y?y=y.fragment:y||(y=void 0);const v=xt.bufferInfo(this.media,t,0);this.hls.trigger(A.ERROR,{type:pt.MEDIA_ERROR,details:K.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,frag:y,buffer:v.len,bufferInfo:v})}}}}}_tryFixBufferStall(t,e,i){var s,r;const{fragmentTracker:o,media:c}=this,h=(s=this.hls)==null?void 0:s.config;if(!c||!o||!h)return;const f=(r=this.hls)==null?void 0:r.latestLevelDetails,g=wu(i,o);if((g||f!=null&&f.live&&i<f.fragmentStart)&&(this._trySkipBufferHole(g)||!this.media))return;const m=t.buffered,y=this.adjacentTraversal(t,i);(m&&m.length>1&&t.len>h.maxBufferHole||t.nextStart&&(t.nextStart-i<h.maxBufferHole||y))&&(e>h.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(t))}adjacentTraversal(t,e){const i=this.fragmentTracker,s=t.nextStart;if(i&&s){const r=i.getFragAtPos(e,mt.MAIN),o=i.getFragAtPos(s,mt.MAIN);if(r&&o)return o.sn-r.sn<2}return!1}_reportStall(t){const{hls:e,media:i,stallReported:s,stalled:r}=this;if(!s&&r!==null&&i&&e){this.stallReported=!0;const o=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${Wt(t)})`);this.warn(o.message),e.trigger(A.ERROR,{type:pt.MEDIA_ERROR,details:K.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:t.len,bufferInfo:t,stalled:{start:r}})}}_trySkipBufferHole(t){var e;const{fragmentTracker:i,media:s}=this,r=(e=this.hls)==null?void 0:e.config;if(!s||!i||!r)return 0;const o=s.currentTime,c=xt.bufferInfo(s,o,0),h=o<c.start?c.start:c.nextStart;if(h&&this.hls){const g=c.len<=r.maxBufferHole,m=c.len>0&&c.len<1&&s.readyState<3,y=h-o;if(y>0&&(g||m)){if(y>r.maxBufferHole){let T=!1;if(o===0){const S=i.getAppendedFrag(0,mt.MAIN);S&&h<S.end&&(T=!0)}if(!T&&t){var f;if(!((f=this.hls.loadLevelObj)!=null&&f.details)||bE(this.hls.inFlightFragments,h))return 0;let x=!1,_=t.end;for(;_<h;){const L=wu(_,i);if(L)_+=L.duration;else{x=!0;break}}if(x)return 0}}const v=Math.max(h+vO,o+yO);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${v}`),this.moved=!0,s.currentTime=v,!(t!=null&&t.gap)){const T=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${v}`),S={type:pt.MEDIA_ERROR,details:K.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:T,reason:T.message,buffer:c.len,bufferInfo:c};t&&("fragment"in t?S.part=t:S.frag=t),this.hls.trigger(A.ERROR,S)}return v}}return 0}_tryNudgeBuffer(t){const{hls:e,media:i,nudgeRetry:s}=this,r=e?.config;if(!i||!r)return 0;const o=i.currentTime;if(this.nudgeRetry++,s<r.nudgeMaxRetry){const c=o+(s+1)*r.nudgeOffset,h=new Error(`Nudging 'currentTime' from ${o} to ${c}`);this.warn(h.message),i.currentTime=c,e.trigger(A.ERROR,{type:pt.MEDIA_ERROR,details:K.BUFFER_NUDGE_ON_STALL,error:h,fatal:!1,buffer:t.len,bufferInfo:t})}else{const c=new Error(`Playhead still not moving while enough data buffered @${o} after ${r.nudgeMaxRetry} nudges`);this.error(c.message),e.trigger(A.ERROR,{type:pt.MEDIA_ERROR,details:K.BUFFER_STALLED_ERROR,error:c,fatal:!0,buffer:t.len,bufferInfo:t})}}}function bE(l,t){const e=RE(l.main);if(e&&e.start<=t)return e;const i=RE(l.audio);return i&&i.start<=t?i:null}function RE(l){if(!l)return null;switch(l.state){case et.IDLE:case et.STOPPED:case et.ENDED:case et.ERROR:return null}return l.frag}function wu(l,t){return t.getAppendedFrag(l,mt.MAIN)||t.getPartialFragment(l)}const SO=.25;function Jd(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function pd(l,t,e,i,s){let r=new l(t,e,"");try{r.value=i,s&&(r.type=s)}catch{r=new l(t,e,Wt(s?Vt({type:s},i):i))}return r}const ku=(()=>{const l=Jd();try{l&&new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class xO{constructor(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(A.EVENT_CUE_ENTER,{})},this.hls=t,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:t}=this;t&&(t.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(A.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:t}=this;t&&(t.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(A.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(A.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(t,e){var i;this.media=e.media,((i=e.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var t;const e=(t=this.hls)==null?void 0:t.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(t,e){this.media=null,!e.transferMedia&&(this.id3Track&&(this.removeCues&&aa(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(t){const e=this.getID3Track(t.textTracks);return e.mode="hidden",e}getID3Track(t){if(this.media){for(let e=0;e<t.length;e++){const i=t[e];if(i.kind==="metadata"&&i.label==="id3")return nx(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(t,e){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:i,enableID3MetadataCues:s}=this.hls.config;if(!i&&!s)return;const{samples:r}=e;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=Jd();if(o)for(let c=0;c<r.length;c++){const h=r[c].type;if(h===hi.emsg&&!i||!s)continue;const f=wS(r[c].data),g=r[c].pts;let m=g+r[c].duration;m>ku&&(m=ku),m-g<=0&&(m=g+SO);for(let v=0;v<f.length;v++){const T=f[v];if(!kS(T)){this.updateId3CueEnds(g,h);const S=pd(o,g,m,T,h);S&&this.id3Track.addCue(S)}}}}updateId3CueEnds(t,e){var i;const s=(i=this.id3Track)==null?void 0:i.cues;if(s)for(let r=s.length;r--;){const o=s[r];o.type===e&&o.startTime<t&&o.endTime===ku&&(o.endTime=t)}}onBufferFlushing(t,{startOffset:e,endOffset:i,type:s}){const{id3Track:r,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:h}}=o;if(r&&(c||h)){let f;s==="audio"?f=g=>g.type===hi.audioId3&&h:s==="video"?f=g=>g.type===hi.emsg&&c:f=g=>g.type===hi.audioId3&&h||g.type===hi.emsg&&c,Qd(r,e,i,f)}}onLevelUpdated(t,{details:e}){this.updateDateRangeCues(e,!0)}onLevelPtsUpdated(t,e){Math.abs(e.drift)>.01&&this.updateDateRangeCues(e.details)}updateDateRangeCues(t,e){if(!this.hls||!this.media)return;const{assetPlayerId:i,timelineOffset:s,enableDateRangeMetadataCues:r,interstitialsController:o}=this.hls.config;if(!r)return;const c=Jd();if(i&&s&&!o){const{fragmentStart:S,fragmentEnd:x}=t;let _=this.assetCue;_?(_.startTime=S,_.endTime=x):c&&(_=this.assetCue=pd(c,S,x,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),_&&(_.id=i,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(_),_.addEventListener("enter",this.onEventCueEnter)))}if(!t.hasProgramDateTime)return;const{id3Track:h}=this,{dateRanges:f}=t,g=Object.keys(f);let m=this.dateRangeCuesAppended;if(h&&e){var y;if((y=h.cues)!=null&&y.length){const S=Object.keys(m).filter(x=>!g.includes(x));for(let x=S.length;x--;){var v;const _=S[x],L=(v=m[_])==null?void 0:v.cues;delete m[_],L&&Object.keys(L).forEach(R=>{const C=L[R];if(C){C.removeEventListener("enter",this.onEventCueEnter);try{h.removeCue(C)}catch{}}})}}else m=this.dateRangeCuesAppended={}}const T=t.fragments[t.fragments.length-1];if(!(g.length===0||!dt(T?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let S=0;S<g.length;S++){const x=g[S],_=f[x],L=_.startTime,R=m[x],C=R?.cues||{};let I=R?.durationKnown||!1,U=ku;const{duration:O,endDate:M}=_;if(M&&O!==null)U=L+O,I=!0;else if(_.endOnNext&&!I){const N=g.reduce((z,J)=>{if(J!==_.id){const lt=f[J];if(lt.class===_.class&&lt.startDate>_.startDate&&(!z||_.startDate<z.startDate))return lt}return z},null);N&&(U=N.startTime,I=!0)}const w=Object.keys(_.attr);for(let N=0;N<w.length;N++){const z=w[N];if(!VL(z))continue;const J=C[z];if(J)I&&!(R!=null&&R.durationKnown)?J.endTime=U:Math.abs(J.startTime-L)>.01&&(J.startTime=L,J.endTime=U);else if(c){let lt=_.attr[z];KL(z)&&(lt=XT(lt));const at=pd(c,L,U,{key:z,data:lt},hi.dateRange);at&&(at.id=x,this.id3Track.addCue(at),C[z]=at,o&&(z==="X-ASSET-LIST"||z==="X-ASSET-URL")&&at.addEventListener("enter",this.onEventCueEnter))}}m[x]={cues:C,dateRange:_,durationKnown:I}}}}}class _O{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,i=this.levelDetails;if(!e||!i)return;this.currentTime=e.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:o}=this.config;if(!r||o===1||!i.live)return;const c=this.targetLatency;if(c===null)return;const h=s-c,f=Math.min(this.maxLatency,c+i.targetduration);if(h<f&&h>.05&&this.forwardBufferLength>1){const m=Math.min(2,Math.max(1,o)),y=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20,v=Math.min(m,Math.max(1,y));this.changeMediaPlaybackRate(e,v)}else e.playbackRate!==1&&e.playbackRate!==0&&this.changeMediaPlaybackRate(e,1)},this.hls=t,this.config=t.config,this.registerListeners()}get levelDetails(){var t;return((t=this.hls)==null?void 0:t.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:t}=this;if(t.liveMaxLatencyDuration!==void 0)return t.liveMaxLatencyDuration;const e=this.levelDetails;return e?t.liveMaxLatencyDurationCount*e.targetduration:0}get targetLatency(){const t=this.levelDetails;if(t===null||this.hls===null)return null;const{holdBack:e,partHoldBack:i,targetduration:s}=t,{liveSyncDuration:r,liveSyncDurationCount:o,lowLatencyMode:c}=this.config,h=this.hls.userConfig;let f=c&&i||e;(this._targetLatencyUpdated||h.liveSyncDuration||h.liveSyncDurationCount||f===0)&&(f=r!==void 0?r:o*s);const g=s;return f+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,g)}set targetLatency(t){this.stallCount=0,this.config.liveSyncDuration=t,this._targetLatencyUpdated=!0}get liveSyncPosition(){const t=this.estimateLiveEdge(),e=this.targetLatency;if(t===null||e===null)return null;const i=this.levelDetails;if(i===null)return null;const s=i.edge,r=t-e-this.edgeStalled,o=s-i.totalduration,c=s-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(o,r),c)}get drift(){const t=this.levelDetails;return t===null?1:t.drift}get edgeStalled(){const t=this.levelDetails;if(t===null)return 0;const e=(this.config.lowLatencyMode&&t.partTarget||t.targetduration)*3;return Math.max(t.age-e,0)}get forwardBufferLength(){const{media:t}=this,e=this.levelDetails;if(!t||!e)return 0;const i=t.buffered.length;return(i?t.buffered.end(i-1):e.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:t}=this;t&&(t.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(A.ERROR,this.onError,this))}unregisterListeners(){const{hls:t}=this;t&&(t.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(A.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(A.ERROR,this.onError,this))}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(t,{details:e}){e.advanced&&this.onTimeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(t,e){var i;e.details===K.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(t,e){var i,s;t.playbackRate!==e&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${t.playbackRate} to ${e}`),t.playbackRate=e)}estimateLiveEdge(){const t=this.levelDetails;return t===null?null:t.edge+t.age}computeLatency(){const t=this.estimateLiveEdge();return t===null?null:t-this.currentTime}}class AO extends Hg{constructor(t,e){super(t,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=e,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(A.LEVEL_LOADED,this.onLevelLoaded,this),t.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(A.FRAG_BUFFERED,this.onFragBuffered,this),t.on(A.ERROR,this.onError,this)}_unregisterListeners(){const{hls:t}=this;t.off(A.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(A.LEVEL_LOADED,this.onLevelLoaded,this),t.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(A.FRAG_BUFFERED,this.onFragBuffered,this),t.off(A.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(t,e){this.resetLevels()}onManifestLoaded(t,e){const i=this.hls.config.preferManagedMediaSource,s=[],r={},o={};let c=!1,h=!1,f=!1;e.levels.forEach(g=>{const m=g.attrs;let{audioCodec:y,videoCodec:v}=g;y&&(g.audioCodec=y=ic(y,i)||void 0),v&&(v=g.videoCodec=oL(v));const{width:T,height:S,unknownCodecs:x}=g;let _=x?x.length:0;if(x)for(let N=_;N--;){const z=x[N];this.isAudioSupported(z)?(g.audioCodec=y=y?`${y},${z}`:z,_--,Ea.audio[y.substring(0,4)]=2):this.isVideoSupported(z)&&(g.videoCodec=v=v?`${v},${z}`:z,_--,Ea.video[v.substring(0,4)]=2)}if(c||(c=!!(T&&S)),h||(h=!!v),f||(f=!!y),_||y&&!this.isAudioSupported(y)||v&&!this.isVideoSupported(v)){this.log(`Some or all CODECS not supported "${m.CODECS}"`);return}const{CODECS:L,"FRAME-RATE":R,"HDCP-LEVEL":C,"PATHWAY-ID":I,RESOLUTION:U,"VIDEO-RANGE":O}=m,w=`${`${I||"."}-`}${g.bitrate}-${U}-${R}-${L}-${O}-${C}`;if(r[w])if(r[w].uri!==g.url&&!g.attrs["PATHWAY-ID"]){const N=o[w]+=1;g.attrs["PATHWAY-ID"]=new Array(N+1).join(".");const z=this.createLevel(g);r[w]=z,s.push(z)}else r[w].addGroupId("audio",m.AUDIO),r[w].addGroupId("text",m.SUBTITLES);else{const N=this.createLevel(g);r[w]=N,o[w]=1,s.push(N)}}),this.filterAndSortMediaOptions(s,e,c,h,f)}createLevel(t){const e=new Kl(t),i=t.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(s.message),e.supportedResult=aS(s,[])}return e}isAudioSupported(t){return Ud(t,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(t){return Ud(t,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(t,e,i,s,r){let o=[],c=[],h=t;if((i||s)&&r&&(h=h.filter(({videoCodec:x,videoRange:_,width:L,height:R})=>(!!x||!!(L&&R))&&pL(_))),h.length===0){Promise.resolve().then(()=>{if(this.hls){let x="no level with compatible codecs found in manifest",_=x;e.levels.length&&(_=`one or more CODECS in variant not supported: ${Wt(e.levels.map(R=>R.attrs.CODECS).filter((R,C,I)=>I.indexOf(R)===C))}`,this.warn(_),x+=` (${_})`);const L=new Error(x);this.hls.trigger(A.ERROR,{type:pt.MEDIA_ERROR,details:K.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:L,reason:_})}});return}e.audioTracks&&(o=e.audioTracks.filter(x=>!x.audioCodec||this.isAudioSupported(x.audioCodec)),LE(o)),e.subtitles&&(c=e.subtitles,LE(c));const f=h.slice(0);h.sort((x,_)=>{if(x.attrs["HDCP-LEVEL"]!==_.attrs["HDCP-LEVEL"])return(x.attrs["HDCP-LEVEL"]||"")>(_.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&x.height!==_.height)return x.height-_.height;if(x.frameRate!==_.frameRate)return x.frameRate-_.frameRate;if(x.videoRange!==_.videoRange)return sc.indexOf(x.videoRange)-sc.indexOf(_.videoRange);if(x.videoCodec!==_.videoCodec){const L=_v(x.videoCodec),R=_v(_.videoCodec);if(L!==R)return R-L}if(x.uri===_.uri&&x.codecSet!==_.codecSet){const L=ec(x.codecSet),R=ec(_.codecSet);if(L!==R)return R-L}return x.averageBitrate!==_.averageBitrate?x.averageBitrate-_.averageBitrate:0});let g=f[0];if(this.steering&&(h=this.steering.filterParsedLevels(h),h.length!==f.length)){for(let x=0;x<f.length;x++)if(f[x].pathwayId===h[0].pathwayId){g=f[x];break}}this._levels=h;for(let x=0;x<h.length;x++)if(h[x]===g){var m;this._firstLevel=x;const _=g.bitrate,L=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${h.length} level(s) found, first bitrate: ${_}`),((m=this.hls.userConfig)==null?void 0:m.abrEwmaDefaultEstimate)===void 0){const R=Math.min(_,this.hls.config.abrEwmaDefaultEstimateMax);R>L&&L===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=R)}break}const y=r&&!s,v=this.hls.config,T=!!(v.audioStreamController&&v.audioTrackController),S={levels:h,audioTracks:o,subtitleTracks:c,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:r,video:s,altAudio:T&&!y&&o.some(x=>!!x.url)};this.hls.trigger(A.MANIFEST_PARSED,S)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(t){const e=this._levels;if(e.length===0)return;if(t<0||t>=e.length){const g=new Error("invalid level idx"),m=t<0;if(this.hls.trigger(A.ERROR,{type:pt.OTHER_ERROR,details:K.LEVEL_SWITCH_ERROR,level:t,fatal:m,error:g,reason:g.message}),m)return;t=Math.min(t,e.length-1)}const i=this.currentLevelIndex,s=this.currentLevel,r=s?s.attrs["PATHWAY-ID"]:void 0,o=e[t],c=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=o,i===t&&s&&r===c)return;this.log(`Switching to level ${t} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${c?" with Pathway "+c:""} from level ${i}${r?" with Pathway "+r:""}`);const h={level:t,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(A.LEVEL_SWITCHING,h);const f=o.details;if(!f||f.live){const g=this.switchParams(o.uri,s?.details,f);this.loadPlaylist(g)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}get firstLevel(){return this._firstLevel}set firstLevel(t){this._firstLevel=t}get startLevel(){if(this._startLevel===void 0){const t=this.hls.config.startLevel;return t!==void 0?t:this.hls.firstAutoLevel}return this._startLevel}set startLevel(t){this._startLevel=t}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(t){if(this.steering){const e=this.steering.pathways(),i=t.filter(s=>e.indexOf(s)!==-1);if(t.length<1){this.warn(`pathwayPriority ${t} should contain at least one pathway from list: ${e}`);return}this.steering.pathwayPriority=i}}onError(t,e){e.fatal||!e.context||e.context.type===Dt.LEVEL&&e.context.level===this.level&&this.checkRetry(e)}onFragBuffered(t,{frag:e}){if(e!==void 0&&e.type===mt.MAIN){const i=e.elementaryStreams;if(!Object.keys(i).some(r=>!!i[r]))return;const s=this._levels[e.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(t,e){var i;const{level:s,details:r}=e,o=e.levelInfo;if(!o){var c;this.warn(`Invalid level index ${s}`),(c=e.deliveryDirectives)!=null&&c.skip&&(r.deltaUpdateFailed=!0);return}if(o===this.currentLevel||e.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let h=o.details;h===e.details&&h.advanced&&(h=void 0),this.playlistLoaded(s,e,h)}else(i=e.deliveryDirectives)!=null&&i.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(t){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const i=this.getUrlWithDirectives(t.uri,e),s=this.currentLevelIndex,r=t.attrs["PATHWAY-ID"],o=t.details,c=o?.age;this.log(`Loading level index ${s}${e?.msn!==void 0?" at sn "+e.msn+" part "+e.part:""}${r?" Pathway "+r:""}${c&&o.live?" age "+c.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(A.LEVEL_LOADING,{url:i,level:s,levelInfo:t,pathwayId:t.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}removeLevel(t){var e;if(this._levels.length===1)return;const i=this._levels.filter((r,o)=>o!==t?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(c=>c.level=-1)),!1));xS(i),this._levels=i,this.currentLevelIndex>-1&&(e=this.currentLevel)!=null&&e.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=i.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(A.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(t,{levels:e}){this._levels=e}checkMaxAutoUpdated(){const{autoLevelCapping:t,maxAutoLevel:e,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==e&&(this._maxAutoLevel=e,this.hls.trigger(A.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:e,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function LE(l){const t={};l.forEach(e=>{const i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++})}function yx(){return self.SourceBuffer||self.WebKitSourceBuffer}function vx(){if(!bn())return!1;const t=yx();return!t||t.prototype&&typeof t.prototype.appendBuffer=="function"&&typeof t.prototype.remove=="function"}function bO(){if(!vx())return!1;const l=bn();return typeof l?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>l.isTypeSupported(Vl(t,"video")))||["mp4a.40.2","fLaC"].some(t=>l.isTypeSupported(Vl(t,"audio"))))}function RO(){var l;const t=yx();return typeof(t==null||(l=t.prototype)==null?void 0:l.changeType)=="function"}const LO=100;class DO extends Mg{constructor(t,e,i){super(t,e,i,"stream-controller",mt.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,r=s?s.currentTime:null;if(r===null||!dt(r)||(this.log(`Media seeked to ${r.toFixed(3)}`),!this.getBufferedFrag(r)))return;const o=this.getFwdBufferInfoAtPos(s,r,mt.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${r} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(A.MANIFEST_PARSED,this.onManifestParsed,this),t.on(A.LEVEL_LOADING,this.onLevelLoading,this),t.on(A.LEVEL_LOADED,this.onLevelLoaded,this),t.on(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(A.BUFFER_CREATED,this.onBufferCreated,this),t.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:t}=this;t.off(A.MANIFEST_PARSED,this.onManifestParsed,this),t.off(A.LEVEL_LOADED,this.onLevelLoaded,this),t.off(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(A.BUFFER_CREATED,this.onBufferCreated,this),t.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(A.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(t,e){if(this.levels){const{lastCurrentTime:i,hls:s}=this;if(this.stopLoad(),this.setInterval(LO),this.level=-1,!this.startFragRequested){let r=s.startLevel;r===-1&&(s.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=s.firstAutoLevel),s.nextLoadLevel=r,this.level=s.loadLevel,this._hasEnoughToStart=!!e}i>0&&t===-1&&!e&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),t=i),this.state=et.IDLE,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}else this._forceStartLoad=!0,this.state=et.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case et.WAITING_LEVEL:{const{levels:e,level:i}=this,s=e?.[i],r=s?.details;if(r&&(!r.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(r))break;this.state=et.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=et.IDLE;break}break}case et.FRAG_LOADING_WAITING_RETRY:{var t;const e=self.performance.now(),i=this.retryDate;if(!i||e>=i||(t=this.media)!=null&&t.seeking){const{levels:s,level:r}=this,o=s?.[r];this.resetStartWhenNotLoaded(o||null),this.state=et.IDLE}}break}this.state===et.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var t;super.onTickEnd(),(t=this.media)!=null&&t.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:t,levelLastLoaded:e,levels:i,media:s}=this;if(e===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!t.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?t.nextLoadLevel:t.loadLevel;if(!(i!=null&&i[r]))return;const o=i[r],c=this.getMainFwdBufferInfo();if(c===null)return;const h=this.getLevelDetails();if(h&&this._streamEnded(c,h)){const S={};this.altAudio===2&&(S.type="video"),this.hls.trigger(A.BUFFER_EOS,S),this.state=et.ENDED;return}if(!this.buffering)return;t.loadLevel!==r&&t.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=t.nextLoadLevel=r;const f=o.details;if(!f||this.state===et.WAITING_LEVEL||this.waitForLive(o)){this.level=r,this.state=et.WAITING_LEVEL,this.startFragRequested=!1;return}const g=c.len,m=this.getMaxBufferLength(o.maxBitrate);if(g>=m)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const y=this.backtrackFragment?this.backtrackFragment.start:c.end;let v=this.getNextFragment(y,f);if(this.couldBacktrack&&!this.fragPrevious&&v&&ve(v)&&this.fragmentTracker.getState(v)!==xe.OK){var T;const x=((T=this.backtrackFragment)!=null?T:v).sn-f.startSN,_=f.fragments[x-1];_&&v.cc===_.cc&&(v=_,this.fragmentTracker.removeFragment(_))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(v&&this.isLoopLoading(v,y)){if(!v.gap){const x=this.audioOnly&&!this.altAudio?Xt.AUDIO:Xt.VIDEO,_=(x===Xt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;_&&this.afterBufferFlushed(_,x,mt.MAIN)}v=this.getNextFragmentLoopLoading(v,f,c,mt.MAIN,m)}v&&(v.initSegment&&!v.initSegment.data&&!this.bitrateTest&&(v=v.initSegment),this.loadFragment(v,o,y))}loadFragment(t,e,i){const s=this.fragmentTracker.getState(t);s===xe.NOT_LOADED||s===xe.PARTIAL?ve(t)?this.bitrateTest?(this.log(`Fragment ${t.sn} of level ${t.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(t,e)):super.loadFragment(t,e,i):this._loadInitSegment(t,e):this.clearTrackerIfNeeded(t)}getBufferedFrag(t){return this.fragmentTracker.getBufferedFrag(t,mt.MAIN)}followingBufferedFrag(t){return t?this.getBufferedFrag(t.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:t,media:e}=this;if(e!=null&&e.readyState){let i;const s=this.getAppendedFrag(e.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<r.targetduration*2)return}if(!e.paused&&t){const c=this.hls.nextLoadLevel,h=t[c],f=this.fragLastKbps;f&&this.fragCurrent?i=this.fragCurrent.duration*h.maxBitrate/(1e3*f)+1:i=0}else i=0;const o=this.getBufferedFrag(e.currentTime+i);if(o){const c=this.followingBufferedFrag(o);if(c){this.abortCurrentFrag();const h=c.maxStartPTS?c.maxStartPTS:c.start,f=c.duration,g=Math.max(o.end,h+Math.min(Math.max(f-this.config.maxFragLookUpTolerance,f*(this.couldBacktrack?.5:.125)),f*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(g,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case et.KEY_LOADING:case et.FRAG_LOADING:case et.FRAG_LOADING_WAITING_RETRY:case et.PARSING:case et.PARSED:this.state=et.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(t,e){super.flushMainBuffer(t,e,this.altAudio===2?"video":null)}onMediaAttached(t,e){super.onMediaAttached(t,e);const i=e.media;mi(i,"playing",this.onMediaPlaying),mi(i,"seeked",this.onMediaSeeked)}onMediaDetaching(t,e){const{media:i}=this;i&&(Ni(i,"playing",this.onMediaPlaying),Ni(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(t,e),!e.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(A.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(t,e){let i=!1,s=!1;for(let r=0;r<e.levels.length;r++){const o=e.levels[r].audioCodec;o&&(i=i||o.indexOf("mp4a.40.2")!==-1,s=s||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=i&&s&&!RO(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1}onLevelLoading(t,e){const{levels:i}=this;if(!i||this.state!==et.IDLE)return;const s=e.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=et.WAITING_LEVEL)}onLevelLoaded(t,e){var i;const{levels:s,startFragRequested:r}=this,o=e.level,c=e.details,h=c.totalduration;if(!s){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""}, cc [${c.startCC}, ${c.endCC}] duration:${h}`);const f=e.levelInfo,g=this.fragCurrent;g&&(this.state===et.FRAG_LOADING||this.state===et.FRAG_LOADING_WAITING_RETRY)&&g.level!==e.level&&g.loader&&this.abortCurrentFrag();let m=0;if(c.live||(i=f.details)!=null&&i.live){var y;if(this.checkLiveUpdate(c),c.deltaUpdateFailed)return;m=this.alignPlaylists(c,f.details,(y=this.levelLastLoaded)==null?void 0:y.details)}if(f.details=c,this.levelLastLoaded=f,r||this.setStartPosition(c,m),this.hls.trigger(A.LEVEL_UPDATED,{details:c,level:o}),this.state===et.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=et.IDLE}r&&c.live&&this.synchronizeToLiveEdge(c),this.tick()}synchronizeToLiveEdge(t){const{config:e,media:i}=this;if(!i)return;const s=this.hls.liveSyncPosition,r=this.getLoadPosition(),o=t.fragmentStart,c=t.edge,h=r>=o-e.maxFragLookUpTolerance&&r<=c;if(s!==null&&i.duration>s&&(r<s||!h)){const g=e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;if((!h&&i.readyState<4||r<c-g)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),i.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var f;const m=xt.bufferInfo(i,s,0);if(!((f=m.buffered)!=null&&f.length)){i.currentTime=s;return}if(m.start<=r){i.currentTime=s;return}const{nextStart:v}=xt.bufferedInfo(m.buffered,r,0);v&&(i.currentTime=v)}else i.currentTime=s}}_handleFragmentLoadProgress(t){var e;const i=t.frag,{part:s,payload:r}=t,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const c=o[i.level];if(!c){this.warn(`Level ${i.level} not found on progress`);return}const h=c.details;if(!h){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const f=c.videoCodec,g=h.PTSKnown||!h.live,m=(e=i.initSegment)==null?void 0:e.data,y=this._getAudioCodec(c),v=this.transmuxer=this.transmuxer||new KS(this.hls,mt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),T=s?s.index:-1,S=T!==-1,x=new Og(i.level,i.sn,i.stats.chunkCount,r.byteLength,T,S),_=this.initPTS[i.cc];v.push(r,m,y,f,i,s,h.totalduration,g,x,_)}onAudioTrackSwitching(t,e){const i=this.hls,s=this.altAudio===2;if(nc(e.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.fragmentTracker.removeAllFragments(),i.once(A.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(A.AUDIO_TRACK_SWITCHED,e)}),i.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(A.AUDIO_TRACK_SWITCHED,e)}}onAudioTrackSwitched(t,e){const i=nc(e.url,this.hls);if(i){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i?2:0,this.tick()}onBufferCreated(t,e){const i=e.tracks;let s,r,o=!1;for(const c in i){const h=i[c];if(h.id==="main"){if(r=c,s=h,c==="video"){const f=i[c];f&&(this.videoBuffer=f.buffer)}}else o=!0}o&&s?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(t,e){const{frag:i,part:s}=e,r=i.type===mt.MAIN;if(r){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===et.PARSED&&(this.state=et.IDLE);return}const c=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),ve(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}const o=this.media;o&&(!this._hasEnoughToStart&&xt.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(t,e){var i;if(e.fatal){this.state=et.ERROR;return}switch(e.details){case K.FRAG_GAP:case K.FRAG_PARSING_ERROR:case K.FRAG_DECRYPT_ERROR:case K.FRAG_LOAD_ERROR:case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_ERROR:case K.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(mt.MAIN,e);break;case K.LEVEL_LOAD_ERROR:case K.LEVEL_LOAD_TIMEOUT:case K.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===et.WAITING_LEVEL&&((i=e.context)==null?void 0:i.type)===Dt.LEVEL&&(this.state=et.IDLE);break;case K.BUFFER_ADD_CODEC_ERROR:case K.BUFFER_APPEND_ERROR:if(e.parent!=="main")return;this.reduceLengthAndFlushBuffer(e)&&this.resetLoadingState();break;case K.BUFFER_FULL_ERROR:if(e.parent!=="main")return;this.reduceLengthAndFlushBuffer(e)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case K.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}onFragLoadEmergencyAborted(){this.state=et.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(t,{type:e}){if(e!==Xt.AUDIO||!this.altAudio){const i=(e===Xt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,e,mt.MAIN),this.tick())}}onLevelsUpdated(t,e){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=e.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:t}=this;if(!t)return;const e=t.currentTime;let i=this.startPosition;if(i>=0&&e<i){if(t.seeking){this.log(`could not seek to ${i}, already seeking at ${e}`);return}const s=this.timelineOffset;s&&i&&(i+=s);const r=this.getLevelDetails(),o=xt.getBuffered(t),c=o.length?o.start(0):0,h=c-i,f=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||h>0&&(h<f||this.loadingParts&&h<2*(r?.partTarget||0)))&&(this.log(`adjusting start position by ${h} to match buffer start`),i+=h,this.startPosition=i),e<i&&(this.log(`seek to target start position ${i} from current time ${e} buffer start ${c}`),t.currentTime=i)}}_getAudioCodec(t){let e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e.indexOf("mp4a.40.5")!==-1?e="mp4a.40.2":e="mp4a.40.5"),e}_loadBitrateTestFrag(t,e){t.bitrateTest=!0,this._doFragLoad(t,e).then(i=>{const{hls:s}=this,r=i?.frag;if(!r||this.fragContextChanged(r))return;e.fragmentError=0,this.state=et.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=r.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(A.FRAG_LOADED,i),r.bitrateTest=!1})}_handleTransmuxComplete(t){const e=this.playlistType,{hls:i}=this,{remuxResult:s,chunkMeta:r}=t,o=this.getCurrentContext(r);if(!o){this.resetWhenMissingContext(r);return}const{frag:c,part:h,level:f}=o,{video:g,text:m,id3:y,initSegment:v}=s,{details:T}=f,S=this.altAudio?void 0:s.audio;if(this.fragContextChanged(c)){this.fragmentTracker.removeFragment(c);return}if(this.state=et.PARSING,v){const x=v.tracks;if(x){const C=c.initSegment||c;if(this.unhandledEncryptionError(v,c))return;this._bufferInitSegment(f,x,C,r),i.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:e,tracks:x})}const _=v.initPTS,L=v.timescale,R=this.initPTS[c.cc];if(dt(_)&&(!R||R.baseTime!==_||R.timescale!==L)){const C=v.trackId;this.initPTS[c.cc]={baseTime:_,timescale:L,trackId:C},i.trigger(A.INIT_PTS_FOUND,{frag:c,id:e,initPTS:_,timescale:L,trackId:C})}}if(g&&T){S&&g.type==="audiovideo"&&this.logMuxedErr(c);const x=T.fragments[c.sn-1-T.startSN],_=c.sn===T.startSN,L=!x||c.cc>x.cc;if(s.independent!==!1){const{startPTS:R,endPTS:C,startDTS:I,endDTS:U}=g;if(h)h.elementaryStreams[g.type]={startPTS:R,endPTS:C,startDTS:I,endDTS:U};else if(g.firstKeyFrame&&g.independent&&r.id===1&&!L&&(this.couldBacktrack=!0),g.dropped&&g.independent){const O=this.getMainFwdBufferInfo(),M=(O?O.end:this.getLoadPosition())+this.config.maxBufferHole,w=g.firstKeyFramePTS?g.firstKeyFramePTS:R;if(!_&&M<w-this.config.maxBufferHole&&!L){this.backtrack(c);return}else L&&(c.gap=!0);c.setElementaryStreamInfo(g.type,c.start,C,c.start,U,!0)}else _&&R-(T.appliedTimelineOffset||0)>Yu&&(c.gap=!0);c.setElementaryStreamInfo(g.type,R,C,I,U),this.backtrackFragment&&(this.backtrackFragment=c),this.bufferFragmentData(g,c,h,r,_||L)}else if(_||L)c.gap=!0;else{this.backtrack(c);return}}if(S){const{startPTS:x,endPTS:_,startDTS:L,endDTS:R}=S;h&&(h.elementaryStreams[Xt.AUDIO]={startPTS:x,endPTS:_,startDTS:L,endDTS:R}),c.setElementaryStreamInfo(Xt.AUDIO,x,_,L,R),this.bufferFragmentData(S,c,h,r)}if(T&&y!=null&&y.samples.length){const x={id:e,frag:c,details:T,samples:y.samples};i.trigger(A.FRAG_PARSING_METADATA,x)}if(T&&m){const x={id:e,frag:c,details:T,samples:m.samples};i.trigger(A.FRAG_PARSING_USERDATA,x)}}logMuxedErr(t){this.warn(`${ve(t)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${t.url}`)}_bufferInitSegment(t,e,i,s){if(this.state!==et.PARSING)return;this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&(delete e.audio,e.audiovideo&&this.logMuxedErr(i));const{audio:r,video:o,audiovideo:c}=e;if(r){const f=t.audioCodec;let g=Fu(r.codec,f);g==="mp4a"&&(g="mp4a.40.5");const m=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){g&&(g.indexOf("mp4a.40.5")!==-1?g="mp4a.40.2":g="mp4a.40.5");const y=r.metadata;y&&"channelCount"in y&&(y.channelCount||1)!==1&&m.indexOf("firefox")===-1&&(g="mp4a.40.5")}g&&g.indexOf("mp4a.40.5")!==-1&&m.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(g="mp4a.40.2",this.log(`Android: force audio codec to ${g}`)),f&&f!==g&&this.log(`Swapping manifest audio codec "${f}" for "${g}"`),r.levelCodec=g,r.id=mt.MAIN,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${g||""}/${f||""}/${r.codec}]`),delete e.audiovideo}if(o){o.levelCodec=t.videoCodec,o.id=mt.MAIN;const f=o.codec;if(f?.length===4)switch(f){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${t.videoCodec||""}/${f}]${o.codec!==f?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete e.audiovideo}c&&(this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${t.codecs}/${c.codec}]`),delete e.video,delete e.audio);const h=Object.keys(e);if(h.length){if(this.hls.trigger(A.BUFFER_CODECS,e),!this.hls)return;h.forEach(f=>{const m=e[f].initSegment;m!=null&&m.byteLength&&this.hls.trigger(A.BUFFER_APPENDING,{type:f,data:m,frag:i,part:null,chunkMeta:s,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const t=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(t,mt.MAIN)}get maxBufferLength(){const{levels:t,level:e}=this,i=t?.[e];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=et.IDLE}checkFragmentChanged(){const t=this.media;let e=null;if(t&&t.readyState>1&&t.seeking===!1){const i=t.currentTime;if(xt.isBuffered(t,i)?e=this.getAppendedFrag(i):xt.isBuffered(t,i+.1)&&(e=this.getAppendedFrag(i+.1)),e){this.backtrackFragment=null;const s=this.fragPlaying,r=e.level;(!s||e.sn!==s.sn||s.level!==r)&&(this.fragPlaying=e,this.hls.trigger(A.FRAG_CHANGED,{frag:e}),(!s||s.level!==r)&&this.hls.trigger(A.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const t=this.nextBufferedFrag;return t?t.level:-1}get currentFrag(){var t;if(this.fragPlaying)return this.fragPlaying;const e=((t=this.media)==null?void 0:t.currentTime)||this.lastCurrentTime;return dt(e)?this.getAppendedFrag(e):null}get currentProgramDateTime(){var t;const e=((t=this.media)==null?void 0:t.currentTime)||this.lastCurrentTime;if(dt(e)){const i=this.getLevelDetails(),s=this.currentFrag||(i?ur(null,i.fragments,e):null);if(s){const r=s.programDateTime;if(r!==null){const o=r+(e-s.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const t=this.currentFrag;return t?t.level:-1}get nextBufferedFrag(){const t=this.currentFrag;return t?this.followingBufferedFrag(t):null}get forceStartLoad(){return this._forceStartLoad}}class IO{constructor(t){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}abort(t){for(const i in this.keyUriToKeyInfo){const s=this.keyUriToKeyInfo[i].loader;if(s){var e;if(t&&t!==((e=s.context)==null?void 0:e.frag.type))return;s.abort()}}}detach(){for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[t]}}destroy(){this.detach();for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t].loader;e&&e.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(t,e=K.KEY_LOAD_ERROR,i,s,r){return new Ms({type:pt.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:r,error:i,networkDetails:s})}loadClear(t,e,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(e.length)for(let s=0,r=e.length;s<r;s++){const o=e[s];if(t.cc<=o.cc&&(!ve(t)||!ve(o)||t.sn<o.sn)||!i&&s==r-1)return this.emeController.selectKeySystemFormat(o).then(c=>{if(!this.emeController)return;o.setKeyFormat(c);const h=Gu(c);if(h)return this.emeController.getKeySystemAccess([h])})}if(this.config.requireKeySystemAccessOnStart){const s=Dl(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(t){return!t.decryptdata&&t.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(t).then(e=>this.loadInternal(t,e)):this.loadInternal(t)}loadInternal(t,e){var i,s;e&&t.setKeyFormat(e);const r=t.decryptdata;if(!r){const f=new Error(e?`Expected frag.decryptdata to be defined after setting format ${e}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(t,K.KEY_LOAD_ERROR,f))}const o=r.uri;if(!o)return Promise.reject(this.createKeyLoadError(t,K.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let c=this.keyUriToKeyInfo[o];if((i=c)!=null&&i.decryptdata.key)return r.key=c.decryptdata.key,Promise.resolve({frag:t,keyInfo:c});if((s=c)!=null&&s.keyLoadPromise){var h;switch((h=c.mediaKeySessionContext)==null?void 0:h.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return c.keyLoadPromise.then(f=>(r.key=f.keyInfo.decryptdata.key,{frag:t,keyInfo:c}))}}switch(c=this.keyUriToKeyInfo[o]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(c,t):this.loadKeyEME(c,t);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(c,t);default:return Promise.reject(this.createKeyLoadError(t,K.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(t,e){const i={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){const s=this.emeController.loadKey(i);if(s)return(t.keyLoadPromise=s.then(r=>(t.mediaKeySessionContext=r,i))).catch(r=>{throw t.keyLoadPromise=null,r})}return Promise.resolve(i)}loadKeyHTTP(t,e){const i=this.config,s=i.loader,r=new s(i);return e.keyLoader=t.loader=r,t.keyLoadPromise=new Promise((o,c)=>{const h={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},f=i.keyLoadPolicy.default,g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(y,v,T,S)=>{const{frag:x,keyInfo:_,url:L}=T;if(!x.decryptdata||_!==this.keyUriToKeyInfo[L])return c(this.createKeyLoadError(x,K.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),S));_.decryptdata.key=x.decryptdata.key=new Uint8Array(y.data),x.keyLoader=null,_.loader=null,o({frag:x,keyInfo:_})},onError:(y,v,T,S)=>{this.resetLoader(v),c(this.createKeyLoadError(e,K.KEY_LOAD_ERROR,new Error(`HTTP Error ${y.code} loading key ${y.text}`),T,Vt({url:h.url,data:void 0},y)))},onTimeout:(y,v,T)=>{this.resetLoader(v),c(this.createKeyLoadError(e,K.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),T))},onAbort:(y,v,T)=>{this.resetLoader(v),c(this.createKeyLoadError(e,K.INTERNAL_ABORTED,new Error("key loading aborted"),T))}};r.load(h,g,m)})}resetLoader(t){const{frag:e,keyInfo:i,url:s}=t,r=i.loader;e.keyLoader===r&&(e.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[s],r&&r.destroy()}}function DE(l){const{type:t}=l;switch(t){case Dt.AUDIO_TRACK:return mt.AUDIO;case Dt.SUBTITLE_TRACK:return mt.SUBTITLE;default:return mt.MAIN}}function yd(l,t){let e=l.url;return(e===void 0||e.indexOf("data:")===0)&&(e=t.url),e}class CO{constructor(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=t,this.registerListeners()}startLoad(t){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:t}=this;t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.LEVEL_LOADING,this.onLevelLoading,this),t.on(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:t}=this;t.off(A.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.LEVEL_LOADING,this.onLevelLoading,this),t.off(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(t){const e=this.hls.config,i=e.pLoader,s=e.loader,r=i||s,o=new r(e);return this.loaders[t.type]=o,o}getInternalLoader(t){return this.loaders[t.type]}resetInternalLoader(t){this.loaders[t]&&delete this.loaders[t]}destroyInternalLoaders(){for(const t in this.loaders){const e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(t,e){const{url:i}=e;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Dt.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(t,e){const{id:i,level:s,pathwayId:r,url:o,deliveryDirectives:c,levelInfo:h}=e;this.load({id:i,level:s,pathwayId:r,responseType:"text",type:Dt.LEVEL,url:o,deliveryDirectives:c,levelOrTrack:h})}onAudioTrackLoading(t,e){const{id:i,groupId:s,url:r,deliveryDirectives:o,track:c}=e;this.load({id:i,groupId:s,level:null,responseType:"text",type:Dt.AUDIO_TRACK,url:r,deliveryDirectives:o,levelOrTrack:c})}onSubtitleTrackLoading(t,e){const{id:i,groupId:s,url:r,deliveryDirectives:o,track:c}=e;this.load({id:i,groupId:s,level:null,responseType:"text",type:Dt.SUBTITLE_TRACK,url:r,deliveryDirectives:o,levelOrTrack:c})}onLevelsUpdated(t,e){const i=this.loaders[Dt.LEVEL];if(i){const s=i.context;s&&!e.levels.some(r=>r===s.levelOrTrack)&&(i.abort(),delete this.loaders[Dt.LEVEL])}}load(t){var e;const i=this.hls.config;let s=this.getInternalLoader(t);if(s){const f=this.hls.logger,g=s.context;if(g&&g.levelOrTrack===t.levelOrTrack&&(g.url===t.url||g.deliveryDirectives&&!t.deliveryDirectives)){g.url===t.url?f.log(`[playlist-loader]: ignore ${t.url} ongoing request`):f.log(`[playlist-loader]: ignore ${t.url} in favor of ${g.url}`);return}f.log(`[playlist-loader]: aborting previous loader for type: ${t.type}`),s.abort()}let r;if(t.type===Dt.MANIFEST?r=i.manifestLoadPolicy.default:r=Kt({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(t),dt((e=t.deliveryDirectives)==null?void 0:e.part)){let f;if(t.type===Dt.LEVEL&&t.level!==null?f=this.hls.levels[t.level].details:t.type===Dt.AUDIO_TRACK&&t.id!==null?f=this.hls.audioTracks[t.id].details:t.type===Dt.SUBTITLE_TRACK&&t.id!==null&&(f=this.hls.subtitleTracks[t.id].details),f){const g=f.partTarget,m=f.targetduration;if(g&&m){const y=Math.max(g*3,m*.8)*1e3;r=Kt({},r,{maxTimeToFirstByteMs:Math.min(y,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(y,r.maxTimeToFirstByteMs)})}}}const o=r.errorRetry||r.timeoutRetry||{},c={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},h={onSuccess:(f,g,m,y)=>{const v=this.getInternalLoader(m);this.resetInternalLoader(m.type);const T=f.data;if(T.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(f,m,new Error("no EXTM3U delimiter"),y||null,g);return}g.parsing.start=performance.now(),ls.isMediaPlaylist(T)||m.type!==Dt.MANIFEST?this.handleTrackOrLevelPlaylist(f,g,m,y||null,v):this.handleMasterPlaylist(f,g,m,y)},onError:(f,g,m,y)=>{this.handleNetworkError(g,m,!1,f,y)},onTimeout:(f,g,m)=>{this.handleNetworkError(g,m,!0,void 0,f)}};s.load(t,c,h)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:t,startPosition:e},forceStartLoad:i}=this.hls;(t||i)&&(this.hls.logger.log(`${t?"auto":"force"} startLoad with configured startPosition ${e}`),this.hls.startLoad(e))}handleMasterPlaylist(t,e,i,s){const r=this.hls,o=t.data,c=yd(t,i),h=ls.parseMasterPlaylist(o,c);if(h.playlistParsingError){this.handleManifestParsingError(t,i,h.playlistParsingError,s,e);return}const{contentSteering:f,levels:g,sessionData:m,sessionKeys:y,startTimeOffset:v,variableList:T}=h;this.variableList=T;const{AUDIO:S=[],SUBTITLES:x,"CLOSED-CAPTIONS":_}=ls.parseMasterPlaylistMedia(o,c,h);S.length&&!S.some(R=>!R.url)&&g[0].audioCodec&&!g[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ee({}),bitrate:0,url:""})),r.trigger(A.MANIFEST_LOADED,{levels:g,audioTracks:S,subtitles:x,captions:_,contentSteering:f,url:c,stats:e,networkDetails:s,sessionData:m,sessionKeys:y,startTimeOffset:v,variableList:T})}handleTrackOrLevelPlaylist(t,e,i,s,r){const o=this.hls,{id:c,level:h,type:f}=i,g=yd(t,i),m=dt(h)?h:dt(c)?c:0,y=DE(i),v=ls.parseLevelPlaylist(t.data,g,m,y,0,this.variableList);if(f===Dt.MANIFEST){const T={attrs:new ee({}),bitrate:0,details:v,name:"",url:g};v.requestScheduled=e.loading.start+ES(v,0),o.trigger(A.MANIFEST_LOADED,{levels:[T],audioTracks:[],url:g,stats:e,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),i.levelDetails=v,this.handlePlaylistLoaded(v,t,e,i,s,r)}handleManifestParsingError(t,e,i,s,r){this.hls.trigger(A.ERROR,{type:pt.NETWORK_ERROR,details:K.MANIFEST_PARSING_ERROR,fatal:e.type===Dt.MANIFEST,url:t.url,err:i,error:i,reason:i.message,response:t,context:e,networkDetails:s,stats:r})}handleNetworkError(t,e,i=!1,s,r){let o=`A network ${i?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${t.type}`;t.type===Dt.LEVEL?o+=`: ${t.level} id: ${t.id}`:(t.type===Dt.AUDIO_TRACK||t.type===Dt.SUBTITLE_TRACK)&&(o+=` id: ${t.id} group-id: "${t.groupId}"`);const c=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let h=K.UNKNOWN,f=!1;const g=this.getInternalLoader(t);switch(t.type){case Dt.MANIFEST:h=i?K.MANIFEST_LOAD_TIMEOUT:K.MANIFEST_LOAD_ERROR,f=!0;break;case Dt.LEVEL:h=i?K.LEVEL_LOAD_TIMEOUT:K.LEVEL_LOAD_ERROR,f=!1;break;case Dt.AUDIO_TRACK:h=i?K.AUDIO_TRACK_LOAD_TIMEOUT:K.AUDIO_TRACK_LOAD_ERROR,f=!1;break;case Dt.SUBTITLE_TRACK:h=i?K.SUBTITLE_TRACK_LOAD_TIMEOUT:K.SUBTITLE_LOAD_ERROR,f=!1;break}g&&this.resetInternalLoader(t.type);const m={type:pt.NETWORK_ERROR,details:h,fatal:f,url:t.url,loader:g,context:t,error:c,networkDetails:e,stats:r};if(s){const y=e?.url||t.url;m.response=Vt({url:y,data:void 0},s)}this.hls.trigger(A.ERROR,m)}handlePlaylistLoaded(t,e,i,s,r,o){const c=this.hls,{type:h,level:f,id:g,groupId:m,deliveryDirectives:y}=s,v=yd(e,s),T=DE(s),S=typeof s.level=="number"&&T===mt.MAIN?f:void 0;if(!t.fragments.length){const _=t.playlistParsingError=new Error("No Segments found in Playlist");c.trigger(A.ERROR,{type:pt.NETWORK_ERROR,details:K.LEVEL_EMPTY_ERROR,fatal:!1,url:v,error:_,reason:_.message,response:e,context:s,level:S,parent:T,networkDetails:r,stats:i});return}t.targetduration||(t.playlistParsingError=new Error("Missing Target Duration"));const x=t.playlistParsingError;if(x){if(this.hls.logger.warn(`${x} ${t.url}`),!c.config.ignorePlaylistParsingErrors){c.trigger(A.ERROR,{type:pt.NETWORK_ERROR,details:K.LEVEL_PARSING_ERROR,fatal:!1,url:v,error:x,reason:x.message,response:e,context:s,level:S,parent:T,networkDetails:r,stats:i});return}t.playlistParsingError=null}switch(t.live&&o&&(o.getCacheAge&&(t.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(t.ageHeader))&&(t.ageHeader=0)),h){case Dt.MANIFEST:case Dt.LEVEL:c.trigger(A.LEVEL_LOADED,{details:t,levelInfo:s.levelOrTrack||c.levels[0],level:S||0,id:g||0,stats:i,networkDetails:r,deliveryDirectives:y,withoutMultiVariant:h===Dt.MANIFEST});break;case Dt.AUDIO_TRACK:c.trigger(A.AUDIO_TRACK_LOADED,{details:t,track:s.levelOrTrack,id:g||0,groupId:m||"",stats:i,networkDetails:r,deliveryDirectives:y});break;case Dt.SUBTITLE_TRACK:c.trigger(A.SUBTITLE_TRACK_LOADED,{details:t,track:s.levelOrTrack,id:g||0,groupId:m||"",stats:i,networkDetails:r,deliveryDirectives:y});break}}}class Us{static get version(){return Yl}static isMSESupported(){return vx()}static isSupported(){return bO()}static getMediaSource(){return bn()}static get Events(){return A}static get MetadataSchema(){return hi}static get ErrorTypes(){return pt}static get ErrorDetails(){return K}static get DefaultConfig(){return Us.defaultConfig?Us.defaultConfig:dO}static set DefaultConfig(t){Us.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Pg,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const e=this.logger=GR(t.debug||!1,"Hls instance",t.assetPlayerId),i=this.config=mO(Us.DefaultConfig,t,e);this.userConfig=t,i.progressive&&pO(i,e);const{abrController:s,bufferController:r,capLevelController:o,errorController:c,fpsController:h}=i,f=new c(this),g=this.abrController=new s(this),m=new OL(this),y=i.interstitialsController,v=y?this.interstitialsController=new y(this,Us):null,T=this.bufferController=new r(this,m),S=this.capLevelController=new o(this),x=new h(this),_=new CO(this),L=i.contentSteeringController,R=L?new L(this):null,C=this.levelController=new AO(this,R),I=new xO(this),U=new IO(this.config),O=this.streamController=new DO(this,m,U),M=this.gapController=new TO(this,m);S.setStreamController(O),x.setStreamController(O);const w=[_,C,O];v&&w.splice(1,0,v),R&&w.splice(1,0,R),this.networkControllers=w;const N=[g,T,M,S,x,I,m];this.audioTrackController=this.createController(i.audioTrackController,w);const z=i.audioStreamController;z&&w.push(this.audioStreamController=new z(this,m,U)),this.subtitleTrackController=this.createController(i.subtitleTrackController,w);const J=i.subtitleStreamController;J&&w.push(this.subtititleStreamController=new J(this,m,U)),this.createController(i.timelineController,N),U.emeController=this.emeController=this.createController(i.emeController,N),this.cmcdController=this.createController(i.cmcdController,N),this.latencyController=this.createController(_O,N),this.coreComponents=N,w.push(f);const lt=f.onErrorOut;typeof lt=="function"&&this.on(A.ERROR,lt,f),this.on(A.MANIFEST_LOADED,_.onManifestLoaded,_)}createController(t,e){if(t){const i=new t(this);return e&&e.push(i),i}return null}on(t,e,i=this){this._emitter.on(t,e,i)}once(t,e,i=this){this._emitter.once(t,e,i)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,e,i=this,s){this._emitter.off(t,e,i,s)}listeners(t){return this._emitter.listeners(t)}emit(t,e,i){return this._emitter.emit(t,e,i)}trigger(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(i){if(this.logger.error("An internal error happened while handling event "+t+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const s=t===A.ERROR;this.trigger(A.ERROR,{type:pt.OTHER_ERROR,details:K.INTERNAL_EXCEPTION,fatal:s,event:t,error:i}),this.triggeringException=!1}}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){this.logger.log("destroy"),this.trigger(A.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){if(!t||"media"in t&&!t.media){const r=new Error(`attachMedia failed: invalid argument (${t})`);this.trigger(A.ERROR,{type:pt.OTHER_ERROR,details:K.ATTACH_MEDIA_ERROR,fatal:!0,error:r});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const e="media"in t,i=e?t.media:t,s=e?t:{media:i};this._media=i,this.trigger(A.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(A.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const t=this.bufferController.transferMedia();return this.trigger(A.MEDIA_DETACHING,{transferMedia:t}),t}loadSource(t){this.stopLoad();const e=this.media,i=this._url,s=this._url=Ag.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),e&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(A.MANIFEST_LOADING,{url:t})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(t=-1,e){this.logger.log(`startLoad(${t+(e?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(t,e),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let t=0;t<this.networkControllers.length&&(this.networkControllers[t].stopLoad(),!(this.started||!this.networkControllers));t++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(t=>{t.resumeBuffering&&t.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(t=>{t.pauseBuffering&&t.pauseBuffering()}))}get inFlightFragments(){const t={[mt.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(t[mt.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(t[mt.SUBTITLE]=this.subtititleStreamController.inFlightFrag),t}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const t=this._media,e=t?.currentTime;this.detachMedia(),t&&(this.attachMedia(t),e&&this.startLoad(e))}removeLevel(t){this.levelController.removeLevel(t)}get sessionId(){let t=this._sessionId;return t||(t=this._sessionId=TC()),t}get levels(){const t=this.levelController.levels;return t||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){this.logger.log(`set currentLevel:${t}`),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){this.logger.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){this.logger.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){this.logger.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){const t=this.levelController.startLevel;return t===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t}set startLevel(t){this.logger.log(`set startLevel:${t}`),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}set bandwidthEstimate(t){this.abrController.resetEstimator(t)}get abrEwmaDefaultEstimate(){const{bwEstimator:t}=this.abrController;return t?t.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(this.logger.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){mL(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:e}}=this;if(!t)return 0;const i=t.length;for(let s=0;s<i;s++)if(t[s].maxBitrate>=e)return s;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:e,maxHdcpLevel:i}=this;let s;if(e===-1&&t!=null&&t.length?s=t.length-1:s=e,i)for(let r=s;r--;){const o=t[r].attrs["HDCP-LEVEL"];if(o&&o<=i)return r}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(t){this.abrController.nextAutoLevel=t}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(t){var e;return((e=this.audioTrackController)==null?void 0:e.setAudioOption(t))||null}setSubtitleOption(t){var e;return((e=this.subtitleTrackController)==null?void 0:e.setSubtitleOption(t))||null}get allAudioTracks(){const t=this.audioTrackController;return t?t.allAudioTracks:[]}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const e=this.audioTrackController;e&&(e.audioTrack=t)}get allSubtitleTracks(){const t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return t?t.subtitleDisplay:!1}set subtitleDisplay(t){const e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(t){this.latencyController.targetLatency=t}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(t){this.levelController.pathwayPriority=t}get bufferedToEnd(){var t;return!!((t=this.bufferController)!=null&&t.bufferedToEnd)}get interstitialsManager(){var t;return((t=this.interstitialsController)==null?void 0:t.interstitialsManager)||null}getMediaDecodingInfo(t,e=this.allAudioTracks){const i=uS(e);return lS(t,i,navigator.mediaCapabilities)}}Us.defaultConfig=void 0;const OO=()=>{const[l,t]=Z.useState("home"),[e,i]=Z.useState([]),[s,r]=Z.useState(null),o=Z.useRef();Z.useEffect(()=>{fetch(`http://localhost:3001/cameras?group=${l}`).then(h=>h.json()).then(h=>i(h))},[l]),Z.useEffect(()=>{e.forEach((h,f)=>{const g=document.getElementById(`cam-${f}`);if(!g)return;const m=`http://localhost:8000${h.stream}`;if(Us.isSupported()){const y=new Us;y.loadSource(m),y.attachMedia(g)}else g.canPlayType("application/vnd.apple.mpegurl")&&(g.src=m)})},[e]);const c=h=>{h.target===o.current&&r(null)};return rt.jsxs("div",{className:"w-full flex flex-col px-8 py-6",children:[rt.jsxs("div",{className:"flex justify-between items-center mb-6",children:[rt.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Kameras"}),rt.jsx("button",{className:"btn-pill bg-[#E8E7E4] hover:bg-[#dad9d6]",onClick:()=>t(l==="home"?"firma":"home"),children:l==="home"?"Kameras Firma":"Kameras Home"})]}),rt.jsx("div",{className:"grid grid-cols-3 gap-5",children:e.map((h,f)=>rt.jsxs("div",{className:"relative bg-[#E8E7E4] rounded-2xl shadow-sm overflow-hidden cursor-pointer hover:shadow-md transition-all",onClick:()=>r(h),children:[rt.jsx("video",{id:`cam-${f}`,className:"w-full h-60 object-cover",autoPlay:!0,muted:!0,playsInline:!0,controls:!1}),rt.jsx("div",{className:"absolute bottom-3 left-3 text-xs bg-black/50 text-white px-2 py-1 rounded",children:h.name})]},f))}),s&&rt.jsx("div",{ref:o,className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-6",onClick:c,children:rt.jsxs("div",{className:"relative w-full max-w-5xl max-h-[90vh] rounded-2xl overflow-hidden bg-black shadow-lg",children:[rt.jsx("button",{className:"absolute top-3 right-3 p-2 rounded-full bg-black/50 hover:bg-black/70 transition",onClick:()=>r(null),children:rt.jsx("img",{src:"/assets/icons/smaller.svg",alt:"close",className:"w-5 h-5 invert"})}),rt.jsx("video",{className:"w-full h-full object-contain",autoPlay:!0,muted:!0,playsInline:!0,controls:!0,src:`http://localhost:8000${s.stream}`})]})})]})},wO=[{name:"Aufwachen",iconPath:"/assets/symbols/wakeup.svg",iconPathActive:"/assets/symbols/wakeup-active.svg",postUrl:"/scenes/01"},{name:"Arrive Home",iconPath:"/assets/symbols/arrive.svg",iconPathActive:"/assets/symbols/arrive-active.svg",postUrl:"/scenes/02"},{name:"Leave Home",iconPath:"/assets/symbols/leave.svg",iconPathActive:"/assets/symbols/leave-active.svg",postUrl:"/scenes/03"},{name:"Cinema mode",iconPath:"/assets/symbols/cinema.svg",iconPathActive:"/assets/symbols/cinema-active.svg",postUrl:"/scenes/04"},{name:"Cooking",iconPath:"/assets/symbols/cooking.svg",iconPathActive:"/assets/symbols/cooking-active.svg",postUrl:"/scenes/05"},{name:"Scene 6",iconPath:"",iconPathActive:"",postUrl:"/scenes/06"},{name:"Scene 7",iconPath:"",iconPathActive:"",postUrl:"/scenes/07"},{name:"Scene 8",iconPath:"",iconPathActive:"",postUrl:"/scenes/08"},{name:"Scene 9",iconPath:"",iconPathActive:"",postUrl:"/scenes/09"},{name:"Scene 10",iconPath:"",iconPathActive:"",postUrl:"/scenes/10"}],kO=async l=>{try{const t=`http://192.168.30.113:1880/scenes/${l}`,i=await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:l})})).json();return console.log(`Scene ${i.id} toggled to ${i.status}`),i}catch(t){return console.error("Error toggling scene:",t),null}},MO=()=>{const[l,t]=Z.useState(wO.map((s,r)=>({...s,id:r+1,status:"off"}))),e=(s,r)=>{const o=s.currentTarget;An.to(o,{scale:.75,duration:.08,ease:"power1.out",onComplete:()=>{An.to(o,{scale:1,duration:.04,ease:"elastic.out(1, 0.6)"}),r&&r()}})},i=async s=>{const r=await kO(s.id.toString().padStart(2,"0"));r&&t(o=>o.map(c=>c.id===s.id?{...c,status:r.status}:c))};return rt.jsxs("div",{className:"w-full h-full flex flex-col px-8 py-6",children:[rt.jsx("div",{className:"flex justify-between items-center mb-6",children:rt.jsx("h2",{className:"text-3xl tracking-tight",children:"Scenes"})}),rt.jsx("div",{className:"grid grid-cols-5 gap-4",children:l.map(s=>{const r=s.status==="on",o=r?s.iconPathActive||"/assets/symbols/noimageactive.svg":s.iconPath||"/assets/symbols/noimage.svg";return rt.jsxs("div",{onClick:c=>e(c,()=>i(s)),className:`flex gap-2 items-center justify-start p-3 h-[100px] shadow-xs rounded-2xl cursor-pointer transition-all transform ${r?"bg-[#ffffffee]":"bg-[#dfdedaaa]"}`,children:[rt.jsx("div",{className:"shadow-xs bg-[#b1aeae30] w-14 h-14 flex items-center justify-center rounded-full",children:rt.jsx("img",{src:o,className:"w-8 h-8"})}),rt.jsx("p",{className:"font-medium text-xl leading-tight truncate",children:s.name})]},s.id)})})]})},PO=()=>rt.jsx(i1,{children:rt.jsxs("div",{className:"app flex",children:[rt.jsx(RR,{}),rt.jsx("div",{className:"ml-[130px] flex-1",children:rt.jsx("div",{className:"bg-[#f7f6f3dd] rounded-[30px] overflow-y-auto content-right mr-[25px] mt-[25px] h-[calc(100vh-50px)] p-1",children:rt.jsxs(kb,{children:[rt.jsx(Jn,{path:"/",element:rt.jsx(LR,{})}),rt.jsx(Jn,{path:"/light",element:rt.jsx(DR,{})}),rt.jsx(Jn,{path:"/automation",element:rt.jsx(IR,{})}),rt.jsx(Jn,{path:"/security",element:rt.jsx(wR,{})}),rt.jsx(Jn,{path:"/cameras",element:rt.jsx(OO,{})}),rt.jsx(Jn,{path:"/scenes",element:rt.jsx(MO,{})})]})})})]})});HA.createRoot(document.getElementById("root")).render(rt.jsx(Z.StrictMode,{children:rt.jsx(PO,{})}));
